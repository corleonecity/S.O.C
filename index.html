<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Assessment System | Spezialkräfte</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Code+Pro:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <style>
        /* ===== BASE STYLES ===== */
        :root {
            /* Professional Color Palette */
            --primary: #0052cc;
            --primary-dark: #0747a6;
            --primary-light: #4c9aff;
            --secondary: #de350b;
            --secondary-light: #ff5630;
            --success: #36b37e;
            --warning: #ffab00;
            --danger: #ff5630;
            --info: #00b8d9;
            
            /* Neutrals */
            --gray-0: #ffffff;
            --gray-10: #fafbfc;
            --gray-20: #f4f5f7;
            --gray-30: #ebecf0;
            --gray-40: #dfe1e6;
            --gray-50: #c1c7d0;
            --gray-60: #b3bac5;
            --gray-70: #a5adba;
            --gray-80: #97a0af;
            --gray-90: #8993a4;
            --gray-100: #7a869a;
            --gray-200: #6b778c;
            --gray-300: #5e6c84;
            --gray-400: #505f79;
            --gray-500: #42526e;
            --gray-600: #344563;
            --gray-700: #253858;
            --gray-800: #172b4d;
            --gray-900: #091e42;
            
            /* Typography */
            --font-primary: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            --font-mono: 'Source Code Pro', 'SF Mono', Monaco, Consolas, monospace;
            
            /* Spacing */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-2xl: 48px;
            --space-3xl: 64px;
            
            /* Borders */
            --border-radius-sm: 4px;
            --border-radius-md: 6px;
            --border-radius-lg: 8px;
            --border-radius-xl: 12px;
            
            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.1);
            
            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 250ms ease;
            --transition-slow: 350ms ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            font-size: 16px;
            scroll-behavior: smooth;
        }
        
        body {
            font-family: var(--font-primary);
            font-size: 14px;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-10);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* ===== LAYOUT ===== */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
        }
        
        /* ===== HEADER ===== */
        .app-header {
            grid-column: 1 / -1;
            background: var(--gray-0);
            border-bottom: 1px solid var(--gray-30);
            padding: var(--space-md) var(--space-xl);
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-sm);
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--border-radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .logo-text h1 {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            line-height: 1.2;
        }
        
        .logo-text .subtitle {
            font-size: 12px;
            color: var(--gray-500);
            font-family: var(--font-mono);
            letter-spacing: 0.5px;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-10);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--gray-30);
            transition: var(--transition-fast);
            cursor: pointer;
        }
        
        .user-profile:hover {
            background: var(--gray-20);
        }
        
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-info {
            display: flex;
            flex-direction: column;
        }
        
        .user-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--gray-900);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--gray-500);
        }
        
        /* ===== SIDEBAR ===== */
        .sidebar {
            background: var(--gray-0);
            border-right: 1px solid var(--gray-30);
            padding: var(--space-xl) 0;
            display: flex;
            flex-direction: column;
            height: calc(100vh - 73px);
            position: sticky;
            top: 73px;
        }
        
        .nav-section {
            padding: 0 var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .nav-title {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--gray-500);
            margin-bottom: var(--space-md);
            padding-left: var(--space-sm);
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-sm) var(--space-sm);
            color: var(--gray-700);
            text-decoration: none;
            border-radius: var(--border-radius-md);
            transition: var(--transition-fast);
            margin-bottom: var(--space-xs);
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: var(--gray-10);
            color: var(--gray-900);
        }
        
        .nav-item.active {
            background: var(--primary-light);
            color: var(--primary-dark);
            font-weight: 500;
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
            font-size: 16px;
        }
        
        /* Search */
        .search-container {
            padding: 0 var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .search-box {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: var(--space-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray-400);
            font-size: 16px;
        }
        
        .search-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md) var(--space-sm) 40px;
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            color: var(--gray-800);
            transition: var(--transition-fast);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.1);
            background: var(--gray-0);
        }
        
        /* Patient List */
        .patient-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 var(--space-xl);
        }
        
        .patient-item {
            padding: var(--space-md);
            background: var(--gray-0);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            margin-bottom: var(--space-sm);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .patient-item:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-sm);
        }
        
        .patient-item.selected {
            border-color: var(--primary);
            background: var(--gray-10);
            box-shadow: 0 0 0 1px var(--primary);
        }
        
        .patient-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-xs);
        }
        
        .patient-name {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 14px;
        }
        
        .patient-id {
            font-family: var(--font-mono);
            font-size: 11px;
            color: var(--gray-500);
            background: var(--gray-10);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .patient-details {
            font-size: 12px;
            color: var(--gray-600);
            margin-bottom: var(--space-sm);
        }
        
        .patient-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .status-completed {
            background: rgba(54, 179, 126, 0.1);
            color: var(--success);
        }
        
        .status-pending {
            background: rgba(255, 171, 0, 0.1);
            color: var(--warning);
        }
        
        .status-critical {
            background: rgba(255, 86, 48, 0.1);
            color: var(--danger);
        }
        
        /* New Patient Button */
        .new-patient-section {
            padding: var(--space-xl);
            border-top: 1px solid var(--gray-30);
            margin-top: auto;
        }
        
        .btn-new {
            width: 100%;
            padding: var(--space-md);
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            transition: var(--transition-fast);
        }
        
        .btn-new:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== MAIN CONTENT ===== */
        .main-content {
            padding: var(--space-xl);
            overflow-y: auto;
            height: calc(100vh - 73px);
        }
        
        /* Content Header */
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-xl);
            padding-bottom: var(--space-md);
            border-bottom: 1px solid var(--gray-30);
        }
        
        .patient-info h2 {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }
        
        .patient-meta {
            display: flex;
            gap: var(--space-xl);
            font-size: 13px;
            color: var(--gray-600);
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }
        
        .meta-item i {
            color: var(--gray-400);
            font-size: 16px;
        }
        
        .action-buttons {
            display: flex;
            gap: var(--space-sm);
        }
        
        /* Tabs */
        .tabs-container {
            margin-bottom: var(--space-xl);
        }
        
        .tabs {
            display: flex;
            gap: 2px;
            background: var(--gray-10);
            border-radius: var(--border-radius-md);
            padding: 4px;
            border: 1px solid var(--gray-30);
        }
        
        .tab {
            flex: 1;
            padding: var(--space-sm) var(--space-md);
            background: transparent;
            border: none;
            border-radius: var(--border-radius-sm);
            font-size: 13px;
            font-weight: 500;
            color: var(--gray-600);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            min-width: 140px;
        }
        
        .tab:hover {
            color: var(--gray-900);
            background: var(--gray-20);
        }
        
        .tab.active {
            background: var(--gray-0);
            color: var(--gray-900);
            box-shadow: var(--shadow-sm);
        }
        
        .tab-badge {
            background: var(--gray-200);
            color: var(--gray-0);
            font-size: 11px;
            padding: 1px 6px;
            border-radius: 10px;
            min-width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tab.active .tab-badge {
            background: var(--primary);
        }
        
        /* Tab Content */
        .tab-content {
            background: var(--gray-0);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-sm);
        }
        
        /* Section */
        .section {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--gray-30);
        }
        
        .section:last-child {
            border-bottom: none;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-xl);
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--gray-900);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .section-title i {
            color: var(--primary);
            font-size: 20px;
        }
        
        .section-badge {
            background: var(--gray-10);
            color: var(--gray-600);
            font-size: 11px;
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid var(--gray-30);
        }
        
        /* Questions Grid */
        .questions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: var(--space-md);
        }
        
        .question-group {
            margin-bottom: var(--space-lg);
        }
        
        .question-label {
            font-weight: 500;
            color: var(--gray-800);
            margin-bottom: var(--space-sm);
            font-size: 14px;
            line-height: 1.5;
        }
        
        .question-input {
            width: 100%;
            padding: var(--space-md);
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            color: var(--gray-900);
            font-family: var(--font-primary);
            resize: vertical;
            min-height: 80px;
            transition: var(--transition-fast);
        }
        
        .question-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.1);
            background: var(--gray-0);
        }
        
        .question-select {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            color: var(--gray-900);
            transition: var(--transition-fast);
            cursor: pointer;
        }
        
        .question-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.1);
            background: var(--gray-0);
        }
        
        /* Vital Parameters */
        .vital-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: var(--space-md);
            margin-bottom: var(--space-xl);
        }
        
        .vital-card {
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            padding: var(--space-md);
            transition: var(--transition-fast);
        }
        
        .vital-card:hover {
            border-color: var(--primary-light);
            box-shadow: var(--shadow-sm);
        }
        
        .vital-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-sm);
        }
        
        .vital-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-sm);
        }
        
        .vital-input {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-0);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            color: var(--gray-900);
            text-align: center;
            transition: var(--transition-fast);
        }
        
        .vital-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.1);
        }
        
        .vital-status {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 10px;
            margin-top: var(--space-xs);
        }
        
        /* Analysis */
        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: var(--space-md);
            margin-top: var(--space-lg);
        }
        
        .analysis-card {
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            padding: var(--space-md);
            text-align: center;
        }
        
        .analysis-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-xs);
        }
        
        .analysis-label {
            font-size: 11px;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* Summary */
        .summary-section {
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            padding: var(--space-xl);
            margin-top: var(--space-xl);
        }
        
        .summary-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: var(--space-md);
        }
        
        /* Notes */
        .notes-container {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .note-item {
            background: var(--gray-10);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            padding: var(--space-md);
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-sm);
        }
        
        .note-author {
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .note-time {
            font-size: 11px;
            color: var(--gray-500);
        }
        
        .note-content {
            color: var(--gray-700);
            line-height: 1.6;
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid transparent;
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        .btn-secondary {
            background: var(--gray-0);
            color: var(--gray-700);
            border-color: var(--gray-30);
        }
        
        .btn-secondary:hover {
            background: var(--gray-10);
            color: var(--gray-800);
        }
        
        .btn-danger {
            background: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        .btn-danger:hover {
            background: var(--secondary);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }
        
        /* ===== MODALS ===== */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(9, 30, 66, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--space-xl);
            backdrop-filter: blur(4px);
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: var(--gray-0);
            border-radius: var(--border-radius-lg);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease;
        }
        
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .modal-header {
            padding: var(--space-xl);
            border-bottom: 1px solid var(--gray-30);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--gray-900);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--gray-400);
            font-size: 20px;
            cursor: pointer;
            padding: var(--space-xs);
            border-radius: var(--border-radius-sm);
            transition: var(--transition-fast);
        }
        
        .modal-close:hover {
            background: var(--gray-10);
            color: var(--gray-600);
        }
        
        .modal-body {
            padding: var(--space-xl);
            overflow-y: auto;
            flex: 1;
        }
        
        .modal-footer {
            padding: var(--space-xl);
            border-top: 1px solid var(--gray-30);
            display: flex;
            justify-content: flex-end;
            gap: var(--space-sm);
        }
        
        /* Form Groups */
        .form-group {
            margin-bottom: var(--space-lg);
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            color: var(--gray-700);
            margin-bottom: var(--space-xs);
            font-size: 14px;
        }
        
        .form-control {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            background: var(--gray-0);
            border: 1px solid var(--gray-30);
            border-radius: var(--border-radius-md);
            font-size: 14px;
            color: var(--gray-900);
            transition: var(--transition-fast);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(0, 82, 204, 0.1);
        }
        
        /* ===== UTILITIES ===== */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .badge-success {
            background: rgba(54, 179, 126, 0.1);
            color: var(--success);
        }
        
        .badge-warning {
            background: rgba(255, 171, 0, 0.1);
            color: var(--warning);
        }
        
        .badge-danger {
            background: rgba(255, 86, 48, 0.1);
            color: var(--danger);
        }
        
        .badge-info {
            background: rgba(0, 184, 217, 0.1);
            color: var(--info);
        }
        
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-danger { color: var(--danger); }
        .text-info { color: var(--info); }
        .text-muted { color: var(--gray-500); }
        
        .empty-state {
            text-align: center;
            padding: var(--space-3xl) var(--space-xl);
            color: var(--gray-500);
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: var(--space-md);
            opacity: 0.3;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: var(--space-3xl);
            color: var(--gray-400);
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-200);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: var(--space-sm);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 1200px) {
            .questions-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .content-header {
                flex-direction: column;
                gap: var(--space-md);
            }
            
            .patient-meta {
                flex-wrap: wrap;
                gap: var(--space-md);
            }
            
            .tabs {
                overflow-x: auto;
                padding-bottom: 4px;
            }
            
            .tab {
                min-width: 120px;
            }
        }
        
        /* ===== PRINT STYLES ===== */
        @media print {
            .app-header,
            .sidebar,
            .action-buttons,
            .tabs-container {
                display: none;
            }
            
            .app-container {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 0;
                height: auto;
            }
            
            .tab-content {
                border: none;
                box-shadow: none;
            }
            
            .section {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-user-md"></i>
                </div>
                <div class="logo-text">
                    <h1>Medical Assessment System</h1>
                    <div class="subtitle">Spezialkräfte • Vertraulich</div>
                </div>
            </div>
            
            <div class="header-actions">
                <div class="user-profile" onclick="openUserMenu()">
                    <div class="user-avatar">AM</div>
                    <div class="user-info">
                        <div class="user-name">Dr. Alexander Miller</div>
                        <div class="user-role">Chief Medical Officer</div>
                    </div>
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
        </header>
        
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Navigation -->
            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <div class="nav-item active" onclick="switchTab('dashboard')">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </div>
                <div class="nav-item" onclick="switchTab('assessments')">
                    <i class="fas fa-clipboard-check"></i>
                    <span>Assessments</span>
                    <span class="tab-badge">4</span>
                </div>
                <div class="nav-item" onclick="switchTab('patients')">
                    <i class="fas fa-users"></i>
                    <span>Patients</span>
                </div>
                <div class="nav-item" onclick="switchTab('reports')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Reports</span>
                </div>
            </div>
            
            <!-- Search -->
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search patients..." id="searchInput">
                </div>
            </div>
            
            <!-- Patient List -->
            <div class="nav-section">
                <div class="nav-title">Active Assessments</div>
                <div class="patient-list" id="patientList">
                    <!-- Patient items will be loaded here -->
                </div>
            </div>
            
            <!-- New Patient Button -->
            <div class="new-patient-section">
                <button class="btn-new" onclick="openNewPatientModal()">
                    <i class="fas fa-plus"></i>
                    New Assessment
                </button>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content" id="mainContent">
            <!-- Content will be loaded dynamically -->
            <div class="empty-state">
                <i class="fas fa-clipboard-list"></i>
                <h3>Select a patient to begin assessment</h3>
                <p>Choose from the list on the left or create a new assessment</p>
            </div>
        </main>
    </div>
    
    <!-- New Patient Modal -->
    <div class="modal-overlay" id="newPatientModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">New Patient Assessment</h2>
                <button class="modal-close" onclick="closeModal('newPatientModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">First Name</label>
                    <input type="text" class="form-control" id="patientFirstName">
                </div>
                <div class="form-group">
                    <label class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="patientLastName">
                </div>
                <div class="form-group">
                    <label class="form-label">Rank</label>
                    <select class="form-control" id="patientRank">
                        <option value="">Select rank</option>
                        <option value="Private">Private</option>
                        <option value="Corporal">Corporal</option>
                        <option value="Sergeant">Sergeant</option>
                        <option value="Lieutenant">Lieutenant</option>
                        <option value="Captain">Captain</option>
                        <option value="Major">Major</option>
                        <option value="Colonel">Colonel</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Unit</label>
                    <select class="form-control" id="patientUnit">
                        <option value="">Select unit</option>
                        <option value="Delta Force">Delta Force</option>
                        <option value="Navy SEALs">Navy SEALs</option>
                        <option value="Special Forces">Special Forces</option>
                        <option value="Air Force SpecOps">Air Force SpecOps</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('newPatientModal')">Cancel</button>
                <button class="btn btn-primary" onclick="createPatient()">Create Assessment</button>
            </div>
        </div>
    </div>
    
    <!-- Assessment Template -->
    <template id="assessmentTemplate">
        <div class="content-header">
            <div class="patient-info">
                <h2 id="assessmentPatientName">John Miller (Major)</h2>
                <div class="patient-meta">
                    <div class="meta-item">
                        <i class="fas fa-id-card"></i>
                        <span id="assessmentPatientId">PT-2024-001</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-users"></i>
                        <span id="assessmentPatientUnit">Delta Force</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-calendar"></i>
                        <span id="assessmentDate">Today, 10:30 AM</span>
                    </div>
                    <div class="meta-item">
                        <i class="fas fa-user-md"></i>
                        <span id="assessmentExaminer">Dr. Alexander Miller</span>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="saveAssessment()">
                    <i class="fas fa-save"></i> Save
                </button>
                <button class="btn btn-primary" onclick="generateReport()">
                    <i class="fas fa-file-pdf"></i> Export
                </button>
                <button class="btn btn-danger" onclick="deleteAssessment()">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
        
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="psychology">
                    <i class="fas fa-brain"></i> Psychology
                    <span class="tab-badge" id="psychBadge">0</span>
                </button>
                <button class="tab" data-tab="medical">
                    <i class="fas fa-heartbeat"></i> Medical
                    <span class="tab-badge" id="medBadge">0</span>
                </button>
                <button class="tab" data-tab="vitals">
                    <i class="fas fa-chart-line"></i> Vitals
                    <span class="tab-badge" id="vitalBadge">0</span>
                </button>
                <button class="tab" data-tab="summary">
                    <i class="fas fa-clipboard-check"></i> Summary
                </button>
            </div>
        </div>
        
        <div class="tab-content">
            <!-- Psychology Tab -->
            <div class="tab-pane active" id="psychologyTab">
                <!-- Psychology content will be loaded here -->
            </div>
            
            <!-- Medical Tab -->
            <div class="tab-pane" id="medicalTab" style="display: none;">
                <!-- Medical content will be loaded here -->
            </div>
            
            <!-- Vitals Tab -->
            <div class="tab-pane" id="vitalsTab" style="display: none;">
                <!-- Vitals content will be loaded here -->
            </div>
            
            <!-- Summary Tab -->
            <div class="tab-pane" id="summaryTab" style="display: none;">
                <!-- Summary content will be loaded here -->
            </div>
        </div>
    </template>
    
    <script>
        // ===== STATE MANAGEMENT =====
        let currentUser = {
            name: "Dr. Alexander Miller",
            role: "Chief Medical Officer",
            email: "a.miller@medical.mil"
        };
        
        let currentPatient = null;
        let patients = [];
        let assessments = new Map();
        let autoSaveTimeout = null;
        
        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSampleData();
            setupEventListeners();
        });
        
        function initializeApp() {
            // Set current user
            updateUserDisplay();
            
            // Setup search
            document.getElementById('searchInput').addEventListener('input', function(e) {
                filterPatients(e.target.value);
            });
        }
        
        function loadSampleData() {
            // Sample patients
            patients = [
                {
                    id: "PT-2024-001",
                    firstName: "John",
                    lastName: "Miller",
                    fullName: "John Miller",
                    rank: "Major",
                    unit: "Delta Force",
                    status: "pending",
                    createdAt: new Date(),
                    examiner: "Dr. Alexander Miller",
                    vitals: {
                        pulse: 72,
                        bpHigh: 125,
                        bpLow: 85,
                        temperature: 36.8,
                        respiration: 16,
                        oxygen: 98,
                        height: 182,
                        weight: 85
                    }
                },
                {
                    id: "PT-2024-002",
                    firstName: "Sarah",
                    lastName: "Connor",
                    fullName: "Sarah Connor",
                    rank: "Captain",
                    unit: "Air Force SpecOps",
                    status: "completed",
                    createdAt: new Date(Date.now() - 86400000),
                    examiner: "Dr. Alexander Miller",
                    vitals: {
                        pulse: 68,
                        bpHigh: 118,
                        bpLow: 78,
                        temperature: 36.5,
                        respiration: 14,
                        oxygen: 99,
                        height: 175,
                        weight: 68
                    }
                },
                {
                    id: "PT-2024-003",
                    firstName: "Michael",
                    lastName: "Rodriguez",
                    fullName: "Michael Rodriguez",
                    rank: "Sergeant",
                    unit: "Navy SEALs",
                    status: "critical",
                    createdAt: new Date(Date.now() - 172800000),
                    examiner: "Dr. James Wilson",
                    vitals: {
                        pulse: 92,
                        bpHigh: 145,
                        bpLow: 95,
                        temperature: 37.8,
                        respiration: 22,
                        oxygen: 92,
                        height: 188,
                        weight: 95
                    }
                }
            ];
            
            renderPatientList();
        }
        
        function setupEventListeners() {
            // Auto-save
            document.addEventListener('input', debounce(function(e) {
                if (currentPatient && e.target.classList.contains('question-input')) {
                    autoSave();
                }
            }, 1500));
            
            // Tab switching
            document.addEventListener('click', function(e) {
                if (e.target.closest('.tab')) {
                    const tab = e.target.closest('.tab');
                    const tabName = tab.getAttribute('data-tab');
                    switchAssessmentTab(tabName);
                }
            });
        }
        
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // ===== PATIENT MANAGEMENT =====
        function renderPatientList() {
            const container = document.getElementById('patientList');
            container.innerHTML = '';
            
            patients.forEach(patient => {
                const item = document.createElement('div');
                item.className = `patient-item ${currentPatient?.id === patient.id ? 'selected' : ''}`;
                item.onclick = () => selectPatient(patient);
                
                const statusClass = patient.status === 'completed' ? 'status-completed' :
                                  patient.status === 'pending' ? 'status-pending' : 'status-critical';
                
                item.innerHTML = `
                    <div class="patient-header">
                        <div class="patient-name">${patient.fullName}</div>
                        <div class="patient-id">${patient.id}</div>
                    </div>
                    <div class="patient-details">
                        ${patient.rank} • ${patient.unit}
                    </div>
                    <div class="${statusClass} patient-status">
                        <i class="fas fa-circle"></i>
                        ${patient.status.charAt(0).toUpperCase() + patient.status.slice(1)}
                    </div>
                `;
                
                container.appendChild(item);
            });
        }
        
        function filterPatients(searchTerm) {
            const items = document.querySelectorAll('.patient-item');
            const term = searchTerm.toLowerCase();
            
            items.forEach(item => {
                const text = item.textContent.toLowerCase();
                item.style.display = text.includes(term) ? 'block' : 'none';
            });
        }
        
        function selectPatient(patient) {
            currentPatient = patient;
            
            // Update UI
            document.querySelectorAll('.patient-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Load assessment
            loadAssessment(patient);
        }
        
        // ===== ASSESSMENT MANAGEMENT =====
        function loadAssessment(patient) {
            const mainContent = document.getElementById('mainContent');
            const template = document.getElementById('assessmentTemplate').content.cloneNode(true);
            
            mainContent.innerHTML = '';
            mainContent.appendChild(template);
            
            // Update patient info
            document.getElementById('assessmentPatientName').textContent = 
                `${patient.fullName} (${patient.rank})`;
            document.getElementById('assessmentPatientId').textContent = patient.id;
            document.getElementById('assessmentPatientUnit').textContent = patient.unit;
            document.getElementById('assessmentDate').textContent = 
                new Date(patient.createdAt).toLocaleString('de-DE', {
                    weekday: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            document.getElementById('assessmentExaminer').textContent = patient.examiner;
            
            // Load assessment data
            if (assessments.has(patient.id)) {
                const assessment = assessments.get(patient.id);
                loadAssessmentData(assessment);
            } else {
                // Initialize empty assessment
                const assessment = {
                    psychology: {},
                    medical: {},
                    vitals: patient.vitals || {},
                    summary: {}
                };
                assessments.set(patient.id, assessment);
                loadAssessmentData(assessment);
            }
            
            // Render psychology tab first
            renderPsychologyTab();
            updateTabBadges();
        }
        
        function loadAssessmentData(assessment) {
            // This function would load data into forms
            // Implementation depends on your data structure
        }
        
        function renderPsychologyTab() {
            const tabContent = document.getElementById('psychologyTab');
            
            const psychologyQuestions = [
                {
                    section: "Persönlichkeit & Hintergrund",
                    questions: [
                        "Wie würden Sie Ihre wichtigsten Charaktereigenschaften beschreiben?",
                        "Gab es in Ihrem Leben Ereignisse, die Sie nachhaltig geprägt haben?",
                        "Welche Ziele verfolgen Sie langfristig in Ihrem Leben?"
                    ]
                },
                {
                    section: "Emotionale Stabilität",
                    questions: [
                        "Wie reagieren Sie, wenn Sie plötzlich unter starken Druck geraten?",
                        "Haben Sie Schwierigkeiten, wieder zur Ruhe zu kommen, wenn Sie gestresst sind?",
                        "Haben Sie Albträume oder Schlafstörungen?",
                        "Können Sie starke negative Gefühle bewusst kontrollieren?"
                    ]
                },
                {
                    section: "Aggressionskontrolle",
                    questions: [
                        "Wie gehen Sie mit Situationen um, in denen Sie wütend werden?",
                        "Haben Sie schon einmal die Kontrolle über Ihr Verhalten verloren?",
                        "Können Sie in Konflikten ruhig bleiben, selbst wenn Sie provoziert werden?",
                        "Was war die schwierigste Situation, in der Sie Ihre Aggressionen beherrschen mussten?",
                        "Wie reagieren Sie auf Respektlosigkeit oder Beleidigungen?"
                    ]
                }
            ];
            
            let html = '';
            
            psychologyQuestions.forEach((section, sectionIndex) => {
                html += `
                    <div class="section">
                        <div class="section-header">
                            <div class="section-title">
                                <i class="fas fa-${sectionIndex === 0 ? 'user' : sectionIndex === 1 ? 'brain' : 'angry'}"></i>
                                ${section.section}
                            </div>
                            <div class="section-badge">Section ${sectionIndex + 1}</div>
                        </div>
                        <div class="questions-grid">
                `;
                
                section.questions.forEach((question, questionIndex) => {
                    html += `
                        <div class="question-group">
                            <div class="question-label">
                                ${question}
                            </div>
                            <textarea class="question-input" 
                                      data-section="psychology" 
                                      data-question="${sectionIndex + 1}.${questionIndex + 1}"
                                      placeholder="Enter response..."></textarea>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            tabContent.innerHTML = html;
        }
        
        function renderMedicalTab() {
            const tabContent = document.getElementById('medicalTab');
            
            const medicalQuestions = [
                "Nehmen Sie regelmäßig Medikamente ein?",
                "Haben Sie in letzter Zeit Gewichtsab-/Zunahme bemerkt?",
                "Haben Sie in der Vergangenheit Knochenbrüche, Operationen oder schwere Verletzungen erlitten?",
                "Wurden Sie jemals ohnmächtig oder haben Sie Bewusstseinsverluste erlebt?",
                "Haben Sie Probleme mit dem Gleichgewicht, Schwindel oder Koordinationsstörungen?",
                "Konsumieren Sie Alkohol oder andere psychoaktive Stoffe?",
                "Wurden Sie jemals wegen Drogen- oder Alkoholmissbrauchs behandelt?",
                "Gibt es in Ihrer Familie bekannte Suchterkrankungen?"
            ];
            
            let html = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-file-medical"></i>
                            Medical History
                        </div>
                        <div class="section-badge">Section 3</div>
                    </div>
                    <div class="questions-grid">
            `;
            
            medicalQuestions.forEach((question, index) => {
                html += `
                    <div class="question-group">
                        <div class="question-label">
                            ${question}
                        </div>
                        <textarea class="question-input" 
                                  data-section="medical" 
                                  data-question="med${index + 1}"
                                  placeholder="Enter response..."></textarea>
                    </div>
                `;
            });
            
            html += `
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-heartbeat"></i>
                            Vital Parameters
                        </div>
                    </div>
                    <div class="vital-grid">
                        <div class="vital-card">
                            <div class="vital-label">Pulse (bpm)</div>
                            <div class="vital-value" id="displayPulse">-</div>
                            <input type="number" class="vital-input" id="inputPulse" placeholder="Enter value" 
                                   min="40" max="200" oninput="updateVitalDisplay('pulse')">
                            <div class="vital-status badge-success" id="pulseStatus">Normal</div>
                        </div>
                        
                        <div class="vital-card">
                            <div class="vital-label">Blood Pressure</div>
                            <div class="vital-value" id="displayBP">-</div>
                            <div style="display: flex; gap: 8px;">
                                <input type="number" class="vital-input" id="inputBPHigh" placeholder="Systolic" 
                                       style="flex: 1;" oninput="updateVitalDisplay('bp')">
                                <span style="color: var(--gray-400); align-self: center;">/</span>
                                <input type="number" class="vital-input" id="inputBPLow" placeholder="Diastolic" 
                                       style="flex: 1;" oninput="updateVitalDisplay('bp')">
                            </div>
                            <div class="vital-status badge-success" id="bpStatus">Normal</div>
                        </div>
                        
                        <div class="vital-card">
                            <div class="vital-label">Temperature (°C)</div>
                            <div class="vital-value" id="displayTemp">-</div>
                            <input type="number" class="vital-input" id="inputTemp" placeholder="Enter value" 
                                   min="35" max="42" step="0.1" oninput="updateVitalDisplay('temp')">
                            <div class="vital-status badge-success" id="tempStatus">Normal</div>
                        </div>
                        
                        <div class="vital-card">
                            <div class="vital-label">Respiration (/min)</div>
                            <div class="vital-value" id="displayResp">-</div>
                            <input type="number" class="vital-input" id="inputResp" placeholder="Enter value" 
                                   min="8" max="40" oninput="updateVitalDisplay('resp')">
                            <div class="vital-status badge-success" id="respStatus">Normal</div>
                        </div>
                    </div>
                </div>
            `;
            
            tabContent.innerHTML = html;
            
            // Load existing vital values
            if (currentPatient && currentPatient.vitals) {
                const v = currentPatient.vitals;
                if (v.pulse) {
                    document.getElementById('inputPulse').value = v.pulse;
                    updateVitalDisplay('pulse');
                }
                if (v.bpHigh && v.bpLow) {
                    document.getElementById('inputBPHigh').value = v.bpHigh;
                    document.getElementById('inputBPLow').value = v.bpLow;
                    updateVitalDisplay('bp');
                }
                if (v.temperature) {
                    document.getElementById('inputTemp').value = v.temperature;
                    updateVitalDisplay('temp');
                }
                if (v.respiration) {
                    document.getElementById('inputResp').value = v.respiration;
                    updateVitalDisplay('resp');
                }
            }
        }
        
        function renderSummaryTab() {
            const tabContent = document.getElementById('summaryTab');
            
            const html = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fas fa-clipboard-check"></i>
                            Assessment Summary
                        </div>
                    </div>
                    
                    <div class="question-group">
                        <div class="question-label">Overall Assessment</div>
                        <textarea class="question-input" id="summaryOverall" 
                                  placeholder="Enter overall assessment and key findings..." 
                                  style="min-height: 120px;"></textarea>
                    </div>
                    
                    <div class="questions-grid">
                        <div class="question-group">
                            <div class="question-label">Psychological Evaluation</div>
                            <textarea class="question-input" id="summaryPsych" 
                                      placeholder="Psychological evaluation..."></textarea>
                        </div>
                        
                        <div class="question-group">
                            <div class="question-label">Medical Evaluation</div>
                            <textarea class="question-input" id="summaryMedical" 
                                      placeholder="Medical evaluation..."></textarea>
                        </div>
                        
                        <div class="question-group">
                            <div class="question-label">Recommendation</div>
                            <select class="question-select" id="summaryRecommendation">
                                <option value="">Select recommendation</option>
                                <option value="fully_fit">Fully operational</option>
                                <option value="limited">Limited operational</option>
                                <option value="not_fit">Not operational</option>
                                <option value="further_eval">Further evaluation needed</option>
                            </select>
                        </div>
                        
                        <div class="question-group">
                            <div class="question-label">Follow-up Actions</div>
                            <textarea class="question-input" id="summaryActions" 
                                      placeholder="Recommended follow-up actions..."></textarea>
                        </div>
                    </div>
                    
                    <div class="summary-section">
                        <div class="summary-title">Examiner's Conclusion</div>
                        <div class="question-group">
                            <div class="question-label">Signature</div>
                            <input type="text" class="question-input" id="summarySignature" 
                                   placeholder="Name and rank" style="min-height: auto;">
                        </div>
                    </div>
                </div>
            `;
            
            tabContent.innerHTML = html;
        }
        
        // ===== VITAL PARAMETERS =====
        function updateVitalDisplay(type) {
            let value, displayElement, statusElement;
            
            switch(type) {
                case 'pulse':
                    value = parseInt(document.getElementById('inputPulse').value);
                    displayElement = document.getElementById('displayPulse');
                    statusElement = document.getElementById('pulseStatus');
                    
                    if (value) {
                        displayElement.textContent = value;
                        if (value >= 60 && value <= 100) {
                            statusElement.textContent = 'Normal';
                            statusElement.className = 'vital-status badge-success';
                        } else if (value < 60) {
                            statusElement.textContent = 'Low';
                            statusElement.className = 'vital-status badge-warning';
                        } else {
                            statusElement.textContent = 'High';
                            statusElement.className = 'vital-status badge-danger';
                        }
                    } else {
                        displayElement.textContent = '-';
                        statusElement.textContent = 'Not set';
                        statusElement.className = 'vital-status';
                    }
                    break;
                    
                case 'bp':
                    const high = parseInt(document.getElementById('inputBPHigh').value);
                    const low = parseInt(document.getElementById('inputBPLow').value);
                    displayElement = document.getElementById('displayBP');
                    statusElement = document.getElementById('bpStatus');
                    
                    if (high && low) {
                        displayElement.textContent = `${high}/${low}`;
                        if (high >= 110 && high <= 140 && low >= 60 && low <= 90) {
                            statusElement.textContent = 'Normal';
                            statusElement.className = 'vital-status badge-success';
                        } else if (high < 110 || low < 60) {
                            statusElement.textContent = 'Low';
                            statusElement.className = 'vital-status badge-warning';
                        } else {
                            statusElement.textContent = 'High';
                            statusElement.className = 'vital-status badge-danger';
                        }
                    } else {
                        displayElement.textContent = '-';
                        statusElement.textContent = 'Not set';
                        statusElement.className = 'vital-status';
                    }
                    break;
                    
                case 'temp':
                    value = parseFloat(document.getElementById('inputTemp').value);
                    displayElement = document.getElementById('displayTemp');
                    statusElement = document.getElementById('tempStatus');
                    
                    if (value) {
                        displayElement.textContent = value;
                        if (value >= 36.1 && value <= 37.5) {
                            statusElement.textContent = 'Normal';
                            statusElement.className = 'vital-status badge-success';
                        } else if (value < 36) {
                            statusElement.textContent = 'Low';
                            statusElement.className = 'vital-status badge-warning';
                        } else {
                            statusElement.textContent = 'Fever';
                            statusElement.className = 'vital-status badge-danger';
                        }
                    } else {
                        displayElement.textContent = '-';
                        statusElement.textContent = 'Not set';
                        statusElement.className = 'vital-status';
                    }
                    break;
                    
                case 'resp':
                    value = parseInt(document.getElementById('inputResp').value);
                    displayElement = document.getElementById('displayResp');
                    statusElement = document.getElementById('respStatus');
                    
                    if (value) {
                        displayElement.textContent = value;
                        if (value >= 12 && value <= 20) {
                            statusElement.textContent = 'Normal';
                            statusElement.className = 'vital-status badge-success';
                        } else if (value < 12) {
                            statusElement.textContent = 'Low';
                            statusElement.className = 'vital-status badge-warning';
                        } else {
                            statusElement.textContent = 'High';
                            statusElement.className = 'vital-status badge-danger';
                        }
                    } else {
                        displayElement.textContent = '-';
                        statusElement.textContent = 'Not set';
                        statusElement.className = 'vital-status';
                    }
                    break;
            }
            
            autoSave();
        }
        
        // ===== TAB MANAGEMENT =====
        function switchAssessmentTab(tabName) {
            // Update active tab
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Hide all tab panes
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.style.display = 'none';
            });
            
            // Show selected tab
            const tabPane = document.getElementById(`${tabName}Tab`);
            if (tabPane) {
                tabPane.style.display = 'block';
                
                // Load content if empty
                if (tabPane.innerHTML === '' && currentPatient) {
                    switch(tabName) {
                        case 'psychology':
                            renderPsychologyTab();
                            break;
                        case 'medical':
                            renderMedicalTab();
                            break;
                        case 'summary':
                            renderSummaryTab();
                            break;
                    }
                }
            }
        }
        
        function updateTabBadges() {
            if (!currentPatient) return;
            
            // Count answered questions
            const psychInputs = document.querySelectorAll('[data-section="psychology"]');
            const psychAnswered = Array.from(psychInputs).filter(input => input.value.trim() !== '').length;
            
            const medInputs = document.querySelectorAll('[data-section="medical"]');
            const medAnswered = Array.from(medInputs).filter(input => input.value.trim() !== '').length;
            
            // Update badges
            const psychBadge = document.getElementById('psychBadge');
            const medBadge = document.getElementById('medBadge');
            
            if (psychBadge) {
                psychBadge.textContent = psychAnswered;
                psychBadge.style.display = psychAnswered > 0 ? 'flex' : 'none';
            }
            
            if (medBadge) {
                medBadge.textContent = medAnswered;
                medBadge.style.display = medAnswered > 0 ? 'flex' : 'none';
            }
        }
        
        // ===== MODAL FUNCTIONS =====
        function openNewPatientModal() {
            document.getElementById('newPatientModal').classList.add('active');
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        
        function createPatient() {
            const firstName = document.getElementById('patientFirstName').value.trim();
            const lastName = document.getElementById('patientLastName').value.trim();
            const rank = document.getElementById('patientRank').value;
            const unit = document.getElementById('patientUnit').value;
            
            if (!firstName || !lastName || !rank || !unit) {
                alert('Please fill all required fields');
                return;
            }
            
            const patientId = `PT-${new Date().getFullYear()}-${String(patients.length + 1).padStart(3, '0')}`;
            
            const newPatient = {
                id: patientId,
                firstName: firstName,
                lastName: lastName,
                fullName: `${firstName} ${lastName}`,
                rank: rank,
                unit: unit,
                status: 'pending',
                createdAt: new Date(),
                examiner: currentUser.name,
                vitals: {}
            };
            
            patients.unshift(newPatient);
            
            closeModal('newPatientModal');
            renderPatientList();
            selectPatient(newPatient);
            
            // Clear form
            document.getElementById('patientFirstName').value = '';
            document.getElementById('patientLastName').value = '';
            document.getElementById('patientRank').value = '';
            document.getElementById('patientUnit').value = '';
        }
        
        // ===== SAVE & EXPORT =====
        function autoSave() {
            if (!currentPatient) return;
            
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            autoSaveTimeout = setTimeout(() => {
                saveAssessment(true);
            }, 2000);
        }
        
        function saveAssessment(isAutoSave = false) {
            if (!currentPatient) return;
            
            // Collect all data
            const assessment = {
                psychology: collectSectionData('psychology'),
                medical: collectSectionData('medical'),
                vitals: collectVitalData(),
                summary: collectSummaryData(),
                lastUpdated: new Date()
            };
            
            // Save to state
            assessments.set(currentPatient.id, assessment);
            
            // Update UI
            const saveBtn = document.querySelector('.btn-secondary');
            if (saveBtn && !isAutoSave) {
                const originalHTML = saveBtn.innerHTML;
                saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
                saveBtn.style.background = 'var(--success)';
                saveBtn.style.borderColor = 'var(--success)';
                
                setTimeout(() => {
                    saveBtn.innerHTML = originalHTML;
                    saveBtn.style.background = '';
                    saveBtn.style.borderColor = '';
                }, 2000);
            }
            
            updateTabBadges();
        }
        
        function collectSectionData(section) {
            const data = {};
            const inputs = document.querySelectorAll(`[data-section="${section}"]`);
            
            inputs.forEach(input => {
                const question = input.getAttribute('data-question');
                if (question && input.value.trim()) {
                    data[question] = input.value.trim();
                }
            });
            
            return data;
        }
        
        function collectVitalData() {
            return {
                pulse: parseInt(document.getElementById('inputPulse')?.value) || null,
                bpHigh: parseInt(document.getElementById('inputBPHigh')?.value) || null,
                bpLow: parseInt(document.getElementById('inputBPLow')?.value) || null,
                temperature: parseFloat(document.getElementById('inputTemp')?.value) || null,
                respiration: parseInt(document.getElementById('inputResp')?.value) || null
            };
        }
        
        function collectSummaryData() {
            return {
                overall: document.getElementById('summaryOverall')?.value.trim() || '',
                psych: document.getElementById('summaryPsych')?.value.trim() || '',
                medical: document.getElementById('summaryMedical')?.value.trim() || '',
                recommendation: document.getElementById('summaryRecommendation')?.value || '',
                actions: document.getElementById('summaryActions')?.value.trim() || '',
                signature: document.getElementById('summarySignature')?.value.trim() || ''
            };
        }
        
        function generateReport() {
            if (!currentPatient) {
                alert('Please select a patient first');
                return;
            }
            
            // Create a simple report
            const reportContent = `
                Medical Assessment Report
                ========================
                
                Patient: ${currentPatient.fullName}
                ID: ${currentPatient.id}
                Unit: ${currentPatient.unit}
                Date: ${new Date().toLocaleDateString('de-DE')}
                
                Generated by: ${currentUser.name}
                ${new Date().toLocaleString('de-DE')}
            `;
            
            // Create download link
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Assessment_${currentPatient.id}_${new Date().getTime()}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function deleteAssessment() {
            if (!currentPatient) return;
            
            if (confirm(`Are you sure you want to delete the assessment for ${currentPatient.fullName}?`)) {
                patients = patients.filter(p => p.id !== currentPatient.id);
                assessments.delete(currentPatient.id);
                currentPatient = null;
                
                // Reset UI
                const mainContent = document.getElementById('mainContent');
                mainContent.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <h3>Select a patient to begin assessment</h3>
                        <p>Choose from the list on the left or create a new assessment</p>
                    </div>
                `;
                
                renderPatientList();
            }
        }
        
        // ===== USER MANAGEMENT =====
        function updateUserDisplay() {
            // Update user info in header
            const userName = document.querySelector('.user-name');
            const userRole = document.querySelector('.user-role');
            
            if (userName) userName.textContent = currentUser.name;
            if (userRole) userRole.textContent = currentUser.role;
        }
        
        function openUserMenu() {
            // Simple user menu
            alert(`Logged in as: ${currentUser.name}\nRole: ${currentUser.role}\nEmail: ${currentUser.email}`);
        }
        
        // ===== NAVIGATION =====
        function switchTab(tab) {
            // Simple tab switching for main navigation
            alert(`Switching to ${tab} tab`);
        }
    </script>
</body>
</html>
