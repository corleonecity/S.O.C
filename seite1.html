<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CACHE-CONTROL META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>üìã HR - Einweisungsmanagement v2.0</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --primary-light: #818cf8;
      --secondary: #10b981;
      --secondary-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --dark: #111827;
      --dark-card: #1f2937;
      --light: #f9fafb;
      --gray: #6b7280;
      --gray-light: #d1d5db;
      --border: rgba(255, 255, 255, .12);
      --shadow-lg: 0 10px 25px -5px rgba(0, 0, 0, .2);
      --shadow-md: 0 4px 12px rgba(0, 0, 0, .08);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, .1);
      --radius-lg: 12px;
      --radius-md: 8px;
      --radius-sm: 6px;
      --transition: all .2s cubic-bezier(.4, 0, .2, 1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: #0f172a;
      color: var(--light);
      min-height: 100vh;
      overflow-x: hidden;
      font-size: 14px;
      line-height: 1.4;
    }

    .bg-effects {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .bg-gradient {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at 15% 70%, rgba(79, 70, 229, .10) 0%, transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(16, 185, 129, .08) 0%, transparent 40%);
    }

    .app-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
      display: grid;
      grid-template-columns: 280px 1fr;
      gap: 16px;
      min-height: 100vh;
    }

    /* Header */
    .app-header {
      grid-column: 1 / -1;
      background: rgba(31, 41, 55, .8);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      margin-bottom: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
      box-shadow: var(--shadow-md);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-container {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .08);
      flex-shrink: 0;
    }

    .logo-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .brand-text {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .brand-text h1 {
      font-size: 18px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 2px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .header-icons {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-left: 10px;
    }

    .header-icon {
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.8;
    }

    .header-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .brand-text .subtitle {
      font-size: 11px;
      color: var(--gray);
      font-weight: 600;
    }

    .header-stats {
      display: flex;
      gap: 12px;
    }

    .stat-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 10px 14px;
      background: rgba(255, 255, 255, .05);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, .08);
      min-width: 90px;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-1px);
      background: rgba(255, 255, 255, .08);
    }

    .stat-value {
      font-size: 20px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 2px;
    }

    .stat-label {
      font-size: 10px;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: .4px;
      font-weight: 700;
    }

    /* Password Modals */
    .password-modal {
      display: flex;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .85);
      backdrop-filter: blur(4px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .password-modal-content {
      background: rgba(31, 41, 55, .95);
      border-radius: var(--radius-lg);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      border: 1px solid rgba(255, 255, 255, .15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
    }

    .password-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, .1);
    }

    .password-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .password-input {
      padding: 12px 16px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .password-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, .08);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, .15);
    }

    .password-error {
      color: var(--danger);
      font-size: 12px;
      display: none;
      margin-top: -8px;
    }

    .password-error.show {
      display: block;
    }

    .modal-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .modal-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, .1);
    }

    /* Ank√ºndigung Banner */
    .ankundigung-banner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(31, 41, 55, .95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(139, 92, 246, .3);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      z-index: 2000;
      max-width: 600px;
      width: 90%;
      box-shadow: var(--shadow-lg);
      display: none;
      animation: slideDown .3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .ankundigung-banner.show {
      display: block;
    }

    .banner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .banner-title {
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .banner-close {
      background: none;
      border: none;
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .banner-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, .1);
    }

    .banner-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 8px;
      white-space: pre-line;
    }

    .banner-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--gray);
    }

    .banner-type {
      background: rgba(139, 92, 246, .15);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 10px;
    }

    /* Unified Modal Styling */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: rgba(31, 41, 55, .95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 1000px;
      max-height: 90vh;
      border: 1px solid rgba(255, 255, 255, .15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, .1);
      flex-shrink: 0;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    /* Scrollable Containers */
    .scrollable-content {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      min-height: 0;
    }

    .scrollable-content::-webkit-scrollbar {
      width: 8px;
    }

    .scrollable-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, .05);
      border-radius: 4px;
    }

    .scrollable-content::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 4px;
    }

    /* Search Containers */
    .search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, .5);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, .08);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, .15);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    /* List Items */
    .list-item {
      background: rgba(255, 255, 255, .03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
      transition: var(--transition);
      flex-shrink: 0;
    }

    .list-item:hover {
      background: rgba(255, 255, 255, .05);
      border-color: var(--primary);
    }

    .item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .item-title {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .item-type {
      background: rgba(139, 92, 246, .10);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(139, 92, 246, .20);
    }

    .item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .item-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0, 0, 0, .2);
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--primary);
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-line;
    }

    .item-content::-webkit-scrollbar {
      width: 6px;
    }

    .item-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, .03);
      border-radius: 3px;
    }

    .item-content::-webkit-scrollbar-thumb {
      background: rgba(139, 92, 246, .50);
      border-radius: 3px;
    }

    /* Empty States */
    .empty-state-container {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    .empty-description {
      font-size: 12px;
      color: var(--gray);
      max-width: 250px;
      margin: 0 auto;
    }

    /* Settings Tabs */
    .settings-tabs,
    .sub-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, .1);
      flex-shrink: 0;
    }

    .tab-button {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .tab-button:hover {
      color: var(--primary-light);
    }

    .tab-button.active {
      color: var(--primary);
    }

    .tab-button.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
    }

    .tab-content {
      display: none;
      flex: 1;
      overflow: hidden;
      min-height: 0;
    }

    .tab-content.active {
      display: flex;
      flex-direction: column;
    }

    /* Sidebar */
    .sidebar {
      background: rgba(31, 41, 55, .8);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
      height: calc(100vh - 120px);
      position: sticky;
      top: 20px;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 800;
      color: var(--gray-light);
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
      letter-spacing: .4px;
    }

    .employee-count {
      background: var(--primary);
      color: #fff;
      font-size: 11px;
      font-weight: 800;
      padding: 4px 10px;
      border-radius: 20px;
    }

    .sidebar-filter-buttons {
      display: flex;
      gap: 6px;
      margin-bottom: 16px;
    }

    .sidebar-filter-btn {
      padding: 8px 10px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: var(--radius-sm);
      color: var(--gray-light);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      text-align: center;
    }

    .sidebar-filter-btn:hover {
      background: rgba(255, 255, 255, .08);
    }

    .sidebar-filter-btn.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    .sidebar-controls {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
    }

    .sidebar-search-container {
      position: relative;
    }

    .sidebar-search-input {
      width: 100%;
      padding: 10px 12px 10px 36px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 13px;
      transition: var(--transition);
    }

    .sidebar-search-input::placeholder {
      color: rgba(255, 255, 255, .5);
    }

    .sidebar-search-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, .08);
      box-shadow: 0 0 0 2px rgba(79, 70, 229, .10);
    }

    .sidebar-search-icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 13px;
    }

    .employee-list-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 16px;
      min-height: 0;
    }

    .employee-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      padding-right: 4px;
      flex: 1;
      min-height: 0;
    }

    .employee-list::-webkit-scrollbar {
      width: 6px;
    }

    .employee-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, .05);
      border-radius: 3px;
    }

    .employee-list::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 3px;
    }

    /* Employee Cards */
    .employee-card {
      background: rgba(255, 255, 255, .03);
      border-radius: var(--radius-md);
      padding: 14px;
      border: 1px solid rgba(255, 255, 255, .08);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 110px;
      justify-content: flex-start;
    }

    .employee-card:hover {
      background: rgba(255, 255, 255, .05);
      border-color: rgba(79, 70, 229, .30);
      transform: translateY(-1px);
      box-shadow: var(--shadow-sm);
    }

    .employee-card.active {
      background: rgba(79, 70, 229, .10);
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary);
    }

    .employee-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--primary);
      opacity: 0;
      transition: var(--transition);
    }

    .employee-card.active::before {
      opacity: 1;
    }

    .employee-card.archived {
      opacity: 0.7;
      border-color: var(--warning);
    }

    .employee-card.archived .employee-name:after {
      content: ' [ARCHIV]';
      color: var(--warning);
      font-size: 10px;
    }

    .employee-top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 2px;
    }

    .employee-name {
      font-weight: 800;
      font-size: 15px;
      color: #fff;
      line-height: 1.3;
      word-break: break-word;
    }

    .employee-dn {
      font-family: 'Inter', monospace;
      font-size: 11px;
      font-weight: 800;
      color: var(--primary-light);
      background: rgba(79, 70, 229, .10);
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(79, 70, 229, .20);
      white-space: nowrap;
      flex-shrink: 0;
      margin-left: 8px;
    }

    .employee-meta {
      font-size: 11px;
      color: var(--gray);
      line-height: 1.3;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .employee-meta i {
      font-size: 10px;
      opacity: .6;
    }

    .induction-badges {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 0;
      padding-top: 2px;
    }

    .induction-badge {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
      transition: var(--transition);
      border: 1px solid transparent;
    }

    .induction-badge:hover {
      transform: translateY(-1px);
    }

    .badge-oral.pending {
      background: rgba(239, 68, 68, .10);
      color: #fca5a5;
      border-color: rgba(239, 68, 68, .20);
    }

    .badge-oral.completed {
      background: rgba(16, 185, 129, .10);
      color: #86efac;
      border-color: rgba(16, 185, 129, .20);
    }

    .badge-org.pending {
      background: rgba(245, 158, 11, .10);
      color: #fcd34d;
      border-color: rgba(245, 158, 11, .20);
    }

    .badge-org.completed {
      background: rgba(16, 185, 129, .10);
      color: #86efac;
      border-color: rgba(16, 185, 129, .20);
    }

    .quick-actions {
      display: grid;
      grid-template-columns: 1fr;
      gap: 8px;
      margin-top: auto;
    }

    .quick-action-btn {
      padding: 10px;
      background: rgba(79, 70, 229, .08);
      border: 1px solid rgba(79, 70, 229, .15);
      border-radius: var(--radius-md);
      color: var(--primary-light);
      font-size: 12px;
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .quick-action-btn:hover {
      background: rgba(79, 70, 229, .12);
      border-color: var(--primary);
      transform: translateY(-1px);
      color: #fff;
    }

    /* Main Content */
    .main-content {
      background: rgba(31, 41, 55, .8);
      backdrop-filter: blur(12px);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, .08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 420px;
    }

    .content-header {
      padding: 16px 20px;
      background: rgba(79, 70, 229, .05);
      border-bottom: 1px solid rgba(255, 255, 255, .08);
      display: none;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .employee-info h2 {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 8px;
    }

    .employee-tags {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .employee-tag {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 12px;
      color: var(--gray);
      font-weight: 700;
    }

    .tag-value {
      color: #fff;
      font-weight: 800;
      background: rgba(79, 70, 229, .10);
      padding: 3px 8px;
      border-radius: 4px;
      border: 1px solid rgba(79, 70, 229, .20);
      font-size: 11px;
    }

    .action-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    /* Buttons */
    .btn {
      padding: 8px 12px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 12px;
      user-select: none;
    }

    .btn-primary {
      background: var(--primary);
      color: #fff;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, .08);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, .12);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, .12);
      transform: translateY(-1px);
    }

    .btn-danger {
      background: var(--danger);
      color: #fff;
    }

    .btn-danger:hover {
      background: var(--danger-dark);
      transform: translateY(-1px);
    }

    /* Induction Content */
    .induction-content {
      padding: 20px;
      flex: 1;
      overflow-y: auto;
      display: none;
    }

    .induction-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 20px;
    }

    .induction-card {
      background: rgba(255, 255, 255, .03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
      transition: var(--transition);
      position: relative;
    }

    .induction-card.completed {
      border-color: var(--secondary);
      background: rgba(16, 185, 129, .05);
    }

    .induction-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 10px;
    }

    .induction-title {
      font-size: 14px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .induction-icon {
      width: 32px;
      height: 32px;
      background: var(--primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: #fff;
    }

    .induction-card.completed .induction-icon {
      background: var(--secondary);
    }

    .induction-status {
      font-size: 11px;
      font-weight: 900;
      padding: 4px 8px;
      border-radius: 12px;
      background: rgba(255, 255, 255, .08);
      color: var(--gray);
      white-space: nowrap;
    }

    .induction-card.completed .induction-status {
      background: rgba(16, 185, 129, .15);
      color: var(--secondary);
    }

    /* Form Styles */
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 4px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: .4px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      padding: 8px 10px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .08);
      border-radius: var(--radius-sm);
      color: #fff;
      font-size: 13px;
      transition: var(--transition);
      width: 100%;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: rgba(255, 255, 255, .4);
    }

    .form-select {
      color: #fff;
      background-color: rgba(255, 255, 255, .05);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      padding-right: 30px;
    }

    .form-select option {
      background: #1f2937;
      color: #fff;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, .08);
      box-shadow: 0 0 0 2px rgba(79, 70, 229, .10);
    }

    .form-textarea {
      resize: vertical;
      min-height: 60px;
      font-family: 'Inter', sans-serif;
      line-height: 1.4;
    }

    .time-container {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 8px;
      align-items: center;
    }

    .time-separator {
      color: var(--gray);
      font-weight: 700;
      text-align: center;
      font-size: 12px;
      padding: 0 4px;
    }

    input[type="time"] {
      font-size: 13px;
      padding: 7px 8px;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 24px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: rgba(255, 255, 255, .10);
      transition: var(--transition);
      border-radius: 34px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: #fff;
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked+.toggle-slider {
      background-color: var(--secondary);
    }

    input:checked+.toggle-slider:before {
      transform: translateX(20px);
    }

    /* Templates Section */
    .templates-section {
      background: rgba(255, 255, 255, .03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 14px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .template-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .template-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    .template-card {
      background: rgba(0, 0, 0, .20);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .template-card.completed {
      border-color: var(--secondary);
    }

    .template-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      gap: 10px;
    }

    .template-card-title {
      font-size: 13px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .template-badge {
      font-size: 10px;
      font-weight: 900;
      padding: 3px 8px;
      border-radius: 12px;
      background: rgba(79, 70, 229, .10);
      color: var(--primary-light);
      white-space: nowrap;
    }

    .template-content {
      font-family: Consolas, Monaco, monospace;
      background: rgba(0, 0, 0, .30);
      padding: 12px;
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--primary);
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 11px;
      line-height: 1.4;
      color: var(--gray-light);
      max-height: 180px;
      overflow-y: auto;
    }

    .template-card.completed .template-content {
      border-left-color: var(--secondary);
    }

    /* Floating Buttons */
    .floating-buttons-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
    }

    .floating-button {
      width: 56px;
      height: 56px;
      background: var(--primary);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .floating-button:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(79, 70, 229, .3);
    }

    .floating-button.warning {
      background: var(--warning);
    }

    .floating-button.warning:hover {
      background: var(--warning-dark);
    }

    /* Settings Section */
    .settings-section {
      background: rgba(0, 0, 0, .2);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
    }

    .section-title-settings {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .settings-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .settings-input {
      padding: 12px 16px;
      background: rgba(255, 255, 255, .05);
      border: 1px solid rgba(255, 255, 255, .1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .settings-input option {
      background: #1f2937;
      color: #fff;
    }

    .settings-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, .08);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, .15);
    }

    /* List Items in Settings */
    .list-item-settings {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, .03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, .08);
    }

    .list-item-name {
      flex: 1;
      font-weight: 900;
      color: #fff;
      font-size: 13px;
    }

    .discord-id-input {
      background: rgba(79, 70, 229, .10);
      color: var(--primary-light);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-family: 'Consolas', monospace;
      border: 1px solid rgba(79, 70, 229, .20);
      min-width: 200px;
      color: #fff;
    }

    .discord-id-input::placeholder {
      color: rgba(255, 255, 255, .4);
    }

    /* Add Button */
    .add-btn {
      padding: 10px 20px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
      margin-top: 12px;
    }

    .add-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Form Actions */
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255, 255, 255, .1);
      flex-shrink: 0;
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: var(--secondary);
      color: #fff;
      padding: 10px 14px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-md);
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1001;
      transform: translateY(100px);
      opacity: 0;
      transition: transform .2s ease, opacity .2s ease;
      min-width: 200px;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-icon {
      font-size: 14px;
    }

    .notification-message {
      font-weight: 900;
      font-size: 13px;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px;
      width: 100%;
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 2px solid rgba(255, 255, 255, .10);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 12px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .app-container {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 16px;
      }

      .sidebar {
        position: static;
        max-height: 500px;
        height: auto;
      }

      .induction-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 14px 16px;
      }

      .header-content {
        flex-direction: column;
        gap: 12px;
        align-items: stretch;
      }

      .header-stats {
        justify-content: center;
      }

      .brand {
        gap: 10px;
      }

      .brand-text h1 {
        font-size: 16px;
      }

      .brand-text .subtitle {
        font-size: 10px;
      }

      .content-header {
        flex-direction: column;
        align-items: stretch;
        padding: 14px;
      }

      .employee-tags {
        flex-direction: column;
        gap: 6px;
      }

      .induction-content {
        padding: 16px;
      }

      .form-grid {
        grid-template-columns: 1fr;
      }

      .modal-overlay {
        padding: 12px;
      }

      .modal-content {
        padding: 20px;
      }

      .form-actions {
        flex-direction: column;
        align-items: stretch;
      }

      .floating-buttons-container {
        bottom: 16px;
        right: 16px;
      }

      .settings-tabs,
      .sub-tabs {
        flex-direction: column;
      }

      .tab-button {
        text-align: left;
        padding: 10px 16px;
      }
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 12px;
      }

      .app-header {
        padding: 12px;
      }

      .stat-card {
        padding: 8px 10px;
        min-width: 70px;
      }

      .stat-value {
        font-size: 18px;
      }

      .sidebar {
        padding: 14px;
      }

      .modal-content {
        padding: 16px;
        margin: 12px;
      }

      .notification {
        left: 12px;
        right: 12px;
        bottom: 12px;
        min-width: auto;
      }
    }
  </style>
</head>

<body>
  <!-- Background Effects -->
  <div class="bg-effects">
    <div class="bg-gradient"></div>
  </div>

  <!-- Main Password Modal -->
  <div class="password-modal" id="mainPasswordModal">
    <div class="password-modal-content">
      <div class="password-header">
        <div class="password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr HR App erforderlich
        </div>
      </div>
      <div class="password-form">
        <input type="password" class="password-input" id="mainPasswordInput" placeholder="Passwort eingeben"
          onkeypress="if(event.key === 'Enter') HRApp.checkMainPassword()">
        <div class="password-error" id="mainPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="HRApp.checkMainPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Password Modal -->
  <div class="password-modal" id="settingsPasswordModal">
    <div class="password-modal-content">
      <div class="password-header">
        <div class="password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr Settings erforderlich
        </div>
        <button class="modal-close" onclick="HRApp.closeSettingsPasswordModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="password-form">
        <input type="password" class="password-input" id="settingsPasswordInput" placeholder="Passwort eingeben"
          onkeypress="if(event.key === 'Enter') HRApp.checkSettingsPassword()">
        <div class="password-error" id="settingsPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="HRApp.checkSettingsPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Ank√ºndigung Banner -->
  <div class="ankundigung-banner" id="ankundigungBanner">
    <div class="banner-header">
      <div class="banner-title" id="bannerTitle">
        <span>ü™ß</span> Ank√ºndigung
      </div>
      <button class="banner-close" onclick="HRApp.closeBanner()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="banner-content" id="bannerContent">
      Lade Ank√ºndigung...
    </div>
    <div class="banner-meta">
      <div class="banner-type" id="bannerType">Ank√ºndigung</div>
      <div id="bannerDate">Heute</div>
    </div>
  </div>

  <!-- Floating Buttons -->
  <div class="floating-buttons-container">
    <button class="floating-button warning" onclick="HRApp.openSoldatenModal()" title="Soldatengespr√§che">
      <i class="fas fa-comments"></i>
    </button>
    <button class="floating-button" onclick="HRApp.openBeobachtungAktenModal()" title="Beobachtungs-Akten">
      <i class="fas fa-folder-open"></i>
    </button>
    <button class="floating-button" onclick="HRApp.openSettingsWithPassword()" title="Settings">
      <i class="fas fa-cog"></i>
    </button>
  </div>

  <!-- App Container (wird erst nach Passwort-Eingabe angezeigt) -->
  <div class="app-container" id="appContainer" style="display:none;">
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <div class="logo-container" id="logoContainer">
            <img src="" alt="Logo">
          </div>
          <div class="brand-text">
            <h1>Human Resources <span class="header-icons">
                <span class="header-icon" onclick="HRApp.openAnkundigungenModal()"
                  title="Ank√ºndigungen anzeigen">üîî</span>
                <span class="header-icon" onclick="HRApp.openBesprechungenModal()"
                  title="Besprechungen anzeigen">üóÉÔ∏è</span>
              </span></h1>
            <div class="subtitle">‚Ä¢</div>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat-card">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Mitarbeiter</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalAkten">0</div>
            <div class="stat-label">Beobachtung</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalArchived">0</div>
            <div class="stat-label">Archiviert</div>
          </div>
        </div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title"><i class="fas fa-users"></i> Mitarbeiter</h3>
        <div class="employee-count" id="employeeCount">0</div>
      </div>

      <div class="sidebar-controls">
        <div class="sidebar-filter-buttons">
          <button class="sidebar-filter-btn active" onclick="HRApp.filterEmployeesByType('all')">Alle</button>
          <button class="sidebar-filter-btn" onclick="HRApp.filterEmployeesByType('oral')">M√ºndlich</button>
          <button class="sidebar-filter-btn" onclick="HRApp.filterEmployeesByType('org')">Organisatorische</button>
        </div>

        <div class="sidebar-search-container">
          <i class="fas fa-search sidebar-search-icon"></i>
          <input type="text" class="sidebar-search-input" id="searchEmployees"
            placeholder="Nach Namen oder DN suchen...">
        </div>
      </div>

      <div class="employee-list-container">
        <div class="employee-list" id="employeeList">
          <div class="empty-state-container">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">Keine Mitarbeiter</div>
            <div class="empty-description">F√ºgen Sie Ihren ersten Mitarbeiter hinzu</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="HRApp.openNewEmployeeModal()">
          <i class="fas fa-user-plus"></i> Neuer Mitarbeiter
        </button>
        <button class="quick-action-btn" onclick="HRApp.toggleArchiveView()">
          <i class="fas fa-archive"></i> <span id="archiveToggleText">Archiv anzeigen</span>
        </button>
      </div>
    </aside>

    <main class="main-content">
      <div class="content-header" id="employeeHeader">
        <div class="employee-info">
          <h2 id="currentEmployeeName">W√§hlen Sie einen Mitarbeiter</h2>
          <div class="employee-tags">
            <div class="employee-tag"><i class="fas fa-hashtag"></i> <span class="tag-value"
                id="currentEmployeeDN">DN-</span></div>
            <div class="employee-tag"><i class="fas fa-building"></i> <span class="tag-value"
                id="currentEmployeeUnit">Unit</span></div>
            <div class="employee-tag"><i class="fas fa-user-tie"></i> <span class="tag-value"
                id="currentEmployeeRank">Rang</span></div>
            <div class="employee-tag" id="archiveStatusTag" style="display:none;">
              <i class="fas fa-archive"></i> <span class="tag-value" style="background:var(--warning);">Archiviert</span>
            </div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="HRApp.openEditEmployeeModal()"><i class="fas fa-edit"></i>
            Bearbeiten</button>
          <button class="btn btn-secondary" id="archiveButton" onclick="HRApp.toggleArchiveEmployee()"
            style="display:none;">
            <i class="fas fa-archive"></i> <span id="archiveButtonText">Archivieren</span>
          </button>
        </div>
      </div>

      <div class="induction-content" id="inductionContent">
        <div class="induction-grid">
          <div class="induction-card" id="oralInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-comments"></i></div>
                M√ºndliche Einweisung
              </div>
              <div class="induction-status" id="oralInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="oralInductionToggle"
                  onchange="HRApp.toggleInduction('oral', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="oralDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="oralTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="oralTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="oralPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="oralNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>

          <div class="induction-card" id="orgInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-clipboard-list"></i></div>
                Organisatorische Einweisung
              </div>
              <div class="induction-status" id="orgInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="orgInductionToggle" onchange="HRApp.toggleInduction('org', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="orgDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="orgTimeStart">
                  <div class="time-separator">-</div>
                  <input type="time" class="form-input" id="orgTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="orgPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect2">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect2">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="orgNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <div class="section-header">
            <div class="section-title"><i class="fas fa-file-code"></i> Discord Vorlagen</div>
            <div class="template-actions">
              <button class="btn btn-secondary" onclick="HRApp.copyOralTemplate()"><i class="fas fa-comments"></i>
                M√ºndlich</button>
              <button class="btn btn-secondary" onclick="HRApp.copyOrgTemplate()"><i class="fas fa-clipboard-list"></i>
                Organisatorisch</button>
            </div>
          </div>

          <div class="template-cards">
            <div class="template-card" id="oralTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-comments"></i> M√ºndliche Einweisung</div>
                <div class="template-badge" id="oralTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="oralTemplateContent"></div>
            </div>

            <div class="template-card" id="orgTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-clipboard-list"></i> Organisatorische Einweisung</div>
                <div class="template-badge" id="orgTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="orgTemplateContent"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-user-plus"></i> Neuen Mitarbeiter hinzuf√ºgen</div>
        <button class="modal-close" onclick="HRApp.closeModal('newEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body">
        <div class="form-grid" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Vollst√§ndiger Name *</label>
            <input type="text" class="form-input" id="newEmployeeName" placeholder="z.B. Max Fiart">
          </div>
          <div class="form-group">
            <label class="form-label">Dienstnummer (DN) *</label>
            <input type="number" class="form-input" id="newEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
          </div>
          <div class="form-group">
            <label class="form-label">Unit</label>
            <select class="form-select" id="newEmployeeUnit">
              <option value="">Unit ausw√§hlen</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Rang</label>
            <select class="form-select" id="newEmployeeRank">
              <option value="">Rang ausw√§hlen</option>
            </select>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn btn-secondary" onclick="HRApp.closeModal('newEmployeeModal')">Abbrechen</button>
          <button class="btn btn-primary" onclick="HRApp.createNewEmployee()"><i class="fas fa-plus"></i> Erstellen</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-edit"></i> Mitarbeiter bearbeiten</div>
        <button class="modal-close" onclick="HRApp.closeModal('editEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body">
        <div class="form-grid" style="margin-bottom: 16px;">
          <div class="form-group">
            <label class="form-label">Vollst√§ndiger Name *</label>
            <input type="text" class="form-input" id="editEmployeeName" placeholder="z.B. Max Fiart">
          </div>
          <div class="form-group">
            <label class="form-label">Dienstnummer (DN) *</label>
            <input type="number" class="form-input" id="editEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
          </div>
          <div class="form-group">
            <label class="form-label">Unit</label>
            <select class="form-select" id="editEmployeeUnit">
              <option value="">Unit ausw√§hlen</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Rang</label>
            <select class="form-select" id="editEmployeeRank">
              <option value="">Rang ausw√§hlen</option>
            </select>
          </div>
        </div>

        <div class="form-actions" style="justify-content: space-between;">
          <button class="btn btn-danger" onclick="HRApp.deleteCurrentEmployee()"><i class="fas fa-trash"></i>
            L√∂schen</button>
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" onclick="HRApp.closeModal('editEmployeeModal')">Abbrechen</button>
            <button class="btn btn-primary" onclick="HRApp.saveEditedEmployee()"><i class="fas fa-save"></i> √Ñnderungen
              speichern</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ank√ºndigungen Modal -->
  <div class="modal-overlay" id="ankundigungenModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-bullhorn"></i> Ank√ºndigungen
        </div>
        <button class="modal-close" onclick="HRApp.closeModal('ankundigungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="ankundigungenSearch"
            placeholder="Nach Thema oder Inhalt suchen..." oninput="HRApp.searchAnkundigungen(this.value)">
        </div>

        <div class="scrollable-content">
          <div id="ankundigungenList">
            <div class="empty-state-container">
              <div class="empty-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-title">Keine Ank√ºndigungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Ank√ºndigung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Besprechungen Modal -->
  <div class="modal-overlay" id="besprechungenModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-calendar-alt"></i> Besprechungen
        </div>
        <button class="modal-close" onclick="HRApp.closeModal('besprechungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="besprechungenSearch"
            placeholder="Nach Thema oder Inhalt suchen..." oninput="HRApp.searchBesprechungen(this.value)">
        </div>

        <div class="scrollable-content">
          <div id="besprechungenList">
            <div class="empty-state-container">
              <div class="empty-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-title">Keine Besprechungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Besprechung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div class="modal-overlay" id="settingsModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-cog"></i> Settings
        </div>
        <button class="modal-close" onclick="HRApp.closeModal('settingsModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="settings-tabs">
          <button class="tab-button active" onclick="HRApp.switchSettingsTab('units')">
            <i class="fas fa-building"></i> Units
          </button>
          <button class="tab-button" onclick="HRApp.switchSettingsTab('ranks')">
            <i class="fas fa-user-tie"></i> R√§nge
          </button>
          <button class="tab-button" onclick="HRApp.switchSettingsTab('ankundigungen')">
            <i class="fas fa-bullhorn"></i> Ank√ºndigungen
          </button>
        </div>

        <div class="tab-content active" id="unitsTab">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-building"></i> Unit-Liste bearbeiten</h3>
            <div class="scrollable-content">
              <div id="unitList"></div>
            </div>
            <button class="add-btn" onclick="HRApp.addNewUnit()">
              <i class="fas fa-plus"></i> Neue Unit hinzuf√ºgen
            </button>
          </div>
        </div>

        <div class="tab-content" id="ranksTab">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-user-tie"></i> Rang-Liste bearbeiten</h3>
            <div class="scrollable-content">
              <div id="rankList"></div>
            </div>
            <button class="add-btn" onclick="HRApp.addNewRank()">
              <i class="fas fa-plus"></i> Neuen Rang hinzuf√ºgen
            </button>
          </div>
        </div>

        <div class="tab-content" id="ankundigungenTab">
          <div class="settings-section" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
            <div class="sub-tabs">
              <button class="tab-button active" onclick="HRApp.switchAnkundigungenTab('new')">
                <span>ü™ß</span> Neue Ank√ºndigung
              </button>
              <button class="tab-button" onclick="HRApp.switchAnkundigungenTab('besprechung')">
                <span>üóÉÔ∏è</span> Neue Besprechung
              </button>
              <button class="tab-button" onclick="HRApp.switchAnkundigungenTab('manage-ankundigungen')">
                <span>üìã</span> Ank√ºndigungen verwalten
              </button>
              <button class="tab-button" onclick="HRApp.switchAnkundigungenTab('manage-besprechungen')">
                <span>üìÖ</span> Besprechungen verwalten
              </button>
            </div>

            <div class="tab-content active" id="ankundigungenNewTab">
              <div class="settings-form-group">
                <label class="settings-label">Titel</label>
                <input type="text" class="settings-input" id="ankundigungTitle" placeholder="Titel der Ank√ºndigung">
              </div>
              <div class="settings-form-group">
                <label class="settings-label">Inhalt *</label>
                <textarea class="settings-input" id="ankundigungContent" placeholder="Inhalt der Ank√ºndigung..."
                  rows="4"></textarea>
              </div>
              <div class="form-actions">
                <button class="btn btn-primary" onclick="HRApp.saveAnkundigung()">
                  <i class="fas fa-save"></i> Ank√ºndigung speichern
                </button>
              </div>
            </div>

            <div class="tab-content" id="ankundigungenBesprechungTab">
              <div class="scrollable-content">
                <div class="settings-form-group">
                  <label class="settings-label">Thema *</label>
                  <input type="text" class="settings-input" id="besprechungThema" placeholder="Thema der Besprechung">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                  <div class="settings-form-group">
                    <label class="settings-label">Datum *</label>
                    <input type="date" class="settings-input" id="besprechungDate" value="">
                  </div>
                  <div class="settings-form-group">
                    <label class="settings-label">Uhrzeit *</label>
                    <input type="time" class="settings-input" id="besprechungTime" value="">
                  </div>
                  <div class="settings-form-group">
                    <label class="settings-label">Ort</label>
                    <input type="text" class="settings-input" id="besprechungOrt" placeholder="Ort der Besprechung">
                  </div>
                </div>
                <div class="settings-form-group">
                  <label class="settings-label">Inhalt *</label>
                  <textarea class="settings-input" id="besprechungContent" placeholder="Inhalt der Besprechung..."
                    rows="8"></textarea>
                </div>
              </div>
              <div class="form-actions">
                <button class="btn btn-primary" onclick="HRApp.saveBesprechung()">
                  <i class="fas fa-save"></i> Besprechung speichern
                </button>
              </div>
            </div>

            <div class="tab-content" id="ankundigungenManageAnkundigungenTab">
              <div class="settings-form-group">
                <label class="settings-label">Ank√ºndigungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageAnkundigungenSearch"
                  placeholder="Nach Ank√ºndigungen suchen..." oninput="HRApp.searchManageAnkundigungen(this.value)">
              </div>
              <div class="scrollable-content">
                <div id="manageAnkundigungenList"></div>
              </div>
            </div>

            <div class="tab-content" id="ankundigungenManageBesprechungenTab">
              <div class="settings-form-group">
                <label class="settings-label">Besprechungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageBesprechungenSearch"
                  placeholder="Nach Besprechungen suchen..." oninput="HRApp.searchManageBesprechungen(this.value)">
              </div>
              <div class="scrollable-content">
                <div id="manageBesprechungenList"></div>
              </div>
            </div>
          </div>
        </div>

        <div class="form-actions">
          <button class="btn btn-secondary" onclick="HRApp.closeModal('settingsModal')">
            <i class="fas fa-times"></i> Schlie√üen
          </button>
          <button class="btn btn-primary" onclick="HRApp.saveSettings()">
            <i class="fas fa-save"></i> Einstellungen speichern
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Soldatengespr√§ch Modal -->
  <div class="modal-overlay" id="soldatenModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-comments"></i> Soldatengespr√§che
        </div>
        <button class="modal-close" onclick="HRApp.closeModal('soldatenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="sub-tabs">
          <button class="tab-button active" onclick="HRApp.switchSoldatenTab('new')">Neues Gespr√§ch</button>
          <button class="tab-button" onclick="HRApp.switchSoldatenTab('list')">Gespr√§chsliste</button>
        </div>

        <div class="tab-content active" id="soldatenNewTab">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Name *</label>
              <input type="text" class="form-input" id="soldatenName" placeholder="Vollst√§ndiger Name">
            </div>
            <div class="form-group">
              <label class="form-label">Dienstnummer (DN) *</label>
              <input type="number" class="form-input" id="soldatenDN" placeholder="z.B. 43">
            </div>
            <div class="form-group">
              <label class="form-label">Hauptunit</label>
              <select class="form-select" id="soldatenUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Rang</label>
              <select class="form-select" id="soldatenRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Datum *</label>
              <input type="date" class="form-input" id="soldatenDate" value="">
            </div>
            <div class="form-group">
              <label class="form-label">Uhrzeit *</label>
              <input type="time" class="form-input" id="soldatenTime" value="">
            </div>
            <div class="form-group" style="grid-column: span 2;">
              <label class="form-label">Notizen *</label>
              <textarea class="form-textarea" id="soldatenNotizen" placeholder="Notizen zum Gespr√§ch..."></textarea>
            </div>
            <div class="form-group" style="grid-column: span 2;">
              <label class="form-label">Sonstiges</label>
              <textarea class="form-textarea" id="soldatenSonstiges" placeholder="Weitere Informationen..."></textarea>
            </div>
          </div>

          <div class="settings-section">
            <div class="section-title-settings">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="template-content" id="soldatenPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Soldatengespr√§ch

Name: 
DN: 
Hauptunit: 
Rang: 
Datum:
Uhrzeit: 
Notizen:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-secondary" onclick="HRApp.copySoldatenTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="btn btn-primary" onclick="HRApp.saveSoldatenGespr√§ch()">
              <i class="fas fa-save"></i> Gespr√§ch speichern
            </button>
          </div>
        </div>

        <div class="tab-content" id="soldatenListTab">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="soldatenSearch" placeholder="Nach Name oder DN suchen..."
              oninput="HRApp.searchSoldaten(this.value)">
          </div>
          <div class="scrollable-content">
            <div id="soldatenListe"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Beobachtungs Akten Modal -->
  <div class="modal-overlay" id="beobachtungAktenModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">
          <i class="fas fa-folder-open"></i> Beobachtungs-Akten
        </div>
        <button class="modal-close" onclick="HRApp.closeModal('beobachtungAktenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="sub-tabs">
          <button class="tab-button active" onclick="HRApp.switchBeobachtungTab('new')">Neue Akte erstellen</button>
          <button class="tab-button" onclick="HRApp.switchBeobachtungTab('list')">Akten durchsuchen</button>
          <button class="tab-button" onclick="HRApp.switchBeobachtungTab('beobachtung')">Beobachtung hinzuf√ºgen</button>
        </div>

        <div class="tab-content active" id="beobachtungNewTab">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Name *</label>
              <input type="text" class="form-input" id="akteName" placeholder="Vollst√§ndiger Name">
            </div>
            <div class="form-group">
              <label class="form-label">Dienstnummer (DN) *</label>
              <input type="number" class="form-input" id="akteDN" placeholder="z.B. 43">
            </div>
            <div class="form-group">
              <label class="form-label">Unit</label>
              <select class="form-select" id="akteUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label">Rang</label>
              <select class="form-select" id="akteRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="HRApp.createNewAkte()">
              <i class="fas fa-plus"></i> Neue Akte erstellen
            </button>
          </div>
        </div>

        <div class="tab-content" id="beobachtungListTab">
          <div class="search-container">
            <i class="fas fa-search search-icon"></i>
            <input type="text" class="search-input" id="aktenSearch" placeholder="Nach Name oder DN suchen..."
              oninput="HRApp.searchAkten(this.value)">
          </div>
          <div class="scrollable-content">
            <div id="aktenListe"></div>
          </div>
        </div>

        <div class="tab-content" id="beobachtungBeobachtungTab">
          <div class="form-grid">
            <div class="form-group">
              <label class="form-label">Name *</label>
              <input type="text" class="form-input" id="beobachtungName" placeholder="Name der Person">
            </div>
            <div class="form-group">
              <label class="form-label">Dienstnummer (DN) *</label>
              <input type="number" class="form-input" id="beobachtungDN" placeholder="z.B. 43">
            </div>
            <div class="form-group" style="grid-column: span 2;">
              <label class="form-label">Grund der Beobachtung *</label>
              <textarea class="form-textarea" id="beobachtungGrund"
                placeholder="Beschreiben Sie den Grund der Beobachtung..."></textarea>
            </div>
          </div>

          <div class="settings-section">
            <div class="section-title-settings">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="template-content" id="beobachtungPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: 
DN:  
Grund:
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            </div>
          </div>

          <div class="form-actions">
            <button class="btn btn-secondary" onclick="HRApp.copyBeobachtungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="btn btn-primary" onclick="HRApp.saveBeobachtungToAkte()">
              <i class="fas fa-save"></i> Zu Akte hinzuf√ºgen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Item Modal -->
  <div class="modal-overlay" id="editItemModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title" id="editItemTitle">
          <i class="fas fa-edit"></i> Bearbeiten
        </div>
        <button class="modal-close" onclick="HRApp.closeEditItemModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="scrollable-content">
          <div id="editItemForm"></div>
        </div>
        <div class="form-actions">
          <button class="btn btn-secondary" onclick="HRApp.closeEditItemModal()">
            <i class="fas fa-times"></i> Abbrechen
          </button>
          <button class="btn btn-primary" onclick="HRApp.saveEditedItem()">
            <i class="fas fa-save"></i> √Ñnderungen speichern
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-check notification-icon"></i>
    <span class="notification-message" id="notificationMessage"></span>
  </div>

  <script>
    const HRApp = (function () {
      'use strict';

      // ==================== KONSTANTEN ====================
      const APP_VERSION = '2.0.20240128';
      const DEFAULT_PASSWORD = 'hr';
      const SETTINGS_PASSWORD = 'soc1';
      const PASSWORD_EXPIRE_MINUTES = 60;
      const DEBOUNCE_DELAY = 300;
      const CACHE_DURATION = 5 * 60 * 1000; // 5 Minuten

      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBTnsLNw68UuOd5Xa2ymMffWk4SYGDQjso",
        authDomain: "cc-shop-finanzsystem.firebaseapp.com",
        projectId: "cc-shop-finanzsystem",
        storageBucket: "cc-shop-finanzsystem.firebasestorage.app",
        messagingSenderId: "575918945925",
        appId: "1:575918945925:web:bf9d973d5cd9fc547e5bec",
        measurementId: "G-9SZREFTJS6"
      };

      // ==================== STATE ====================
      const state = {
        currentEmployee: null,
        employees: [],
        bothInductionsCompleted: false,
        currentFilter: 'all',
        settings: {
          units: [],
          ranks: []
        },
        showArchived: false,
        ankundigungen: [],
        soldatenGespr√§che: [],
        akten: [],
        currentSettingsTab: 'units',
        currentAnkundigungenTab: 'new',
        currentSoldatenTab: 'new',
        currentBeobachtungTab: 'new',
        isAuthenticated: false,
        settingsAuthenticated: false,
        settingsAuthTimestamp: 0,
        unsubscribeFunctions: [],
        currentEditItemId: null,
        currentEditItemType: null,
        debounceTimers: {},
        cache: new Map()
      };

      // ==================== FIREBASE INIT ====================
      let db;
      try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
      } catch (error) {
        console.error('Firebase Initialisierungsfehler:', error);
        showNotification('Datenbankverbindung fehlgeschlagen', 'error');
      }

      // ==================== HELPER FUNKTIONEN ====================
      const helpers = {
        escapeHtml(str) {
          if (!str) return '';
          return String(str)
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");
        },

        debounce(func, wait) {
          return (...args) => {
            clearTimeout(this.debounceTimers[func.name]);
            this.debounceTimers[func.name] = setTimeout(() => func.apply(this, args), wait);
          };
        },

        formatDate(date) {
          return new Date(date).toLocaleDateString('de-DE');
        },

        async copyToClipboard(text) {
          try {
            await navigator.clipboard.writeText(text);
            return true;
          } catch {
            try {
              const textArea = document.createElement('textarea');
              textArea.value = text;
              document.body.appendChild(textArea);
              textArea.select();
              const success = document.execCommand('copy');
              document.body.removeChild(textArea);
              return success;
            } catch {
              return false;
            }
          }
        },

        validateEmail(email) {
          const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return re.test(email);
        },

        generateId(prefix) {
          return `${prefix}-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;
        }
      };

      // ==================== UI FUNKTIONEN ====================
      const ui = {
        showNotification(message, type = 'info') {
          const notification = document.getElementById('notification');
          const messageElement = document.getElementById('notificationMessage');
          messageElement.textContent = message;

          notification.className = 'notification';
          if (type === 'success') notification.style.background = 'var(--secondary)';
          else if (type === 'error') notification.style.background = 'var(--danger)';
          else if (type === 'warning') notification.style.background = 'var(--warning)';
          else notification.style.background = 'var(--primary)';

          notification.classList.add('show');
          setTimeout(() => notification.classList.remove('show'), 3000);
        },

        showLoading(containerId, message = 'Lade...') {
          const container = document.getElementById(containerId);
          if (container) {
            container.innerHTML = `
              <div class="loading">
                <div class="loading-spinner"></div>
                <div>${message}</div>
              </div>
            `;
          }
        },

        showEmptyState(containerId, options = {}) {
          const container = document.getElementById(containerId);
          if (container) {
            container.innerHTML = `
              <div class="empty-state-container">
                <div class="empty-icon"><i class="fas fa-${options.icon || 'exclamation-circle'}"></i></div>
                <div class="empty-title">${options.title || 'Keine Daten'}</div>
                <div class="empty-description">${options.description || ''}</div>
              </div>
            `;
          }
        },

        openModal(modalId) {
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
          }
        },

        closeModal(modalId) {
          const modal = document.getElementById(modalId);
          if (modal) {
            modal.classList.remove('active');
            document.body.style.overflow = '';
            
            if (modalId === 'akteDetailModal') {
              setTimeout(() => modal.remove(), 300);
            }
          }
        },

        switchTab(tabGroup, tabName) {
          // Deaktiviere alle Tabs in der Gruppe
          document.querySelectorAll(`[data-tab-group="${tabGroup}"]`).forEach(tab => {
            tab.classList.remove('active');
          });

          // Aktiviere den gew√§hlten Tab
          const activeTab = document.querySelector(`[data-tab="${tabName}"]`);
          if (activeTab) {
            activeTab.classList.add('active');
          }

          // Zeige den entsprechenden Content
          document.querySelectorAll(`[data-content-group="${tabGroup}"]`).forEach(content => {
            content.classList.remove('active');
          });

          const activeContent = document.querySelector(`[data-content="${tabName}"]`);
          if (activeContent) {
            activeContent.classList.add('active');
          }
        },

        updateSelectOptions(selectElement, options, currentValue = '') {
          if (!selectElement) return;
          
          const current = selectElement.value;
          selectElement.innerHTML = options.map(opt => 
            `<option value="${helpers.escapeHtml(opt.value)}">${helpers.escapeHtml(opt.label)}</option>`
          ).join('');
          
          if (currentValue) {
            selectElement.value = currentValue;
          } else if (current) {
            selectElement.value = current;
          }
        }
      };

      // ==================== DATENBANK FUNKTIONEN ====================
      const database = {
        async getCachedData(key) {
          const cached = state.cache.get(key);
          if (cached && Date.now() - cached.timestamp < CACHE_DURATION) {
            return cached.data;
          }
          return null;
        },

        setCachedData(key, data) {
          state.cache.set(key, {
            data,
            timestamp: Date.now()
          });
        },

        async getSettings() {
          try {
            const cached = await this.getCachedData('settings');
            if (cached) return cached;

            const doc = await db.collection('hrSettings').doc('settings').get();
            let settings = doc.exists ? doc.data() : { units: [], ranks: [] };

            // Default-Werte falls leer
            if (!settings.units || settings.units.length === 0) {
              settings.units = [
                { name: "Air Force", discordId: "1269229762400878675" },
                { name: "S.O.C", discordId: "1339523576159666218" },
                { name: "Infantry", discordId: "1187756956425920645" },
                { name: "Military Police", discordId: "1289716541658497055" },
                { name: "Navy Marine", discordId: "1097653037968920776" },
                { name: "Navy SEALs", discordId: "1125174901989445693" }
              ];
            }

            if (!settings.ranks || settings.ranks.length === 0) {
              settings.ranks = [
                { name: "Private", discordId: "1097625924104626198" },
                { name: "Private First Class", discordId: "1098190829295771739" },
                { name: "Specialist", discordId: "1097625921516748830" },
                { name: "Corporal", discordId: "1097625914763919532" },
                { name: "Sergeant", discordId: "1097625913274933298" },
                { name: "Staff Sergeant", discordId: "1097625912163451112" },
                { name: "Sergeant First Class", discordId: "1348414845862674524" },
                { name: "Master Sergeant", discordId: "1348414845862674524" },
                { name: "Lieutenant", discordId: "1097625900125782278" },
                { name: "Captain", discordId: "1097625898880077955" },
                { name: "Major", discordId: "1097625896560640024" },
                { name: "Colonel", discordId: "1097625895541428275" },
                { name: "Major General", discordId: "1097625893880479777" },
                { name: "General of Army", discordId: "1097625891632316436" }
              ];
            }

            this.setCachedData('settings', settings);
            return settings;
          } catch (error) {
            console.error('Fehler beim Laden der Einstellungen:', error);
            ui.showNotification('Fehler beim Laden der Einstellungen', 'error');
            return { units: [], ranks: [] };
          }
        },

        async saveSettings(settings) {
          try {
            await db.collection('hrSettings').doc('settings').set(settings, { merge: true });
            this.setCachedData('settings', settings);
            return true;
          } catch (error) {
            console.error('Fehler beim Speichern der Einstellungen:', error);
            return false;
          }
        },

        async saveEmployee(employee) {
          try {
            const data = {
              name: employee.name,
              dn: employee.dn,
              unit: employee.unit,
              rank: employee.rank,
              lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
              inductions: employee.inductions || {},
              oralData: employee.oralData || {},
              orgData: employee.orgData || {},
              status: employee.status || 'active'
            };

            await db.collection('hrEmployees').doc(employee.id).set(data, { merge: true });
            return true;
          } catch (error) {
            console.error('Fehler beim Speichern des Mitarbeiters:', error);
            return false;
          }
        },

        async deleteEmployee(id) {
          try {
            await db.collection('hrEmployees').doc(id).delete();
            return true;
          } catch (error) {
            console.error('Fehler beim L√∂schen des Mitarbeiters:', error);
            return false;
          }
        }
      };

      // ==================== AUTHENTIFIZIERUNG ====================
      const auth = {
        checkAuthentication() {
          const savedPassword = localStorage.getItem('hr_app_password');
          const savedTimestamp = localStorage.getItem('hr_app_password_timestamp');
          const currentTime = Date.now();
          const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;

          if (savedPassword === DEFAULT_PASSWORD && savedTimestamp &&
            (currentTime - parseInt(savedTimestamp) < expireTime)) {
            state.isAuthenticated = true;
            state.settingsAuthenticated = true;
            state.settingsAuthTimestamp = Date.now();
            localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);
            main.initializeApp();
          } else {
            setTimeout(() => {
              document.getElementById('mainPasswordInput').focus();
            }, 100);
          }
        },

        checkMainPassword() {
          const password = document.getElementById('mainPasswordInput').value;
          const errorElement = document.getElementById('mainPasswordError');

          if (password === DEFAULT_PASSWORD) {
            localStorage.setItem('hr_app_password', password);
            localStorage.setItem('hr_app_password_timestamp', Date.now());
            state.isAuthenticated = true;
            state.settingsAuthenticated = true;
            state.settingsAuthTimestamp = Date.now();
            localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);

            document.getElementById('mainPasswordModal').style.display = 'none';
            document.getElementById('appContainer').style.display = 'grid';

            main.initializeApp();
          } else {
            errorElement.style.display = 'block';
            document.getElementById('mainPasswordInput').value = '';
            document.getElementById('mainPasswordInput').focus();
          }
        },

        checkSettingsAuth() {
          if (state.settingsAuthenticated) {
            const savedTimestamp = localStorage.getItem('hr_settings_auth_timestamp');
            const currentTime = Date.now();
            const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;

            if (savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
              return true;
            }
          }
          return false;
        },

        openSettingsPasswordModal() {
          ui.openModal('settingsPasswordModal');
          document.getElementById('settingsPasswordInput').focus();
        },

        closeSettingsPasswordModal() {
          ui.closeModal('settingsPasswordModal');
          document.getElementById('settingsPasswordInput').value = '';
          document.getElementById('settingsPasswordError').classList.remove('show');
        },

        checkSettingsPassword() {
          const password = document.getElementById('settingsPasswordInput').value;
          const errorElement = document.getElementById('settingsPasswordError');

          if (password === SETTINGS_PASSWORD) {
            state.settingsAuthenticated = true;
            state.settingsAuthTimestamp = Date.now();
            localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);
            this.closeSettingsPasswordModal();
            ui.openModal('settingsModal');
          } else {
            errorElement.classList.add('show');
            document.getElementById('settingsPasswordInput').value = '';
            document.getElementById('settingsPasswordInput').focus();
          }
        },

        openSettingsWithPassword() {
          if (this.checkSettingsAuth()) {
            ui.openModal('settingsModal');
          } else {
            this.openSettingsPasswordModal();
          }
        }
      };

      // ==================== MITARBEITER FUNKTIONEN ====================
      const employees = {
        renderEmployeeList() {
          const container = document.getElementById('employeeList');
          const countElement = document.getElementById('employeeCount');

          let filteredEmployees = this.getFilteredEmployees();

          filteredEmployees.sort((a, b) => {
            const nameA = (a.name || '').toUpperCase();
            const nameB = (b.name || '').toUpperCase();
            return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;
          });

          if (filteredEmployees.length === 0) {
            ui.showEmptyState('employeeList', {
              icon: 'user-plus',
              title: this.getEmptyStateTitle(),
              description: this.getEmptyStateDescription()
            });
            countElement.textContent = '0';
            return;
          }

          container.innerHTML = '';
          countElement.textContent = filteredEmployees.length;

          filteredEmployees.forEach(employee => {
            const isArchived = employee.status === 'archived';
            const isActive = state.currentEmployee?.id === employee.id;
            const oralCompleted = employee.inductions?.oral?.completed || false;
            const orgCompleted = employee.inductions?.org?.completed || false;

            const card = document.createElement('div');
            card.className = `employee-card ${isActive ? 'active' : ''} ${isArchived ? 'archived' : ''}`;
            card.onclick = () => this.selectEmployee(employee);
            card.oncontextmenu = (e) => {
              e.preventDefault();
              this.showEmployeeContextMenu(e, employee);
            };

            card.innerHTML = `
              <div class="employee-top-row">
                <div class="employee-name">${helpers.escapeHtml(employee.name || '')}</div>
                <div class="employee-dn">DN ${helpers.escapeHtml(employee.dn || '')}</div>
              </div>
              <div class="employee-meta">
                <i class="fas fa-user-tie"></i> ${helpers.escapeHtml(employee.rank || 'Kein Rang')} ‚Ä¢
                <i class="fas fa-building"></i> ${helpers.escapeHtml(employee.unit || 'Keine Unit')}
              </div>
              <div class="induction-badges">
                <div class="induction-badge badge-oral ${oralCompleted ? 'completed' : 'pending'}">
                  <i class="fas ${oralCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
                  M√ºndlich
                </div>
                <div class="induction-badge badge-org ${orgCompleted ? 'completed' : 'pending'}">
                  <i class="fas ${orgCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
                  Organisatorisch
                </div>
              </div>
            `;

            container.appendChild(card);
          });
        },

        getFilteredEmployees() {
          let filtered = state.employees.filter(emp => {
            if (state.showArchived) {
              return emp.status === 'archived';
            } else {
              return !emp.status || emp.status === 'active';
            }
          });

          if (state.currentFilter === 'oral') {
            filtered = filtered.filter(emp => !(emp.inductions?.oral?.completed));
          } else if (state.currentFilter === 'org') {
            filtered = filtered.filter(emp => !(emp.inductions?.org?.completed));
          }

          return filtered;
        },

        getEmptyStateTitle() {
          if (state.showArchived) return 'Keine archivierten Mitarbeiter';
          return 'Keine aktiven Mitarbeiter';
        },

        getEmptyStateDescription() {
          if (state.showArchived) {
            if (state.currentFilter === 'oral') return 'Keine archivierten Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
            if (state.currentFilter === 'org') return 'Keine archivierten Mitarbeiter mit ausstehender organisatorischer Einweisung';
            return 'Keine archivierten Mitarbeiter gefunden';
          }

          if (state.currentFilter === 'oral') return 'Keine Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
          if (state.currentFilter === 'org') return 'Keine Mitarbeiter mit ausstehender organisatorischer Einweisung';
          return 'F√ºgen Sie Ihren ersten Mitarbeiter hinzu';
        },

        filterEmployees(searchTerm) {
          const cards = document.querySelectorAll('.employee-card');
          const term = (searchTerm || '').toLowerCase().trim();

          if (!term) {
            cards.forEach(card => card.style.display = 'flex');
            return;
          }

          cards.forEach(card => {
            const text = card.textContent.toLowerCase();
            card.style.display = text.includes(term) ? 'flex' : 'none';
          });
        },

        filterEmployeesByType(type) {
          state.currentFilter = type;

          document.querySelectorAll('.sidebar-filter-btn').forEach(btn => btn.classList.remove('active'));
          if (type === 'all') document.querySelectorAll('.sidebar-filter-btn')[0].classList.add('active');
          if (type === 'oral') document.querySelectorAll('.sidebar-filter-btn')[1].classList.add('active');
          if (type === 'org') document.querySelectorAll('.sidebar-filter-btn')[2].classList.add('active');

          this.renderEmployeeList();
        },

        selectEmployee(employee) {
          state.currentEmployee = employee;

          document.getElementById('employeeHeader').style.display = 'flex';
          document.getElementById('inductionContent').style.display = 'block';

          this.updateEmployeeHeader();
          this.loadEmployeeData();
          this.updateInductionDisplay();
          this.renderEmployeeList();
        },

        loadEmployeeData() {
          if (!state.currentEmployee) return;

          const oralData = state.currentEmployee.oralData || {};
          const orgData = state.currentEmployee.orgData || {};
          const isArchived = state.currentEmployee.status === 'archived';

          // M√ºndliche Einweisung
          document.getElementById('oralDate').value = oralData.date || (new Date().toISOString().split('T')[0]);
          document.getElementById('oralTimeStart').value = oralData.timeStart || '16:40';
          document.getElementById('oralTimeEnd').value = oralData.timeEnd || '18:00';
          document.getElementById('oralPerson').value = oralData.person || '';
          document.getElementById('oralNotes').value = oralData.notes || '';
          document.getElementById('unitSelect').value = oralData.unit || state.currentEmployee.unit || '';
          document.getElementById('rankSelect').value = oralData.rank || state.currentEmployee.rank || '';

          // Organisatorische Einweisung
          document.getElementById('orgDate').value = orgData.date || (new Date().toISOString().split('T')[0]);
          document.getElementById('orgTimeStart').value = orgData.timeStart || '22:10';
          document.getElementById('orgTimeEnd').value = orgData.timeEnd || '23:05';
          document.getElementById('orgPerson').value = orgData.person || '';
          document.getElementById('orgNotes').value = orgData.notes || '';
          document.getElementById('unitSelect2').value = orgData.unit || state.currentEmployee.unit || '';
          document.getElementById('rankSelect2').value = orgData.rank || state.currentEmployee.rank || '';

          // Toggle-Buttons
          const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
          const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;

          document.getElementById('oralInductionToggle').checked = oralCompleted;
          document.getElementById('orgInductionToggle').checked = orgCompleted;

          this.updateInductionUI('oral', oralCompleted);
          this.updateInductionUI('org', orgCompleted);

          // Archiv-Status
          const archiveTag = document.getElementById('archiveStatusTag');
          const archiveButton = document.getElementById('archiveButton');
          const archiveButtonText = document.getElementById('archiveButtonText');

          if (isArchived) {
            archiveTag.style.display = 'flex';
            archiveButton.style.display = 'inline-flex';
            archiveButtonText.textContent = 'Wiederherstellen';
            document.getElementById('oralInductionToggle').disabled = true;
            document.getElementById('orgInductionToggle').disabled = true;
          } else {
            archiveTag.style.display = 'none';
            archiveButton.style.display = 'inline-flex';
            archiveButtonText.textContent = 'Archivieren';
            document.getElementById('oralInductionToggle').disabled = false;
            document.getElementById('orgInductionToggle').disabled = false;
          }

          this.checkBothInductionsCompleted();
          templates.updateTemplates();
        },

        updateInductionDisplay() {
          if (!state.currentEmployee) return;

          const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
          const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;

          this.updateInductionUI('oral', oralCompleted);
          this.updateInductionUI('org', orgCompleted);

          this.renderEmployeeList();
        },

        updateEmployeeHeader() {
          if (!state.currentEmployee) return;

          document.getElementById('currentEmployeeName').textContent = state.currentEmployee.name || '';
          document.getElementById('currentEmployeeDN').textContent = state.currentEmployee.dn || '';
          document.getElementById('currentEmployeeUnit').textContent = state.currentEmployee.unit || 'Keine Unit';
          document.getElementById('currentEmployeeRank').textContent = state.currentEmployee.rank || 'Kein Rang';
        },

        updateInductionUI(type, completed) {
          const card = document.getElementById(`${type}InductionCard`);
          const status = document.getElementById(`${type}InductionStatus`);

          if (completed) {
            card.classList.add('completed');
            status.textContent = 'BESTANDEN';
          } else {
            card.classList.remove('completed');
            status.textContent = 'AUSSTEHEND';
          }
        },

        saveFormData() {
          if (!state.currentEmployee) return;

          state.currentEmployee.oralData = {
            date: document.getElementById('oralDate').value,
            timeStart: document.getElementById('oralTimeStart').value,
            timeEnd: document.getElementById('oralTimeEnd').value,
            person: document.getElementById('oralPerson').value,
            notes: document.getElementById('oralNotes').value,
            unit: document.getElementById('unitSelect').value,
            rank: document.getElementById('rankSelect').value
          };

          state.currentEmployee.orgData = {
            date: document.getElementById('orgDate').value,
            timeStart: document.getElementById('orgTimeStart').value,
            timeEnd: document.getElementById('orgTimeEnd').value,
            person: document.getElementById('orgPerson').value,
            notes: document.getElementById('orgNotes').value,
            unit: document.getElementById('unitSelect2').value,
            rank: document.getElementById('rankSelect2').value
          };

          const unitSelectValue = document.getElementById('unitSelect').value;
          const rankSelectValue = document.getElementById('rankSelect').value;
          if (unitSelectValue) state.currentEmployee.unit = unitSelectValue;
          if (rankSelectValue) state.currentEmployee.rank = rankSelectValue;
        },

        async saveEmployeeData(autoSave = false) {
          if (!state.currentEmployee) return false;

          try {
            const success = await database.saveEmployee(state.currentEmployee);
            if (success && !autoSave) {
              ui.showNotification('Mitarbeiterdaten gespeichert', 'success');
            }
            return success;
          } catch (error) {
            console.error('Fehler beim Speichern:', error);
            if (!autoSave) {
              ui.showNotification('Fehler beim Speichern: ' + error.message, 'error');
            }
            return false;
          }
        },

        openEditEmployeeModal() {
          if (!state.currentEmployee) {
            ui.showNotification('Bitte w√§hlen Sie zuerst einen Mitarbeiter aus', 'warning');
            return;
          }

          document.getElementById('editEmployeeName').value = state.currentEmployee.name || '';
          document.getElementById('editEmployeeDN').value = state.currentEmployee.dn || '';
          document.getElementById('editEmployeeUnit').value = state.currentEmployee.unit || '';
          document.getElementById('editEmployeeRank').value = state.currentEmployee.rank || '';

          ui.openModal('editEmployeeModal');
        },

        async saveEditedEmployee() {
          if (!state.currentEmployee) return;

          const name = document.getElementById('editEmployeeName').value.trim();
          const dn = document.getElementById('editEmployeeDN').value;

          if (!name || !dn) {
            ui.showNotification('Name und Dienstnummer sind Pflichtfelder', 'warning');
            return;
          }

          state.currentEmployee.name = name;
          state.currentEmployee.dn = dn;
          state.currentEmployee.unit = document.getElementById('editEmployeeUnit').value || '';
          state.currentEmployee.rank = document.getElementById('editEmployeeRank').value || '';

          const success = await this.saveEmployeeData(false);
          if (success) {
            ui.closeModal('editEmployeeModal');
            this.updateEmployeeHeader();
            this.renderEmployeeList();
            templates.updateTemplates();
          }
        },

        async deleteCurrentEmployee() {
          if (!state.currentEmployee) {
            ui.showNotification('Bitte w√§hlen Sie zuerst einen Mitarbeiter aus', 'warning');
            return;
          }

          if (!confirm(`Mitarbeiter "${state.currentEmployee.name}" (DN ${state.currentEmployee.dn}) wirklich l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden!`)) {
            return;
          }

          try {
            const success = await database.deleteEmployee(state.currentEmployee.id);
            if (success) {
              ui.closeModal('editEmployeeModal');
              state.currentEmployee = null;
              document.getElementById('employeeHeader').style.display = 'none';
              document.getElementById('inductionContent').style.display = 'none';
              this.renderEmployeeList();
              main.updateStats();
            }
          } catch (error) {
            console.error('Fehler beim L√∂schen:', error);
            ui.showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
          }
        },

        toggleInduction(type, completed) {
          if (!state.currentEmployee) return;

          if (!state.currentEmployee.inductions) state.currentEmployee.inductions = {};

          state.currentEmployee.inductions[type] = {
            completed: completed,
            date: completed ? new Date().toISOString() : null,
            updatedBy: 'System'
          };

          this.updateInductionUI(type, completed);
          templates.updateTemplates();
          this.saveEmployeeData(true);
          this.checkBothInductionsCompleted();
          this.renderEmployeeList();
          main.updateStats();

          const typeName = type === 'oral' ? 'M√ºndliche' : 'Organisatorische';
          const status = completed ? 'bestanden' : 'als ausstehend markiert';
          ui.showNotification(`${typeName} Einweisung ${status}`, 'success');
        },

        checkBothInductionsCompleted() {
          if (!state.currentEmployee) return false;

          const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
          const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;

          const nowBothCompleted = oralCompleted && orgCompleted;

          if (nowBothCompleted && !state.bothInductionsCompleted) {
            state.bothInductionsCompleted = true;
          } else if (!nowBothCompleted) {
            state.bothInductionsCompleted = false;
          }

          return nowBothCompleted;
        },

        openNewEmployeeModal() {
          ui.openModal('newEmployeeModal');
        },

        async createNewEmployee() {
          const name = document.getElementById('newEmployeeName').value.trim();
          const dn = document.getElementById('newEmployeeDN').value;
          const unit = document.getElementById('newEmployeeUnit').value;
          const rank = document.getElementById('newEmployeeRank').value;

          if (!name || !dn) {
            ui.showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
            return;
          }

          const employeeId = helpers.generateId('EMP');

          const newEmployee = {
            id: employeeId,
            name,
            dn,
            unit: unit || '',
            rank: rank || '',
            lastUpdated: new Date().toISOString(),
            inductions: { oral: { completed: false }, org: { completed: false } },
            oralData: { date: '', timeStart: '16:40', timeEnd: '18:00', person: '', notes: '', unit: unit || '', rank: rank || '' },
            orgData: { date: '', timeStart: '22:10', timeEnd: '23:05', person: '', notes: '', unit: unit || '', rank: rank || '' },
            status: 'active'
          };

          try {
            await db.collection('hrEmployees').doc(employeeId).set(newEmployee);

            ui.closeModal('newEmployeeModal');
            this.selectEmployee(newEmployee);
            main.updateStats();

            document.getElementById('newEmployeeName').value = '';
            document.getElementById('newEmployeeDN').value = '';
            document.getElementById('newEmployeeUnit').value = '';
            document.getElementById('newEmployeeRank').value = '';

            ui.showNotification(`Mitarbeiter "${name}" erstellt`, 'success');
          } catch (error) {
            console.error('Fehler beim Erstellen:', error);
            ui.showNotification('Fehler beim Erstellen: ' + error.message, 'error');
          }
        },

        showEmployeeContextMenu(e, employee) {
          e.preventDefault();

          const existingMenu = document.getElementById('contextMenu');
          if (existingMenu) existingMenu.remove();

          const menu = document.createElement('div');
          menu.id = 'contextMenu';
          menu.style.cssText = `
            position: fixed;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            border-radius: 8px;
            padding: 8px;
            z-index: 1000;
            min-width: 160px;
            box-shadow: var(--shadow-md);
          `;

          const isArchived = employee.status === 'archived';

          menu.innerHTML = `
            <div style="padding: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
              <div style="font-weight: 900; color: white; margin-bottom: 2px; font-size: 13px;">${helpers.escapeHtml(employee.name || '')}</div>
              <div style="font-size: 11px; color: var(--gray);">DN: ${helpers.escapeHtml(employee.dn || '')}</div>
              ${isArchived ? '<div style="font-size: 10px; color: var(--warning); margin-top: 4px;"><i class="fas fa-archive"></i> Archiviert</div>' : ''}
            </div>
            <div style="padding: 4px 0;">
              <button onclick="HRApp.selectEmployee(HRApp.state.employees.find(x => x.id === '${employee.id}')); HRApp.openEditEmployeeModal(); document.getElementById('contextMenu')?.remove();"
                style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:var(--primary-light);font-weight:900;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;margin-bottom:2px;">
                <i class="fas fa-edit"></i> Bearbeiten
              </button>
              <button onclick="HRApp.toggleArchiveEmployeeContext('${employee.id}')"
                style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:${isArchived ? 'var(--secondary)' : 'var(--warning)'};font-weight:900;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;margin-bottom:2px;">
                <i class="fas ${isArchived ? 'fa-undo' : 'fa-archive'}"></i> ${isArchived ? 'Wiederherstellen' : 'Archivieren'}
              </button>
              <button onclick="HRApp.deleteEmployeePermanently('${employee.id}')"
                style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:var(--danger);font-weight:900;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;">
                <i class="fas fa-trash"></i> L√∂schen
              </button>
            </div>
          `;

          menu.style.left = `${Math.min(e.pageX, window.innerWidth - 180)}px`;
          menu.style.top = `${Math.min(e.pageY, window.innerHeight - 240)}px`;

          document.body.appendChild(menu);

          setTimeout(() => {
            const closeMenu = (event) => {
              if (!menu.contains(event.target)) {
                menu.remove();
                document.removeEventListener('click', closeMenu);
              }
            };
            document.addEventListener('click', closeMenu);
          }, 100);
        },

        async toggleArchiveEmployeeContext(employeeId) {
          const employee = state.employees.find(emp => emp.id === employeeId);
          if (!employee) return;

          const newStatus = employee.status === 'archived' ? 'active' : 'archived';

          try {
            await db.collection('hrEmployees').doc(employeeId).update({
              status: newStatus,
              lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });

            const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
            ui.showNotification(message, 'success');

            document.getElementById('contextMenu')?.remove();
          } catch (error) {
            console.error('Fehler beim Archivieren/Wiederherstellen:', error);
            ui.showNotification('Fehler: ' + error.message, 'error');
          }
        },

        async deleteEmployeePermanently(employeeId) {
          const employee = state.employees.find(emp => emp.id === employeeId);
          if (!employee) return;

          if (!confirm(`Mitarbeiter "${employee.name}" (DN ${employee.dn}) wirklich endg√ºltig l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden!`)) {
            return;
          }

          try {
            await db.collection('hrEmployees').doc(employeeId).delete();

            if (state.currentEmployee && state.currentEmployee.id === employeeId) {
              state.currentEmployee = null;
              document.getElementById('employeeHeader').style.display = 'none';
              document.getElementById('inductionContent').style.display = 'none';
            }

            ui.showNotification('Mitarbeiter endg√ºltig gel√∂scht', 'success');
            document.getElementById('contextMenu')?.remove();
          } catch (error) {
            console.error('Fehler beim L√∂schen:', error);
            ui.showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
          }
        },

        async toggleArchiveEmployee() {
          if (!state.currentEmployee) return;

          const newStatus = state.currentEmployee.status === 'archived' ? 'active' : 'archived';

          try {
            await db.collection('hrEmployees').doc(state.currentEmployee.id).update({
              status: newStatus,
              lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });

            const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
            ui.showNotification(message, 'success');
          } catch (error) {
            console.error('Fehler beim Archivieren/Wiederherstellen:', error);
            ui.showNotification('Fehler: ' + error.message, 'error');
          }
        },

        toggleArchiveView() {
          state.showArchived = !state.showArchived;
          const buttonText = document.getElementById('archiveToggleText');
          buttonText.textContent = state.showArchived ? 'Aktive anzeigen' : 'Archiv anzeigen';
          this.renderEmployeeList();
        }
      };

      // ==================== TEMPLATES FUNKTIONEN ====================
      const templates = {
        updateTemplates() {
          if (!state.currentEmployee) {
            this.seedTemplateBoxes();
            return;
          }

          employees.saveFormData();

          const oralTemplate = this.generateTemplate('oral');
          document.getElementById('oralTemplateContent').textContent = oralTemplate;

          const orgTemplate = this.generateTemplate('org');
          document.getElementById('orgTemplateContent').textContent = orgTemplate;

          const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
          const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;

          document.getElementById('oralTemplateBadge').textContent = oralCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
          document.getElementById('orgTemplateBadge').textContent = orgCompleted ? 'BESTANDEN' : 'AUSSTEHEND';

          document.getElementById('oralTemplateCard').classList.toggle('completed', oralCompleted);
          document.getElementById('orgTemplateCard').classList.toggle('completed', orgCompleted);
        },

        generateTemplate(type) {
          const isOral = type === 'oral';
          const completed = isOral
            ? (state.currentEmployee.inductions?.oral?.completed || false)
            : (state.currentEmployee.inductions?.org?.completed || false);

          const data = isOral ? state.currentEmployee.oralData : state.currentEmployee.orgData;

          const name = state.currentEmployee.name || '';
          const dn = state.currentEmployee.dn || '';

          const unit = isOral
            ? (document.getElementById('unitSelect').value || state.currentEmployee.unit || '')
            : (document.getElementById('unitSelect2').value || state.currentEmployee.unit || '');

          const rank = isOral
            ? (document.getElementById('rankSelect').value || state.currentEmployee.rank || '')
            : (document.getElementById('rankSelect2').value || state.currentEmployee.rank || '');

          const date = data?.date ? helpers.formatDate(data.date) : '';
          const timeStart = data?.timeStart || '';
          const timeEnd = data?.timeEnd || '';
          const person = data?.person || '';
          const notes = data?.notes || '';

          const timeSeparator = isOral ? 'bis' : '-';

          const unitSetting = state.settings.units.find(u => u.name === unit);
          const rankSetting = state.settings.ranks.find(r => r.name === rank);

          const unitDiscordId = unitSetting?.discordId || '';
          const rankDiscordId = rankSetting?.discordId || '';

          const unitDisplay = unitDiscordId ? `<@&${unitDiscordId}>` : unit;
          const rankDisplay = rankDiscordId ? `<@&${rankDiscordId}>` : rank;

          return `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
${isOral ? 'M√ºndliche Einweisung' : 'Organisatorische Einweisung'}

Name: ${name}
DN: ${dn}
Hauptunit: ${unitDisplay}
Rang: ${rankDisplay}
Datum: ${date}
Uhrzeit: ${timeStart} ${timeSeparator} ${timeEnd}
Beteiligte: ${person}
Sonstiges: ${notes}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
        },

        async copyOralTemplate() {
          const template = document.getElementById('oralTemplateContent').textContent;
          const success = await helpers.copyToClipboard(template);
          ui.showNotification(success ? 'M√ºndliche Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        async copyOrgTemplate() {
          const template = document.getElementById('orgTemplateContent').textContent;
          const success = await helpers.copyToClipboard(template);
          ui.showNotification(success ? 'Organisatorische Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        seedTemplateBoxes() {
          document.getElementById('oralTemplateContent').textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
M√ºndliche Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;

          document.getElementById('orgTemplateContent').textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Organisatorische Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
        }
      };

      // ==================== ANK√úNDIGUNGEN FUNKTIONEN ====================
      const ankundigungen = {
        async loadAnkundigungen() {
          const container = document.getElementById('ankundigungenList');
          ui.showLoading('ankundigungenList', 'Lade Ank√ºndigungen...');

          try {
            const querySnapshot = await db.collection('hrAnkundigungen')
              .where('type', '==', 'ankundigung')
              .orderBy('created', 'desc')
              .get();

            if (querySnapshot.empty) {
              ui.showEmptyState('ankundigungenList', {
                icon: 'bullhorn',
                title: 'Keine Ank√ºndigungen gefunden',
                description: 'Erstellen Sie Ihre erste Ank√ºndigung in den Settings'
              });
              return;
            }

            let items = [];
            querySnapshot.forEach(doc => {
              const item = doc.data();
              items.push({ ...item, id: doc.id });
            });

            this.renderAnkundigungenList(items, 'ankundigungenList');
          } catch (error) {
            console.error('Fehler beim Laden der Ank√ºndigungen:', error);
            ui.showEmptyState('ankundigungenList', {
              icon: 'exclamation-triangle',
              title: 'Fehler beim Laden',
              description: error.message
            });
          }
        },

        renderAnkundigungenList(items, containerId) {
          const container = document.getElementById(containerId);
          if (!container) return;

          if (items.length === 0) {
            ui.showEmptyState(containerId, {
              icon: 'bullhorn',
              title: 'Keine Ank√ºndigungen gefunden'
            });
            return;
          }

          let html = '';
          items.forEach(item => {
            const title = item.title || 'Ohne Titel';
            const date = item.createdFormatted || helpers.formatDate(item.created || Date.now());
            const content = item.content || '';

            html += `
              <div class="list-item">
                <div class="item-header">
                  <div class="item-title">
                    <span>${item.icon || 'ü™ß'}</span> ${helpers.escapeHtml(title)}
                  </div>
                  <div class="item-type">
                    Ank√ºndigung
                  </div>
                </div>
                <div class="item-date">
                  <i class="fas fa-calendar"></i> ${date}
                </div>
                <div class="item-content">
                  ${helpers.escapeHtml(content)}
                </div>
              </div>
            `;
          });

          container.innerHTML = html;
        },

        searchAnkundigungen(searchTerm) {
          const items = document.querySelectorAll('#ankundigungenList .list-item');
          const term = searchTerm.toLowerCase().trim();

          if (!term) {
            items.forEach(item => item.style.display = 'block');
            return;
          }

          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(term) ? 'block' : 'none';
          });
        },

        openAnkundigungenModal() {
          ui.openModal('ankundigungenModal');
          this.loadAnkundigungen();
        }
      };

      // ==================== BESPRECHUNGEN FUNKTIONEN ====================
      const besprechungen = {
        async loadBesprechungen() {
          const container = document.getElementById('besprechungenList');
          ui.showLoading('besprechungenList', 'Lade Besprechungen...');

          try {
            const querySnapshot = await db.collection('hrAnkundigungen')
              .where('type', '==', 'besprechung')
              .orderBy('created', 'desc')
              .get();

            if (querySnapshot.empty) {
              ui.showEmptyState('besprechungenList', {
                icon: 'calendar-alt',
                title: 'Keine Besprechungen gefunden',
                description: 'Erstellen Sie Ihre erste Besprechung in den Settings'
              });
              return;
            }

            let items = [];
            querySnapshot.forEach(doc => {
              const item = doc.data();
              items.push({ ...item, id: doc.id });
            });

            this.renderBesprechungenList(items, 'besprechungenList');
          } catch (error) {
            console.error('Fehler beim Laden der Besprechungen:', error);
            ui.showEmptyState('besprechungenList', {
              icon: 'exclamation-triangle',
              title: 'Fehler beim Laden',
              description: error.message
            });
          }
        },

        renderBesprechungenList(items, containerId) {
          const container = document.getElementById(containerId);
          if (!container) return;

          if (items.length === 0) {
            ui.showEmptyState(containerId, {
              icon: 'calendar-alt',
              title: 'Keine Besprechungen gefunden'
            });
            return;
          }

          let html = '';
          items.forEach(item => {
            const title = item.thema || 'Ohne Thema';
            const date = item.date ? helpers.formatDate(item.date) : helpers.formatDate(item.created || Date.now());
            const content = item.content || '';

            html += `
              <div class="list-item">
                <div class="item-header">
                  <div class="item-title">
                    <span>${item.icon || 'üóÉÔ∏è'}</span> ${helpers.escapeHtml(title)}
                  </div>
                  <div class="item-type">
                    Besprechung
                  </div>
                </div>
                <div class="item-date">
                  <i class="fas fa-calendar"></i> ${date}
                  ${item.time ? ` ‚Ä¢ ${item.time}` : ''}
                  ${item.ort ? ` ‚Ä¢ ${item.ort}` : ''}
                </div>
                <div class="item-content">
                  ${helpers.escapeHtml(content)}
                </div>
              </div>
            `;
          });

          container.innerHTML = html;
        },

        searchBesprechungen(searchTerm) {
          const items = document.querySelectorAll('#besprechungenList .list-item');
          const term = searchTerm.toLowerCase().trim();

          if (!term) {
            items.forEach(item => item.style.display = 'block');
            return;
          }

          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(term) ? 'block' : 'none';
          });
        },

        openBesprechungenModal() {
          ui.openModal('besprechungenModal');
          this.loadBesprechungen();
        }
      };

      // ==================== SETTINGS FUNKTIONEN ====================
      const settings = {
        async loadSettings() {
          const loadedSettings = await database.getSettings();
          state.settings = { ...state.settings, ...loadedSettings };
          this.updateUnitAndRankSelects();
          this.populateSettingsUI();
        },

        populateSettingsUI() {
          const unitList = document.getElementById('unitList');
          unitList.innerHTML = '';

          state.settings.units.forEach((unit, index) => {
            const unitItem = document.createElement('div');
            unitItem.className = 'list-item-settings';
            unitItem.innerHTML = `
              <div class="list-item-name">${helpers.escapeHtml(unit.name)}</div>
              <input type="text" class="discord-id-input" value="${helpers.escapeHtml(unit.discordId || '')}" 
                     placeholder="Discord Rollen-ID" onchange="HRApp.updateUnitDiscordId(${index}, this.value)">
              <button class="btn btn-danger" onclick="HRApp.removeUnit(${index})">
                <i class="fas fa-trash"></i>
              </button>
            `;
            unitList.appendChild(unitItem);
          });

          const rankList = document.getElementById('rankList');
          rankList.innerHTML = '';

          state.settings.ranks.forEach((rank, index) => {
            const rankItem = document.createElement('div');
            rankItem.className = 'list-item-settings';
            rankItem.innerHTML = `
              <div class="list-item-name">${helpers.escapeHtml(rank.name)}</div>
              <input type="text" class="discord-id-input" value="${helpers.escapeHtml(rank.discordId || '')}" 
                     placeholder="Discord Rollen-ID" onchange="HRApp.updateRankDiscordId(${index}, this.value)">
              <button class="btn btn-danger" onclick="HRApp.removeRank(${index})">
                <i class="fas fa-trash"></i>
              </button>
            `;
            rankList.appendChild(rankItem);
          });
        },

        updateUnitAndRankSelects() {
          const unitSelects = [
            document.getElementById('unitSelect'),
            document.getElementById('unitSelect2'),
            document.getElementById('newEmployeeUnit'),
            document.getElementById('editEmployeeUnit'),
            document.getElementById('soldatenUnit'),
            document.getElementById('akteUnit'),
            document.getElementById('beobachtungUnit')
          ];

          unitSelects.forEach(select => {
            if (select) {
              const currentValue = select.value;
              select.innerHTML = '<option value="">Unit ausw√§hlen</option>';

              if (state.settings.units && state.settings.units.length > 0) {
                state.settings.units.forEach(unit => {
                  const option = document.createElement('option');
                  option.value = unit.name;
                  option.textContent = unit.name;
                  select.appendChild(option);
                });
              }

              select.value = currentValue;
            }
          });

          const rankSelects = [
            document.getElementById('rankSelect'),
            document.getElementById('rankSelect2'),
            document.getElementById('newEmployeeRank'),
            document.getElementById('editEmployeeRank'),
            document.getElementById('soldatenRank'),
            document.getElementById('akteRank'),
            document.getElementById('beobachtungRank')
          ];

          rankSelects.forEach(select => {
            if (select) {
              const currentValue = select.value;
              select.innerHTML = '<option value="">Rang ausw√§hlen</option>';

              if (state.settings.ranks && state.settings.ranks.length > 0) {
                state.settings.ranks.forEach(rank => {
                  const option = document.createElement('option');
                  option.value = rank.name;
                  option.textContent = rank.name;
                  select.appendChild(option);
                });
              }

              select.value = currentValue;
            }
          });
        },

        addNewUnit() {
          const name = prompt('Name der neuen Unit:');
          if (name && name.trim()) {
            state.settings.units.push({
              name: name.trim(),
              discordId: ''
            });
            this.populateSettingsUI();
            ui.showNotification('Unit hinzugef√ºgt', 'success');
          }
        },

        addNewRank() {
          const name = prompt('Name des neuen Rangs:');
          if (name && name.trim()) {
            state.settings.ranks.push({
              name: name.trim(),
              discordId: ''
            });
            this.populateSettingsUI();
            ui.showNotification('Rang hinzugef√ºgt', 'success');
          }
        },

        updateUnitDiscordId(index, discordId) {
          if (index >= 0 && index < state.settings.units.length) {
            state.settings.units[index].discordId = discordId;
          }
        },

        updateRankDiscordId(index, discordId) {
          if (index >= 0 && index < state.settings.ranks.length) {
            state.settings.ranks[index].discordId = discordId;
          }
        },

        removeUnit(index) {
          if (confirm('Unit wirklich l√∂schen?')) {
            state.settings.units.splice(index, 1);
            this.populateSettingsUI();
            ui.showNotification('Unit gel√∂scht', 'success');
          }
        },

        removeRank(index) {
          if (confirm('Rang wirklich l√∂schen?')) {
            state.settings.ranks.splice(index, 1);
            this.populateSettingsUI();
            ui.showNotification('Rang gel√∂scht', 'success');
          }
        },

        async saveSettings() {
          const success = await database.saveSettings(state.settings);
          if (success) {
            this.updateUnitAndRankSelects();
            ui.closeModal('settingsModal');
            ui.showNotification('Einstellungen gespeichert', 'success');
          } else {
            ui.showNotification('Fehler beim Speichern der Einstellungen', 'error');
          }
        },

        switchSettingsTab(tabName) {
          state.currentSettingsTab = tabName;

          document.querySelectorAll('.settings-tabs .tab-button').forEach(tab => {
            tab.classList.remove('active');
          });

          document.querySelectorAll('#settingsModal .tab-content').forEach(content => {
            content.classList.remove('active');
          });

          if (tabName === 'units') {
            document.querySelector('.settings-tabs .tab-button:nth-child(1)').classList.add('active');
            document.getElementById('unitsTab').classList.add('active');
          } else if (tabName === 'ranks') {
            document.querySelector('.settings-tabs .tab-button:nth-child(2)').classList.add('active');
            document.getElementById('ranksTab').classList.add('active');
          } else if (tabName === 'ankundigungen') {
            document.querySelector('.settings-tabs .tab-button:nth-child(3)').classList.add('active');
            document.getElementById('ankundigungenTab').classList.add('active');
          }
        },

        switchAnkundigungenTab(tabName) {
          state.currentAnkundigungenTab = tabName;

          const tabs = document.querySelectorAll('#ankundigungenTab .sub-tabs .tab-button');
          const contents = document.querySelectorAll('#ankundigungenTab .tab-content');

          tabs.forEach(tab => tab.classList.remove('active'));
          contents.forEach(content => content.classList.remove('active'));

          if (tabName === 'new') {
            tabs[0].classList.add('active');
            document.getElementById('ankundigungenNewTab').classList.add('active');
          } else if (tabName === 'besprechung') {
            tabs[1].classList.add('active');
            document.getElementById('ankundigungenBesprechungTab').classList.add('active');
          } else if (tabName === 'manage-ankundigungen') {
            tabs[2].classList.add('active');
            document.getElementById('ankundigungenManageAnkundigungenTab').classList.add('active');
            this.loadManageAnkundigungen();
          } else if (tabName === 'manage-besprechungen') {
            tabs[3].classList.add('active');
            document.getElementById('ankundigungenManageBesprechungenTab').classList.add('active');
            this.loadManageBesprechungen();
          }
        },

        async loadManageAnkundigungen() {
          ui.showLoading('manageAnkundigungenList');

          try {
            const querySnapshot = await db.collection('hrAnkundigungen')
              .where('type', '==', 'ankundigung')
              .orderBy('created', 'desc')
              .get();

            if (querySnapshot.empty) {
              ui.showEmptyState('manageAnkundigungenList', {
                icon: 'bullhorn',
                title: 'Keine Ank√ºndigungen gefunden'
              });
              return;
            }

            let items = [];
            querySnapshot.forEach(doc => {
              const item = doc.data();
              items.push({ ...item, id: doc.id });
            });

            this.renderManageList(items, 'manageAnkundigungenList', 'ankundigung');
          } catch (error) {
            console.error('Fehler beim Laden der Ank√ºndigungen:', error);
            ui.showEmptyState('manageAnkundigungenList', {
              icon: 'exclamation-triangle',
              title: 'Fehler beim Laden'
            });
          }
        },

        async loadManageBesprechungen() {
          ui.showLoading('manageBesprechungenList');

          try {
            const querySnapshot = await db.collection('hrAnkundigungen')
              .where('type', '==', 'besprechung')
              .orderBy('created', 'desc')
              .get();

            if (querySnapshot.empty) {
              ui.showEmptyState('manageBesprechungenList', {
                icon: 'calendar-alt',
                title: 'Keine Besprechungen gefunden'
              });
              return;
            }

            let items = [];
            querySnapshot.forEach(doc => {
              const item = doc.data();
              items.push({ ...item, id: doc.id });
            });

            this.renderManageList(items, 'manageBesprechungenList', 'besprechung');
          } catch (error) {
            console.error('Fehler beim Laden der Besprechungen:', error);
            ui.showEmptyState('manageBesprechungenList', {
              icon: 'exclamation-triangle',
              title: 'Fehler beim Laden'
            });
          }
        },

        renderManageList(items, containerId, type) {
          const container = document.getElementById(containerId);
          if (!container) return;

          if (items.length === 0) {
            ui.showEmptyState(containerId, {
              icon: type === 'ankundigung' ? 'bullhorn' : 'calendar-alt',
              title: `Keine ${type === 'ankundigung' ? 'Ank√ºndigungen' : 'Besprechungen'} gefunden`
            });
            return;
          }

          let html = '';
          items.forEach(item => {
            const date = type === 'ankundigung'
              ? (item.createdFormatted || helpers.formatDate(item.created || Date.now()))
              : (item.date ? helpers.formatDate(item.date) : helpers.formatDate(item.created || Date.now()));

            const title = type === 'ankundigung' ? item.title || 'Ohne Titel' : item.thema || 'Ohne Thema';
            const icon = type === 'ankundigung' ? 'ü™ß' : 'üóÉÔ∏è';

            html += `
              <div class="list-item">
                <div class="item-header">
                  <div class="item-title">
                    <span>${icon}</span> ${helpers.escapeHtml(title)}
                  </div>
                  <div class="item-type">
                    ${type === 'ankundigung' ? 'Ank√ºndigung' : 'Besprechung'}
                  </div>
                </div>
                <div class="item-date">
                  <i class="fas fa-calendar"></i> ${date}
                  ${type === 'besprechung' && item.time ? ` ‚Ä¢ ${item.time}` : ''}
                  ${type === 'besprechung' && item.ort ? ` ‚Ä¢ ${item.ort}` : ''}
                </div>
                <div class="item-content">
                  ${helpers.escapeHtml(item.content || '')}
                </div>
                <div class="form-actions" style="justify-content: flex-end; padding: 0; border: none; margin: 0;">
                  <button class="btn btn-secondary" onclick="HRApp.editItem('${item.id}', '${type}')">
                    <i class="fas fa-edit"></i> Bearbeiten
                  </button>
                  <button class="btn btn-danger" onclick="HRApp.deleteItem('${item.id}', '${type}')">
                    <i class="fas fa-trash"></i> L√∂schen
                  </button>
                </div>
              </div>
            `;
          });

          container.innerHTML = html;
        },

        searchManageAnkundigungen(searchTerm) {
          const items = document.querySelectorAll('#manageAnkundigungenList .list-item');
          const term = searchTerm.toLowerCase().trim();

          if (!term) {
            items.forEach(item => item.style.display = 'block');
            return;
          }

          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(term) ? 'block' : 'none';
          });
        },

        searchManageBesprechungen(searchTerm) {
          const items = document.querySelectorAll('#manageBesprechungenList .list-item');
          const term = searchTerm.toLowerCase().trim();

          if (!term) {
            items.forEach(item => item.style.display = 'block');
            return;
          }

          items.forEach(item => {
            const text = item.textContent.toLowerCase();
            item.style.display = text.includes(term) ? 'block' : 'none';
          });
        },

        async editItem(id, type) {
          try {
            const doc = await db.collection('hrAnkundigungen').doc(id).get();
            if (!doc.exists) {
              ui.showNotification(`${type === 'ankundigung' ? 'Ank√ºndigung' : 'Besprechung'} nicht gefunden`, 'error');
              return;
            }

            const item = doc.data();
            state.currentEditItemId = id;
            state.currentEditItemType = type;

            document.getElementById('editItemTitle').innerHTML = `
              <i class="fas fa-edit"></i> ${type === 'ankundigung' ? 'Ank√ºndigung' : 'Besprechung'} bearbeiten
            `;

            let formHtml = '';
            if (type === 'ankundigung') {
              formHtml = `
                <div class="settings-form-group">
                  <label class="settings-label">Titel</label>
                  <input type="text" class="settings-input" id="editAnkundigungTitle" value="${helpers.escapeHtml(item.title || '')}">
                </div>
                <div class="settings-form-group">
                  <label class="settings-label">Inhalt *</label>
                  <textarea class="settings-input" id="editAnkundigungContent" rows="6">${helpers.escapeHtml(item.content || '')}</textarea>
                </div>
              `;
            } else {
              formHtml = `
                <div class="settings-form-group">
                  <label class="settings-label">Thema *</label>
                  <input type="text" class="settings-input" id="editBesprechungThema" value="${helpers.escapeHtml(item.thema || '')}">
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin-bottom: 16px;">
                  <div class="settings-form-group">
                    <label class="settings-label">Datum *</label>
                    <input type="date" class="settings-input" id="editBesprechungDate" value="${item.date || ''}">
                  </div>
                  <div class="settings-form-group">
                    <label class="settings-label">Uhrzeit *</label>
                    <input type="time" class="settings-input" id="editBesprechungTime" value="${item.time || ''}">
                  </div>
                  <div class="settings-form-group">
                    <label class="settings-label">Ort</label>
                    <input type="text" class="settings-input" id="editBesprechungOrt" value="${helpers.escapeHtml(item.ort || '')}">
                  </div>
                </div>
                <div class="settings-form-group">
                  <label class="settings-label">Inhalt *</label>
                  <textarea class="settings-input" id="editBesprechungContent" rows="6">${helpers.escapeHtml(item.content || '')}</textarea>
                </div>
              `;
            }

            document.getElementById('editItemForm').innerHTML = formHtml;
            ui.openModal('editItemModal');
          } catch (error) {
            console.error('Fehler beim Laden:', error);
            ui.showNotification('Fehler: ' + error.message, 'error');
          }
        },

        async saveEditedItem() {
          if (!state.currentEditItemId || !state.currentEditItemType) return;

          try {
            if (state.currentEditItemType === 'ankundigung') {
              const title = document.getElementById('editAnkundigungTitle').value.trim();
              const content = document.getElementById('editAnkundigungContent').value.trim();

              if (!content) {
                ui.showNotification('Bitte geben Sie den Inhalt der Ank√ºndigung ein', 'warning');
                return;
              }

              await db.collection('hrAnkundigungen').doc(state.currentEditItemId).update({
                title: title || 'Ohne Titel',
                content,
                updated: new Date().toISOString()
              });

              ui.closeModal('editItemModal');
              ui.showNotification('Ank√ºndigung erfolgreich aktualisiert', 'success');

              this.loadManageAnkundigungen();
              ankundigungen.loadAnkundigungen();
            } else {
              const thema = document.getElementById('editBesprechungThema').value.trim();
              const date = document.getElementById('editBesprechungDate').value;
              const time = document.getElementById('editBesprechungTime').value;
              const ort = document.getElementById('editBesprechungOrt').value.trim();
              const content = document.getElementById('editBesprechungContent').value.trim();

              if (!thema || !date || !time || !content) {
                ui.showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
                return;
              }

              await db.collection('hrAnkundigungen').doc(state.currentEditItemId).update({
                thema,
                date,
                time,
                ort: ort || '',
                content,
                updated: new Date().toISOString()
              });

              ui.closeModal('editItemModal');
              ui.showNotification('Besprechung erfolgreich aktualisiert', 'success');

              this.loadManageBesprechungen();
              besprechungen.loadBesprechungen();
            }
          } catch (error) {
            console.error('Fehler beim Aktualisieren:', error);
            ui.showNotification('Fehler: ' + error.message, 'error');
          }
        },

        async deleteItem(id, type) {
          if (!confirm(`${type === 'ankundigung' ? 'Ank√ºndigung' : 'Besprechung'} wirklich l√∂schen?`)) return;

          try {
            await db.collection('hrAnkundigungen').doc(id).delete();

            ui.showNotification(`${type === 'ankundigung' ? 'Ank√ºndigung' : 'Besprechung'} gel√∂scht`, 'success');

            if (type === 'ankundigung') {
              this.loadManageAnkundigungen();
            } else {
              this.loadManageBesprechungen();
            }
          } catch (error) {
            console.error('Fehler beim L√∂schen:', error);
            ui.showNotification('Fehler: ' + error.message, 'error');
          }
        },

        async saveAnkundigung() {
          const title = document.getElementById('ankundigungTitle').value.trim();
          const content = document.getElementById('ankundigungContent').value.trim();

          if (!content) {
            ui.showNotification('Bitte geben Sie den Inhalt der Ank√ºndigung ein', 'warning');
            return;
          }

          const ankundigung = {
            id: helpers.generateId('ANK'),
            type: 'ankundigung',
            title: title || 'Ohne Titel',
            content: content,
            created: new Date().toISOString(),
            createdFormatted: helpers.formatDate(Date.now()),
            icon: 'ü™ß'
          };

          try {
            await db.collection('hrAnkundigungen').doc(ankundigung.id).set(ankundigung);

            ui.showNotification('Ank√ºndigung erfolgreich gespeichert', 'success');
            document.getElementById('ankundigungTitle').value = '';
            document.getElementById('ankundigungContent').value = '';

            ui.closeModal('settingsModal');
          } catch (error) {
            console.error('Fehler beim Speichern der Ank√ºndigung:', error);
            ui.showNotification('Fehler beim Speichern: ' + error.message, 'error');
          }
        },

        async saveBesprechung() {
          const thema = document.getElementById('besprechungThema').value.trim();
          const date = document.getElementById('besprechungDate').value;
          const time = document.getElementById('besprechungTime').value;
          const ort = document.getElementById('besprechungOrt').value.trim();
          const content = document.getElementById('besprechungContent').value.trim();

          if (!thema || !date || !time || !content) {
            ui.showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
            return;
          }

          const besprechung = {
            id: helpers.generateId('BES'),
            type: 'besprechung',
            thema,
            date,
            time,
            ort: ort || '',
            content,
            created: new Date().toISOString(),
            createdFormatted: helpers.formatDate(Date.now()),
            icon: 'üóÉÔ∏è'
          };

          try {
            await db.collection('hrAnkundigungen').doc(besprechung.id).set(besprechung);

            ui.showNotification('Besprechung erfolgreich gespeichert', 'success');
            document.getElementById('besprechungThema').value = '';
            document.getElementById('besprechungDate').value = '';
            document.getElementById('besprechungTime').value = '';
            document.getElementById('besprechungOrt').value = '';
            document.getElementById('besprechungContent').value = '';

            ui.closeModal('settingsModal');
          } catch (error) {
            console.error('Fehler beim Speichern der Besprechung:', error);
            ui.showNotification('Fehler beim Speichern: ' + error.message, 'error');
          }
        }
      };

      // ==================== SOLDATENGESPR√ÑCH FUNKTIONEN ====================
      const soldaten = {
        openSoldatenModal() {
          ui.openModal('soldatenModal');
          this.updateSoldatenPreview();
        },

        switchSoldatenTab(tabName) {
          state.currentSoldatenTab = tabName;

          const tabs = document.querySelectorAll('#soldatenModal .sub-tabs .tab-button');
          const contents = document.querySelectorAll('#soldatenModal .tab-content');

          tabs.forEach(tab => tab.classList.remove('active'));
          contents.forEach(content => content.classList.remove('active'));

          if (tabName === 'new') {
            tabs[0].classList.add('active');
            document.getElementById('soldatenNewTab').classList.add('active');
          } else if (tabName === 'list') {
            tabs[1].classList.add('active');
            document.getElementById('soldatenListTab').classList.add('active');
            this.renderSoldatenListe();
          }
        },

        updateSoldatenPreview() {
          const name = document.getElementById('soldatenName').value;
          const dn = document.getElementById('soldatenDN').value;
          const unit = document.getElementById('soldatenUnit').value;
          const rank = document.getElementById('soldatenRank').value;
          const date = document.getElementById('soldatenDate').value;
          const time = document.getElementById('soldatenTime').value;
          const notizen = document.getElementById('soldatenNotizen').value;
          const sonstiges = document.getElementById('soldatenSonstiges').value;

          const formattedDate = date ? helpers.formatDate(date) : '';

          const unitSetting = state.settings.units.find(u => u.name === unit);
          const rankSetting = state.settings.ranks.find(r => r.name === rank);

          const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
          const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;

          const template = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Soldatengespr√§ch

Name: ${name || ''}
DN: ${dn || ''}
Hauptunit: ${unitDisplay || ''}
Rang: ${rankDisplay || ''}
Datum: ${formattedDate}
Uhrzeit: ${time || ''}
Notizen: ${notizen || ''}
Sonstiges: ${sonstiges || ''}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;

          document.getElementById('soldatenPreview').textContent = template;
        },

        async copySoldatenTemplate() {
          const template = document.getElementById('soldatenPreview').textContent;
          const success = await helpers.copyToClipboard(template);
          ui.showNotification(success ? 'Soldatengespr√§ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        async saveSoldatenGespr√§ch() {
          const name = document.getElementById('soldatenName').value.trim();
          const dn = document.getElementById('soldatenDN').value;
          const unit = document.getElementById('soldatenUnit').value;
          const rank = document.getElementById('soldatenRank').value;
          const date = document.getElementById('soldatenDate').value;
          const time = document.getElementById('soldatenTime').value;
          const notizen = document.getElementById('soldatenNotizen').value.trim();
          const sonstiges = document.getElementById('soldatenSonstiges').value.trim();

          if (!name || !dn || !date || !time || !notizen) {
            ui.showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
            return;
          }

          const gespr√§ch = {
            id: helpers.generateId('SOLDATEN'),
            name,
            dn,
            unit: unit || '',
            rank: rank || '',
            date,
            time,
            notizen,
            sonstiges: sonstiges || '',
            created: new Date().toISOString(),
            createdFormatted: helpers.formatDate(Date.now()),
            dateFormatted: helpers.formatDate(date),
            template: document.getElementById('soldatenPreview').textContent
          };

          try {
            await db.collection('hrSoldatenGespr√§che').doc(gespr√§ch.id).set(gespr√§ch);

            ui.showNotification('Soldatengespr√§ch erfolgreich gespeichert', 'success');
            this.resetSoldatenForm();
            this.updateSoldatenPreview();
            this.renderSoldatenListe();
            this.switchSoldatenTab('list');
          } catch (error) {
            console.error('Fehler beim Speichern des Soldatengespr√§chs:', error);
            ui.showNotification('Fehler beim Speichern: ' + error.message, 'error');
          }
        },

        resetSoldatenForm() {
          document.getElementById('soldatenName').value = '';
          document.getElementById('soldatenDN').value = '';
          document.getElementById('soldatenUnit').value = '';
          document.getElementById('soldatenRank').value = '';
          document.getElementById('soldatenDate').value = new Date().toISOString().split('T')[0];
          document.getElementById('soldatenTime').value = '';
          document.getElementById('soldatenNotizen').value = '';
          document.getElementById('soldatenSonstiges').value = '';
        },

        renderSoldatenListe() {
          const container = document.getElementById('soldatenListe');
          const searchTerm = document.getElementById('soldatenSearch')?.value.toLowerCase() || '';

          let filteredGespr√§che = state.soldatenGespr√§che;
          if (searchTerm) {
            filteredGespr√§che = state.soldatenGespr√§che.filter(gespr√§ch =>
              gespr√§ch.name.toLowerCase().includes(searchTerm) ||
              gespr√§ch.dn.toString().includes(searchTerm)
            );
          }

          if (filteredGespr√§che.length === 0) {
            ui.showEmptyState('soldatenListe', {
              icon: 'comments',
              title: searchTerm ? 'Keine passenden Gespr√§che gefunden' : 'Keine Gespr√§che gefunden',
              description: searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihr erstes Soldatengespr√§ch'
            });
            return;
          }

          let html = '';
          filteredGespr√§che.forEach(gespr√§ch => {
            html += `
              <div class="list-item">
                <div class="item-header">
                  <div class="item-title">${helpers.escapeHtml(gespr√§ch.name)}</div>
                  <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                    DN ${helpers.escapeHtml(gespr√§ch.dn)}
                  </div>
                </div>
                <div class="item-date">
                  <i class="fas fa-calendar"></i> Gespr√§ch am: ${gespr√§ch.dateFormatted} um ${gespr√§ch.time || ''}
                </div>
                <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
                  <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                    ${gespr√§ch.unit || 'Keine Unit'}
                  </div>
                  <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                    ${gespr√§ch.rank || 'Kein Rang'}
                  </div>
                </div>
                <div class="item-content">
                  <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                    <i class="fas fa-sticky-note" style="color: var(--warning); font-size: 12px;"></i>
                    <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Notizen:</span>
                  </div>
                  ${helpers.escapeHtml(gespr√§ch.notizen.length > 200 ? gespr√§ch.notizen.substring(0, 200) + '...' : gespr√§ch.notizen)}
                </div>
                ${gespr√§ch.sonstiges ? `
                <div class="item-content">
                  <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                    <i class="fas fa-ellipsis-h" style="color: var(--warning); font-size: 12px;"></i>
                    <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Sonstiges:</span>
                  </div>
                  ${helpers.escapeHtml(gespr√§ch.sonstiges.length > 200 ? gespr√§ch.sonstiges.substring(0, 200) + '...' : gespr√§ch.sonstiges)}
                </div>
                ` : ''}
                <div class="form-actions" style="justify-content: flex-end; padding: 0; border: none; margin: 0;">
                  <button class="btn btn-secondary" onclick="HRApp.copySoldatenFromList('${gespr√§ch.id}')">
                    <i class="fas fa-copy"></i> Kopieren
                  </button>
                  <button class="btn btn-danger" onclick="HRApp.deleteSoldatenGespr√§ch('${gespr√§ch.id}')">
                    <i class="fas fa-trash"></i> L√∂schen
                  </button>
                </div>
              </div>
            `;
          });

          container.innerHTML = html;
        },

        searchSoldaten(searchTerm) {
          this.renderSoldatenListe();
        },

        async copySoldatenFromList(gespr√§chId) {
          const gespr√§ch = state.soldatenGespr√§che.find(g => g.id === gespr√§chId);
          if (!gespr√§ch) return;

          const success = await helpers.copyToClipboard(gespr√§ch.template);
          ui.showNotification(success ? 'Soldatengespr√§ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        async deleteSoldatenGespr√§ch(gespr√§chId) {
          if (!confirm('Soldatengespr√§ch wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) return;

          try {
            await db.collection('hrSoldatenGespr√§che').doc(gespr√§chId).delete();
            ui.showNotification('Soldatengespr√§ch gel√∂scht', 'success');
          } catch (error) {
            console.error('Fehler beim L√∂schen des Soldatengespr√§chs:', error);
            ui.showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
          }
        }
      };

      // ==================== BEOBACHTUNGS AKTEN FUNKTIONEN ====================
      const beobachtungen = {
        openBeobachtungAktenModal() {
          ui.openModal('beobachtungAktenModal');
          this.updateBeobachtungPreview();
        },

        switchBeobachtungTab(tabName) {
          state.currentBeobachtungTab = tabName;

          const tabs = document.querySelectorAll('#beobachtungAktenModal .sub-tabs .tab-button');
          const contents = document.querySelectorAll('#beobachtungAktenModal .tab-content');

          tabs.forEach(tab => tab.classList.remove('active'));
          contents.forEach(content => content.classList.remove('active'));

          if (tabName === 'new') {
            tabs[0].classList.add('active');
            document.getElementById('beobachtungNewTab').classList.add('active');
          } else if (tabName === 'list') {
            tabs[1].classList.add('active');
            document.getElementById('beobachtungListTab').classList.add('active');
            this.renderAktenListe();
          } else if (tabName === 'beobachtung') {
            tabs[2].classList.add('active');
            document.getElementById('beobachtungBeobachtungTab').classList.add('active');
          }
        },

        updateBeobachtungPreview() {
          const name = document.getElementById('beobachtungName').value;
          const dn = document.getElementById('beobachtungDN').value;
          const grund = document.getElementById('beobachtungGrund').value;

          const akte = state.akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
          const unit = akte?.unit || '';
          const rank = akte?.rank || '';

          const unitSetting = state.settings.units.find(u => u.name === unit);
          const rankSetting = state.settings.ranks.find(r => r.name === rank);

          const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
          const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;

          const template = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: ${name || ''}
DN: ${dn || ''}
Unit: ${unitDisplay || ''}
Rang: ${rankDisplay || ''}
Grund: ${grund || ''}
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;

          document.getElementById('beobachtungPreview').textContent = template;
        },

        async copyBeobachtungTemplate() {
          const template = document.getElementById('beobachtungPreview').textContent;
          const success = await helpers.copyToClipboard(template);
          ui.showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        async createNewAkte() {
          const name = document.getElementById('akteName').value.trim();
          const dn = document.getElementById('akteDN').value;
          const unit = document.getElementById('akteUnit').value;
          const rank = document.getElementById('akteRank').value;

          if (!name || !dn) {
            ui.showNotification('Name und Dienstnummer sind erforderlich', 'warning');
            return;
          }

          const existingAkte = state.akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
          if (existingAkte) {
            ui.showNotification('Eine Akte f√ºr diese Person existiert bereits', 'warning');
            return;
          }

          const akte = {
            id: helpers.generateId('AKTE'),
            name,
            dn,
            unit: unit || '',
            rank: rank || '',
            created: new Date().toISOString(),
            createdFormatted: helpers.formatDate(Date.now()),
            beobachtungen: [],
            lastUpdated: new Date().toISOString()
          };

          try {
            await db.collection('hrAkten').doc(akte.id).set(akte);
            ui.showNotification('Akte erfolgreich erstellt', 'success');
            this.resetAkteForm();
            main.updateStats();
            this.renderAktenListe();
            this.switchBeobachtungTab('list');
          } catch (error) {
            console.error('Fehler beim Erstellen der Akte:', error);
            ui.showNotification('Fehler beim Erstellen: ' + error.message, 'error');
          }
        },

        resetAkteForm() {
          document.getElementById('akteName').value = '';
          document.getElementById('akteDN').value = '';
          document.getElementById('akteUnit').value = '';
          document.getElementById('akteRank').value = '';
        },

        async saveBeobachtungToAkte() {
          const name = document.getElementById('beobachtungName').value.trim();
          const dn = document.getElementById('beobachtungDN').value;
          const grund = document.getElementById('beobachtungGrund').value.trim();

          if (!name || !dn) {
            ui.showNotification('Name und Dienstnummer sind erforderlich', 'warning');
            return;
          }

          if (!grund) {
            ui.showNotification('Bitte geben Sie einen Grund f√ºr die Beobachtung an', 'warning');
            return;
          }

          let akte = state.akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());

          if (!akte) {
            const newAkte = {
              id: helpers.generateId('AKTE'),
              name,
              dn,
              unit: '',
              rank: '',
              created: new Date().toISOString(),
              createdFormatted: helpers.formatDate(Date.now()),
              beobachtungen: [],
              lastUpdated: new Date().toISOString()
            };

            try {
              await db.collection('hrAkten').doc(newAkte.id).set(newAkte);
              akte = newAkte;
              state.akten.push(newAkte);
            } catch (error) {
              console.error('Fehler beim Erstellen der Akte:', error);
              ui.showNotification('Fehler beim Erstellen der Akte: ' + error.message, 'error');
              return;
            }
          }

          const beobachtung = {
            id: helpers.generateId('BEO'),
            name,
            dn,
            grund,
            date: new Date().toISOString(),
            dateFormatted: helpers.formatDate(Date.now()),
            template: document.getElementById('beobachtungPreview').textContent
          };

          try {
            if (!akte.beobachtungen) akte.beobachtungen = [];
            akte.beobachtungen.unshift(beobachtung);
            akte.lastUpdated = new Date().toISOString();

            await db.collection('hrAkten').doc(akte.id).update({
              beobachtungen: akte.beobachtungen,
              lastUpdated: akte.lastUpdated
            });

            ui.showNotification('Beobachtung zur Akte hinzugef√ºgt', 'success');
            this.resetBeobachtungForm();
            this.updateBeobachtungPreview();
            main.updateStats();
            this.renderAktenListe();
          } catch (error) {
            console.error('Fehler beim Speichern der Beobachtung:', error);
            ui.showNotification('Fehler beim Speichern: ' + error.message, 'error');
          }
        },

        resetBeobachtungForm() {
          document.getElementById('beobachtungName').value = '';
          document.getElementById('beobachtungDN').value = '';
          document.getElementById('beobachtungGrund').value = '';
        },

        renderAktenListe() {
          const container = document.getElementById('aktenListe');
          const searchTerm = document.getElementById('aktenSearch')?.value.toLowerCase() || '';

          let filteredAkten = state.akten;
          if (searchTerm) {
            filteredAkten = state.akten.filter(akte =>
              akte.name.toLowerCase().includes(searchTerm) ||
              akte.dn.toString().includes(searchTerm)
            );
          }

          if (filteredAkten.length === 0) {
            ui.showEmptyState('aktenListe', {
              icon: 'folder-open',
              title: searchTerm ? 'Keine passenden Akten gefunden' : 'Keine Akten gefunden',
              description: searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihre erste Akte'
            });
            return;
          }

          let html = '';
          filteredAkten.forEach(akte => {
            const beobachtungenCount = akte.beobachtungen ? akte.beobachtungen.length : 0;

            html += `
              <div class="list-item">
                <div class="item-header">
                  <div class="item-title">${helpers.escapeHtml(akte.name)}</div>
                  <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                    DN ${helpers.escapeHtml(akte.dn)}
                  </div>
                </div>
                <div class="item-date">
                  <i class="fas fa-calendar"></i> Erstellt: ${akte.createdFormatted}
                </div>
                <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                  <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                    ${akte.unit || 'Keine Unit'}
                  </div>
                  <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                    ${akte.rank || 'Kein Rang'}
                  </div>
                </div>
                <div style="color: var(--gray); font-size: 11px; margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
                  <i class="fas fa-eye"></i> ${beobachtungenCount} Beobachtung${beobachtungenCount !== 1 ? 'en' : ''}
                </div>
            `;

            if (beobachtungenCount > 0) {
              const latestBeobachtung = akte.beobachtungen[0];
              html += `
                <div class="item-content">
                  <div style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">
                    <i class="fas fa-calendar"></i> Letzte Beobachtung: ${latestBeobachtung.dateFormatted}
                  </div>
                  ${helpers.escapeHtml(latestBeobachtung.grund.length > 150 ? latestBeobachtung.grund.substring(0, 150) + '...' : latestBeobachtung.grund)}
                </div>
              `;
            }

            html += `
                <div class="form-actions" style="justify-content: flex-end; padding: 0; border: none; margin: 0;">
                  <button class="btn btn-secondary" onclick="HRApp.openAkteDetail('${akte.id}')">
                    <i class="fas fa-eye"></i> Akte √∂ffnen
                  </button>
                  <button class="btn btn-danger" onclick="HRApp.deleteAkte('${akte.id}')">
                    <i class="fas fa-trash"></i> L√∂schen
                  </button>
                </div>
              </div>
            `;
          });

          container.innerHTML = html;
        },

        searchAkten(searchTerm) {
          this.renderAktenListe();
        },

        openAkteDetail(akteId) {
          const akte = state.akten.find(a => a.id === akteId);
          if (!akte) return;

          let beobachtungenHtml = '';
          if (akte.beobachtungen && akte.beobachtungen.length > 0) {
            akte.beobachtungen.forEach(beobachtung => {
              beobachtungenHtml += `
                <div class="list-item">
                  <div class="item-date">
                    <i class="fas fa-calendar"></i> ${beobachtung.dateFormatted}
                  </div>
                  <div class="item-content">
                    ${helpers.escapeHtml(beobachtung.grund)}
                  </div>
                  <div style="font-family: 'Consolas', 'Monaco', monospace; background: rgba(0,0,0,.3); padding: 12px; border-radius: var(--radius-sm); border: 1px solid rgba(255,255,255,.08); font-size: 11px; color: var(--gray-light); margin-bottom: 12px;">
                    ${helpers.escapeHtml(beobachtung.template)}
                  </div>
                  <div class="form-actions" style="justify-content: flex-end; padding: 0; border: none; margin: 0;">
                    <button class="btn btn-secondary" onclick="HRApp.copyBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                      <i class="fas fa-copy"></i> Kopieren
                    </button>
                    <button class="btn btn-danger" onclick="HRApp.deleteBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                      <i class="fas fa-trash"></i> L√∂schen
                    </button>
                  </div>
                </div>
              `;
            });
          } else {
            beobachtungenHtml = `
              <div class="empty-state-container">
                <div class="empty-icon"><i class="fas fa-eye"></i></div>
                <div class="empty-title">Keine Beobachtungen</div>
                <div class="empty-description">F√ºgen Sie die erste Beobachtung hinzu</div>
              </div>
            `;
          }

          const modalHtml = `
            <div class="modal-overlay active" id="akteDetailModal" onclick="if(event.target===this)HRApp.closeModal('akteDetailModal')">
              <div class="modal-content">
                <div class="modal-header">
                  <div class="modal-title">
                    <i class="fas fa-folder-open"></i> Akte: ${helpers.escapeHtml(akte.name)} (DN ${helpers.escapeHtml(akte.dn)})
                  </div>
                  <button class="modal-close" onclick="HRApp.closeModal('akteDetailModal')">
                    <i class="fas fa-times"></i>
                  </button>
                </div>
                <div class="modal-body">
                  <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                    <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                      <i class="fas fa-building"></i> ${akte.unit || 'Keine Unit'}
                    </div>
                    <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                      <i class="fas fa-user-tie"></i> ${akte.rank || 'Kein Rang'}
                    </div>
                    <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                      <i class="fas fa-eye"></i> ${akte.beobachtungen ? akte.beobachtungen.length : 0} Beobachtungen
                    </div>
                  </div>
                  <div class="scrollable-content">
                    ${beobachtungenHtml}
                  </div>
                  <div class="form-actions">
                    <button class="btn btn-primary" onclick="HRApp.addNewBeobachtungToAkte('${akte.id}')">
                      <i class="fas fa-plus"></i> Neue Beobachtung hinzuf√ºgen
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;

          const modalContainer = document.createElement('div');
          modalContainer.id = 'akteDetailModal';
          modalContainer.innerHTML = modalHtml;
          document.body.appendChild(modalContainer);
        },

        async copyBeobachtungFromAkte(akteId, beobachtungId) {
          const akte = state.akten.find(a => a.id === akteId);
          if (!akte || !akte.beobachtungen) return;

          const beobachtung = akte.beobachtungen.find(b => b.id === beobachtungId);
          if (!beobachtung) return;

          const success = await helpers.copyToClipboard(beobachtung.template);
          ui.showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
        },

        async deleteBeobachtungFromAkte(akteId, beobachtungId) {
          if (!confirm('Beobachtung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) return;

          const akte = state.akten.find(a => a.id === akteId);
          if (!akte || !akte.beobachtungen) return;

          try {
            akte.beobachtungen = akte.beobachtungen.filter(b => b.id !== beobachtungId);
            akte.lastUpdated = new Date().toISOString();

            await db.collection('hrAkten').doc(akteId).update({
              beobachtungen: akte.beobachtungen,
              lastUpdated: akte.lastUpdated
            });

            ui.showNotification('Beobachtung gel√∂scht', 'success');
            ui.closeModal('akteDetailModal');
            setTimeout(() => this.openAkteDetail(akteId), 100);
            this.renderAktenListe();
          } catch (error) {
            console.error('Fehler beim L√∂schen der Beobachtung:', error);
            ui.showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
          }
        },

        async deleteAkte(akteId) {
          if (!confirm('Akte wirklich l√∂schen? Alle Beobachtungen werden ebenfalls gel√∂scht.')) return;

          try {
            await db.collection('hrAkten').doc(akteId).delete();
            ui.showNotification('Akte gel√∂scht', 'success');
          } catch (error) {
            console.error('Fehler beim L√∂schen der Akte:', error);
            ui.showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
          }
        },

        addNewBeobachtungToAkte(akteId) {
          const akte = state.akten.find(a => a.id === akteId);
          if (!akte) return;

          ui.closeModal('akteDetailModal');
          this.openBeobachtungAktenModal();
          this.switchBeobachtungTab('beobachtung');
          document.getElementById('beobachtungName').value = akte.name;
          document.getElementById('beobachtungDN').value = akte.dn;
          this.updateBeobachtungPreview();
        }
      };

      // ==================== ANK√úNDIGUNG BANNER ====================
      const banner = {
        async showLatestAnkundigung() {
          try {
            const querySnapshot = await db.collection('hrAnkundigungen')
              .where('type', '==', 'ankundigung')
              .orderBy('created', 'desc')
              .limit(1)
              .get();

            if (querySnapshot.empty) {
              console.log('Keine Ank√ºndigungen gefunden');
              return;
            }

            querySnapshot.forEach(doc => {
              const ankundigung = doc.data();
              this.displayBanner(ankundigung);
            });
          } catch (error) {
            console.error('Fehler beim Laden der Ank√ºndigung:', error);
          }
        },

        displayBanner(ankundigung) {
          const banner = document.getElementById('ankundigungBanner');
          const title = document.getElementById('bannerTitle');
          const content = document.getElementById('bannerContent');
          const type = document.getElementById('bannerType');
          const date = document.getElementById('bannerDate');

          title.innerHTML = `<span>${ankundigung.icon || 'ü™ß'}</span> ${helpers.escapeHtml(ankundigung.title || 'Ank√ºndigung')}`;
          content.textContent = ankundigung.content || '';
          type.textContent = 'Ank√ºndigung';
          date.textContent = ankundigung.createdFormatted || helpers.formatDate(Date.now());

          banner.classList.add('show');

          setTimeout(() => {
            banner.classList.remove('show');
          }, 10000);
        },

        closeBanner() {
          document.getElementById('ankundigungBanner').classList.remove('show');
        }
      };

      // ==================== EVENT LISTENER SETUP ====================
      const events = {
        setupEventListeners() {
          // Mitarbeiter Suche
          document.getElementById('searchEmployees').addEventListener('input', (e) => {
            employees.filterEmployees(e.target.value);
          });

          // Form √Ñnderungen
          const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea, .toggle-switch input');
          formInputs.forEach(input => {
            input.addEventListener('input', this.handleFormChange);
            input.addEventListener('change', this.handleFormChange);
          });

          // Soldaten Inputs
          const soldatenInputs = document.querySelectorAll('#soldatenName, #soldatenDN, #soldatenUnit, #soldatenRank, #soldatenDate, #soldatenTime, #soldatenNotizen, #soldatenSonstiges');
          soldatenInputs.forEach(input => {
            input.addEventListener('input', () => soldaten.updateSoldatenPreview());
          });

          // Beobachtung Inputs
          const beobachtungInputs = document.querySelectorAll('#beobachtungName, #beobachtungDN, #beobachtungGrund');
          beobachtungInputs.forEach(input => {
            input.addEventListener('input', () => beobachtungen.updateBeobachtungPreview());
          });

          // Keyboard Shortcuts
          document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'n') {
              e.preventDefault();
              employees.openNewEmployeeModal();
            }
            if (e.ctrlKey && e.key === 'f') {
              e.preventDefault();
              document.getElementById('searchEmployees').focus();
            }
            if (e.ctrlKey && e.key === 'e' && state.currentEmployee) {
              e.preventDefault();
              employees.openEditEmployeeModal();
            }
            if (e.ctrlKey && e.key === 'b') {
              e.preventDefault();
              beobachtungen.openBeobachtungAktenModal();
            }
            if (e.ctrlKey && e.key === 's') {
              e.preventDefault();
              soldaten.openSoldatenModal();
            }
            if (e.ctrlKey && e.key === ',') {
              e.preventDefault();
              auth.openSettingsWithPassword();
            }
          });

          // Window Resize
          window.addEventListener('resize', this.adjustSidebarHeight);
        },

        handleFormChange() {
          if (state.currentEmployee) {
            employees.saveFormData();
            templates.updateTemplates();
            employees.saveEmployeeData(true);
          }
        },

        adjustSidebarHeight() {
          const sidebar = document.querySelector('.sidebar');
          const header = document.querySelector('.app-header');
          const windowHeight = window.innerHeight;
          const headerHeight = header.offsetHeight;

          const availableHeight = windowHeight - headerHeight - 40;
          const newHeight = Math.max(availableHeight, 500);
          sidebar.style.height = `${newHeight}px`;
        }
      };

      // ==================== REALTIME LISTENER ====================
      const realtime = {
        setupRealtimeListeners() {
          // Mitarbeiter
          const unsubscribeEmployees = db.collection('hrEmployees')
            .orderBy('lastUpdated', 'desc')
            .onSnapshot((snapshot) => {
              state.employees = [];
              let archivedCount = 0;

              snapshot.forEach(doc => {
                const employee = { id: doc.id, ...doc.data() };
                state.employees.push(employee);

                if (employee.status === 'archived') {
                  archivedCount++;
                }
              });

              employees.renderEmployeeList();
              main.updateStats();
              document.getElementById('totalArchived').textContent = archivedCount;

              if (state.currentEmployee) {
                const updatedEmployee = state.employees.find(emp => emp.id === state.currentEmployee.id);
                if (updatedEmployee) {
                  employees.selectEmployee(updatedEmployee);
                }
              }

              setTimeout(() => employees.updateInductionDisplay(), 100);
            }, (error) => {
              console.error('Fehler beim Lauschen auf Mitarbeiter-√Ñnderungen:', error);
              ui.showNotification('Fehler bei Live-Updates', 'error');
            });

          // Akten
          const unsubscribeAkten = db.collection('hrAkten')
            .orderBy('lastUpdated', 'desc')
            .limit(100)
            .onSnapshot((snapshot) => {
              state.akten = [];
              snapshot.forEach(doc => {
                const data = doc.data();
                state.akten.push({
                  id: doc.id,
                  ...data,
                  createdFormatted: data.createdFormatted || helpers.formatDate(data.created)
                });
              });
              main.updateStats();
            }, (error) => {
              console.error('Fehler beim Lauschen auf Akten-√Ñnderungen:', error);
            });

          // Soldatengespr√§che
          const unsubscribeSoldaten = db.collection('hrSoldatenGespr√§che')
            .orderBy('created', 'desc')
            .limit(100)
            .onSnapshot((snapshot) => {
              state.soldatenGespr√§che = [];
              snapshot.forEach(doc => {
                const data = doc.data();
                state.soldatenGespr√§che.push({
                  id: doc.id,
                  ...data,
                  createdFormatted: data.createdFormatted || helpers.formatDate(data.created),
                  dateFormatted: data.dateFormatted || (data.date ? helpers.formatDate(data.date) : '')
                });
              });
            }, (error) => {
              console.error('Fehler beim Lauschen auf Soldatengespr√§che:', error);
            });

          // Settings
          const unsubscribeSettings = db.collection('hrSettings')
            .doc('settings')
            .onSnapshot((doc) => {
              if (doc.exists) {
                const newSettings = doc.data();
                state.settings = { ...state.settings, ...newSettings };
                database.setCachedData('settings', state.settings);
                settings.populateSettingsUI();
                settings.updateUnitAndRankSelects();
              }
            }, (error) => {
              console.error('Fehler beim Lauschen auf Settings:', error);
            });

          // Ank√ºndigungen
          const unsubscribeAnkundigungen = db.collection('hrAnkundigungen')
            .onSnapshot((snapshot) => {
              state.ankundigungen = [];
              snapshot.forEach(doc => {
                const data = doc.data();
                state.ankundigungen.push({
                  id: doc.id,
                  ...data
                });
              });
            }, (error) => {
              console.error('Fehler beim Lauschen auf Ank√ºndigungen:', error);
            });

          state.unsubscribeFunctions = [
            unsubscribeEmployees,
            unsubscribeAkten,
            unsubscribeSoldaten,
            unsubscribeSettings,
            unsubscribeAnkundigungen
          ];
        },

        cleanupListeners() {
          state.unsubscribeFunctions.forEach(unsubscribe => {
            if (unsubscribe) unsubscribe();
          });
          state.unsubscribeFunctions = [];
        }
      };

      // ==================== MAIN APP FUNKTIONEN ====================
      const main = {
        initializeApp() {
          if (!state.isAuthenticated) return;

          console.log(`HR App Version ${APP_VERSION} geladen`);
          
          // Load settings
          settings.loadSettings();
          
          // Setup realtime listeners
          realtime.setupRealtimeListeners();
          
          // Set initial dates and times
          this.setInitialDates();
          
          // Setup event listeners
          events.setupEventListeners();
          
          // Seed template boxes
          templates.seedTemplateBoxes();
          
          // Adjust sidebar height
          events.adjustSidebarHeight();
          
          // Show latest announcement
          setTimeout(() => banner.showLatestAnkundigung(), 1000);
        },

        setInitialDates() {
          const today = new Date().toISOString().split('T')[0];
          document.getElementById('oralDate').value = today;
          document.getElementById('orgDate').value = today;
          document.getElementById('soldatenDate').value = today;
          document.getElementById('besprechungDate').value = today;

          const now = new Date();
          const hours = now.getHours().toString().padStart(2, '0');
          const minutes = now.getMinutes().toString().padStart(2, '0');
          document.getElementById('soldatenTime').value = `${hours}:${minutes}`;
          document.getElementById('besprechungTime').value = `${hours}:${minutes}`;

          document.getElementById('oralTimeStart').value = '16:40';
          document.getElementById('oralTimeEnd').value = '18:00';
          document.getElementById('orgTimeStart').value = '22:10';
          document.getElementById('orgTimeEnd').value = '23:05';
        },

        updateStats() {
          const totalEmployees = state.employees.filter(emp => !emp.status || emp.status === 'active').length;
          const totalArchived = state.employees.filter(emp => emp.status === 'archived').length;

          document.getElementById('totalEmployees').textContent = totalEmployees;
          document.getElementById('totalArchived').textContent = totalArchived;

          let aktenCount = 0;
          state.employees.forEach(emp => {
            if (emp.beobachtungen && emp.beobachtungen.length > 0) {
              aktenCount += emp.beobachtungen.length;
            }
          });
          document.getElementById('totalAkten').textContent = aktenCount + state.akten.length;
        },

        handleFormChange() {
          events.handleFormChange();
        },

        cleanup() {
          realtime.cleanupListeners();
        }
      };

      // ==================== PUBLIC API ====================
      return {
        // App State (nur f√ºr Debugging)
        state,

        // Authentication
        checkMainPassword: auth.checkMainPassword.bind(auth),
        checkSettingsPassword: auth.checkSettingsPassword.bind(auth),
        openSettingsPasswordModal: auth.openSettingsPasswordModal.bind(auth),
        closeSettingsPasswordModal: auth.closeSettingsPasswordModal.bind(auth),
        openSettingsWithPassword: auth.openSettingsWithPassword.bind(auth),

        // Employees
        selectEmployee: employees.selectEmployee.bind(employees),
        filterEmployeesByType: employees.filterEmployeesByType.bind(employees),
        openNewEmployeeModal: employees.openNewEmployeeModal.bind(employees),
        openEditEmployeeModal: employees.openEditEmployeeModal.bind(employees),
        saveEditedEmployee: employees.saveEditedEmployee.bind(employees),
        deleteCurrentEmployee: employees.deleteCurrentEmployee.bind(employees),
        toggleInduction: employees.toggleInduction.bind(employees),
        createNewEmployee: employees.createNewEmployee.bind(employees),
        toggleArchiveEmployee: employees.toggleArchiveEmployee.bind(employees),
        toggleArchiveView: employees.toggleArchiveView.bind(employees),
        toggleArchiveEmployeeContext: employees.toggleArchiveEmployeeContext.bind(employees),
        deleteEmployeePermanently: employees.deleteEmployeePermanently.bind(employees),

        // Templates
        copyOralTemplate: templates.copyOralTemplate.bind(templates),
        copyOrgTemplate: templates.copyOrgTemplate.bind(templates),

        // Ank√ºndigungen
        openAnkundigungenModal: ankundigungen.openAnkundigungenModal.bind(ankundigungen),
        searchAnkundigungen: ankundigungen.searchAnkundigungen.bind(ankundigungen),
        openBesprechungenModal: besprechungen.openBesprechungenModal.bind(besprechungen),
        searchBesprechungen: besprechungen.searchBesprechungen.bind(besprechungen),

        // Settings
        switchSettingsTab: settings.switchSettingsTab.bind(settings),
        switchAnkundigungenTab: settings.switchAnkundigungenTab.bind(settings),
        addNewUnit: settings.addNewUnit.bind(settings),
        addNewRank: settings.addNewRank.bind(settings),
        updateUnitDiscordId: settings.updateUnitDiscordId.bind(settings),
        updateRankDiscordId: settings.updateRankDiscordId.bind(settings),
        removeUnit: settings.removeUnit.bind(settings),
        removeRank: settings.removeRank.bind(settings),
        saveSettings: settings.saveSettings.bind(settings),
        saveAnkundigung: settings.saveAnkundigung.bind(settings),
        saveBesprechung: settings.saveBesprechung.bind(settings),
        searchManageAnkundigungen: settings.searchManageAnkundigungen.bind(settings),
        searchManageBesprechungen: settings.searchManageBesprechungen.bind(settings),
        editItem: settings.editItem.bind(settings),
        saveEditedItem: settings.saveEditedItem.bind(settings),
        deleteItem: settings.deleteItem.bind(settings),

        // Soldatengespr√§che
        openSoldatenModal: soldaten.openSoldatenModal.bind(soldaten),
        switchSoldatenTab: soldaten.switchSoldatenTab.bind(soldaten),
        copySoldatenTemplate: soldaten.copySoldatenTemplate.bind(soldaten),
        saveSoldatenGespr√§ch: soldaten.saveSoldatenGespr√§ch.bind(soldaten),
        searchSoldaten: soldaten.searchSoldaten.bind(soldaten),
        copySoldatenFromList: soldaten.copySoldatenFromList.bind(soldaten),
        deleteSoldatenGespr√§ch: soldaten.deleteSoldatenGespr√§ch.bind(soldaten),

        // Beobachtungs Akten
        openBeobachtungAktenModal: beobachtungen.openBeobachtungAktenModal.bind(beobachtungen),
        switchBeobachtungTab: beobachtungen.switchBeobachtungTab.bind(beobachtungen),
        copyBeobachtungTemplate: beobachtungen.copyBeobachtungTemplate.bind(beobachtungen),
        createNewAkte: beobachtungen.createNewAkte.bind(beobachtungen),
        saveBeobachtungToAkte: beobachtungen.saveBeobachtungToAkte.bind(beobachtungen),
        searchAkten: beobachtungen.searchAkten.bind(beobachtungen),
        openAkteDetail: beobachtungen.openAkteDetail.bind(beobachtungen),
        copyBeobachtungFromAkte: beobachtungen.copyBeobachtungFromAkte.bind(beobachtungen),
        deleteBeobachtungFromAkte: beobachtungen.deleteBeobachtungFromAkte.bind(beobachtungen),
        deleteAkte: beobachtungen.deleteAkte.bind(beobachtungen),
        addNewBeobachtungToAkte: beobachtungen.addNewBeobachtungToAkte.bind(beobachtungen),

        // Banner
        closeBanner: banner.closeBanner.bind(banner),

        // UI
        openModal: ui.openModal.bind(ui),
        closeModal: ui.closeModal.bind(ui),
        closeEditItemModal: () => {
          ui.closeModal('editItemModal');
          state.currentEditItemId = null;
          state.currentEditItemType = null;
          document.getElementById('editItemForm').innerHTML = '';
        },

        // App
        updateStats: main.updateStats.bind(main),
        handleFormChange: main.handleFormChange.bind(main),
        cleanup: main.cleanup.bind(main)
      };
    })();

    // ==================== APP INITIALISIERUNG ====================
    document.addEventListener('DOMContentLoaded', function () {
      // Cleanup on page unload
      window.addEventListener('beforeunload', function () {
        HRApp.cleanup();
      });

      // Initialize authentication check
      HRApp.state = HRApp.state; // Expose state for debugging
      const savedPassword = localStorage.getItem('hr_app_password');
      const savedTimestamp = localStorage.getItem('hr_app_password_timestamp');
      const currentTime = Date.now();
      const expireTime = 60 * 60 * 1000; // 1 Stunde

      if (savedPassword === 'hr' && savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
        HRApp.state.isAuthenticated = true;
        HRApp.state.settingsAuthenticated = true;
        HRApp.state.settingsAuthTimestamp = Date.now();
        localStorage.setItem('hr_settings_auth_timestamp', HRApp.state.settingsAuthTimestamp);
        
        document.getElementById('mainPasswordModal').style.display = 'none';
        document.getElementById('appContainer').style.display = 'grid';
        
        HRApp.initializeApp();
      } else {
        setTimeout(() => {
          document.getElementById('mainPasswordInput').focus();
        }, 100);
      }
    });
  </script>
</body>
</html>
