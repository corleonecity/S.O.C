<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CACHE-CONTROL META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>üìã HR - Einweisungsmanagement v1.0</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <style>
    :root{
      --primary:#4f46e5; --primary-dark:#4338ca; --primary-light:#818cf8;
      --secondary:#10b981; --secondary-dark:#059669;
      --danger:#ef4444; --danger-dark:#dc2626;
      --warning:#f59e0b; --warning-dark:#d97706;
      --dark:#111827; --dark-card:#1f2937;
      --light:#f9fafb; --gray:#6b7280; --gray-light:#d1d5db;
      --border:rgba(255,255,255,.12);

      --shadow-lg:0 10px 25px -5px rgba(0,0,0,.2);
      --shadow-md:0 4px 12px rgba(0,0,0,.08);
      --shadow-sm:0 1px 3px rgba(0,0,0,.1);

      --radius-lg:12px; --radius-md:8px; --radius-sm:6px;
      --transition:all .2s cubic-bezier(.4,0,.2,1);
    }

    *{margin:0;padding:0;box-sizing:border-box}

    body{
      font-family:'Inter',sans-serif;
      background:#0f172a;
      color:var(--light);
      min-height:100vh;
      overflow-x:hidden;
      font-size:14px;
      line-height:1.4;
    }

    .bg-effects{
      position:fixed; inset:0;
      z-index:-1; overflow:hidden;
    }
    .bg-gradient{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 70%, rgba(79,70,229,.10) 0%, transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(16,185,129,.08) 0%, transparent 40%);
    }

    .app-container{
      max-width:1200px;
      margin:0 auto;
      padding:16px;
      display:grid;
      grid-template-columns:280px 1fr;
      gap:16px;
      min-height:100vh;
    }

    /* Header */
    .app-header{
      grid-column:1 / -1;
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      padding:16px 20px;
      margin-bottom:16px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:var(--shadow-md);
    }
    .header-content{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:12px;
    }
    /* Logo Container */
    .logo-container {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      flex-shrink: 0;
    }
    .logo-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .brand-text {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .brand-text h1{
      font-size:18px;
      font-weight:800;
      color:#fff;
      margin-bottom:2px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .header-icons {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-left: 10px;
    }
    .header-icon {
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.8;
    }
    .header-icon:hover {
      opacity: 1;
      transform: scale(1.1);
    }
    .brand-text .subtitle{font-size:11px;color:var(--gray);font-weight:600}
    .header-stats{display:flex;gap:12px}
    .stat-card{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:10px 14px;
      background:rgba(255,255,255,.05);
      border-radius:var(--radius-md);
      border:1px solid rgba(255,255,255,.08);
      min-width:90px;
      transition:var(--transition);
    }
    .stat-card:hover{transform:translateY(-1px);background:rgba(255,255,255,.08)}
    .stat-value{font-size:20px;font-weight:800;color:#fff;margin-bottom:2px}
    .stat-label{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:.4px;font-weight:700}

    /* Password Modal f√ºr App-Login */
    .main-password-modal {
      display: flex;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .main-password-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
    }

    .main-password-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
    }

    .main-password-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .main-password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .main-password-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .main-password-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(79,70,229,.15);
    }

    .main-password-error {
      color: var(--danger);
      font-size: 12px;
      display: none;
      margin-top: -8px;
    }

    .main-password-error.show {
      display: block;
    }

    /* Settings Password Modal */
    .settings-password-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .settings-password-modal.active {
      display: flex;
    }

    .settings-password-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
    }

    .settings-password-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
    }

    .settings-password-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-password-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .settings-password-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .settings-password-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .settings-password-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .settings-password-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(79,70,229,.15);
    }

    .settings-password-error {
      color: var(--danger);
      font-size: 12px;
      display: none;
      margin-top: -8px;
    }

    .settings-password-error.show {
      display: block;
    }

    /* Ank√ºndigung Banner */
    .ankundigung-banner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(31,41,55,.95);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(139,92,246,.3);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      z-index: 2000;
      max-width: 600px;
      width: 90%;
      box-shadow: var(--shadow-lg);
      display: none;
      animation: slideDown .3s ease;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }

    .ankundigung-banner.show {
      display: block;
    }

    .banner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .banner-title {
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .banner-close {
      background: none;
      border: none;
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
      width: 28px;
      height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .banner-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .banner-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 8px;
      white-space: pre-line;
    }

    .banner-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 11px;
      color: var(--gray);
    }

    .banner-type {
      background: rgba(139,92,246,.15);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-weight: 900;
      font-size: 10px;
    }

    /* Besprechungen Modal */
    .besprechungen-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .besprechungen-modal.active {
      display: flex;
    }

    .besprechungen-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 1000px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .besprechungen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .besprechungen-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .besprechungen-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .besprechungen-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .besprechungen-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .besprechungen-search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .besprechungen-search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .besprechungen-search-input::placeholder {
      color: rgba(255,255,255,.5);
    }

    .besprechungen-search-input:focus {
      outline: none;
      border-color: #8b5cf6;
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(139,92,246,.15);
    }

    .besprechungen-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    .besprechungen-list-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .besprechungen-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
    }

    .besprechungen-list::-webkit-scrollbar {
      width: 8px;
    }

    .besprechungen-list::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .besprechungen-list::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .besprechungen-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
    }

    .besprechungen-item:hover {
      background: rgba(255,255,255,.05);
      border-color: #8b5cf6;
    }

    .besprechungen-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .besprechungen-item-title {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .besprechungen-item-type {
      background: rgba(139,92,246,.10);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(139,92,246,.20);
    }

    .besprechungen-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Vergr√∂√üerte Textbereiche f√ºr Besprechungen */
    .besprechungen-item-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid #8b5cf6;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-line;
    }

    .besprechungen-item-content::-webkit-scrollbar {
      width: 6px;
    }

    .besprechungen-item-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 3px;
    }

    .besprechungen-item-content::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,.50);
      border-radius: 3px;
    }

    .besprechungen-item-content::-webkit-scrollbar-thumb:hover {
      background: rgba(139,92,246,.70);
    }

    .empty-besprechungen {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-besprechungen-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-besprechungen-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    /* Ank√ºndigungen Modal */
    .ankundigungen-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .ankundigungen-modal.active {
      display: flex;
    }

    .ankundigungen-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 1000px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .ankundigungen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .ankundigungen-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ankundigungen-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .ankundigungen-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .ankundigungen-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigungen-search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .ankundigungen-search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .ankundigungen-search-input::placeholder {
      color: rgba(255,255,255,.5);
    }

    .ankundigungen-search-input:focus {
      outline: none;
      border-color: #8b5cf6;
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(139,92,246,.15);
    }

    .ankundigungen-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    .ankundigungen-list-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigungen-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
    }

    .ankundigungen-list::-webkit-scrollbar {
      width: 8px;
    }

    .ankundigungen-list::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .ankundigungen-list::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .ankundigungen-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
    }

    .ankundigungen-item:hover {
      background: rgba(255,255,255,.05);
      border-color: #8b5cf6;
    }

    .ankundigungen-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .ankundigungen-item-title {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ankundigungen-item-type {
      background: rgba(139,92,246,.10);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(139,92,246,.20);
    }

    .ankundigungen-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    /* Vergr√∂√üerte Textbereiche f√ºr Ank√ºndigungen */
    .ankundigungen-item-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid #8b5cf6;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-line;
    }

    .ankundigungen-item-content::-webkit-scrollbar {
      width: 6px;
    }

    .ankundigungen-item-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 3px;
    }

    .ankundigungen-item-content::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,.50);
      border-radius: 3px;
    }

    .ankundigungen-item-content::-webkit-scrollbar-thumb:hover {
      background: rgba(139,92,246,.70);
    }

    .empty-ankundigungen {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-ankundigungen-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-ankundigungen-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    /* Settings - Manage Ank√ºndigungen/Besprechungen Container - KORRIGIERT MIT SCROLL */
    .manage-items-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      margin-top: 16px;
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius-md);
      background: rgba(0,0,0,.1);
    }

    .manage-items-list-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
    }

    .manage-items-list {
      flex: 1;
      overflow-y: auto;
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
      max-height: 400px;
    }

    .manage-items-list::-webkit-scrollbar {
      width: 8px;
    }

    .manage-items-list::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .manage-items-list::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .manage-items-list::-webkit-scrollbar-thumb:hover {
      background: #7c3aed;
    }

    .manage-items-list {
      scrollbar-width: thin;
      scrollbar-color: #8b5cf6 rgba(255,255,255,.05);
    }

    .manage-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
      flex-shrink: 0;
    }

    .manage-item:hover {
      background: rgba(255,255,255,.05);
      border-color: #8b5cf6;
    }

    .manage-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .manage-item-title {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .manage-item-type {
      background: rgba(139,92,246,.10);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(139,92,246,.20);
    }

    .manage-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .manage-item-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid #8b5cf6;
      max-height: 200px;
      overflow-y: auto;
      white-space: pre-line;
    }

    .manage-item-content::-webkit-scrollbar {
      width: 6px;
    }

    .manage-item-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 3px;
    }

    .manage-item-content::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,.50);
      border-radius: 3px;
    }

    .manage-item-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 12px;
    }

    .manage-item-btn {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
    }

    .manage-item-btn-edit {
      background: rgba(79,70,229,.15);
      color: var(--primary-light);
      border: 1px solid rgba(79,70,229,.25);
    }

    .manage-item-btn-edit:hover {
      background: rgba(79,70,229,.25);
    }

    .manage-item-btn-delete {
      background: rgba(239,68,68,.15);
      color: #fca5a5;
      border: 1px solid rgba(239,68,68,.25);
    }

    .manage-item-btn-delete:hover {
      background: rgba(239,68,68,.25);
    }

    /* Ank√ºndigungen Tab Content */
    .ankundigungen-tab-content {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
    }

    .ankundigungen-tab-content.active {
      display: flex;
    }

    /* NEU: Scroll-Container f√ºr Besprechungsformular */
    .besprechung-form-scroll-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .besprechung-form-scroll {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      margin-bottom: 16px;
      min-height: 0;
    }

    .besprechung-form-scroll::-webkit-scrollbar {
      width: 8px;
    }

    .besprechung-form-scroll::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .besprechung-form-scroll::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    /* NEU: Verbessertes Layout f√ºr Besprechungsformular */
    .besprechung-form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .besprechung-form-row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .besprechung-form-details-row {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }

    @media (max-width: 768px) {
      .besprechung-form-details-row {
        grid-template-columns: 1fr;
      }
    }

    /* Edit Ank√ºndigung/Besprechung Modal */
    .edit-item-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .edit-item-modal.active {
      display: flex;
    }

    .edit-item-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 30px;
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .edit-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .edit-item-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .edit-item-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .edit-item-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .edit-item-body {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      margin-bottom: 20px;
      min-height: 0;
    }

    .edit-item-body::-webkit-scrollbar {
      width: 8px;
    }

    .edit-item-body::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .edit-item-body::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .edit-item-form {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .edit-item-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .edit-item-input:focus {
      outline: none;
      border-color: #8b5cf6;
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(139,92,246,.15);
    }

    .edit-item-textarea {
      min-height: 150px;
      resize: vertical;
      line-height: 1.5;
    }

    .edit-item-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    /* Rest des vorhandenen CSS bleibt erhalten */
    .sidebar{
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      height:calc(100vh - 120px);
      position:sticky;
      top:20px;
      display:flex;
      flex-direction:column;
    }
    .sidebar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .sidebar-title{
      font-size:14px;font-weight:800;color:var(--gray-light);
      display:flex;align-items:center;gap:8px;
      text-transform:uppercase;letter-spacing:.4px;
    }
    .employee-count{
      background:var(--primary);
      color:#fff;
      font-size:11px;font-weight:800;
      padding:4px 10px;
      border-radius:20px;
    }
    .sidebar-filter-buttons{display:flex;gap:6px;margin-bottom:16px}
    .sidebar-filter-btn{
      padding:8px 10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-sm);
      color:var(--gray-light);
      font-size:11px;font-weight:700;
      cursor:pointer;
      transition:var(--transition);
      flex:1;
      text-align:center;
    }
    .sidebar-filter-btn:hover{background:rgba(255,255,255,.08)}
    .sidebar-filter-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

    .sidebar-controls{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}
    .search-container{position:relative}
    .search-input{
      width:100%;
      padding:10px 12px 10px 36px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:13px;
      transition:var(--transition);
    }
    .search-input::placeholder{color:rgba(255,255,255,.5)}
    .search-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 2px rgba(79,70,229,.10);
    }
    .search-icon{
      position:absolute;left:12px;top:50%;
      transform:translateY(-50%);
      color:var(--gray);font-size:13px;
    }

    .employee-list-container{
      flex:1;
      display:flex;
      flex-direction:column;
      margin-bottom:16px;
      min-height:0;
    }
    .employee-list{
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow-y:auto;
      padding-right:4px;
      flex:1;
      min-height:0;
    }
    .employee-list::-webkit-scrollbar{width:6px}
    .employee-list::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:3px}
    .employee-list::-webkit-scrollbar-thumb{background:var(--primary);border-radius:3px}

    /* Employee Cards */
    .employee-card{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:14px;
      border:1px solid rgba(255,255,255,.08);
      cursor:pointer;
      transition:var(--transition);
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:110px;
      justify-content:flex-start;
    }
    .employee-card:hover{
      background:rgba(255,255,255,.05);
      border-color:rgba(79,70,229,.30);
      transform:translateY(-1px);
      box-shadow:var(--shadow-sm);
    }
    .employee-card.active{
      background:rgba(79,70,229,.10);
      border-color:var(--primary);
      box-shadow:0 0 0 1px var(--primary);
    }
    .employee-card::before{
      content:'';
      position:absolute;left:0;top:0;bottom:0;
      width:2px;background:var(--primary);
      opacity:0;transition:var(--transition);
    }
    .employee-card.active::before{opacity:1}
    .employee-card.archived{
      opacity:0.7;
      border-color:var(--warning);
    }
    .employee-card.archived .employee-name:after{
      content:' [ARCHIV]';
      color:var(--warning);
      font-size:10px;
    }

    .employee-top-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2px}
    .employee-name{font-weight:800;font-size:15px;color:#fff;line-height:1.3;word-break:break-word}
    .employee-dn{
      font-family:'Inter',monospace;
      font-size:11px;font-weight:800;
      color:var(--primary-light);
      background:rgba(79,70,229,.10);
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(79,70,229,.20);
      white-space:nowrap;
      flex-shrink:0;
      margin-left:8px;
    }
    .employee-meta{
      font-size:11px;color:var(--gray);
      line-height:1.3;
      margin-bottom:4px;
      display:flex;align-items:center;gap:4px;
    }
    .employee-meta i{font-size:10px;opacity:.6}

    .induction-badges{
      display:flex;gap:6px;flex-wrap:wrap;
      margin-top:0;
      padding-top:2px;
    }
    .induction-badge{
      font-size:10px;
      padding:3px 8px;
      border-radius:12px;
      font-weight:700;
      display:flex;align-items:center;gap:4px;
      white-space:nowrap;
      transition:var(--transition);
      border:1px solid transparent;
    }
    .induction-badge:hover{transform:translateY(-1px)}
    .badge-oral.pending{background:rgba(239,68,68,.10);color:#fca5a5;border-color:rgba(239,68,68,.20)}
    .badge-oral.completed{background:rgba(16,185,129,.10);color:#86efac;border-color:rgba(16,185,129,.20)}
    .badge-org.pending{background:rgba(245,158,11,.10);color:#fcd34d;border-color:rgba(245,158,11,.20)}
    .badge-org.completed{background:rgba(16,185,129,.10);color:#86efac;border-color:rgba(16,185,129,.20)}

    .quick-actions{display:grid;grid-template-columns:1fr;gap:8px;margin-top:auto}
    .quick-action-btn{
      padding:10px;
      background:rgba(79,70,229,.08);
      border:1px solid rgba(79,70,229,.15);
      border-radius:var(--radius-md);
      color:var(--primary-light);
      font-size:12px;font-weight:800;
      cursor:pointer;
      transition:var(--transition);
      display:flex;align-items:center;justify-content:center;gap:6px;
    }
    .quick-action-btn:hover{
      background:rgba(79,70,229,.12);
      border-color:var(--primary);
      transform:translateY(-1px);
      color:#fff;
    }

    /* Main Content */
    .main-content{
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:420px;
    }
    .content-header{
      padding:16px 20px;
      background:rgba(79,70,229,.05);
      border-bottom:1px solid rgba(255,255,255,.08);
      display:none;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .employee-info h2{font-size:18px;font-weight:900;color:#fff;margin-bottom:8px}
    .employee-tags{display:flex;gap:12px;flex-wrap:wrap}
    .employee-tag{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--gray);font-weight:700}
    .tag-value{
      color:#fff;
      font-weight:800;
      background:rgba(79,70,229,.10);
      padding:3px 8px;
      border-radius:4px;
      border:1px solid rgba(79,70,229,.20);
      font-size:11px;
    }
    .action-buttons{display:flex;gap:8px;flex-wrap:wrap}

    .btn{
      padding:8px 12px;
      border:none;
      border-radius:var(--radius-md);
      font-weight:800;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;align-items:center;justify-content:center;gap:6px;
      font-size:12px;
      user-select:none;
    }
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-dark);transform:translateY(-1px)}
    .btn-secondary{
      background:rgba(255,255,255,.08);
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
    }
    .btn-secondary:hover{background:rgba(255,255,255,.12);transform:translateY(-1px)}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-danger:hover{background:var(--danger-dark);transform:translateY(-1px)}

    .induction-content{
      padding:20px;
      flex:1;
      overflow-y:auto;
      display:none;
    }

    .induction-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
      margin-bottom:20px;
    }
    .induction-card{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      transition:var(--transition);
      position:relative;
    }
    .induction-card.completed{
      border-color:var(--secondary);
      background:rgba(16,185,129,.05);
    }
    .induction-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:10px}
    .induction-title{
      font-size:14px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .induction-icon{
      width:32px;height:32px;
      background:var(--primary);
      border-radius:var(--radius-md);
      display:flex;align-items:center;justify-content:center;
      font-size:14px;color:#fff;
    }
    .induction-card.completed .induction-icon{background:var(--secondary)}

    .induction-status{
      font-size:11px;font-weight:900;
      padding:4px 8px;border-radius:12px;
      background:rgba(255,255,255,.08);
      color:var(--gray);
      white-space:nowrap;
    }
    .induction-card.completed .induction-status{background:rgba(16,185,129,.15);color:var(--secondary)}

    .oral-form-grid, .org-form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:4px;
    }
    .form-group{display:flex;flex-direction:column;gap:6px}
    .form-label{
      font-weight:900;color:var(--gray-light);
      font-size:11px;text-transform:uppercase;letter-spacing:.4px;
    }
    .form-input,.form-select,.form-textarea{
      padding:8px 10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-sm);
      color:#fff;
      font-size:13px;
      transition:var(--transition);
      width:100%;
    }
    .form-input::placeholder,.form-textarea::placeholder{color:rgba(255,255,255,.4)}
    .form-select{
      color:#fff;
      background-color:rgba(255,255,255,.05);
      appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 10px center;
      padding-right:30px;
    }
    /* FIX: Dropdown-Optionen dunkler Hintergrund */
    .form-select option {
      background: #1f2937;
      color: #fff;
    }
    .form-input:focus,.form-select:focus,.form-textarea:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 2px rgba(79,70,229,.10);
    }
    .form-textarea{
      resize:vertical;
      min-height:60px;
      font-family:'Inter',sans-serif;
      line-height:1.4;
    }

    .time-container{
      display:grid;
      grid-template-columns:1fr auto 1fr;
      gap:8px;
      align-items:center;
    }
    .time-separator{color:var(--gray);font-weight:700;text-align:center;font-size:12px;padding:0 4px}
    input[type="time"]{font-size:13px;padding:7px 8px}

    /* Toggle */
    .toggle-switch{position:relative;display:inline-block;width:44px;height:24px}
    .toggle-switch input{opacity:0;width:0;height:0}
    .toggle-slider{
      position:absolute;cursor:pointer;inset:0;
      background-color:rgba(255,255,255,.10);
      transition:var(--transition);
      border-radius:34px;
    }
    .toggle-slider:before{
      position:absolute;content:"";
      height:16px;width:16px;left:4px;bottom:4px;
      background-color:#fff;
      transition:var(--transition);
      border-radius:50%;
    }
    input:checked + .toggle-slider{background-color:var(--secondary)}
    input:checked + .toggle-slider:before{transform:translateX(20px)}

    /* Templates */
    .templates-section{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
    }
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:10px;flex-wrap:wrap}
    .section-title{
      font-size:14px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .template-actions{display:flex;gap:8px;flex-wrap:wrap}

    .template-cards{
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }

    .template-card{
      background:rgba(0,0,0,.20);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
    }
    .template-card.completed{border-color:var(--secondary)}
    .template-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:10px}
    .template-card-title{
      font-size:13px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:6px;
    }
    .template-badge{
      font-size:10px;font-weight:900;
      padding:3px 8px;border-radius:12px;
      background:rgba(79,70,229,.10);
      color:var(--primary-light);
      white-space:nowrap;
    }
    .template-content{
      font-family:Consolas,Monaco,monospace;
      background:rgba(0,0,0,.30);
      padding:12px;
      border-radius:var(--radius-sm);
      border-left:2px solid var(--primary);
      overflow-x:auto;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:11px;
      line-height:1.4;
      color:var(--gray-light);
      max-height:180px;
      overflow-y:auto;
    }
    .template-card.completed .template-content{border-left-color:var(--secondary)}

    /* Floating Buttons Container */
    .floating-buttons-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
    }

    .floating-button {
      width: 56px;
      height: 56px;
      background: var(--primary);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .floating-button:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(79,70,229,.3);
    }

    .floating-button.soldaten {
      background: var(--warning);
    }

    .floating-button.soldaten:hover {
      background: var(--warning-dark);
    }

    /* Settings Modal */
    .settings-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .settings-modal.active {
      display: flex;
    }

    .settings-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .settings-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-title i {
      color: var(--primary);
      font-size: 20px;
    }

    .settings-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .settings-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .settings-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .settings-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .settings-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-tab:hover {
      color: var(--primary-light);
    }

    .settings-tab.active {
      color: var(--primary);
    }

    .settings-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--primary);
    }

    .settings-section {
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
    }

    .section-title-settings {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 16px;
    }

    .settings-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .settings-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }
    
    /* FIX: Settings-Input Selects */
    .settings-input option {
      background: #1f2937;
      color: #fff;
    }
    
    /* FIX: Soldaten-Input Selects */
    .soldaten-input option {
      background: #1f2937;
      color: #fff;
    }
    
    /* FIX: Akte-Input Selects */
    .akte-input option {
      background: #1f2937;
      color: #fff;
    }

    .settings-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(79,70,229,.15);
    }

    .unit-list, .rank-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 12px;
      max-height: 300px;
      overflow-y: auto;
      padding-right: 5px;
    }

    .unit-item, .rank-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,.08);
    }

    .unit-name, .rank-name {
      flex: 1;
      font-weight: 900;
      color: #fff;
      font-size: 13px;
    }

    .discord-id {
      background: rgba(79,70,229,.10);
      color: var(--primary-light);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      font-size: 12px;
      font-family: 'Consolas', monospace;
      border: 1px solid rgba(79,70,229,.20);
      min-width: 200px;
      color: #fff;
    }

    .discord-id::placeholder {
      color: rgba(255,255,255,.4);
    }

    .add-btn {
      padding: 10px 20px;
      background: var(--primary);
      color: #fff;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
      margin-top: 12px;
    }

    .add-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    .settings-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    /* Ank√ºndigungen & Besprechungen in Settings */
    .ankundigungen-section {
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-md);
      padding: 20px;
      margin-bottom: 16px;
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigungen-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .ankundigungen-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ankundigungen-tab:hover {
      color: #8b5cf6;
    }

    .ankundigungen-tab.active {
      color: #8b5cf6;
    }

    .ankundigungen-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: #8b5cf6;
    }

    .ankundigungen-form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .empty-ankundigungen {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-ankundigungen-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-ankundigungen-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    /* Logo Upload - ENTFERNT */
    /* Alle CSS-Klassen f√ºr Logo-Upload wurden entfernt */

    /* Soldatengespr√§ch Modal */
    .soldaten-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .soldaten-modal.active {
      display: flex;
    }

    .soldaten-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .soldaten-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .soldaten-title i {
      color: var(--warning);
      font-size: 20px;
    }

    .soldaten-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .soldaten-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .soldaten-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
    }

    .soldaten-tab:hover {
      color: var(--warning);
    }

    .soldaten-tab.active {
      color: var(--warning);
    }

    .soldaten-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--warning);
    }

    .soldaten-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .soldaten-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .soldaten-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .soldaten-input:focus {
      outline: none;
      border-color: var(--warning);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(245,158,11,.15);
    }

    .soldaten-textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .soldaten-preview {
      background: rgba(0,0,0,.3);
      border-radius: var(--radius-md);
      padding: 20px;
      border-left: 3px solid var(--warning);
      margin-top: 10px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .soldaten-preview-title {
      font-weight: 900;
      color: var(--gray-light);
      margin-bottom: 12px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .soldaten-preview-content {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      line-height: 1.4;
      color: #fff;
      background: rgba(0,0,0,.2);
      padding: 16px;
      border-radius: var(--radius-sm);
      max-height: 200px;
      overflow-y: auto;
      min-height: 100px;
    }

    .soldaten-preview-content::-webkit-scrollbar {
      width: 6px;
    }

    .soldaten-preview-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 3px;
    }

    .soldaten-preview-content::-webkit-scrollbar-thumb {
      background: var(--warning);
      border-radius: 3px;
    }

    .soldaten-tab-content {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-liste-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-liste {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
    }

    .soldaten-liste::-webkit-scrollbar {
      width: 8px;
    }

    .soldaten-liste::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .soldaten-liste::-webkit-scrollbar-thumb {
      background: var(--warning);
      border-radius: 4px;
    }

    .soldaten-liste::-webkit-scrollbar-thumb:hover {
      background: var(--warning-dark);
    }

    .soldaten-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
      flex-shrink: 0;
    }

    .soldaten-item:hover {
      background: rgba(255,255,255,.05);
      border-color: var(--warning);
    }

    .soldaten-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .soldaten-item-name {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
    }

    .soldaten-item-dn {
      font-family: 'Inter', monospace;
      background: rgba(245,158,11,.10);
      color: #fcd34d;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(245,158,11,.20);
    }

    .soldaten-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .soldaten-item-notizen {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--warning);
      max-height: 100px;
      overflow-y: auto;
    }

    .soldaten-item-notizen::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-notizen::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-notizen::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-sonstiges {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--warning);
      max-height: 100px;
      overflow-y: auto;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-template {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 11px;
      line-height: 1.4;
      color: var(--gray-light);
      background: rgba(0,0,0,.3);
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255,255,255,.08);
      max-height: 150px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .soldaten-item-template::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-template::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-template::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .soldaten-item-btn {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
    }

    .soldaten-item-btn-copy {
      background: rgba(245,158,11,.15);
      color: #fcd34d;
      border: 1px solid rgba(245,158,11,.25);
    }

    .soldaten-item-btn-copy:hover {
      background: rgba(245,158,11,.25);
    }

    .soldaten-item-btn-delete {
      background: rgba(239,68,68,.15);
      color: #fca5a5;
      border: 1px solid rgba(239,68,68,.25);
    }

    .soldaten-item-btn-delete:hover {
      background: rgba(239,68,68,.25);
    }

    .empty-soldaten {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-soldaten-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-soldaten-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    .soldaten-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
    }

    .soldaten-btn-copy {
      background: var(--warning);
      color: #fff;
    }

    .soldaten-btn-copy:hover {
      background: var(--warning-dark);
      transform: translateY(-1px);
    }

    .soldaten-btn-save {
      background: var(--secondary);
      color: #fff;
    }

    .soldaten-btn-save:hover {
      background: var(--secondary-dark);
      transform: translateY(-1px);
    }

    .soldaten-search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .soldaten-search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .soldaten-search-input::placeholder {
      color: rgba(255,255,255,.5);
    }

    .soldaten-search-input:focus {
      outline: none;
      border-color: var(--warning);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(245,158,11,.15);
    }

    .soldaten-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    /* Beobachtungs Akten Modal */
    .beobachtung-akten-modal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.85);
      backdrop-filter:blur(4px);
      z-index:2000;
      align-items:center;
      justify-content:center;
      padding:20px;
      animation:fadeIn .2s ease;
    }
    .beobachtung-akten-modal.active{display:flex}
    
    .beobachtung-akten-content{
      background:rgba(31,41,55,.95);
      border-radius:var(--radius-lg);
      padding:24px;
      width:100%;
      max-width:900px;
      max-height:90vh;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:var(--shadow-lg);
      animation:slideUp .2s ease;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    
    .beobachtung-akten-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
      padding-bottom:16px;
      border-bottom:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-akten-title{
      font-size:18px;
      font-weight:900;
      color:#fff;
      display:flex;
      align-items:center;
      gap:10px;
    }
    
    .beobachtung-akten-title i{
      color:var(--primary-light);
      font-size:20px;
    }
    
    .beobachtung-akten-close{
      background:none;
      border:none;
      color:var(--gray);
      font-size:20px;
      cursor:pointer;
      transition:var(--transition);
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
    }
    
    .beobachtung-akten-close:hover{
      color:#fff;
      background:rgba(255,255,255,.1);
    }
    
    .beobachtung-akten-body{
      flex:1;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    
    .beobachtung-tabs{
      display:flex;
      gap:2px;
      margin-bottom:16px;
      border-bottom:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-tab{
      padding:12px 20px;
      background:none;
      border:none;
      color:var(--gray);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      font-size:13px;
      position:relative;
    }
    
    .beobachtung-tab:hover{
      color:var(--primary-light);
    }
    
    .beobachtung-tab.active{
      color:var(--primary);
    }
    
    .beobachtung-tab.active::after{
      content:'';
      position:absolute;
      bottom:-1px;
      left:0;
      right:0;
      height:2px;
      background:var(--primary);
    }
    
    .akte-form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:20px;
    }
    
    .akte-label{
      font-weight:900;
      color:var(--gray-light);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    
    .akte-input{
      padding:12px 16px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:14px;
      transition:var(--transition);
      width:100%;
      font-family:'Inter',sans-serif;
    }
    
    .akte-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(79,70,229,.15);
    }
    
    .akte-textarea{
      min-height:120px;
      resize:vertical;
      line-height:1.5;
    }
    
    .beobachtung-preview{
      background:rgba(0,0,0,.3);
      border-radius:var(--radius-md);
      padding:20px;
      border-left:3px solid var(--primary);
      margin-top:10px;
      margin-bottom:20px;
      flex-shrink:0;
    }
    
    .beobachtung-preview-title{
      font-weight:900;
      color:var(--gray-light);
      margin-bottom:12px;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    
    .beobachtung-preview-content{
      font-family:'Consolas','Monaco',monospace;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:12px;
      line-height:1.4;
      color:#fff;
      background:rgba(0,0,0,.2);
      padding:16px;
      border-radius:var(--radius-sm);
      max-height:200px;
      overflow-y:auto;
      min-height:100px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar{
      width:6px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar-track{
      background:rgba(255,255,255,.05);
      border-radius:3px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar-thumb{
      background:var(--primary);
      border-radius:3px;
    }
    
    .beobachtung-akten-liste{
      flex:1;
      overflow-y:auto;
      padding-right:8px;
      min-height:0;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar{
      width:8px;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar-track{
      background:rgba(255,255,255,.05);
      border-radius:4px;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar-thumb{
      background:var(--primary);
      border-radius:4px;
    }
    
    .beobachtung-akte-item{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      margin-bottom:12px;
      transition:var(--transition);
    }
    
    .beobachtung-akte-item:hover{
      background:rgba(255,255,255,.05);
      border-color:var(--primary-light);
    }
    
    .beobachtung-akte-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:12px;
    }
    
    .beobachtung-akte-name{
      font-weight:900;
      color:#fff;
      font-size:15px;
    }
    
    .beobachtung-akte-dn{
      font-family:'Inter',monospace;
      background:rgba(79,70,229,.10);
      color:var(--primary-light);
      padding:4px 10px;
      border-radius:12px;
      font-size:11px;
      font-weight:900;
      border:1px solid rgba(79,70,229,.20);
    }
    
    .beobachtung-akte-date{
      color:var(--gray);
      font-size:11px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    
    .beobachtung-akte-grund{
      color:var(--gray-light);
      font-size:13px;
      line-height:1.5;
      margin-bottom:12px;
      padding:12px;
      background:rgba(0,0,0,.2);
      border-radius:var(--radius-sm);
      border-left:2px solid var(--primary);
      white-space: pre-line;
    }
    
    .beobachtung-akte-template{
      font-family:'Consolas','Monaco',monospace;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:11px;
      line-height:1.4;
      color:var(--gray-light);
      background:rgba(0,0,0,.3);
      padding:12px;
      border-radius:var(--radius-sm);
      border:1px solid rgba(255,255,255,.08);
      max-height:150px;
      overflow-y:auto;
      margin-bottom:12px;
    }
    
    .beobachtung-akte-actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    
    .beobachtung-akte-btn{
      padding:6px 12px;
      border:none;
      border-radius:var(--radius-sm);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      font-size:11px;
    }
    
    .beobachtung-akte-btn-copy{
      background:rgba(79,70,229,.15);
      color:var(--primary-light);
      border:1px solid rgba(79,70,229,.25);
    }
    
    .beobachtung-akte-btn-copy:hover{
      background:rgba(79,70,229,.25);
    }
    
    .beobachtung-akte-btn-delete{
      background:rgba(239,68,68,.15);
      color:#fca5a5;
      border:1px solid rgba(239,68,68,.25);
    }
    
    .beobachtung-akte-btn-delete:hover{
      background:rgba(239,68,68,.25);
    }
    
    .empty-beobachtungen{
      text-align:center;
      padding:40px 20px;
      color:var(--gray);
    }
    
    .empty-beobachtungen-icon{
      font-size:36px;
      margin-bottom:12px;
      opacity:.3;
    }
    
    .empty-beobachtungen-title{
      font-size:14px;
      font-weight:900;
      margin-bottom:6px;
      color:var(--gray-light);
    }
    
    .beobachtung-actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:10px;
      padding-top:20px;
      border-top:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-btn{
      padding:10px 20px;
      border:none;
      border-radius:var(--radius-md);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-size:13px;
    }
    
    .beobachtung-btn-copy{
      background:var(--primary);
      color:#fff;
    }
    
    .beobachtung-btn-copy:hover{
      background:var(--primary-dark);
      transform:translateY(-1px);
    }
    
    .beobachtung-btn-save{
      background:var(--secondary);
      color:#fff;
    }
    
    .beobachtung-btn-save:hover{
      background:var(--secondary-dark);
      transform:translateY(-1px);
    }

    /* Akten Suche */
    .akten-search-container{
      position:relative;
      margin-bottom:20px;
    }
    
    .akten-search-input{
      width:100%;
      padding:12px 16px 12px 44px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:14px;
      transition:var(--transition);
    }
    
    .akten-search-input::placeholder{
      color:rgba(255,255,255,.5);
    }
    
    .akten-search-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(79,70,229,.15);
    }
    
    .akten-search-icon{
      position:absolute;
      left:16px;
      top:50%;
      transform:translateY(-50%);
      color:var(--gray);
      font-size:16px;
    }

    /* Modals */
    .modal-overlay{
      display:none;
      position:fixed;inset:0;
      background:rgba(0,0,0,.80);
      backdrop-filter:blur(4px);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:16px;
      animation:fadeIn .2s ease;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-overlay.active{display:flex}
    .modal{
      background:rgba(31,41,55,.95);
      border-radius:var(--radius-lg);
      padding:20px;
      width:100%;
      max-width:500px;
      border:1px solid rgba(255,255,255,.12);
      box-shadow:var(--shadow-lg);
      animation:slideUp .2s ease;
    }
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;gap:10px}
    .modal-title{
      font-size:16px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .modal-close{
      background:none;border:none;color:var(--gray);
      font-size:18px;cursor:pointer;
      transition:var(--transition);
      width:28px;height:28px;
      display:flex;align-items:center;justify-content:center;
      border-radius:50%;
    }
    .modal-close:hover{color:#fff;background:rgba(255,255,255,.10)}

    /* Empty / Loading */
    .empty-state{text-align:center;padding:40px 20px;color:var(--gray);width:100%}
    .empty-icon{font-size:36px;margin-bottom:12px;opacity:.3}
    .empty-title{font-size:14px;font-weight:900;margin-bottom:6px;color:var(--gray-light)}
    .empty-description{font-size:12px;color:var(--gray);max-width:250px;margin:0 auto 12px}

    .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;width:100%}
    .loading-spinner{
      width:32px;height:32px;
      border:2px solid rgba(255,255,255,.10);
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Notification */
    .notification{
      position:fixed;
      bottom:16px;right:16px;
      background:var(--secondary);
      color:#fff;
      padding:10px 14px;
      border-radius:var(--radius-md);
      box-shadow:var(--shadow-md);
      display:flex;align-items:center;gap:8px;
      z-index:1001;
      transform:translateY(100px);
      opacity:0;
      transition:transform .2s ease, opacity .2s ease;
      min-width:200px;
    }
    .notification.show{transform:translateY(0);opacity:1}
    .notification-icon{font-size:14px}
    .notification-message{font-weight:900;font-size:13px}

    /* Responsive */
    @media (max-width:1200px){
      .app-container{grid-template-columns:1fr;padding:16px;gap:16px}
      .sidebar{position:static;max-height:500px;height:auto}
      .induction-grid{grid-template-columns:1fr}
    }
    @media (max-width:768px){
      .app-header{padding:14px 16px}
      .header-content{flex-direction:column;gap:12px;align-items:stretch}
      .header-stats{justify-content:center}
      .brand{gap:10px}
      .brand-text h1{font-size:16px}
      .brand-text .subtitle{font-size:10px}
      .content-header{flex-direction:column;align-items:stretch;padding:14px}
      .employee-tags{flex-direction:column;gap:6px}
      .induction-content{padding:16px}
      .oral-form-grid,.org-form-grid{grid-template-columns:1fr}
      .settings-modal,
      .soldaten-modal,
      .beobachtung-akten-modal,
      .besprechungen-modal,
      .ankundigungen-modal{padding:12px}
      .settings-content,
      .soldaten-content,
      .beobachtung-akten-content,
      .besprechungen-content,
      .ankundigungen-content{padding:20px}
      .settings-actions,
      .soldaten-actions,
      .beobachtung-actions{flex-direction:column;align-items:stretch}
      .floating-buttons-container{
        bottom: 16px;
        right: 16px;
      }
      .settings-tabs,
      .soldaten-tabs,
      .beobachtung-tabs{flex-direction:column}
      .settings-tab,
      .soldaten-tab,
      .beobachtung-tab{text-align:left;padding:10px 16px}
      .soldaten-form-grid,
      .akte-form-grid{grid-template-columns:1fr}
    }
    @media (max-width:480px){
      .app-container{padding:12px}
      .app-header{padding:12px}
      .stat-card{padding:8px 10px;min-width:70px}
      .stat-value{font-size:18px}
      .sidebar{padding:14px}
      .modal{padding:16px;margin:12px}
      .notification{left:12px;right:12px;bottom:12px;min-width:auto}
      .settings-content,
      .soldaten-content,
      .beobachtung-akten-content,
      .besprechungen-content,
      .ankundigungen-content{padding:16px}
      .soldaten-item-actions,
      .beobachtung-akte-actions{flex-direction:column}
    }
  </style>
</head>

<body>
  <!-- Main Password Modal (am Anfang) -->
  <div class="main-password-modal" id="mainPasswordModal">
    <div class="main-password-content">
      <div class="main-password-header">
        <div class="main-password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr HR App erforderlich
        </div>
      </div>
      <div class="main-password-form">
        <input type="password" class="main-password-input" id="mainPasswordInput" 
               placeholder="Passwort eingeben" onkeypress="if(event.key === 'Enter') checkMainPassword()">
        <div class="main-password-error" id="mainPasswordError" style="display:none">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkMainPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Password Modal -->
  <div class="settings-password-modal" id="settingsPasswordModal">
    <div class="settings-password-content">
      <div class="settings-password-header">
        <div class="settings-password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr Settings erforderlich
        </div>
        <button class="settings-password-close" onclick="closeSettingsPasswordModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="settings-password-form">
        <input type="password" class="settings-password-input" id="settingsPasswordInput" 
               placeholder="Passwort eingeben" onkeypress="if(event.key === 'Enter') checkSettingsPassword()">
        <div class="settings-password-error" id="settingsPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkSettingsPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Ank√ºndigung/Besprechung Modal -->
  <div class="edit-item-modal" id="editItemModal">
    <div class="edit-item-content">
      <div class="edit-item-header">
        <div class="edit-item-title" id="editItemTitle">
          <i class="fas fa-edit"></i> Bearbeiten
        </div>
        <button class="edit-item-close" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="edit-item-body">
        <div class="edit-item-form" id="editItemForm">
          <!-- Form wird dynamisch eingef√ºgt -->
        </div>
      </div>
      
      <div class="edit-item-actions">
        <button class="btn btn-secondary" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i> Abbrechen
        </button>
        <button class="btn btn-primary" onclick="saveEditedItem()">
          <i class="fas fa-save"></i> √Ñnderungen speichern
        </button>
      </div>
    </div>
  </div>

  <!-- Ank√ºndigung Banner -->
  <div class="ankundigung-banner" id="ankundigungBanner">
    <div class="banner-header">
      <div class="banner-title" id="bannerTitle">
        <span>ü™ß</span> Ank√ºndigung
      </div>
      <button class="banner-close" onclick="closeBanner()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="banner-content" id="bannerContent">
      Lade Ank√ºndigung...
    </div>
    <div class="banner-meta">
      <div class="banner-type" id="bannerType">Ank√ºndigung</div>
      <div id="bannerDate">Heute</div>
    </div>
  </div>

  <!-- Ank√ºndigungen Modal -->
  <div class="ankundigungen-modal" id="ankundigungenModal" onclick="if(event.target===this)closeModal('ankundigungenModal')">
    <div class="ankundigungen-content">
      <div class="ankundigungen-header">
        <div class="ankundigungen-title">
          <i class="fas fa-bullhorn"></i> Ank√ºndigungen
        </div>
        <button class="ankundigungen-close" onclick="closeModal('ankundigungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="ankundigungen-body">
        <div class="ankundigungen-search-container">
          <i class="fas fa-search ankundigungen-search-icon"></i>
          <input type="text" class="ankundigungen-search-input" id="ankundigungenSearch" 
                 placeholder="Nach Thema oder Inhalt suchen..." oninput="searchAnkundigungen(this.value)">
        </div>
        
        <div class="ankundigungen-list-container">
          <div class="ankundigungen-list" id="ankundigungenList">
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Ank√ºndigung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Besprechungen Modal -->
  <div class="besprechungen-modal" id="besprechungenModal" onclick="if(event.target===this)closeModal('besprechungenModal')">
    <div class="besprechungen-content">
      <div class="besprechungen-header">
        <div class="besprechungen-title">
          <i class="fas fa-calendar-alt"></i> Besprechungen
        </div>
        <button class="besprechungen-close" onclick="closeModal('besprechungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="besprechungen-body">
        <div class="besprechungen-search-container">
          <i class="fas fa-search besprechungen-search-icon"></i>
          <input type="text" class="besprechungen-search-input" id="besprechungenSearch" 
                 placeholder="Nach Thema oder Inhalt suchen..." oninput="searchBesprechungen(this.value)">
        </div>
        
        <div class="besprechungen-list-container">
          <div class="besprechungen-list" id="besprechungenList">
            <div class="empty-besprechungen">
              <div class="empty-besprechungen-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-besprechungen-title">Keine Besprechungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Besprechung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Buttons -->
  <div class="floating-buttons-container">
    <button class="floating-button soldaten" onclick="openSoldatenModal()" title="Soldatengespr√§che">
      <i class="fas fa-comments"></i>
    </button>
    <button class="floating-button" onclick="openBeobachtungAktenModal()" title="Beobachtungs-Akten">
      <i class="fas fa-folder-open"></i>
    </button>
    <button class="floating-button" onclick="openSettingsWithPassword()" title="Settings">
      <i class="fas fa-cog"></i>
    </button>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal" onclick="if(event.target===this)closeModal('settingsModal')">
    <div class="settings-content">
      <div class="settings-header">
        <div class="settings-title">
          <i class="fas fa-cog"></i> Settings
        </div>
        <button class="settings-close" onclick="closeModal('settingsModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-body">
        <div class="settings-tabs">
          <button class="settings-tab active" onclick="switchSettingsTab('units')">
            <i class="fas fa-building"></i> Units
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('ranks')">
            <i class="fas fa-user-tie"></i> R√§nge
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('ankundigungen')">
            <i class="fas fa-bullhorn"></i> Ank√ºndigungen
          </button>
        </div>
        
        <!-- Units Tab -->
        <div class="settings-tab-content" id="unitsTab">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-building"></i> Unit-Liste bearbeiten</h3>
            <div class="unit-list" id="unitList">
              <!-- Units werden hier dynamisch geladen -->
            </div>
            <button class="add-btn" onclick="addNewUnit()">
              <i class="fas fa-plus"></i> Neue Unit hinzuf√ºgen
            </button>
          </div>
        </div>
        
        <!-- R√§nge Tab -->
        <div class="settings-tab-content" id="ranksTab" style="display:none;">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-user-tie"></i> Rang-Liste bearbeiten</h3>
            <div class="rank-list" id="rankList">
              <!-- R√§nge werden hier dynamisch geladen -->
            </div>
            <button class="add-btn" onclick="addNewRank()">
              <i class="fas fa-plus"></i> Neuen Rang hinzuf√ºgen
            </button>
          </div>
        </div>
        
        <!-- Ank√ºndigungen Tab -->
        <div class="settings-tab-content" id="ankundigungenTab" style="display:none;">
          <div class="ankundigungen-section">
            <div class="ankundigungen-tabs">
              <button class="ankundigungen-tab active" onclick="switchAnkundigungenTab('new')">
                <span>ü™ß</span> Neue Ank√ºndigung
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('besprechung')">
                <span>üóÉÔ∏è</span> Neue Besprechung
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('manage-ankundigungen')">
                <span>üìã</span> Ank√ºndigungen verwalten
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('manage-besprechungen')">
                <span>üìÖ</span> Besprechungen verwalten
              </button>
            </div>
            
            <!-- Neue Ank√ºndigung -->
            <div class="ankundigungen-tab-content" id="ankundigungenNewTab">
              <div class="ankundigungen-form-grid">
                <div class="settings-form-group">
                  <label class="settings-label">Titel</label>
                  <input type="text" class="settings-input" id="ankundigungTitle" placeholder="Titel der Ank√ºndigung">
                </div>
                <div class="settings-form-group">
                  <label class="settings-label">Inhalt *</label>
                  <textarea class="settings-input" id="ankundigungContent" 
                            placeholder="Inhalt der Ank√ºndigung..." rows="4"></textarea>
                </div>
              </div>
              <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveAnkundigung()">
                  <i class="fas fa-save"></i> Ank√ºndigung speichern
                </button>
              </div>
            </div>
            
            <!-- NEUE BESPRECHUNG - MIT VERBESSERTEM LAYOUT -->
            <div class="ankundigungen-tab-content" id="ankundigungenBesprechungTab" style="display:none;">
              <div class="besprechung-form-scroll-container">
                <div class="besprechung-form-scroll">
                  <div class="besprechung-form-grid">
                    <div class="besprechung-form-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Thema *</label>
                        <input type="text" class="settings-input" id="besprechungThema" placeholder="Thema der Besprechung">
                      </div>
                    </div>
                    
                    <div class="besprechung-form-details-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Datum *</label>
                        <input type="date" class="settings-input" id="besprechungDate" value="">
                      </div>
                      <div class="settings-form-group">
                        <label class="settings-label">Uhrzeit *</label>
                        <input type="time" class="settings-input" id="besprechungTime" value="">
                      </div>
                      <div class="settings-form-group">
                        <label class="settings-label">Ort</label>
                        <input type="text" class="settings-input" id="besprechungOrt" placeholder="Ort der Besprechung">
                      </div>
                    </div>
                    
                    <div class="besprechung-form-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Inhalt *</label>
                        <textarea class="settings-input" id="besprechungContent" 
                                  placeholder="Inhalt der Besprechung..." rows="8"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="settings-actions">
                  <button class="btn btn-primary" onclick="saveBesprechung()">
                    <i class="fas fa-save"></i> Besprechung speichern
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Ank√ºndigungen verwalten -->
            <div class="ankundigungen-tab-content" id="ankundigungenManageAnkundigungenTab" style="display:none;">
              <div class="settings-form-group">
                <label class="settings-label">Ank√ºndigungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageAnkundigungenSearch" 
                       placeholder="Nach Ank√ºndigungen suchen..." oninput="searchManageAnkundigungen(this.value)">
              </div>
              
              <div class="manage-items-container">
                <div class="manage-items-list-container">
                  <div class="manage-items-list" id="manageAnkundigungenList">
                    <div class="empty-ankundigungen">
                      <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
                      <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Besprechungen verwalten -->
            <div class="ankundigungen-tab-content" id="ankundigungenManageBesprechungenTab" style="display:none;">
              <div class="settings-form-group">
                <label class="settings-label">Besprechungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageBesprechungenSearch" 
                       placeholder="Nach Besprechungen suchen..." oninput="searchManageBesprechungen(this.value)">
              </div>
              
              <div class="manage-items-container">
                <div class="manage-items-list-container">
                  <div class="manage-items-list" id="manageBesprechungenList">
                    <div class="empty-ankundigungen">
                      <div class="empty-ankundigungen-icon"><i class="fas fa-calendar-alt"></i></div>
                      <div class="empty-ankundigungen-title">Keine Besprechungen gefunden</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="settings-actions">
          <button class="btn btn-secondary" onclick="closeModal('settingsModal')">
            <i class="fas fa-times"></i> Schlie√üen
          </button>
          <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save"></i> Einstellungen speichern
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Soldatengespr√§ch Modal -->
  <div class="soldaten-modal" id="soldatenModal" onclick="if(event.target===this)closeModal('soldatenModal')">
    <div class="soldaten-content">
      <div class="soldaten-header">
        <div class="soldaten-title">
          <i class="fas fa-comments"></i> Soldatengespr√§che
        </div>
        <button class="soldaten-close" onclick="closeModal('soldatenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="soldaten-body">
        <div class="soldaten-tabs">
          <button class="soldaten-tab active" onclick="switchSoldatenTab('new')">Neues Gespr√§ch</button>
          <button class="soldaten-tab" onclick="switchSoldatenTab('list')">Gespr√§chsliste</button>
        </div>
        
        <!-- Neues Gespr√§ch Tab -->
        <div class="soldaten-tab-content" id="soldatenNewTab">
          <div class="soldaten-form-grid">
            <div class="soldaten-form-group">
              <label class="soldaten-label">Name *</label>
              <input type="text" class="soldaten-input" id="soldatenName" placeholder="Vollst√§ndiger Name">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Dienstnummer (DN) *</label>
              <input type="number" class="soldaten-input" id="soldatenDN" placeholder="z.B. 43">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Hauptunit</label>
              <select class="soldaten-input" id="soldatenUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Rang</label>
              <select class="soldaten-input" id="soldatenRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Datum *</label>
              <input type="date" class="soldaten-input" id="soldatenDate" value="">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Uhrzeit *</label>
              <input type="time" class="soldaten-input" id="soldatenTime" value="">
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Notizen *</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenNotizen" 
                        placeholder="Notizen zum Gespr√§ch..."></textarea>
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Sonstiges</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenSonstiges" 
                        placeholder="Weitere Informationen..."></textarea>
            </div>
          </div>
          
          <div class="soldaten-preview">
            <div class="soldaten-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="soldaten-preview-content" id="soldatenPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Soldatengespr√§ch

Name: 
DN: 
Hauptunit: 
Rang: 
Datum:
Uhrzeit: 
Notizen:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            </div>
          </div>
          
          <div class="soldaten-actions">
            <button class="soldaten-btn soldaten-btn-copy" onclick="copySoldatenTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="soldaten-btn soldaten-btn-save" onclick="saveSoldatenGespr√§ch()">
              <i class="fas fa-save"></i> Gespr√§ch speichern
            </button>
          </div>
        </div>
        
        <!-- Gespr√§chsliste Tab -->
        <div class="soldaten-tab-content" id="soldatenListTab" style="display:none;">
          <div class="soldaten-search-container">
            <i class="fas fa-search soldaten-search-icon"></i>
            <input type="text" class="soldaten-search-input" id="soldatenSearch" 
                   placeholder="Nach Name oder DN suchen..." oninput="searchSoldaten(this.value)">
          </div>
          
          <!-- Scrollbar-Container f√ºr die Liste -->
          <div class="soldaten-liste-container">
            <div class="soldaten-liste" id="soldatenListe">
              <div class="empty-soldaten">
                <div class="empty-soldaten-icon"><i class="fas fa-comments"></i></div>
                <div class="empty-soldaten-title">Keine Gespr√§che gefunden</div>
                <div class="empty-description">Erstellen Sie Ihr erstes Soldatengespr√§ch</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Beobachtungs Akten Modal -->
  <div class="beobachtung-akten-modal" id="beobachtungAktenModal" onclick="if(event.target===this)closeModal('beobachtungAktenModal')">
    <div class="beobachtung-akten-content">
      <div class="beobachtung-akten-header">
        <div class="beobachtung-akten-title">
          <i class="fas fa-folder-open"></i> Beobachtungs-Akten
        </div>
        <button class="beobachtung-akten-close" onclick="closeModal('beobachtungAktenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="beobachtung-akten-body">
        <div class="beobachtung-tabs">
          <button class="beobachtung-tab active" onclick="switchBeobachtungTab('new')">Neue Akte erstellen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('list')">Akten durchsuchen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('beobachtung')">Beobachtung hinzuf√ºgen</button>
        </div>
        
        <!-- Neue Akte erstellen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungNewTab">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="akteName" placeholder="Vollst√§ndiger Name">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="akteDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Unit</label>
              <select class="akte-input" id="akteUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Rang</label>
              <select class="akte-input" id="akteRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-save" onclick="createNewAkte()">
              <i class="fas fa-plus"></i> Neue Akte erstellen
            </button>
          </div>
        </div>
        
        <!-- Akten durchsuchen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungListTab" style="display:none;">
          <div class="akten-search-container">
            <i class="fas fa-search akten-search-icon"></i>
            <input type="text" class="akten-search-input" id="aktenSearch" 
                   placeholder="Nach Name oder DN suchen..." oninput="searchAkten(this.value)">
          </div>
          
          <div class="beobachtung-akten-liste" id="aktenListe">
            <div class="empty-beobachtungen">
              <div class="empty-beobachtungen-icon"><i class="fas fa-folder-open"></i></div>
              <div class="empty-beobachtungen-title">Keine Akten gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Akte</div>
            </div>
          </div>
        </div>
        
        <!-- Beobachtung hinzuf√ºgen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungBeobachtungTab" style="display:none;">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="beobachtungName" placeholder="Name der Person">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="beobachtungDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group" style="grid-column: span 2;">
              <label class="akte-label">Grund der Beobachtung *</label>
              <textarea class="akte-input akte-textarea" id="beobachtungGrund" 
                        placeholder="Beschreiben Sie den Grund der Beobachtung..."></textarea>
            </div>
          </div>
          
          <div class="beobachtung-preview">
            <div class="beobachtung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="beobachtung-preview-content" id="beobachtungPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: 
DN:  
Grund:
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-copy" onclick="copyBeobachtungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="beobachtung-btn beobachtung-btn-save" onclick="saveBeobachtungToAkte()">
              <i class="fas fa-save"></i> Zu Akte hinzuf√ºgen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check notification-icon"></i>
    <span class="notification-message" id="notificationMessage"></span>
  </div>

  <!-- App Container (wird erst nach Passwort-Eingabe angezeigt) -->
  <div class="app-container" id="appContainer" style="display:none;">
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <!-- Logo Container -->
<div class="logo-container" id="logoContainer">
  <img
    src=""
    alt="Logo">
</div>
          <div class="brand-text">
            <h1>Human Resources <span class="header-icons">
              <span class="header-icon" onclick="openAnkundigungenModal()" title="Ank√ºndigungen anzeigen">üîî</span>
              <span class="header-icon" onclick="openBesprechungenModal()" title="Besprechungen anzeigen">üóÉÔ∏è</span>
            </span></h1>
            <div class="subtitle">‚Ä¢</div>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat-card">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Mitarbeiter</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalAkten">0</div>
            <div class="stat-label">Beobachtung</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalArchived">0</div>
            <div class="stat-label">Archiviert</div>
          </div>
        </div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title"><i class="fas fa-users"></i> Mitarbeiter</h3>
        <div class="employee-count" id="employeeCount">0</div>
      </div>

      <div class="sidebar-controls">
        <div class="sidebar-filter-buttons">
          <button class="sidebar-filter-btn active" onclick="filterEmployeesByType('all')">Alle</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('oral')">M√ºndlich</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('org')">Organisatorische</button>
        </div>

        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchEmployees" placeholder="Nach Namen oder DN suchen...">
        </div>
      </div>

      <div class="employee-list-container">
        <div class="employee-list" id="employeeList">
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">Keine Mitarbeiter</div>
            <div class="empty-description">F√ºgen Sie Ihren ersten Mitarbeiter hinzu</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="openNewEmployeeModal()">
          <i class="fas fa-user-plus"></i> Neuer Mitarbeiter
        </button>
        <button class="quick-action-btn" onclick="toggleArchiveView()">
          <i class="fas fa-archive"></i> <span id="archiveToggleText">Archiv anzeigen</span>
        </button>
      </div>
    </aside>

    <main class="main-content">
      <div class="content-header" id="employeeHeader">
        <div class="employee-info">
          <h2 id="currentEmployeeName">W√§hlen Sie einen Mitarbeiter</h2>
          <div class="employee-tags">
            <div class="employee-tag"><i class="fas fa-hashtag"></i> <span class="tag-value" id="currentEmployeeDN">DN-</span></div>
            <div class="employee-tag"><i class="fas fa-building"></i> <span class="tag-value" id="currentEmployeeUnit">Unit</span></div>
            <div class="employee-tag"><i class="fas fa-user-tie"></i> <span class="tag-value" id="currentEmployeeRank">Rang</span></div>
            <div class="employee-tag" id="archiveStatusTag" style="display:none;">
              <i class="fas fa-archive"></i> <span class="tag-value" style="background:var(--warning);">Archiviert</span>
            </div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="openEditEmployeeModal()"><i class="fas fa-edit"></i> Bearbeiten</button>
          <button class="btn btn-secondary" id="archiveButton" onclick="toggleArchiveEmployee()" style="display:none;">
            <i class="fas fa-archive"></i> <span id="archiveButtonText">Archivieren</span>
          </button>
        </div>
      </div>

      <div class="induction-content" id="inductionContent">
        <div class="induction-grid">
          <div class="induction-card" id="oralInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-comments"></i></div>
                M√ºndliche Einweisung
              </div>
              <div class="induction-status" id="oralInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="oralInductionToggle" onchange="toggleInduction('oral', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="oral-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="oralDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="oralTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="oralTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="oralPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="oralNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>

          <div class="induction-card" id="orgInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-clipboard-list"></i></div>
                Organisatorische Einweisung
              </div>
              <div class="induction-status" id="orgInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="orgInductionToggle" onchange="toggleInduction('org', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="org-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="orgDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="orgTimeStart">
                  <div class="time-separator">-</div>
                  <input type="time" class="form-input" id="orgTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="orgPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect2">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect2">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="orgNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <div class="section-header">
            <div class="section-title"><i class="fas fa-file-code"></i> Discord Vorlagen</div>
            <div class="template-actions">
              <button class="btn btn-secondary" onclick="copyOralTemplate()"><i class="fas fa-comments"></i> M√ºndlich</button>
              <button class="btn btn-secondary" onclick="copyOrgTemplate()"><i class="fas fa-clipboard-list"></i> Organisatorisch</button>
            </div>
          </div>

          <div class="template-cards">
            <div class="template-card" id="oralTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-comments"></i> M√ºndliche Einweisung</div>
                <div class="template-badge" id="oralTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="oralTemplateContent"></div>
            </div>

            <div class="template-card" id="orgTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-clipboard-list"></i> Organisatorische Einweisung</div>
                <div class="template-badge" id="orgTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="orgTemplateContent"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal" onclick="if(event.target===this)closeModal('newEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-user-plus"></i> Neuen Mitarbeiter hinzuf√ºgen</div>
        <button class="modal-close" onclick="closeModal('newEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div class="form-group">
          <label class="form-label">Vollst√§ndiger Name *</label>
          <input type="text" class="form-input" id="newEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="newEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="newEmployeeUnit">
            <option value="">Unit ausw√§hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="newEmployeeRank">
            <option value="">Rang ausw√§hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button class="btn btn-secondary" onclick="closeModal('newEmployeeModal')">Abbrechen</button>
        <button class="btn btn-primary" onclick="createNewEmployee()"><i class="fas fa-plus"></i> Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal" onclick="if(event.target===this)closeModal('editEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-edit"></i> Mitarbeiter bearbeiten</div>
        <button class="modal-close" onclick="closeModal('editEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div class="form-group">
          <label class="form-label">Vollst√§ndiger Name *</label>
          <input type="text" class="form-input" id="editEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="editEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="editEmployeeUnit">
            <option value="">Unit ausw√§hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="editEmployeeRank">
            <option value="">Rang ausw√§hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:16px;">
        <button class="btn btn-danger" onclick="deleteCurrentEmployee()" style="margin-right:auto;"><i class="fas fa-trash"></i> L√∂schen</button>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-secondary" onclick="closeModal('editEmployeeModal')">Abbrechen</button>
          <button class="btn btn-primary" onclick="saveEditedEmployee()"><i class="fas fa-save"></i> √Ñnderungen speichern</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== KONFIGURATION ====================
const APP_VERSION = '1.1.20240128'; // Version erh√∂ht
const DEFAULT_PASSWORD = 'hr';
const SETTINGS_PASSWORD = 'soc1';
const PASSWORD_EXPIRE_MINUTES = 120; // Verl√§ngert auf 2 Stunden
const AUTO_SAVE_DELAY = 2000; // 2 Sekunden Debounce f√ºr Auto-Save
const MAX_EMPLOYEE_DN = 9999;

// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyBTnsLNw68UuOd5Xa2ymMffWk4SYGDQjso",
  authDomain: "cc-shop-finanzsystem.firebaseapp.com",
  projectId: "cc-shop-finanzsystem",
  storageBucket: "cc-shop-finanzsystem.firebasestorage.app",
  messagingSenderId: "575918945925",
  appId: "1:575918945925:web:bf9d973d5cd9fc547e5bec",
  measurementId: "G-9SZREFTJS6"
};

// App State
const state = {
  currentEmployee: null,
  employees: [],
  bothInductionsCompleted: false,
  currentFilter: 'all',
  settings: {
    units: [],
    ranks: []
  },
  showArchived: false,
  ankundigungen: [],
  soldatenGespr√§che: [],
  akten: [],
  currentSettingsTab: 'units',
  currentAnkundigungenTab: 'new',
  currentSoldatenTab: 'new',
  currentBeobachtungTab: 'new',
  isAuthenticated: false,
  settingsAuthenticated: false,
  settingsAuthTimestamp: 0,
  unsubscribeFunctions: [],
  currentEditItemId: null,
  currentEditItemType: null,
  autoSaveTimeout: null,
  isLoading: false
};

// DOM Cache f√ºr h√§ufig verwendete Elemente
const domCache = {};

// ==================== HELPER FUNCTIONS ====================
function cacheDOM() {
  domCache.mainPasswordInput = document.getElementById('mainPasswordInput');
  domCache.mainPasswordError = document.getElementById('mainPasswordError');
  domCache.settingsPasswordInput = document.getElementById('settingsPasswordInput');
  domCache.settingsPasswordError = document.getElementById('settingsPasswordError');
  domCache.appContainer = document.getElementById('appContainer');
  domCache.employeeList = document.getElementById('employeeList');
  domCache.employeeCount = document.getElementById('employeeCount');
  domCache.searchEmployees = document.getElementById('searchEmployees');
  domCache.totalEmployees = document.getElementById('totalEmployees');
  domCache.totalArchived = document.getElementById('totalArchived');
  domCache.totalAkten = document.getElementById('totalAkten');
}

function debounce(func, wait) {
  let timeout;
  return function executedFunction(...args) {
    const later = () => {
      clearTimeout(timeout);
      func(...args);
    };
    clearTimeout(timeout);
    timeout = setTimeout(later, wait);
  };
}

async function copyToClipboard(text) {
  try {
    if (navigator.clipboard && window.isSecureContext) {
      await navigator.clipboard.writeText(text);
      return true;
    } else {
      const textArea = document.createElement('textarea');
      textArea.value = text;
      textArea.style.position = 'fixed';
      textArea.style.opacity = '0';
      document.body.appendChild(textArea);
      textArea.select();
      const success = document.execCommand('copy');
      document.body.removeChild(textArea);
      return success;
    }
  } catch (err) {
    console.error('Copy failed:', err);
    return false;
  }
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

function formatDate(date) {
  return new Date(date).toLocaleDateString('de-DE', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit'
  });
}

function formatDateTime(date) {
  return new Date(date).toLocaleDateString('de-DE', {
    year: 'numeric',
    month: '2-digit',
    day: '2-digit',
    hour: '2-digit',
    minute: '2-digit'
  });
}

function showNotification(message, type = 'info') {
  const notification = document.getElementById('notification');
  const messageElement = document.getElementById('notificationMessage');
  
  if (!notification || !messageElement) return;
  
  messageElement.textContent = message;
  
  const colors = {
    success: 'var(--secondary)',
    error: 'var(--danger)',
    warning: 'var(--warning)',
    info: 'var(--primary)'
  };
  
  notification.style.background = colors[type] || colors.info;
  
  notification.classList.add('show');
  setTimeout(() => notification.classList.remove('show'), 3000);
}

function validateEmail(email) {
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}

function validateDN(dn) {
  const num = parseInt(dn, 10);
  return !isNaN(num) && num > 0 && num <= MAX_EMPLOYEE_DN;
}

// ==================== FIREBASE INITIALIZATION ====================
let db;
try {
  firebase.initializeApp(firebaseConfig);
  db = firebase.firestore();
} catch (error) {
  console.error('Firebase initialization failed:', error);
  showNotification('Datenbankverbindung fehlgeschlagen', 'error');
}

// ==================== AUTHENTICATION ====================
document.addEventListener('DOMContentLoaded', function () {
  console.log(`HR App Version ${APP_VERSION} geladen`);
  cacheDOM();
  checkAuthentication();
});

function checkAuthentication() {
  const savedPassword = localStorage.getItem('hr_app_password');
  const savedTimestamp = localStorage.getItem('hr_app_password_timestamp');
  const currentTime = Date.now();
  const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
  
  if (savedPassword === DEFAULT_PASSWORD && savedTimestamp && 
      (currentTime - parseInt(savedTimestamp) < expireTime)) {
    state.isAuthenticated = true;
    state.settingsAuthenticated = true;
    state.settingsAuthTimestamp = Date.now();
    localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);
    initializeApp();
  } else {
    setTimeout(() => {
      if (domCache.mainPasswordInput) domCache.mainPasswordInput.focus();
    }, 100);
  }
}

function checkMainPassword() {
  const password = domCache.mainPasswordInput.value;
  const errorElement = domCache.mainPasswordError;
  
  if (password === DEFAULT_PASSWORD) {
    localStorage.setItem('hr_app_password', password);
    localStorage.setItem('hr_app_password_timestamp', Date.now());
    state.isAuthenticated = true;
    state.settingsAuthenticated = true;
    state.settingsAuthTimestamp = Date.now();
    localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);
    
    document.getElementById('mainPasswordModal').style.display = 'none';
    domCache.appContainer.style.display = 'grid';
    
    initializeApp();
  } else {
    errorElement.style.display = 'block';
    domCache.mainPasswordInput.value = '';
    domCache.mainPasswordInput.focus();
  }
}

function checkSettingsAuth() {
  if (state.settingsAuthenticated) {
    const savedTimestamp = localStorage.getItem('hr_settings_auth_timestamp');
    const currentTime = Date.now();
    const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
    
    if (savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
      return true;
    }
  }
  return false;
}

function openSettingsPasswordModal() {
  document.getElementById('settingsPasswordModal').classList.add('active');
  domCache.settingsPasswordInput.focus();
}

function closeSettingsPasswordModal() {
  document.getElementById('settingsPasswordModal').classList.remove('active');
  domCache.settingsPasswordInput.value = '';
  domCache.settingsPasswordError.classList.remove('show');
}

function checkSettingsPassword() {
  const password = domCache.settingsPasswordInput.value;
  const errorElement = domCache.settingsPasswordError;
  
  if (password === SETTINGS_PASSWORD) {
    state.settingsAuthenticated = true;
    state.settingsAuthTimestamp = Date.now();
    localStorage.setItem('hr_settings_auth_timestamp', state.settingsAuthTimestamp);
    closeSettingsPasswordModal();
    openSettingsModal();
  } else {
    errorElement.classList.add('show');
    domCache.settingsPasswordInput.value = '';
    domCache.settingsPasswordInput.focus();
  }
}

function openSettingsWithPassword() {
  if (checkSettingsAuth()) {
    openSettingsModal();
  } else {
    openSettingsPasswordModal();
  }
}

// ==================== APP INITIALIZATION ====================
function initializeApp() {
  if (!state.isAuthenticated) return;
  
  console.log('App wird initialisiert');
  
  // Set default dates
  const today = new Date().toISOString().split('T')[0];
  const now = new Date();
  const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
  
  ['oralDate', 'orgDate', 'soldatenDate', 'besprechungDate'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = today;
  });
  
  ['soldatenTime', 'besprechungTime'].forEach(id => {
    const el = document.getElementById(id);
    if (el) el.value = timeString;
  });
  
  document.getElementById('oralTimeStart').value = '16:40';
  document.getElementById('oralTimeEnd').value = '18:00';
  document.getElementById('orgTimeStart').value = '22:10';
  document.getElementById('orgTimeEnd').value = '23:05';
  
  loadSettings();
  setupRealtimeListeners();
  setupEventListeners();
  setupFormChangeListeners();
  adjustSidebarHeight();
  
  setTimeout(showLatestAnkundigung, 1000);
}

// ==================== SETTINGS MANAGEMENT ====================
async function loadSettings() {
  try {
    const doc = await db.collection('hrSettings').doc('settings').get();
    
    if (doc.exists) {
      const loadedSettings = doc.data();
      state.settings = { ...state.settings, ...loadedSettings };
    }
    
    // Default units if none exist
    if (!state.settings.units || state.settings.units.length === 0) {
      state.settings.units = [
        { name: "Air Force", discordId: "1269229762400878675" },
        { name: "S.O.C", discordId: "1339523576159666218" },
        { name: "Infantry", discordId: "1187756956425920645" },
        { name: "Military Police", discordId: "1289716541658497055" },
        { name: "Navy Marine", discordId: "1097653037968920776" },
        { name: "Navy SEALs", discordId: "1125174901989445693" }
      ];
    }
    
    // Default ranks if none exist
    if (!state.settings.ranks || state.settings.ranks.length === 0) {
      state.settings.ranks = [
        { name: "Private", discordId: "1097625924104626198" },
        { name: "Private First Class", discordId: "1098190829295771739" },
        { name: "Specialist", discordId: "1097625921516748830" },
        { name: "Corporal", discordId: "1097625914763919532" },
        { name: "Sergeant", discordId: "1097625913274933298" },
        { name: "Staff Sergeant", discordId: "1097625912163451112" },
        { name: "Sergeant First Class", discordId: "1348414845862674524" },
        { name: "Master Sergeant", discordId: "1348414845862674524" },
        { name: "Lieutenant", discordId: "1097625900125782278" },
        { name: "Captain", discordId: "1097625898880077955" },
        { name: "Major", discordId: "1097625896560640024" },
        { name: "Colonel", discordId: "1097625895541428275" },
        { name: "Major General", discordId: "1097625893880479777" },
        { name: "General of Army", discordId: "1097625891632316436" }
      ];
    }
    
    updateUnitAndRankSelects();
    populateSettingsUI();
  } catch (error) {
    console.error('Fehler beim Laden der Einstellungen:', error);
    showNotification('Einstellungen konnten nicht geladen werden', 'error');
  }
}

function populateSettingsUI() {
  const unitList = document.getElementById('unitList');
  const rankList = document.getElementById('rankList');
  
  if (!unitList || !rankList) return;
  
  unitList.innerHTML = '';
  rankList.innerHTML = '';
  
  state.settings.units.forEach((unit, index) => {
    const unitItem = document.createElement('div');
    unitItem.className = 'unit-item';
    unitItem.innerHTML = `
      <div class="unit-name">${escapeHtml(unit.name)}</div>
      <input type="text" class="discord-id" value="${escapeHtml(unit.discordId || '')}" 
             placeholder="Discord Rollen-ID" 
             onchange="updateUnitDiscordId(${index}, this.value)">
      <button class="btn btn-danger" onclick="removeUnit(${index})">
        <i class="fas fa-trash"></i>
      </button>
    `;
    unitList.appendChild(unitItem);
  });
  
  state.settings.ranks.forEach((rank, index) => {
    const rankItem = document.createElement('div');
    rankItem.className = 'rank-item';
    rankItem.innerHTML = `
      <div class="rank-name">${escapeHtml(rank.name)}</div>
      <input type="text" class="discord-id" value="${escapeHtml(rank.discordId || '')}" 
             placeholder="Discord Rollen-ID" 
             onchange="updateRankDiscordId(${index}, this.value)">
      <button class="btn btn-danger" onclick="removeRank(${index})">
        <i class="fas fa-trash"></i>
      </button>
    `;
    rankList.appendChild(rankItem);
  });
}

function updateUnitAndRankSelects() {
  const unitSelectIds = [
    'unitSelect', 'unitSelect2', 'newEmployeeUnit', 'editEmployeeUnit',
    'soldatenUnit', 'akteUnit', 'beobachtungUnit'
  ];
  
  const rankSelectIds = [
    'rankSelect', 'rankSelect2', 'newEmployeeRank', 'editEmployeeRank',
    'soldatenRank', 'akteRank', 'beobachtungRank'
  ];
  
  unitSelectIds.forEach(id => {
    const select = document.getElementById(id);
    if (select) {
      const currentValue = select.value;
      select.innerHTML = '<option value="">Unit ausw√§hlen</option>';
      
      state.settings.units.forEach(unit => {
        const option = document.createElement('option');
        option.value = unit.name;
        option.textContent = unit.name;
        select.appendChild(option);
      });
      
      if (currentValue) select.value = currentValue;
    }
  });
  
  rankSelectIds.forEach(id => {
    const select = document.getElementById(id);
    if (select) {
      const currentValue = select.value;
      select.innerHTML = '<option value="">Rang ausw√§hlen</option>';
      
      state.settings.ranks.forEach(rank => {
        const option = document.createElement('option');
        option.value = rank.name;
        option.textContent = rank.name;
        select.appendChild(option);
      });
      
      if (currentValue) select.value = currentValue;
    }
  });
}

function updateUnitDiscordId(index, discordId) {
  if (index >= 0 && index < state.settings.units.length) {
    state.settings.units[index].discordId = discordId.trim();
  }
}

function updateRankDiscordId(index, discordId) {
  if (index >= 0 && index < state.settings.ranks.length) {
    state.settings.ranks[index].discordId = discordId.trim();
  }
}

function addNewUnit() {
  const name = prompt('Name der neuen Unit:');
  if (name && name.trim()) {
    state.settings.units.push({
      name: name.trim(),
      discordId: ''
    });
    populateSettingsUI();
    showNotification('Unit hinzugef√ºgt', 'success');
  }
}

function addNewRank() {
  const name = prompt('Name des neuen Rangs:');
  if (name && name.trim()) {
    state.settings.ranks.push({
      name: name.trim(),
      discordId: ''
    });
    populateSettingsUI();
    showNotification('Rang hinzugef√ºgt', 'success');
  }
}

function removeUnit(index) {
  if (confirm('Unit wirklich l√∂schen?')) {
    state.settings.units.splice(index, 1);
    populateSettingsUI();
    showNotification('Unit gel√∂scht', 'success');
  }
}

function removeRank(index) {
  if (confirm('Rang wirklich l√∂schen?')) {
    state.settings.ranks.splice(index, 1);
    populateSettingsUI();
    showNotification('Rang gel√∂scht', 'success');
  }
}

async function saveSettings() {
  try {
    await db.collection('hrSettings').doc('settings').set(state.settings, { merge: true });
    
    updateUnitAndRankSelects();
    closeModal('settingsModal');
    showNotification('Einstellungen gespeichert', 'success');
  } catch (error) {
    console.error('Fehler beim Speichern der Einstellungen:', error);
    showNotification('Fehler: ' + error.message, 'error');
  }
}

// ==================== EMPLOYEE MANAGEMENT ====================
function renderEmployeeList() {
  const container = domCache.employeeList;
  const countElement = domCache.employeeCount;
  
  if (!container) return;
  
  let filteredEmployees = getFilteredEmployees();
  
  // Sort by name
  filteredEmployees.sort((a, b) => {
    const nameA = (a.name || '').toUpperCase();
    const nameB = (b.name || '').toUpperCase();
    return nameA.localeCompare(nameB, 'de');
  });
  
  if (filteredEmployees.length === 0) {
    container.innerHTML = `
      <div class="empty-state">
        <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
        <div class="empty-title">${getEmptyStateTitle()}</div>
        <div class="empty-description">${getEmptyStateDescription()}</div>
      </div>
    `;
    countElement.textContent = '0';
    return;
  }
  
  container.innerHTML = '';
  countElement.textContent = filteredEmployees.length;
  
  filteredEmployees.forEach(employee => {
    const isArchived = employee.status === 'archived';
    const isActive = state.currentEmployee?.id === employee.id;
    const oralCompleted = employee.inductions?.oral?.completed || false;
    const orgCompleted = employee.inductions?.org?.completed || false;
    
    const card = document.createElement('div');
    card.className = `employee-card ${isActive ? 'active' : ''} ${isArchived ? 'archived' : ''}`;
    card.onclick = () => selectEmployee(employee);
    card.oncontextmenu = (e) => {
      e.preventDefault();
      showEmployeeContextMenu(e, employee);
    };
    
    card.innerHTML = `
      <div class="employee-top-row">
        <div class="employee-name">${escapeHtml(employee.name || '')}</div>
        <div class="employee-dn">DN ${escapeHtml(employee.dn || '')}</div>
      </div>
      <div class="employee-meta">
        <i class="fas fa-user-tie"></i> ${escapeHtml(employee.rank || 'Kein Rang')} ‚Ä¢
        <i class="fas fa-building"></i> ${escapeHtml(employee.unit || 'Keine Unit')}
      </div>
      <div class="induction-badges">
        <div class="induction-badge badge-oral ${oralCompleted ? 'completed' : 'pending'}">
          <i class="fas ${oralCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
          M√ºndlich
        </div>
        <div class="induction-badge badge-org ${orgCompleted ? 'completed' : 'pending'}">
          <i class="fas ${orgCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
          Organisatorisch
        </div>
      </div>
    `;
    
    container.appendChild(card);
  });
}

function getFilteredEmployees() {
  let filtered = state.employees.filter(emp => {
    if (state.showArchived) {
      return emp.status === 'archived';
    } else {
      return !emp.status || emp.status === 'active';
    }
  });
  
  if (state.currentFilter === 'oral') {
    filtered = filtered.filter(emp => !(emp.inductions?.oral?.completed));
  } else if (state.currentFilter === 'org') {
    filtered = filtered.filter(emp => !(emp.inductions?.org?.completed));
  }
  
  return filtered;
}

function getEmptyStateTitle() {
  if (state.showArchived) return 'Keine archivierten Mitarbeiter';
  return 'Keine aktiven Mitarbeiter';
}

function getEmptyStateDescription() {
  if (state.showArchived) {
    if (state.currentFilter === 'oral') return 'Keine archivierten Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
    if (state.currentFilter === 'org') return 'Keine archivierten Mitarbeiter mit ausstehender organisatorischer Einweisung';
    return 'Keine archivierten Mitarbeiter gefunden';
  }
  
  if (state.currentFilter === 'oral') return 'Keine Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
  if (state.currentFilter === 'org') return 'Keine Mitarbeiter mit ausstehender organisatorischer Einweisung';
  return 'F√ºgen Sie Ihren ersten Mitarbeiter hinzu';
}

function filterEmployees(searchTerm) {
  const cards = document.querySelectorAll('.employee-card');
  const term = (searchTerm || '').toLowerCase().trim();
  
  if (!term) {
    cards.forEach(card => card.style.display = 'flex');
    return;
  }
  
  cards.forEach(card => {
    const text = card.textContent.toLowerCase();
    card.style.display = text.includes(term) ? 'flex' : 'none';
  });
}

function filterEmployeesByType(type) {
  state.currentFilter = type;
  
  document.querySelectorAll('.sidebar-filter-btn').forEach(btn => btn.classList.remove('active'));
  const buttons = document.querySelectorAll('.sidebar-filter-btn');
  if (buttons[0]) buttons[0].classList.add('active');
  
  renderEmployeeList();
}

function selectEmployee(employee) {
  state.currentEmployee = employee;
  
  document.getElementById('employeeHeader').style.display = 'flex';
  document.getElementById('inductionContent').style.display = 'block';
  
  updateEmployeeHeader();
  loadEmployeeData();
  updateInductionDisplay();
  renderEmployeeList();
}

function loadEmployeeData() {
  if (!state.currentEmployee) return;
  
  const oralData = state.currentEmployee.oralData || {};
  const orgData = state.currentEmployee.orgData || {};
  const isArchived = state.currentEmployee.status === 'archived';
  
  // Load oral data
  document.getElementById('oralDate').value = oralData.date || new Date().toISOString().split('T')[0];
  document.getElementById('oralTimeStart').value = oralData.timeStart || '16:40';
  document.getElementById('oralTimeEnd').value = oralData.timeEnd || '18:00';
  document.getElementById('oralPerson').value = oralData.person || '';
  document.getElementById('oralNotes').value = oralData.notes || '';
  document.getElementById('unitSelect').value = oralData.unit || state.currentEmployee.unit || '';
  document.getElementById('rankSelect').value = oralData.rank || state.currentEmployee.rank || '';
  
  // Load org data
  document.getElementById('orgDate').value = orgData.date || new Date().toISOString().split('T')[0];
  document.getElementById('orgTimeStart').value = orgData.timeStart || '22:10';
  document.getElementById('orgTimeEnd').value = orgData.timeEnd || '23:05';
  document.getElementById('orgPerson').value = orgData.person || '';
  document.getElementById('orgNotes').value = orgData.notes || '';
  document.getElementById('unitSelect2').value = orgData.unit || state.currentEmployee.unit || '';
  document.getElementById('rankSelect2').value = orgData.rank || state.currentEmployee.rank || '';
  
  // Update toggles
  const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
  const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;
  
  document.getElementById('oralInductionToggle').checked = oralCompleted;
  document.getElementById('orgInductionToggle').checked = orgCompleted;
  
  updateInductionUI('oral', oralCompleted);
  updateInductionUI('org', orgCompleted);
  
  // Update archive UI
  const archiveTag = document.getElementById('archiveStatusTag');
  const archiveButton = document.getElementById('archiveButton');
  const archiveButtonText = document.getElementById('archiveButtonText');
  
  if (isArchived) {
    if (archiveTag) archiveTag.style.display = 'flex';
    if (archiveButton) {
      archiveButton.style.display = 'inline-flex';
      archiveButtonText.textContent = 'Wiederherstellen';
    }
    document.getElementById('oralInductionToggle').disabled = true;
    document.getElementById('orgInductionToggle').disabled = true;
  } else {
    if (archiveTag) archiveTag.style.display = 'none';
    if (archiveButton) {
      archiveButton.style.display = 'inline-flex';
      archiveButtonText.textContent = 'Archivieren';
    }
    document.getElementById('oralInductionToggle').disabled = false;
    document.getElementById('orgInductionToggle').disabled = false;
  }
  
  checkBothInductionsCompleted();
  updateTemplates();
}

function updateInductionUI(type, completed) {
  const card = document.getElementById(`${type}InductionCard`);
  const status = document.getElementById(`${type}InductionStatus`);
  
  if (!card || !status) return;
  
  if (completed) {
    card.classList.add('completed');
    status.textContent = 'BESTANDEN';
  } else {
    card.classList.remove('completed');
    status.textContent = 'AUSSTEHEND';
  }
}

function saveFormData() {
  if (!state.currentEmployee) return;
  
  state.currentEmployee.oralData = {
    date: document.getElementById('oralDate').value,
    timeStart: document.getElementById('oralTimeStart').value,
    timeEnd: document.getElementById('oralTimeEnd').value,
    person: document.getElementById('oralPerson').value,
    notes: document.getElementById('oralNotes').value,
    unit: document.getElementById('unitSelect').value,
    rank: document.getElementById('rankSelect').value
  };
  
  state.currentEmployee.orgData = {
    date: document.getElementById('orgDate').value,
    timeStart: document.getElementById('orgTimeStart').value,
    timeEnd: document.getElementById('orgTimeEnd').value,
    person: document.getElementById('orgPerson').value,
    notes: document.getElementById('orgNotes').value,
    unit: document.getElementById('unitSelect2').value,
    rank: document.getElementById('rankSelect2').value
  };
}

async function saveEmployeeData(autoSave = false) {
  if (!state.currentEmployee || !db) return false;
  
  clearTimeout(state.autoSaveTimeout);
  
  const saveFunction = async () => {
    try {
      const dataToSave = {
        name: state.currentEmployee.name,
        dn: state.currentEmployee.dn,
        unit: state.currentEmployee.unit,
        rank: state.currentEmployee.rank,
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
        inductions: state.currentEmployee.inductions || {},
        oralData: state.currentEmployee.oralData || {},
        orgData: state.currentEmployee.orgData || {},
        status: state.currentEmployee.status || 'active'
      };
      
      await db.collection('hrEmployees').doc(state.currentEmployee.id).set(dataToSave, { merge: true });
      return true;
    } catch (error) {
      console.error('Fehler beim Speichern:', error);
      if (!autoSave) {
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
      return false;
    }
  };
  
  if (autoSave) {
    state.autoSaveTimeout = setTimeout(saveFunction, AUTO_SAVE_DELAY);
    return true;
  } else {
    return await saveFunction();
  }
}

// ==================== EVENT LISTENERS ====================
function setupEventListeners() {
  // Search input
  if (domCache.searchEmployees) {
    domCache.searchEmployees.addEventListener('input', debounce(function (e) {
      filterEmployees(e.target.value);
    }, 300));
  }
  
  // Keyboard shortcuts
  document.addEventListener('keydown', function (e) {
    if (e.ctrlKey) {
      switch(e.key) {
        case 'n':
          e.preventDefault();
          openNewEmployeeModal();
          break;
        case 'f':
          e.preventDefault();
          if (domCache.searchEmployees) domCache.searchEmployees.focus();
          break;
        case 'e':
          e.preventDefault();
          if (state.currentEmployee) openEditEmployeeModal();
          break;
        case 'b':
          e.preventDefault();
          openBeobachtungAktenModal();
          break;
        case 's':
          e.preventDefault();
          openSoldatenModal();
          break;
        case ',':
          e.preventDefault();
          openSettingsWithPassword();
          break;
      }
    }
  });
  
  // Window resize
  window.addEventListener('resize', adjustSidebarHeight);
}

function setupFormChangeListeners() {
  const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea, .toggle-switch input');
  formInputs.forEach(input => {
    input.addEventListener('input', handleFormChange);
    input.addEventListener('change', handleFormChange);
  });
}

function handleFormChange() {
  if (state.currentEmployee) {
    saveFormData();
    updateTemplates();
    saveEmployeeData(true);
  }
}

// ==================== MODAL FUNCTIONS ====================
function openModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) modal.classList.add('active');
}

function closeModal(modalId) {
  const modal = document.getElementById(modalId);
  if (modal) {
    modal.classList.remove('active');
    if (modalId === 'akteDetailModal') {
      setTimeout(() => modal.remove(), 300);
    }
  }
}

function openSettingsModal() {
  if (!checkSettingsAuth()) {
    openSettingsPasswordModal();
    return;
  }
  openModal('settingsModal');
  populateSettingsUI();
}

function switchSettingsTab(tabName) {
  state.currentSettingsTab = tabName;
  
  document.querySelectorAll('.settings-tab').forEach(tab => tab.classList.remove('active'));
  document.querySelectorAll('.settings-tab-content').forEach(content => content.style.display = 'none');
  
  const tabElements = document.querySelectorAll('.settings-tab');
  const tabContents = {
    'units': document.getElementById('unitsTab'),
    'ranks': document.getElementById('ranksTab'),
    'ankundigungen': document.getElementById('ankundigungenTab')
  };
  
  if (tabElements[0]) tabElements[0].classList.add('active');
  if (tabContents[tabName]) tabContents[tabName].style.display = 'block';
}

// ==================== UI UTILITIES ====================
function adjustSidebarHeight() {
  const sidebar = document.querySelector('.sidebar');
  const header = document.querySelector('.app-header');
  
  if (!sidebar || !header) return;
  
  const windowHeight = window.innerHeight;
  const headerHeight = header.offsetHeight;
  const availableHeight = windowHeight - headerHeight - 40;
  const newHeight = Math.max(availableHeight, 500);
  
  sidebar.style.height = `${newHeight}px`;
}

function updateStats() {
  const totalEmployees = state.employees.filter(emp => !emp.status || emp.status === 'active').length;
  const totalArchived = state.employees.filter(emp => emp.status === 'archived').length;
  
  if (domCache.totalEmployees) domCache.totalEmployees.textContent = totalEmployees;
  if (domCache.totalArchived) domCache.totalArchived.textContent = totalArchived;
  
  let aktenCount = 0;
  state.employees.forEach(emp => {
    if (emp.beobachtungen && emp.beobachtungen.length > 0) {
      aktenCount += emp.beobachtungen.length;
    }
  });
  
  if (domCache.totalAkten) {
    domCache.totalAkten.textContent = aktenCount + state.akten.length;
  }
}

// ==================== REAL-TIME LISTENERS ====================
function setupRealtimeListeners() {
  if (!db) return;
  
  // Clean up previous listeners
  state.unsubscribeFunctions.forEach(unsubscribe => unsubscribe());
  state.unsubscribeFunctions = [];
  
  // Employees listener
  const unsubscribeEmployees = db.collection('hrEmployees')
    .orderBy('lastUpdated', 'desc')
    .onSnapshot((snapshot) => {
      state.employees = [];
      let archivedCount = 0;
      
      snapshot.forEach(doc => {
        const employee = { id: doc.id, ...doc.data() };
        state.employees.push(employee);
        
        if (employee.status === 'archived') {
          archivedCount++;
        }
      });
      
      renderEmployeeList();
      updateStats();
      if (domCache.totalArchived) domCache.totalArchived.textContent = archivedCount;
      
      if (state.currentEmployee) {
        const updatedEmployee = state.employees.find(emp => emp.id === state.currentEmployee.id);
        if (updatedEmployee) {
          selectEmployee(updatedEmployee);
        }
      }
      
      setTimeout(updateInductionDisplay, 100);
    }, (error) => {
      console.error('Fehler beim Lauschen auf Mitarbeiter-√Ñnderungen:', error);
      showNotification('Fehler bei Live-Updates', 'error');
    });
  
  // Akten listener
  const unsubscribeAkten = db.collection('hrAkten')
    .orderBy('lastUpdated', 'desc')
    .limit(100)
    .onSnapshot((snapshot) => {
      state.akten = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        state.akten.push({ 
          id: doc.id, 
          ...data,
          createdFormatted: data.createdFormatted || formatDate(data.created)
        });
      });
      updateStats();
    }, (error) => {
      console.error('Fehler beim Lauschen auf Akten-√Ñnderungen:', error);
    });
  
  // Soldaten listener
  const unsubscribeSoldaten = db.collection('hrSoldatenGespr√§che')
    .orderBy('created', 'desc')
    .limit(100)
    .onSnapshot((snapshot) => {
      state.soldatenGespr√§che = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        state.soldatenGespr√§che.push({ 
          id: doc.id, 
          ...data,
          createdFormatted: data.createdFormatted || formatDate(data.created),
          dateFormatted: data.dateFormatted || (data.date ? formatDate(data.date) : '')
        });
      });
    }, (error) => {
      console.error('Fehler beim Lauschen auf Soldatengespr√§che:', error);
    });
  
  // Settings listener
  const unsubscribeSettings = db.collection('hrSettings')
    .doc('settings')
    .onSnapshot((doc) => {
      if (doc.exists) {
        const newSettings = doc.data();
        state.settings = { ...state.settings, ...newSettings };
        populateSettingsUI();
        updateUnitAndRankSelects();
      }
    }, (error) => {
      console.error('Fehler beim Lauschen auf Settings:', error);
    });
  
  // Ank√ºndigungen listener
  const unsubscribeAnkundigungen = db.collection('hrAnkundigungen')
    .onSnapshot((snapshot) => {
      state.ankundigungen = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        state.ankundigungen.push({ 
          id: doc.id, 
          ...data
        });
      });
    }, (error) => {
      console.error('Fehler beim Lauschen auf Ank√ºndigungen:', error);
    });
  
  state.unsubscribeFunctions = [
    unsubscribeEmployees,
    unsubscribeAkten,
    unsubscribeSoldaten,
    unsubscribeSettings,
    unsubscribeAnkundigungen
  ];
}

// ==================== TEMPLATE FUNCTIONS ====================
function updateTemplates() {
  if (!state.currentEmployee) {
    seedTemplateBoxes();
    return;
  }
  
  saveFormData();
  
  const oralTemplate = generateTemplate('oral');
  const orgTemplate = generateTemplate('org');
  
  const oralTemplateContent = document.getElementById('oralTemplateContent');
  const orgTemplateContent = document.getElementById('orgTemplateContent');
  
  if (oralTemplateContent) oralTemplateContent.textContent = oralTemplate;
  if (orgTemplateContent) orgTemplateContent.textContent = orgTemplate;
  
  const oralCompleted = state.currentEmployee.inductions?.oral?.completed || false;
  const orgCompleted = state.currentEmployee.inductions?.org?.completed || false;
  
  const oralTemplateBadge = document.getElementById('oralTemplateBadge');
  const orgTemplateBadge = document.getElementById('orgTemplateBadge');
  
  if (oralTemplateBadge) oralTemplateBadge.textContent = oralCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
  if (orgTemplateBadge) orgTemplateBadge.textContent = orgCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
  
  const oralTemplateCard = document.getElementById('oralTemplateCard');
  const orgTemplateCard = document.getElementById('orgTemplateCard');
  
  if (oralTemplateCard) oralTemplateCard.classList.toggle('completed', oralCompleted);
  if (orgTemplateCard) orgTemplateCard.classList.toggle('completed', orgCompleted);
}

function generateTemplate(type) {
  const isOral = type === 'oral';
  const data = isOral ? state.currentEmployee.oralData : state.currentEmployee.orgData;
  
  const name = state.currentEmployee.name || '';
  const dn = state.currentEmployee.dn || '';
  const unit = isOral ? 
    (document.getElementById('unitSelect').value || state.currentEmployee.unit || '') :
    (document.getElementById('unitSelect2').value || state.currentEmployee.unit || '');
  const rank = isOral ? 
    (document.getElementById('rankSelect').value || state.currentEmployee.rank || '') :
    (document.getElementById('rankSelect2').value || state.currentEmployee.rank || '');
  
  const date = data?.date ? formatDate(data.date) : '';
  const timeStart = data?.timeStart || '';
  const timeEnd = data?.timeEnd || '';
  const person = data?.person || '';
  const notes = data?.notes || '';
  const timeSeparator = isOral ? 'bis' : '-';
  
  const unitSetting = state.settings.units.find(u => u.name === unit);
  const rankSetting = state.settings.ranks.find(r => r.name === rank);
  
  const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
  const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;
  
  return `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
${isOral ? 'M√ºndliche Einweisung' : 'Organisatorische Einweisung'}

Name: ${name}
DN: ${dn}
Hauptunit: ${unitDisplay}
Rang: ${rankDisplay}
Datum: ${date}
Uhrzeit: ${timeStart} ${timeSeparator} ${timeEnd}
Beteiligte: ${person}
Sonstiges: ${notes}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
}

function seedTemplateBoxes() {
  const oralTemplateContent = document.getElementById('oralTemplateContent');
  const orgTemplateContent = document.getElementById('orgTemplateContent');
  
  if (oralTemplateContent) {
    oralTemplateContent.textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
M√ºndliche Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
  }
  
  if (orgTemplateContent) {
    orgTemplateContent.textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Organisatorische Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
  }
}

// ==================== EXPORT FUNCTIONS ====================
// Alle Funktionen, die im HTML verwendet werden, m√ºssen global verf√ºgbar sein
window.checkMainPassword = checkMainPassword;
window.openSettingsWithPassword = openSettingsWithPassword;
window.openSettingsPasswordModal = openSettingsPasswordModal;
window.closeSettingsPasswordModal = closeSettingsPasswordModal;
window.checkSettingsPassword = checkSettingsPassword;
window.switchSettingsTab = switchSettingsTab;
window.updateUnitDiscordId = updateUnitDiscordId;
window.updateRankDiscordId = updateRankDiscordId;
window.addNewUnit = addNewUnit;
window.addNewRank = addNewRank;
window.removeUnit = removeUnit;
window.removeRank = removeRank;
window.saveSettings = saveSettings;
window.filterEmployeesByType = filterEmployeesByType;
window.toggleInduction = toggleInduction;
window.copyOralTemplate = copyOralTemplate;
window.copyOrgTemplate = copyOrgTemplate;
window.openNewEmployeeModal = openNewEmployeeModal;
window.createNewEmployee = createNewEmployee;
window.openEditEmployeeModal = openEditEmployeeModal;
window.saveEditedEmployee = saveEditedEmployee;
window.deleteCurrentEmployee = deleteCurrentEmployee;
window.toggleArchiveEmployee = toggleArchiveEmployee;
window.toggleArchiveView = toggleArchiveView;
window.openAnkundigungenModal = openAnkundigungenModal;
window.openBesprechungenModal = openBesprechungenModal;
window.openSoldatenModal = openSoldatenModal;
window.openBeobachtungAktenModal = openBeobachtungAktenModal;
window.closeModal = closeModal;
</script>
</body>
</html>
