<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CACHE-CONTROL META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>ðŸ“‹ HR - Einweisungsmanagement v1.0</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <style>
    :root {
      --primary: #6366f1;
      --primary-dark: #4f46e5;
      --primary-light: #818cf8;
      --secondary: #10b981;
      --secondary-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --info: #3b82f6;
      --info-dark: #2563eb;
      --dark: #0f172a;
      --dark-card: #1e293b;
      --darker: #0a0f1c;
      --light: #f8fafc;
      --gray: #64748b;
      --gray-light: #cbd5e1;
      --border: rgba(255, 255, 255, 0.1);
      --border-light: rgba(255, 255, 255, 0.05);

      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.2);
      --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.5);

      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --radius-xs: 6px;
      --radius-full: 9999px;

      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-fast: all 0.15s ease;
      --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);

      --gradient-primary: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      --gradient-secondary: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
      --gradient-warning: linear-gradient(135deg, var(--warning) 0%, var(--warning-dark) 100%);
      --gradient-danger: linear-gradient(135deg, var(--danger) 0%, var(--danger-dark) 100%);
      --gradient-dark: linear-gradient(135deg, var(--dark) 0%, var(--darker) 100%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--darker);
      color: var(--light);
      min-height: 100vh;
      overflow-x: hidden;
      font-size: 15px;
      line-height: 1.6;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.08) 0%, transparent 30%),
        radial-gradient(circle at 90% 80%, rgba(16, 185, 129, 0.06) 0%, transparent 30%),
        radial-gradient(circle at 50% 50%, rgba(0, 0, 0, 0.2) 0%, transparent 100%);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: var(--radius-full);
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Glass Morphism Effect */
    .glass {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-lg);
    }

    .glass-dark {
      background: rgba(15, 23, 42, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-lg);
    }

    /* App Container */
    .app-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
      min-height: 100vh;
    }

    /* Header */
    .app-header {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 20px 28px;
      margin-bottom: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: var(--shadow-lg);
      position: relative;
      overflow: hidden;
    }

    .app-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-container {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-md);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--gradient-primary);
      border: 2px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
      box-shadow: var(--shadow-md);
    }

    .logo-container i {
      font-size: 24px;
      color: white;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-text h1 {
      font-size: 24px;
      font-weight: 900;
      background: linear-gradient(135deg, #fff 0%, var(--gray-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-icons {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-left: 12px;
    }

    .header-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      color: var(--gray-light);
    }

    .header-icon:hover {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .brand-text .subtitle {
      font-size: 13px;
      color: var(--gray);
      font-weight: 500;
      letter-spacing: 0.5px;
    }

    .header-stats {
      display: flex;
      gap: 16px;
    }

    .stat-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.05);
      min-width: 110px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--gradient-primary);
      opacity: 0;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-md);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 700;
    }

    /* Password Modal */
    .main-password-modal {
      display: flex;
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 28, 0.95);
      backdrop-filter: blur(10px);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .main-password-content {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 40px;
      width: 100%;
      max-width: 440px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-xl);
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .main-password-content::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .main-password-header {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }

    .main-password-title {
      font-size: 22px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .main-password-title i {
      color: var(--primary);
      font-size: 24px;
    }

    .main-password-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .main-password-input {
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 15px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .main-password-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .main-password-error {
      color: var(--danger);
      font-size: 13px;
      display: none;
      margin-top: -8px;
      padding-left: 4px;
    }

    .main-password-error.show {
      display: block;
    }

    /* Settings Password Modal */
    .settings-password-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 28, 0.95);
      backdrop-filter: blur(10px);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }

    .settings-password-modal.active {
      display: flex;
    }

    .settings-password-content {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 40px;
      width: 100%;
      max-width: 440px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-xl);
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .settings-password-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .settings-password-title {
      font-size: 22px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .settings-password-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }

    .settings-password-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }

    .settings-password-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .settings-password-input {
      padding: 16px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 15px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .settings-password-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .settings-password-error {
      color: var(--danger);
      font-size: 13px;
      display: none;
      margin-top: -8px;
      padding-left: 4px;
    }

    .settings-password-error.show {
      display: block;
    }

    /* AnkÃ¼ndigung Banner */
    .ankundigung-banner {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(139, 92, 246, 0.3);
      border-radius: var(--radius-lg);
      padding: 20px 24px;
      z-index: 9998;
      max-width: 700px;
      width: 90%;
      box-shadow: var(--shadow-xl);
      opacity: 0;
      visibility: hidden;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .ankundigung-banner.show {
      opacity: 1;
      visibility: visible;
      transform: translateX(-50%) translateY(0);
    }

    .banner-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .banner-title {
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 18px;
    }

    .banner-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--gray);
      cursor: pointer;
      transition: var(--transition);
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }

    .banner-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }

    .banner-content {
      color: var(--gray-light);
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 12px;
      white-space: pre-line;
    }

    .banner-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: var(--gray);
    }

    .banner-type {
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
      padding: 6px 14px;
      border-radius: var(--radius-full);
      font-weight: 800;
      font-size: 11px;
      letter-spacing: 0.5px;
    }

    /* Sidebar */
    .sidebar {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      height: calc(100vh - 140px);
      position: sticky;
      top: 30px;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-lg);
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-title {
      font-size: 16px;
      font-weight: 800;
      color: var(--gray-light);
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .employee-count {
      background: var(--gradient-primary);
      color: #fff;
      font-size: 13px;
      font-weight: 900;
      padding: 6px 14px;
      border-radius: var(--radius-full);
      box-shadow: var(--shadow-sm);
    }

    .sidebar-filter-buttons {
      display: flex;
      gap: 6px;
      margin-bottom: 20px;
    }

    .sidebar-filter-btn {
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: var(--gray-light);
      font-size: 12px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      text-align: center;
      letter-spacing: 0.3px;
    }

    .sidebar-filter-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .sidebar-filter-btn.active {
      background: var(--gradient-primary);
      color: #fff;
      border-color: transparent;
      box-shadow: var(--shadow-md);
    }

    .sidebar-controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 24px;
    }

    .search-container {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 14px 20px 14px 48px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    .employee-list-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
      min-height: 0;
    }

    .employee-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      padding-right: 8px;
      flex: 1;
      min-height: 0;
    }

    /* Employee Cards */
    .employee-card {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      padding: 20px;
      border: 2px solid rgba(255, 255, 255, 0.08);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 120px;
      justify-content: flex-start;
    }

    .employee-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: var(--gradient-primary);
      opacity: 0;
      transition: var(--transition);
    }

    .employee-card:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateY(-3px);
      box-shadow: var(--shadow-md);
    }

    .employee-card:hover::before {
      opacity: 1;
    }

    .employee-card.active {
      background: rgba(99, 102, 241, 0.1);
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary), var(--shadow-md);
    }

    .employee-card.active::before {
      opacity: 1;
    }

    .employee-card.archived {
      opacity: 0.7;
      border-color: var(--warning);
    }

    .employee-card.archived .employee-name::after {
      content: ' [ARCHIV]';
      color: var(--warning);
      font-size: 11px;
      font-weight: 700;
    }

    .employee-top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 4px;
    }

    .employee-name {
      font-weight: 800;
      font-size: 16px;
      color: #fff;
      line-height: 1.4;
      word-break: break-word;
      flex: 1;
    }

    .employee-dn {
      font-family: 'Inter', monospace;
      font-size: 12px;
      font-weight: 800;
      color: var(--primary-light);
      background: rgba(99, 102, 241, 0.1);
      padding: 4px 10px;
      border-radius: var(--radius-full);
      border: 1px solid rgba(99, 102, 241, 0.2);
      white-space: nowrap;
      flex-shrink: 0;
      margin-left: 12px;
    }

    .employee-meta {
      font-size: 12px;
      color: var(--gray);
      line-height: 1.4;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .employee-meta i {
      font-size: 11px;
      opacity: 0.7;
    }

    .induction-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .induction-badge {
      font-size: 12px;
      padding: 8px 14px;
      border-radius: var(--radius-full);
      font-weight: 800;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      transition: var(--transition);
      border: 2px solid transparent;
      letter-spacing: 0.3px;
      min-width: 120px;
      justify-content: center;
    }

    .induction-badge:hover {
      transform: translateY(-1px);
    }

    .badge-oral.pending {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border-color: rgba(239, 68, 68, 0.3);
    }

    .badge-oral.completed {
      background: rgba(16, 185, 129, 0.2);
      color: #86efac;
      border-color: rgba(16, 185, 129, 0.3);
    }

    .badge-org.pending {
      background: rgba(245, 158, 11, 0.2);
      color: #fcd34d;
      border-color: rgba(245, 158, 11, 0.3);
    }

    .badge-org.completed {
      background: rgba(16, 185, 129, 0.2);
      color: #86efac;
      border-color: rgba(16, 185, 129, 0.3);
    }

    .quick-actions {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: auto;
    }

    .quick-action-btn {
      padding: 14px;
      background: rgba(99, 102, 241, 0.08);
      border: 2px solid rgba(99, 102, 241, 0.15);
      border-radius: var(--radius-md);
      color: var(--primary-light);
      font-size: 13px;
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      letter-spacing: 0.3px;
    }

    .quick-action-btn:hover {
      background: rgba(99, 102, 241, 0.12);
      border-color: var(--primary);
      transform: translateY(-2px);
      color: #fff;
      box-shadow: var(--shadow-md);
    }

    /* Main Content */
    .main-content {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 500px;
      box-shadow: var(--shadow-lg);
    }

    .content-header {
      padding: 24px 28px;
      background: rgba(99, 102, 241, 0.05);
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      display: none;
      justify-content: space-between;
      align-items: flex-start;
      gap: 20px;
      position: relative;
    }

    .content-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .employee-info h2 {
      font-size: 24px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 12px;
    }

    .employee-tags {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .employee-tag {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--gray);
      font-weight: 700;
    }

    .tag-value {
      color: #fff;
      font-weight: 800;
      background: rgba(99, 102, 241, 0.1);
      padding: 6px 12px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(99, 102, 241, 0.2);
      font-size: 12px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      font-size: 13px;
      user-select: none;
      letter-spacing: 0.3px;
    }

    .btn-primary {
      background: var(--gradient-primary);
      color: #fff;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-danger {
      background: var(--gradient-danger);
      color: #fff;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-warning {
      background: var(--gradient-warning);
      color: #fff;
    }

    .btn-warning:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    /* Induction Content */
    .induction-content {
      padding: 28px;
      flex: 1;
      overflow-y: auto;
      display: none;
    }

    .induction-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 32px;
    }

    .induction-card {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 2px solid rgba(255, 255, 255, 0.08);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .induction-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      opacity: 0.5;
    }

    .induction-card.completed {
      border-color: var(--secondary);
      background: rgba(16, 185, 129, 0.05);
    }

    .induction-card.completed::before {
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
    }

    .induction-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
    }

    .induction-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .induction-icon {
      width: 48px;
      height: 48px;
      background: var(--gradient-primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
      box-shadow: var(--shadow-md);
    }

    .induction-card.completed .induction-icon {
      background: var(--gradient-secondary);
    }

    .induction-status {
      font-size: 12px;
      font-weight: 900;
      padding: 8px 16px;
      border-radius: var(--radius-full);
      background: rgba(255, 255, 255, 0.08);
      color: var(--gray);
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .induction-card.completed .induction-status {
      background: rgba(16, 185, 129, 0.15);
      color: var(--secondary);
    }

    /* Forms */
    .oral-form-grid,
    .org-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 8px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-weight: 800;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .form-select {
      color: #fff;
      background-color: rgba(255, 255, 255, 0.05);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 48px;
    }

    .form-select option {
      background: var(--dark-card);
      color: #fff;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Inter', sans-serif;
      line-height: 1.6;
    }

    .time-container {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 12px;
      align-items: center;
    }

    .time-separator {
      color: var(--gray);
      font-weight: 700;
      text-align: center;
      font-size: 14px;
      padding: 0 8px;
    }

    input[type="time"] {
      font-size: 14px;
      padding: 10px 12px;
    }

    /* Toggle Switch */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 32px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.1);
      transition: var(--transition);
      border-radius: var(--radius-full);
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 24px;
      width: 24px;
      left: 4px;
      bottom: 4px;
      background-color: #fff;
      transition: var(--transition);
      border-radius: 50%;
      box-shadow: var(--shadow-sm);
    }

    input:checked + .toggle-slider {
      background-color: var(--secondary);
    }

    input:checked + .toggle-slider::before {
      transform: translateX(28px);
    }

    /* Templates Section */
    .templates-section {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 2px solid rgba(255, 255, 255, 0.08);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .template-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .template-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .template-card {
      background: rgba(0, 0, 0, 0.2);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 2px solid rgba(255, 255, 255, 0.08);
      transition: var(--transition);
    }

    .template-card:hover {
      border-color: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .template-card.completed {
      border-color: var(--secondary);
    }

    .template-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 16px;
    }

    .template-card-title {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .template-badge {
      font-size: 11px;
      font-weight: 900;
      padding: 6px 14px;
      border-radius: var(--radius-full);
      background: rgba(99, 102, 241, 0.1);
      color: var(--primary-light);
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .template-content {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: rgba(0, 0, 0, 0.3);
      padding: 20px;
      border-radius: var(--radius-md);
      border-left: 4px solid var(--primary);
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 13px;
      line-height: 1.6;
      color: var(--gray-light);
      max-height: 240px;
      overflow-y: auto;
    }

    .template-card.completed .template-content {
      border-left-color: var(--secondary);
    }

    /* Floating Buttons */
    .floating-buttons-container {
      position: fixed;
      bottom: 30px;
      right: 30px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      z-index: 9997;
    }

    .floating-button {
      width: 64px;
      height: 64px;
      border: none;
      border-radius: var(--radius-lg);
      color: #fff;
      font-size: 24px;
      cursor: pointer;
      box-shadow: var(--shadow-xl);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .floating-button::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.1), transparent);
      opacity: 0;
      transition: var(--transition);
    }

    .floating-button:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
    }

    .floating-button:hover::before {
      opacity: 1;
    }

    .floating-button.soldaten {
      background: var(--gradient-warning);
    }

    .floating-button.settings {
      background: var(--gradient-primary);
    }

    .floating-button.akten {
      background: var(--gradient-info);
    }

    /* Modals */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 28, 0.95);
      backdrop-filter: blur(10px);
      z-index: 9998;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 32px;
      width: 100%;
      max-width: 600px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-xl);
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .modal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      gap: 16px;
    }

    .modal-title {
      font-size: 20px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .modal-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }

    .modal-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }

    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 60px 40px;
      color: var(--gray);
      width: 100%;
    }

    .empty-icon {
      font-size: 48px;
      margin-bottom: 20px;
      opacity: 0.2;
    }

    .empty-title {
      font-size: 18px;
      font-weight: 900;
      margin-bottom: 12px;
      color: var(--gray-light);
    }

    .empty-description {
      font-size: 14px;
      color: var(--gray);
      max-width: 300px;
      margin: 0 auto 20px;
      line-height: 1.6;
    }

    /* Loading */
    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      width: 100%;
    }

    .loading-spinner {
      width: 48px;
      height: 48px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 16px 24px;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-xl);
      display: flex;
      align-items: center;
      gap: 12px;
      z-index: 9999;
      transform: translateX(100px);
      opacity: 0;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.4s ease;
      min-width: 300px;
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .notification.show {
      transform: translateX(0);
      opacity: 1;
    }

    .notification-icon {
      font-size: 20px;
    }

    .notification-message {
      font-weight: 800;
      font-size: 14px;
      flex: 1;
    }

    /* Settings, AnkÃ¼ndigungen, Besprechungen Modals */
    .settings-modal,
    .soldaten-modal,
    .beobachtung-akten-modal,
    .besprechungen-modal,
    .ankundigungen-modal,
    .edit-item-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(10, 15, 28, 0.95);
      backdrop-filter: blur(10px);
      z-index: 9998;
      align-items: center;
      justify-content: center;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }

    .settings-modal.active,
    .soldaten-modal.active,
    .beobachtung-akten-modal.active,
    .besprechungen-modal.active,
    .ankundigungen-modal.active,
    .edit-item-modal.active {
      display: flex;
    }

    .settings-content,
    .soldaten-content,
    .beobachtung-akten-content,
    .besprechungen-content,
    .ankundigungen-content,
    .edit-item-content {
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
      backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 32px;
      width: 100%;
      max-width: 1200px;
      max-height: 90vh;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-xl);
      animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* AnkÃ¼ndigungen/Besprechungen Modal Styles */
    .ankundigungen-header,
    .besprechungen-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      gap: 16px;
    }

    .ankundigungen-title,
    .besprechungen-title {
      font-size: 20px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .ankundigungen-close,
    .besprechungen-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }

    .ankundigungen-close:hover,
    .besprechungen-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }

    .ankundigungen-body,
    .besprechungen-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .ankundigungen-search-container,
    .besprechungen-search-container {
      position: relative;
      margin-bottom: 20px;
    }

    .ankundigungen-search-icon,
    .besprechungen-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    .ankundigungen-search-input,
    .besprechungen-search-input {
      width: 100%;
      padding: 14px 20px 14px 48px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .ankundigungen-search-input:focus,
    .besprechungen-search-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .ankundigungen-list-container,
    .besprechungen-list-container {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
    }

    .ankundigungen-list,
    .besprechungen-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .ankundigungen-item,
    .besprechungen-item {
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 2px solid rgba(255, 255, 255, 0.08);
      transition: var(--transition);
    }

    .ankundigungen-item:hover,
    .besprechungen-item:hover {
      border-color: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .ankundigungen-item-header,
    .besprechungen-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
      gap: 16px;
    }

    .ankundigungen-item-title,
    .besprechungen-item-title {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .ankundigungen-item-type,
    .besprechungen-item-type {
      font-size: 11px;
      font-weight: 900;
      padding: 6px 14px;
      border-radius: var(--radius-full);
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .ankundigungen-item-date,
    .besprechungen-item-date {
      font-size: 12px;
      color: var(--gray);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ankundigungen-item-content,
    .besprechungen-item-content {
      font-size: 14px;
      line-height: 1.6;
      color: var(--gray-light);
      white-space: pre-line;
    }

    /* Settings Modal Styles */
    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 28px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      gap: 16px;
    }

    .settings-title {
      font-size: 20px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .settings-close {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
    }

    .settings-close:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
      transform: rotate(90deg);
    }

    .settings-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .settings-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .settings-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.3px;
    }

    .settings-tab:hover {
      color: var(--primary-light);
    }

    .settings-tab.active {
      color: var(--primary);
    }

    .settings-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 3px 3px 0 0;
    }

    .settings-section {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .section-title-settings {
      font-size: 16px;
      font-weight: 900;
      color: #fff;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .unit-list,
    .rank-list {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 16px;
    }

    .unit-item,
    .rank-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: var(--radius-md);
      margin-bottom: 8px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .unit-name,
    .rank-name {
      flex: 1;
      font-weight: 800;
      color: var(--gray-light);
      min-width: 150px;
    }

    .discord-id {
      padding: 8px 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 12px;
      width: 200px;
    }

    .add-btn {
      padding: 12px 20px;
      background: var(--gradient-primary);
      border: none;
      border-radius: var(--radius-md);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
    }

    .add-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .settings-input {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
    }

    .settings-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.15);
    }

    .settings-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    /* Tabs */
    .settings-tabs,
    .soldaten-tabs,
    .beobachtung-tabs,
    .ankundigungen-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
    }

    .settings-tab,
    .soldaten-tab,
    .beobachtung-tab,
    .ankundigungen-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 10px;
      letter-spacing: 0.3px;
    }

    .settings-tab:hover,
    .soldaten-tab:hover,
    .beobachtung-tab:hover,
    .ankundigungen-tab:hover {
      color: var(--primary-light);
    }

    .settings-tab.active,
    .soldaten-tab.active,
    .beobachtung-tab.active,
    .ankundigungen-tab.active {
      color: var(--primary);
    }

    .settings-tab.active::after,
    .soldaten-tab.active::after,
    .beobachtung-tab.active::after,
    .ankundigungen-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--gradient-primary);
      border-radius: 3px 3px 0 0;
    }

    /* Context Menu */
    #contextMenu {
      position: fixed;
      z-index: 10000;
      animation: slideUp 0.2s ease;
    }

    /* Shake Animation */
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
      20%, 40%, 60%, 80% { transform: translateX(5px); }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
      .app-container {
        grid-template-columns: 1fr;
        padding: 20px;
        gap: 20px;
      }
      
      .sidebar {
        position: static;
        max-height: 600px;
        height: auto;
      }
      
      .induction-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app-container {
        padding: 16px;
      }
      
      .app-header {
        padding: 20px 24px;
      }
      
      .header-content {
        flex-direction: column;
        gap: 20px;
        align-items: stretch;
      }
      
      .header-stats {
        justify-content: center;
      }
      
      .brand {
        gap: 16px;
      }
      
      .brand-text h1 {
        font-size: 22px;
      }
      
      .content-header {
        flex-direction: column;
        align-items: stretch;
        padding: 24px;
        gap: 20px;
      }
      
      .employee-tags {
        flex-direction: column;
        gap: 12px;
      }
      
      .induction-content {
        padding: 24px;
      }
      
      .oral-form-grid,
      .org-form-grid {
        grid-template-columns: 1fr;
      }
      
      .floating-buttons-container {
        bottom: 20px;
        right: 20px;
      }
      
      .floating-button {
        width: 56px;
        height: 56px;
        font-size: 20px;
      }
      
      .unit-item,
      .rank-item {
        flex-direction: column;
        align-items: stretch;
      }
      
      .unit-name,
      .rank-name {
        min-width: auto;
      }
      
      .discord-id {
        width: 100%;
      }
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 12px;
      }
      
      .app-header {
        padding: 16px 20px;
      }
      
      .stat-card {
        padding: 12px 16px;
        min-width: 90px;
      }
      
      .stat-value {
        font-size: 24px;
      }
      
      .sidebar {
        padding: 20px;
      }
      
      .notification {
        left: 16px;
        right: 16px;
        bottom: 16px;
        min-width: auto;
      }
      
      .modal {
        padding: 24px;
        margin: 16px;
      }
      
      .settings-content,
      .soldaten-content,
      .beobachtung-akten-content,
      .besprechungen-content,
      .ankundigungen-content {
        padding: 24px;
      }
      
      .settings-tabs,
      .soldaten-tabs,
      .beobachtung-tabs,
      .ankundigungen-tabs {
        flex-direction: column;
      }
      
      .settings-tab,
      .soldaten-tab,
      .beobachtung-tab,
      .ankundigungen-tab {
        text-align: left;
        padding: 10px 16px;
      }
      
      .induction-badge {
        min-width: 100px;
        padding: 6px 12px;
        font-size: 11px;
      }
    }
  </style>
</head>

<body>
  <!-- Main Password Modal -->
  <div class="main-password-modal" id="mainPasswordModal">
    <div class="main-password-content">
      <div class="main-password-header">
        <div class="main-password-title">
          <i class="fas fa-lock"></i> Passwort fÃ¼r HR App
        </div>
      </div>
      <div class="main-password-form">
        <input type="password" class="main-password-input" id="mainPasswordInput" 
               placeholder="Passwort eingeben" autofocus
               onkeypress="if(event.key === 'Enter') checkMainPassword()">
        <div class="main-password-error" id="mainPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkMainPassword()">
          <i class="fas fa-unlock"></i> App Ã¶ffnen
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Password Modal -->
  <div class="settings-password-modal" id="settingsPasswordModal">
    <div class="settings-password-content">
      <div class="settings-password-header">
        <div class="settings-password-title">
          <i class="fas fa-lock"></i> Passwort fÃ¼r Einstellungen
        </div>
        <button class="settings-password-close" onclick="closeSettingsPasswordModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="settings-password-form">
        <input type="password" class="settings-password-input" id="settingsPasswordInput" 
               placeholder="Passwort eingeben" autofocus
               onkeypress="if(event.key === 'Enter') checkSettingsPassword()">
        <div class="settings-password-error" id="settingsPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkSettingsPassword()">
          <i class="fas fa-unlock"></i> Einstellungen Ã¶ffnen
        </button>
      </div>
    </div>
  </div>

  <!-- Edit AnkÃ¼ndigung/Besprechung Modal -->
  <div class="edit-item-modal" id="editItemModal">
    <div class="edit-item-content">
      <div class="modal-header">
        <div class="modal-title" id="editItemTitle">
          <i class="fas fa-edit"></i> Bearbeiten
        </div>
        <button class="modal-close" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="edit-item-body" id="editItemBody">
        <!-- Form wird dynamisch eingefÃ¼gt -->
      </div>
      
      <div class="settings-actions">
        <button class="btn btn-secondary" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i> Abbrechen
        </button>
        <button class="btn btn-primary" onclick="saveEditedItem()">
          <i class="fas fa-save"></i> Ã„nderungen speichern
        </button>
      </div>
    </div>
  </div>

  <!-- AnkÃ¼ndigung Banner -->
  <div class="ankundigung-banner" id="ankundigungBanner">
    <div class="banner-header">
      <div class="banner-title" id="bannerTitle">
        <span>ðŸª§</span> AnkÃ¼ndigung
      </div>
      <button class="banner-close" onclick="closeBanner()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="banner-content" id="bannerContent">
      Lade AnkÃ¼ndigung...
    </div>
    <div class="banner-meta">
      <div class="banner-type" id="bannerType">AnkÃ¼ndigung</div>
      <div id="bannerDate">Heute</div>
    </div>
  </div>

  <!-- Floating Buttons -->
  <div class="floating-buttons-container">
    <button class="floating-button soldaten" onclick="openSoldatenModal()" title="SoldatengesprÃ¤che">
      <i class="fas fa-comments"></i>
    </button>
    <button class="floating-button akten" onclick="openBeobachtungAktenModal()" title="Beobachtungs-Akten">
      <i class="fas fa-folder-open"></i>
    </button>
    <button class="floating-button settings" onclick="openSettingsWithPassword()" title="Einstellungen">
      <i class="fas fa-cog"></i>
    </button>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <i class="fas fa-check notification-icon"></i>
    <span class="notification-message" id="notificationMessage"></span>
  </div>

  <!-- App Container -->
  <div class="app-container" id="appContainer" style="display:none;">
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <div class="logo-container">
            <i class="fas fa-users"></i>
          </div>
          <div class="brand-text">
            <h1>Human Resources <span class="header-icons">
              <span class="header-icon" onclick="openAnkundigungenModal()" title="AnkÃ¼ndigungen">
                <i class="fas fa-bullhorn"></i>
              </span>
              <span class="header-icon" onclick="openBesprechungenModal()" title="Besprechungen">
                <i class="fas fa-calendar-alt"></i>
              </span>
            </span></h1>
            <div class="subtitle">Einweisungsmanagement System v1.0</div>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat-card">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Mitarbeiter</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalAkten">0</div>
            <div class="stat-label">Beobachtungen</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalArchived">0</div>
            <div class="stat-label">Archiviert</div>
          </div>
        </div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title"><i class="fas fa-users"></i> Mitarbeiter</h3>
        <div class="employee-count" id="employeeCount">0</div>
      </div>

      <div class="sidebar-controls">
        <div class="sidebar-filter-buttons">
          <button class="sidebar-filter-btn active" onclick="filterEmployeesByType('all')">Alle</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('oral')">MÃ¼ndlich</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('org')">Organisatorisch</button>
        </div>

        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchEmployees" 
                 placeholder="Nach Namen oder DN suchen..." autocomplete="off">
        </div>
      </div>

      <div class="employee-list-container">
        <div class="employee-list" id="employeeList">
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">Keine Mitarbeiter</div>
            <div class="empty-description">FÃ¼gen Sie Ihren ersten Mitarbeiter hinzu</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="openNewEmployeeModal()">
          <i class="fas fa-user-plus"></i> Neuer Mitarbeiter
        </button>
        <button class="quick-action-btn" onclick="toggleArchiveView()">
          <i class="fas fa-archive"></i> <span id="archiveToggleText">Archiv anzeigen</span>
        </button>
      </div>
    </aside>

    <main class="main-content">
      <div class="content-header" id="employeeHeader">
        <div class="employee-info">
          <h2 id="currentEmployeeName">WÃ¤hlen Sie einen Mitarbeiter</h2>
          <div class="employee-tags">
            <div class="employee-tag"><i class="fas fa-hashtag"></i> <span class="tag-value" id="currentEmployeeDN">DN-</span></div>
            <div class="employee-tag"><i class="fas fa-building"></i> <span class="tag-value" id="currentEmployeeUnit">Unit</span></div>
            <div class="employee-tag"><i class="fas fa-user-tie"></i> <span class="tag-value" id="currentEmployeeRank">Rang</span></div>
            <div class="employee-tag" id="archiveStatusTag" style="display:none;">
              <i class="fas fa-archive"></i> <span class="tag-value" style="background:var(--warning);">Archiviert</span>
            </div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="openEditEmployeeModal()">
            <i class="fas fa-edit"></i> Bearbeiten
          </button>
          <button class="btn btn-warning" id="archiveButton" onclick="toggleArchiveEmployee()" style="display:none;">
            <i class="fas fa-archive"></i> <span id="archiveButtonText">Archivieren</span>
          </button>
        </div>
      </div>

      <div class="induction-content" id="inductionContent">
        <div class="induction-grid">
          <div class="induction-card" id="oralInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-comments"></i></div>
                MÃ¼ndliche Einweisung
              </div>
              <div class="induction-status" id="oralInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
              <label style="font-weight:800;color:var(--gray);font-size:13px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="oralInductionToggle" onchange="toggleInduction('oral', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="oral-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="oralDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="oralTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="oralTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="oralPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect">
                  <option value="">Unit auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect">
                  <option value="">Rang auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="oralNotes" placeholder="Weitere Informationen..." rows="3"></textarea>
              </div>
            </div>
          </div>

          <div class="induction-card" id="orgInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-clipboard-list"></i></div>
                Organisatorische Einweisung
              </div>
              <div class="induction-status" id="orgInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:16px;margin-bottom:24px;">
              <label style="font-weight:800;color:var(--gray);font-size:13px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="orgInductionToggle" onchange="toggleInduction('org', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="org-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="orgDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="orgTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="orgTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="orgPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect2">
                  <option value="">Unit auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect2">
                  <option value="">Rang auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="orgNotes" placeholder="Weitere Informationen..." rows="3"></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <div class="section-header">
            <div class="section-title"><i class="fas fa-file-code"></i> Discord Vorlagen</div>
            <div class="template-actions">
              <button class="btn btn-secondary" onclick="copyOralTemplate()">
                <i class="fas fa-comments"></i> MÃ¼ndlich kopieren
              </button>
              <button class="btn btn-secondary" onclick="copyOrgTemplate()">
                <i class="fas fa-clipboard-list"></i> Organisatorisch kopieren
              </button>
            </div>
          </div>

          <div class="template-cards">
            <div class="template-card" id="oralTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-comments"></i> MÃ¼ndliche Einweisung</div>
                <div class="template-badge" id="oralTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="oralTemplateContent"></div>
            </div>

            <div class="template-card" id="orgTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-clipboard-list"></i> Organisatorische Einweisung</div>
                <div class="template-badge" id="orgTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="orgTemplateContent"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-user-plus"></i> Neuen Mitarbeiter hinzufÃ¼gen</div>
        <button class="modal-close" onclick="closeModal('newEmployeeModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
        <div class="form-group">
          <label class="form-label">VollstÃ¤ndiger Name *</label>
          <input type="text" class="form-input" id="newEmployeeName" placeholder="z.B. Max Fiart" autofocus>
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="newEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="newEmployeeUnit">
            <option value="">Unit auswÃ¤hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="newEmployeeRank">
            <option value="">Rang auswÃ¤hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:24px;">
        <button class="btn btn-secondary" onclick="closeModal('newEmployeeModal')">
          <i class="fas fa-times"></i> Abbrechen
        </button>
        <button class="btn btn-primary" onclick="createNewEmployee()">
          <i class="fas fa-plus"></i> Mitarbeiter erstellen
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-edit"></i> Mitarbeiter bearbeiten</div>
        <button class="modal-close" onclick="closeModal('editEmployeeModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
        <div class="form-group">
          <label class="form-label">VollstÃ¤ndiger Name *</label>
          <input type="text" class="form-input" id="editEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="editEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="editEmployeeUnit">
            <option value="">Unit auswÃ¤hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="editEmployeeRank">
            <option value="">Rang auswÃ¤hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:24px;">
        <button class="btn btn-danger" onclick="deleteCurrentEmployee()" style="margin-right:auto;">
          <i class="fas fa-trash"></i> LÃ¶schen
        </button>
        <div style="display:flex;gap:12px;">
          <button class="btn btn-secondary" onclick="closeModal('editEmployeeModal')">
            <i class="fas fa-times"></i> Abbrechen
          </button>
          <button class="btn btn-primary" onclick="saveEditedEmployee()">
            <i class="fas fa-save"></i> Ã„nderungen speichern
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== KONFIGURATION ====================
    const APP_VERSION = '1.0.20240128';
    const DEFAULT_PASSWORD = 'hr';
    const SETTINGS_PASSWORD = 'soc1';
    const PASSWORD_EXPIRE_MINUTES = 120;
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBTnsLNw68UuOd5Xa2ymMffWk4SYGDQjso",
      authDomain: "cc-shop-finanzsystem.firebaseapp.com",
      projectId: "cc-shop-finanzsystem",
      storageBucket: "cc-shop-finanzsystem.firebasestorage.app",
      messagingSenderId: "575918945925",
      appId: "1:575918945925:web:bf9d973d5cd9fc547e5bec",
      measurementId: "G-9SZREFTJS6"
    };

    // App State
    let currentEmployee = null;
    let employees = [];
    let settings = {
      units: [],
      ranks: []
    };
    let showArchived = false;
    let currentFilter = 'all';
    let isAuthenticated = false;
    let settingsAuthenticated = false;
    
    // Unsubscribe-Funktionen fÃ¼r Listener
    let unsubscribeFunctions = [];
    
    // Edit Item State
    let currentEditItemId = null;
    let currentEditItemType = null;

    // ==================== INITIALISIERUNG ====================
    document.addEventListener('DOMContentLoaded', async function () {
      console.log(`HR App Version ${APP_VERSION} geladen`);
      
      try {
        // Firebase initialisieren
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        window.db = firebase.firestore();
        window.storage = firebase.storage();
        
        console.log('Firebase initialisiert');
      } catch (error) {
        console.error('Fehler bei Firebase-Initialisierung:', error);
        showNotification('Datenbank-Verbindungsfehler', 'error');
      }
      
      checkAuthentication();
      setupEventListeners();
    });

    // ==================== AUTHENTIFIZIERUNG ====================
    function checkAuthentication() {
      const savedPassword = localStorage.getItem('hr_app_password');
      const savedTimestamp = localStorage.getItem('hr_app_password_timestamp');
      const currentTime = Date.now();
      const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
      
      if (savedPassword === DEFAULT_PASSWORD && savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
        isAuthenticated = true;
        settingsAuthenticated = true;
        initializeApp();
      } else {
        setTimeout(() => {
          document.getElementById('mainPasswordInput').focus();
        }, 100);
      }
    }

    function checkMainPassword() {
      const password = document.getElementById('mainPasswordInput').value.trim();
      const errorElement = document.getElementById('mainPasswordError');
      
      if (password === DEFAULT_PASSWORD) {
        localStorage.setItem('hr_app_password', password);
        localStorage.setItem('hr_app_password_timestamp', Date.now());
        isAuthenticated = true;
        settingsAuthenticated = true;
        
        document.getElementById('mainPasswordModal').style.display = 'none';
        document.getElementById('appContainer').style.display = 'grid';
        
        showNotification('Erfolgreich angemeldet', 'success');
        initializeApp();
      } else {
        errorElement.style.display = 'block';
        document.getElementById('mainPasswordInput').value = '';
        document.getElementById('mainPasswordInput').focus();
        shakeElement(document.getElementById('mainPasswordInput'));
      }
    }

    function checkSettingsAuth() {
      if (settingsAuthenticated) {
        const savedTimestamp = localStorage.getItem('hr_settings_auth_timestamp');
        const currentTime = Date.now();
        const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
        
        if (savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
          return true;
        }
      }
      return false;
    }

    function openSettingsPasswordModal() {
      const modal = document.getElementById('settingsPasswordModal');
      modal.classList.add('active');
      setTimeout(() => {
        document.getElementById('settingsPasswordInput').focus();
      }, 100);
    }

    function closeSettingsPasswordModal() {
      const modal = document.getElementById('settingsPasswordModal');
      modal.classList.remove('active');
      document.getElementById('settingsPasswordInput').value = '';
      document.getElementById('settingsPasswordError').style.display = 'none';
    }

    function checkSettingsPassword() {
      const password = document.getElementById('settingsPasswordInput').value.trim();
      const errorElement = document.getElementById('settingsPasswordError');
      
      if (password === SETTINGS_PASSWORD) {
        settingsAuthenticated = true;
        localStorage.setItem('hr_settings_auth_timestamp', Date.now());
        closeSettingsPasswordModal();
        openSettingsModal();
      } else {
        errorElement.style.display = 'block';
        document.getElementById('settingsPasswordInput').value = '';
        document.getElementById('settingsPasswordInput').focus();
        shakeElement(document.getElementById('settingsPasswordInput'));
      }
    }

    function openSettingsWithPassword() {
      if (checkSettingsAuth()) {
        openSettingsModal();
      } else {
        openSettingsPasswordModal();
      }
    }

    // ==================== ANKÃœNDIGUNGEN & BESPRECHUNGEN ====================
    function openAnkundigungenModal() {
      createAndShowModal('ankundigungen', 'AnkÃ¼ndigungen', 'fas fa-bullhorn', 'ankundigung');
    }

    function openBesprechungenModal() {
      createAndShowModal('besprechungen', 'Besprechungen', 'fas fa-calendar-alt', 'besprechung');
    }

    async function createAndShowModal(type, title, icon, contentType) {
      const modalId = `${type}Modal`;
      let modal = document.getElementById(modalId);
      
      if (modal) {
        modal.classList.add('active');
        await loadModalContent(type, contentType);
        return;
      }

      // Modal erstellen
      const modalHTML = `
        <div class="${type}-modal" id="${modalId}">
          <div class="${type}-content">
            <div class="${type}-header">
              <div class="${type}-title">
                <i class="${icon}"></i> ${title}
              </div>
              <button class="${type}-close" onclick="closeModal('${modalId}')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            
            <div class="${type}-body">
              <div class="${type}-search-container">
                <i class="fas fa-search ${type}-search-icon"></i>
                <input type="text" class="${type}-search-input" id="${type}Search" 
                       placeholder="${contentType === 'ankundigung' ? 'Nach AnkÃ¼ndigungen suchen...' : 'Nach Besprechungen suchen...'}"
                       oninput="search${type.charAt(0).toUpperCase() + type.slice(1)}(this.value)">
              </div>
              
              <div class="${type}-list-container">
                <div class="${type}-list" id="${type}List">
                  <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>Lade ${title.toLowerCase()}...</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', modalHTML);
      
      setTimeout(async () => {
        modal = document.getElementById(modalId);
        modal.classList.add('active');
        await loadModalContent(type, contentType);
      }, 10);
    }

    async function loadModalContent(type, contentType) {
      const container = document.getElementById(`${type}List`);
      
      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', contentType)
          .orderBy('created', 'desc')
          .get();
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="empty-state">
              <div class="empty-icon"><i class="${contentType === 'ankundigung' ? 'fas fa-bullhorn' : 'fas fa-calendar-alt'}"></i></div>
              <div class="empty-title">Keine ${contentType === 'ankundigung' ? 'AnkÃ¼ndigungen' : 'Besprechungen'} gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste ${contentType === 'ankundigung' ? 'AnkÃ¼ndigung' : 'Besprechung'} in den Einstellungen</div>
            </div>
          `;
          return;
        }

        let html = '';
        querySnapshot.forEach(doc => {
          const item = doc.data();
          const isBesprechung = contentType === 'besprechung';
          
          html += `
            <div class="${type}-item">
              <div class="${type}-item-header">
                <div class="${type}-item-title">
                  <span>${item.icon || (isBesprechung ? 'ðŸ—ƒï¸' : 'ðŸª§')}</span> 
                  ${escapeHtml(isBesprechung ? item.thema || 'Ohne Thema' : item.title || 'Ohne Titel')}
                </div>
                <div class="${type}-item-type">
                  ${isBesprechung ? 'Besprechung' : 'AnkÃ¼ndigung'}
                </div>
              </div>
              <div class="${type}-item-date">
                <i class="fas fa-calendar"></i> 
                ${isBesprechung && item.date ? new Date(item.date).toLocaleDateString('de-DE') : 
                  item.createdFormatted || new Date(item.created || Date.now()).toLocaleDateString('de-DE')}
                ${isBesprechung && item.time ? ` â€¢ ${item.time}` : ''}
                ${isBesprechung && item.ort ? ` â€¢ ${item.ort}` : ''}
              </div>
              <div class="${type}-item-content">
                ${escapeHtml(item.content || '')}
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
      } catch (error) {
        console.error(`Fehler beim Laden der ${type}:`, error);
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="empty-title">Fehler beim Laden</div>
            <div class="empty-description">${error.message}</div>
          </div>
        `;
      }
    }

    function searchAnkundigungen(searchTerm) {
      searchInModal('ankundigungen', searchTerm);
    }

    function searchBesprechungen(searchTerm) {
      searchInModal('besprechungen', searchTerm);
    }

    function searchInModal(type, searchTerm) {
      const items = document.querySelectorAll(`.${type}-item`);
      const term = searchTerm.toLowerCase().trim();
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = !term || text.includes(term) ? 'block' : 'none';
      });
    }

    // ==================== APP INITIALISIERUNG ====================
    async function initializeApp() {
      if (!isAuthenticated) return;
      
      console.log('App wird initialisiert');
      
      await loadSettings();
      setupRealtimeListeners();
      updateUnitAndRankSelects();
      
      // Setze heutiges Datum
      const today = new Date().toISOString().split('T')[0];
      ['oralDate', 'orgDate'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = today;
      });
      
      // Setze aktuelle Uhrzeit
      const now = new Date();
      const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
      
      setupFormChangeListeners();
      seedTemplateBoxes();
      adjustSidebarHeight();
      
      setTimeout(showLatestAnkundigung, 1500);
    }

    // ==================== ANKÃœNDIGUNGEN FUNKTIONEN ====================
    async function showLatestAnkundigung() {
      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'ankundigung')
          .orderBy('created', 'desc')
          .limit(1)
          .get();
        
        if (querySnapshot.empty) return;
        
        const doc = querySnapshot.docs[0];
        const ankundigung = doc.data();
        
        const banner = document.getElementById('ankundigungBanner');
        const title = document.getElementById('bannerTitle');
        const content = document.getElementById('bannerContent');
        const type = document.getElementById('bannerType');
        const date = document.getElementById('bannerDate');
        
        title.innerHTML = `<span>${ankundigung.icon || 'ðŸª§'}</span> ${escapeHtml(ankundigung.title || 'AnkÃ¼ndigung')}`;
        content.textContent = ankundigung.content || '';
        type.textContent = 'AnkÃ¼ndigung';
        date.textContent = ankundigung.createdFormatted || new Date(ankundigung.created).toLocaleDateString('de-DE');
        
        banner.classList.add('show');
        
        setTimeout(() => {
          banner.classList.remove('show');
        }, 15000);
      } catch (error) {
        console.error('Fehler beim Laden der AnkÃ¼ndigung:', error);
      }
    }

    function closeBanner() {
      document.getElementById('ankundigungBanner').classList.remove('show');
    }

    // ==================== SETTINGS FUNKTIONEN ====================
    async function loadSettings() {
      try {
        const doc = await db.collection('hrSettings').doc('settings').get();
        if (doc.exists) {
          const loadedSettings = doc.data();
          settings = { ...settings, ...loadedSettings };
        }
        
        // Default Units
        if (!settings.units || settings.units.length === 0) {
          settings.units = [
            { name: "Air Force", discordId: "1269229762400878675" },
            { name: "S.O.C", discordId: "1339523576159666218" },
            { name: "Infantry", discordId: "1187756956425920645" },
            { name: "Military Police", discordId: "1289716541658497055" },
            { name: "Navy Marine", discordId: "1097653037968920776" },
            { name: "Navy SEALs", discordId: "1125174901989445693" }
          ];
        }

        // Default Ranks
        if (!settings.ranks || settings.ranks.length === 0) {
          settings.ranks = [
            { name: "Private", discordId: "1097625924104626198" },
            { name: "Private First Class", discordId: "1098190829295771739" },
            { name: "Specialist", discordId: "1097625921516748830" },
            { name: "Corporal", discordId: "1097625914763919532" },
            { name: "Sergeant", discordId: "1097625913274933298" },
            { name: "Staff Sergeant", discordId: "1097625912163451112" },
            { name: "Sergeant First Class", discordId: "1348414845862674524" },
            { name: "Master Sergeant", discordId: "1348414845862674524" },
            { name: "Lieutenant", discordId: "1097625900125782278" },
            { name: "Captain", discordId: "1097625898880077955" },
            { name: "Major", discordId: "1097625896560640024" },
            { name: "Colonel", discordId: "1097625895541428275" },
            { name: "Major General", discordId: "1097625893880479777" },
            { name: "General of Army", discordId: "1097625891632316436" }
          ];
        }

        updateUnitAndRankSelects();
      } catch (error) {
        console.error('Fehler beim Laden der Einstellungen:', error);
      }
    }

    function updateUnitAndRankSelects() {
      // Alle Unit-Selects
      const unitSelects = [
        document.getElementById('unitSelect'),
        document.getElementById('unitSelect2'),
        document.getElementById('newEmployeeUnit'),
        document.getElementById('editEmployeeUnit')
      ];
      
      // Alle Rank-Selects
      const rankSelects = [
        document.getElementById('rankSelect'),
        document.getElementById('rankSelect2'),
        document.getElementById('newEmployeeRank'),
        document.getElementById('editEmployeeRank')
      ];
      
      // Units befÃ¼llen
      unitSelects.forEach(select => {
        if (select) {
          const currentValue = select.value;
          select.innerHTML = '<option value="">Unit auswÃ¤hlen</option>';
          
          settings.units.forEach(unit => {
            const option = document.createElement('option');
            option.value = unit.name;
            option.textContent = unit.name;
            select.appendChild(option);
          });
          
          if (currentValue) {
            select.value = currentValue;
          }
        }
      });
      
      // RÃ¤nge befÃ¼llen
      rankSelects.forEach(select => {
        if (select) {
          const currentValue = select.value;
          select.innerHTML = '<option value="">Rang auswÃ¤hlen</option>';
          
          settings.ranks.forEach(rank => {
            const option = document.createElement('option');
            option.value = rank.name;
            option.textContent = rank.name;
            select.appendChild(option);
          });
          
          if (currentValue) {
            select.value = currentValue;
          }
        }
      });
    }

    // ==================== REALTIME LISTENER ====================
    function setupRealtimeListeners() {
      // Mitarbeiter Listener
      const unsubscribeEmployees = db.collection('hrEmployees')
        .orderBy('lastUpdated', 'desc')
        .onSnapshot((snapshot) => {
          employees = [];
          let archivedCount = 0;
          
          snapshot.forEach(doc => {
            const employee = { id: doc.id, ...doc.data() };
            employees.push(employee);
            
            if (employee.status === 'archived') {
              archivedCount++;
            }
          });

          renderEmployeeList();
          updateStats();
          document.getElementById('totalArchived').textContent = archivedCount;
          
          if (currentEmployee) {
            const updatedEmployee = employees.find(emp => emp.id === currentEmployee.id);
            if (updatedEmployee) {
              selectEmployee(updatedEmployee);
            }
          }
          
          setTimeout(updateInductionDisplay, 100);
        }, (error) => {
          console.error('Fehler bei Mitarbeiter-Updates:', error);
          showNotification('Fehler bei Live-Updates', 'error');
        });

      // Settings Listener
      const unsubscribeSettings = db.collection('hrSettings')
        .doc('settings')
        .onSnapshot((doc) => {
          if (doc.exists) {
            const newSettings = doc.data();
            settings = { ...settings, ...newSettings };
            updateUnitAndRankSelects();
          }
        }, (error) => {
          console.error('Fehler bei Settings-Updates:', error);
        });

      // Beobachtungen Listener (fÃ¼r Statistik)
      const unsubscribeBeobachtungen = db.collection('hrBeobachtungen')
        .onSnapshot((snapshot) => {
          document.getElementById('totalAkten').textContent = snapshot.size;
        }, (error) => {
          console.error('Fehler bei Beobachtungen-Updates:', error);
        });

      unsubscribeFunctions = [unsubscribeEmployees, unsubscribeSettings, unsubscribeBeobachtungen];
    }

    // ==================== HAUPTFUNKTIONEN ====================
    function setupEventListeners() {
      // Suchfunktion
      document.getElementById('searchEmployees').addEventListener('input', function (e) {
        filterEmployees(e.target.value);
      });

      // Keyboard Shortcuts
      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey || e.metaKey) {
          switch(e.key) {
            case 'n':
              e.preventDefault();
              openNewEmployeeModal();
              break;
            case 'f':
              e.preventDefault();
              document.getElementById('searchEmployees').focus();
              break;
            case 'e':
              e.preventDefault();
              if (currentEmployee) openEditEmployeeModal();
              break;
            case 'b':
              e.preventDefault();
              openBeobachtungAktenModal();
              break;
            case 's':
              e.preventDefault();
              openSoldatenModal();
              break;
            case ',':
              e.preventDefault();
              openSettingsWithPassword();
              break;
          }
        }
      });

      // Window Resize
      window.addEventListener('resize', adjustSidebarHeight);
      
      // Form Changes
      const formElements = document.querySelectorAll('.form-input, .form-select, .form-textarea');
      formElements.forEach(element => {
        element.addEventListener('change', handleFormChange);
        element.addEventListener('input', handleFormChange);
      });
    }

    function setupFormChangeListeners() {
      const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea');
      formInputs.forEach(input => {
        input.addEventListener('input', handleFormChange);
        input.addEventListener('change', handleFormChange);
      });
    }

    function adjustSidebarHeight() {
      const sidebar = document.querySelector('.sidebar');
      const header = document.querySelector('.app-header');
      const windowHeight = window.innerHeight;
      const headerHeight = header.offsetHeight;

      const availableHeight = windowHeight - headerHeight - 48;
      sidebar.style.height = `${Math.max(availableHeight, 500)}px`;
    }

    // ==================== MITARBEITER FUNKTIONEN ====================
    function renderEmployeeList() {
      const container = document.getElementById('employeeList');
      const countElement = document.getElementById('employeeCount');

      let filteredEmployees = getFilteredEmployees();
      filteredEmployees.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

      if (filteredEmployees.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">${getEmptyStateTitle()}</div>
            <div class="empty-description">${getEmptyStateDescription()}</div>
          </div>
        `;
        countElement.textContent = '0';
        return;
      }

      container.innerHTML = '';
      countElement.textContent = filteredEmployees.length;

      filteredEmployees.forEach(employee => {
        const isArchived = employee.status === 'archived';
        const isActive = currentEmployee?.id === employee.id;
        
        const oralCompleted = employee.inductions?.oral?.completed || false;
        const orgCompleted = employee.inductions?.org?.completed || false;

        const card = document.createElement('div');
        card.className = `employee-card ${isActive ? 'active' : ''} ${isArchived ? 'archived' : ''}`;
        card.onclick = () => selectEmployee(employee);
        card.oncontextmenu = (e) => { 
          e.preventDefault(); 
          showEmployeeContextMenu(e, employee); 
        };

        card.innerHTML = `
          <div class="employee-top-row">
            <div class="employee-name">${escapeHtml(employee.name || '')}</div>
            <div class="employee-dn">DN ${escapeHtml(employee.dn || '')}</div>
          </div>
          <div class="employee-meta">
            <i class="fas fa-user-tie"></i> ${escapeHtml(employee.rank || 'Kein Rang')} â€¢
            <i class="fas fa-building"></i> ${escapeHtml(employee.unit || 'Keine Unit')}
          </div>
          <div class="induction-badges">
            <div class="induction-badge badge-oral ${oralCompleted ? 'completed' : 'pending'}">
              <i class="fas ${oralCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              MÃ¼ndlich
            </div>
            <div class="induction-badge badge-org ${orgCompleted ? 'completed' : 'pending'}">
              <i class="fas ${orgCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              Organisatorisch
            </div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    function getFilteredEmployees() {
      let filtered = employees.filter(emp => {
        if (showArchived) {
          return emp.status === 'archived';
        } else {
          return !emp.status || emp.status === 'active';
        }
      });

      if (currentFilter === 'oral') {
        filtered = filtered.filter(emp => !(emp.inductions?.oral?.completed));
      } else if (currentFilter === 'org') {
        filtered = filtered.filter(emp => !(emp.inductions?.org?.completed));
      }
      
      return filtered;
    }

    function getEmptyStateTitle() {
      if (showArchived) return 'Keine archivierten Mitarbeiter';
      if (currentFilter === 'oral') return 'Keine Mitarbeiter mit ausstehender mÃ¼ndlicher Einweisung';
      if (currentFilter === 'org') return 'Keine Mitarbeiter mit ausstehender organisatorischer Einweisung';
      return 'Keine aktiven Mitarbeiter';
    }

    function getEmptyStateDescription() {
      if (showArchived) return 'Keine archivierten Mitarbeiter gefunden';
      return 'FÃ¼gen Sie Ihren ersten Mitarbeiter hinzu';
    }

    function filterEmployees(searchTerm) {
      const cards = document.querySelectorAll('.employee-card');
      const term = (searchTerm || '').toLowerCase().trim();

      cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = !term || text.includes(term) ? 'flex' : 'none';
      });
    }

    function filterEmployeesByType(type) {
      currentFilter = type;
      
      document.querySelectorAll('.sidebar-filter-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      document.querySelectorAll('.sidebar-filter-btn')[type === 'all' ? 0 : type === 'oral' ? 1 : 2].classList.add('active');
      
      renderEmployeeList();
    }

    function selectEmployee(employee) {
      currentEmployee = employee;

      document.getElementById('employeeHeader').style.display = 'flex';
      document.getElementById('inductionContent').style.display = 'block';

      updateEmployeeHeader();
      loadEmployeeData();
      updateInductionDisplay();
      renderEmployeeList();
    }

    function loadEmployeeData() {
      if (!currentEmployee) return;

      const oralData = currentEmployee.oralData || {};
      const orgData = currentEmployee.orgData || {};
      const isArchived = currentEmployee.status === 'archived';

      // Oral Data
      document.getElementById('oralDate').value = oralData.date || new Date().toISOString().split('T')[0];
      document.getElementById('oralTimeStart').value = oralData.timeStart || '16:40';
      document.getElementById('oralTimeEnd').value = oralData.timeEnd || '18:00';
      document.getElementById('oralPerson').value = oralData.person || '';
      document.getElementById('oralNotes').value = oralData.notes || '';
      document.getElementById('unitSelect').value = oralData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect').value = oralData.rank || currentEmployee.rank || '';

      // Org Data
      document.getElementById('orgDate').value = orgData.date || new Date().toISOString().split('T')[0];
      document.getElementById('orgTimeStart').value = orgData.timeStart || '22:10';
      document.getElementById('orgTimeEnd').value = orgData.timeEnd || '23:05';
      document.getElementById('orgPerson').value = orgData.person || '';
      document.getElementById('orgNotes').value = orgData.notes || '';
      document.getElementById('unitSelect2').value = orgData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect2').value = orgData.rank || currentEmployee.rank || '';

      // Toggles
      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;
      
      document.getElementById('oralInductionToggle').checked = oralCompleted;
      document.getElementById('orgInductionToggle').checked = orgCompleted;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);

      // Archive Status
      const archiveTag = document.getElementById('archiveStatusTag');
      const archiveButton = document.getElementById('archiveButton');
      const archiveButtonText = document.getElementById('archiveButtonText');
      
      if (isArchived) {
        archiveTag.style.display = 'flex';
        archiveButton.style.display = 'inline-flex';
        archiveButtonText.textContent = 'Wiederherstellen';
        ['oralInductionToggle', 'orgInductionToggle'].forEach(id => {
          document.getElementById(id).disabled = true;
        });
      } else {
        archiveTag.style.display = 'none';
        archiveButton.style.display = 'inline-flex';
        archiveButtonText.textContent = 'Archivieren';
        ['oralInductionToggle', 'orgInductionToggle'].forEach(id => {
          document.getElementById(id).disabled = false;
        });
      }

      updateTemplates();
    }

    function updateInductionDisplay() {
      if (!currentEmployee) return;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);
      renderEmployeeList();
    }

    function updateEmployeeHeader() {
      if (!currentEmployee) return;

      document.getElementById('currentEmployeeName').textContent = currentEmployee.name || '';
      document.getElementById('currentEmployeeDN').textContent = currentEmployee.dn || '';
      document.getElementById('currentEmployeeUnit').textContent = currentEmployee.unit || 'Keine Unit';
      document.getElementById('currentEmployeeRank').textContent = currentEmployee.rank || 'Kein Rang';
    }

    function updateInductionUI(type, completed) {
      const card = document.getElementById(`${type}InductionCard`);
      const status = document.getElementById(`${type}InductionStatus`);

      if (completed) {
        card.classList.add('completed');
        status.textContent = 'BESTANDEN';
      } else {
        card.classList.remove('completed');
        status.textContent = 'AUSSTEHEND';
      }
    }

    function saveFormData() {
      if (!currentEmployee) return;

      currentEmployee.oralData = {
        date: document.getElementById('oralDate').value,
        timeStart: document.getElementById('oralTimeStart').value,
        timeEnd: document.getElementById('oralTimeEnd').value,
        person: document.getElementById('oralPerson').value,
        notes: document.getElementById('oralNotes').value,
        unit: document.getElementById('unitSelect').value,
        rank: document.getElementById('rankSelect').value
      };

      currentEmployee.orgData = {
        date: document.getElementById('orgDate').value,
        timeStart: document.getElementById('orgTimeStart').value,
        timeEnd: document.getElementById('orgTimeEnd').value,
        person: document.getElementById('orgPerson').value,
        notes: document.getElementById('orgNotes').value,
        unit: document.getElementById('unitSelect2').value,
        rank: document.getElementById('rankSelect2').value
      };

      // Update main unit/rank if changed
      const unitSelectValue = document.getElementById('unitSelect').value;
      const rankSelectValue = document.getElementById('rankSelect').value;
      if (unitSelectValue) currentEmployee.unit = unitSelectValue;
      if (rankSelectValue) currentEmployee.rank = rankSelectValue;
    }

    async function saveEmployeeData(autoSave = false) {
      if (!currentEmployee) return false;

      try {
        const dataToSave = {
          name: currentEmployee.name,
          dn: currentEmployee.dn,
          unit: currentEmployee.unit,
          rank: currentEmployee.rank,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          inductions: currentEmployee.inductions || {},
          oralData: currentEmployee.oralData || {},
          orgData: currentEmployee.orgData || {},
          status: currentEmployee.status || 'active'
        };

        await db.collection('hrEmployees').doc(currentEmployee.id).set(dataToSave, { merge: true });
        
        if (!autoSave) {
          showNotification('Mitarbeiterdaten gespeichert', 'success');
        }
        
        return true;
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        if (!autoSave) {
          showNotification('Fehler beim Speichern: ' + error.message, 'error');
        }
        return false;
      }
    }

    function openEditEmployeeModal() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      document.getElementById('editEmployeeName').value = currentEmployee.name || '';
      document.getElementById('editEmployeeDN').value = currentEmployee.dn || '';
      document.getElementById('editEmployeeUnit').value = currentEmployee.unit || '';
      document.getElementById('editEmployeeRank').value = currentEmployee.rank || '';

      openModal('editEmployeeModal');
    }

    async function saveEditedEmployee() {
      if (!currentEmployee) return;

      const name = document.getElementById('editEmployeeName').value.trim();
      const dn = document.getElementById('editEmployeeDN').value;

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind Pflichtfelder', 'warning');
        return;
      }

      currentEmployee.name = name;
      currentEmployee.dn = dn;
      currentEmployee.unit = document.getElementById('editEmployeeUnit').value || '';
      currentEmployee.rank = document.getElementById('editEmployeeRank').value || '';

      const success = await saveEmployeeData(false);
      if (success) {
        closeModal('editEmployeeModal');
        updateEmployeeHeader();
        renderEmployeeList();
        updateTemplates();
      }
    }

    async function deleteCurrentEmployee() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      if (!confirm(`Mitarbeiter "${currentEmployee.name}" (DN ${currentEmployee.dn}) wirklich lÃ¶schen?\n\nDiese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!`)) {
        return;
      }

      try {
        await db.collection('hrEmployees').doc(currentEmployee.id).delete();

        closeModal('editEmployeeModal');
        currentEmployee = null;
        document.getElementById('employeeHeader').style.display = 'none';
        document.getElementById('inductionContent').style.display = 'none';
        renderEmployeeList();
        updateStats();
        showNotification('Mitarbeiter endgÃ¼ltig gelÃ¶scht', 'success');
      } catch (error) {
        console.error('Fehler beim LÃ¶schen:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    function toggleInduction(type, completed) {
      if (!currentEmployee) return;

      if (!currentEmployee.inductions) currentEmployee.inductions = {};

      currentEmployee.inductions[type] = {
        completed: completed,
        date: completed ? new Date().toISOString() : null,
        updatedBy: 'System'
      };

      updateInductionUI(type, completed);
      updateTemplates();
      saveEmployeeData(true);
      renderEmployeeList();
      updateStats();

      const typeName = type === 'oral' ? 'MÃ¼ndliche' : 'Organisatorische';
      const status = completed ? 'bestanden' : 'als ausstehend markiert';
      showNotification(`${typeName} Einweisung ${status}`, 'success');
    }

    function updateTemplates() {
      if (!currentEmployee) {
        seedTemplateBoxes();
        return;
      }

      saveFormData();

      // Oral Template
      const oralTemplate = generateTemplate('oral');
      document.getElementById('oralTemplateContent').textContent = oralTemplate;
      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      document.getElementById('oralTemplateBadge').textContent = oralCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
      document.getElementById('oralTemplateCard').classList.toggle('completed', oralCompleted);

      // Org Template
      const orgTemplate = generateTemplate('org');
      document.getElementById('orgTemplateContent').textContent = orgTemplate;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;
      document.getElementById('orgTemplateBadge').textContent = orgCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
      document.getElementById('orgTemplateCard').classList.toggle('completed', orgCompleted);
    }

    function generateTemplate(type) {
      const isOral = type === 'oral';
      const data = isOral ? currentEmployee.oralData : currentEmployee.orgData;

      const name = currentEmployee.name || '';
      const dn = currentEmployee.dn || '';
      const unit = isOral ? 
        (document.getElementById('unitSelect').value || currentEmployee.unit || '') :
        (document.getElementById('unitSelect2').value || currentEmployee.unit || '');
      const rank = isOral ? 
        (document.getElementById('rankSelect').value || currentEmployee.rank || '') :
        (document.getElementById('rankSelect2').value || currentEmployee.rank || '');
      const date = data?.date ? new Date(data.date).toLocaleDateString('de-DE') : '';
      const timeStart = data?.timeStart || '';
      const timeEnd = data?.timeEnd || '';
      const person = data?.person || '';
      const notes = data?.notes || '';

      // Find Discord IDs
      const unitSetting = settings.units.find(u => u.name === unit);
      const rankSetting = settings.ranks.find(r => r.name === rank);
      
      const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
      const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;

      return `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
${isOral ? 'MÃ¼ndliche Einweisung' : 'Organisatorische Einweisung'}

Name: ${name}
DN: ${dn}
Hauptunit: ${unitDisplay}
Rang: ${rankDisplay}
Datum: ${date}
Uhrzeit: ${timeStart} bis ${timeEnd}
Beteiligte: ${person}
Sonstiges: ${notes}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
    }

    function updateStats() {
      const totalEmployees = employees.filter(emp => !emp.status || emp.status === 'active').length;
      const totalArchived = employees.filter(emp => emp.status === 'archived').length;
      
      document.getElementById('totalEmployees').textContent = totalEmployees;
      document.getElementById('totalArchived').textContent = totalArchived;
    }

    // ==================== MODAL FUNKTIONEN ====================
    function openModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('active');
      }
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
      }
    }

    function openNewEmployeeModal() {
      openModal('newEmployeeModal');
      setTimeout(() => {
        document.getElementById('newEmployeeName').focus();
      }, 100);
    }

    async function createNewEmployee() {
      const name = document.getElementById('newEmployeeName').value.trim();
      const dn = document.getElementById('newEmployeeDN').value;
      const unit = document.getElementById('newEmployeeUnit').value;
      const rank = document.getElementById('newEmployeeRank').value;

      if (!name || !dn) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const employeeId = `EMP-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;

      const newEmployee = {
        id: employeeId,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
        inductions: { oral: { completed: false }, org: { completed: false } },
        oralData: { 
          date: '', 
          timeStart: '16:40', 
          timeEnd: '18:00', 
          person: '', 
          notes: '', 
          unit: unit || '', 
          rank: rank || '' 
        },
        orgData: { 
          date: '', 
          timeStart: '22:10', 
          timeEnd: '23:05', 
          person: '', 
          notes: '', 
          unit: unit || '', 
          rank: rank || '' 
        },
        status: 'active'
      };

      try {
        await db.collection('hrEmployees').doc(employeeId).set(newEmployee);

        closeModal('newEmployeeModal');
        selectEmployee(newEmployee);
        updateStats();

        document.getElementById('newEmployeeName').value = '';
        document.getElementById('newEmployeeDN').value = '';
        document.getElementById('newEmployeeUnit').value = '';
        document.getElementById('newEmployeeRank').value = '';

        showNotification(`Mitarbeiter "${name}" erstellt`, 'success');
      } catch (error) {
        console.error('Fehler beim Erstellen:', error);
        showNotification('Fehler beim Erstellen: ' + error.message, 'error');
      }
    }

    // ==================== HELPER FUNKTIONEN ====================
    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const messageElement = document.getElementById('notificationMessage');
      messageElement.textContent = message;

      // Setze Farbe basierend auf Typ
      if (type === 'success') {
        notification.style.background = 'var(--gradient-secondary)';
      } else if (type === 'error') {
        notification.style.background = 'var(--gradient-danger)';
      } else if (type === 'warning') {
        notification.style.background = 'var(--gradient-warning)';
      } else {
        notification.style.background = 'var(--gradient-primary)';
      }

      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 4000);
    }

    function seedTemplateBoxes() {
      document.getElementById('oralTemplateContent').textContent = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
MÃ¼ndliche Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

      document.getElementById('orgTemplateContent').textContent = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
Organisatorische Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
    }

    function escapeHtml(str) {
      if (!str) return '';
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        try {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch {
          return false;
        }
      }
    }

    async function copyOralTemplate() {
      const template = document.getElementById('oralTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'MÃ¼ndliche Einweisung kopiert' : 'Fehler beim Kopieren', 
                      success ? 'success' : 'error');
    }

    async function copyOrgTemplate() {
      const template = document.getElementById('orgTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Organisatorische Einweisung kopiert' : 'Fehler beim Kopieren', 
                      success ? 'success' : 'error');
    }

    function shakeElement(element) {
      element.style.animation = 'shake 0.5s';
      setTimeout(() => {
        element.style.animation = '';
      }, 500);
    }

    // ==================== ARCHIVIERUNG ====================
    async function toggleArchiveEmployee() {
      if (!currentEmployee) return;

      const newStatus = currentEmployee.status === 'archived' ? 'active' : 'archived';

      try {
        await db.collection('hrEmployees').doc(currentEmployee.id).update({
          status: newStatus,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });

        const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
        showNotification(message, 'success');
      } catch (error) {
        console.error('Fehler beim Archivieren/Wiederherstellen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    function toggleArchiveView() {
      showArchived = !showArchived;
      const buttonText = document.getElementById('archiveToggleText');
      buttonText.textContent = showArchived ? 'Aktive anzeigen' : 'Archiv anzeigen';
      renderEmployeeList();
    }

    function handleFormChange() {
      if (currentEmployee) {
        saveFormData();
        updateTemplates();
        saveEmployeeData(true);
      }
    }

    // ==================== CONTEXT MENU ====================
    function showEmployeeContextMenu(e, employee) {
      e.preventDefault();

      const existingMenu = document.getElementById('contextMenu');
      if (existingMenu) existingMenu.remove();

      const menu = document.createElement('div');
      menu.id = 'contextMenu';
      menu.style.cssText = `
        position: fixed;
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(15, 23, 42, 0.95) 100%);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: var(--radius-md);
        padding: 12px;
        z-index: 10000;
        min-width: 180px;
        box-shadow: var(--shadow-xl);
        animation: slideUp 0.2s ease;
      `;

      const isArchived = employee.status === 'archived';
      
      menu.innerHTML = `
        <div style="padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); margin-bottom: 8px;">
          <div style="font-weight: 900; color: white; margin-bottom: 4px; font-size: 14px;">${escapeHtml(employee.name || '')}</div>
          <div style="font-size: 12px; color: var(--gray);">DN: ${escapeHtml(employee.dn || '')}</div>
          ${isArchived ? '<div style="font-size: 11px; color: var(--warning); margin-top: 6px; display: flex; align-items: center; gap: 4px;"><i class="fas fa-archive"></i> Archiviert</div>' : ''}
        </div>
        <div style="display: flex; flex-direction: column; gap: 4px;">
          <button onclick="selectEmployee(employees.find(x => x.id === '${employee.id}')); openEditEmployeeModal(); document.getElementById('contextMenu')?.remove();"
            style="width:100%;text-align:left;padding:10px 12px;background:rgba(255,255,255,0.05);border:none;color:var(--primary-light);font-weight:800;cursor:pointer;transition:var(--transition);border-radius:var(--radius-sm);display:flex;align-items:center;gap:8px;font-size:13px;margin-bottom:2px;">
            <i class="fas fa-edit"></i> Bearbeiten
          </button>
          <button onclick="toggleArchiveEmployeeContext('${employee.id}')"
            style="width:100%;text-align:left;padding:10px 12px;background:rgba(255,255,255,0.05);border:none;color:${isArchived ? 'var(--secondary)' : 'var(--warning)'};font-weight:800;cursor:pointer;transition:var(--transition);border-radius:var(--radius-sm);display:flex;align-items:center;gap:8px;font-size:13px;margin-bottom:2px;">
            <i class="fas ${isArchived ? 'fa-undo' : 'fa-archive'}"></i> ${isArchived ? 'Wiederherstellen' : 'Archivieren'}
          </button>
          <button onclick="deleteEmployeePermanently('${employee.id}')"
            style="width:100%;text-align:left;padding:10px 12px;background:rgba(255,255,255,0.05);border:none;color:var(--danger);font-weight:800;cursor:pointer;transition:var(--transition);border-radius:var(--radius-sm);display:flex;align-items:center;gap:8px;font-size:13px;">
            <i class="fas fa-trash"></i> LÃ¶schen
          </button>
        </div>
      `;

      menu.style.left = `${Math.min(e.pageX, window.innerWidth - 200)}px`;
      menu.style.top = `${Math.min(e.pageY, window.innerHeight - 300)}px`;

      document.body.appendChild(menu);

      setTimeout(() => {
        const closeMenu = (event) => {
          if (!menu.contains(event.target)) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        };
        document.addEventListener('click', closeMenu);
      }, 100);
    }

    async function toggleArchiveEmployeeContext(employeeId) {
      const employee = employees.find(emp => emp.id === employeeId);
      if (!employee) return;

      const newStatus = employee.status === 'archived' ? 'active' : 'archived';

      try {
        await db.collection('hrEmployees').doc(employeeId).update({
          status: newStatus,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });

        const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
        showNotification(message, 'success');
        
        document.getElementById('contextMenu')?.remove();
      } catch (error) {
        console.error('Fehler beim Archivieren/Wiederherstellen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    async function deleteEmployeePermanently(employeeId) {
      const employee = employees.find(emp => emp.id === employeeId);
      if (!employee) return;

      if (!confirm(`Mitarbeiter "${employee.name}" (DN ${employee.dn}) wirklich endgÃ¼ltig lÃ¶schen?\n\nDiese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!`)) {
        return;
      }

      try {
        await db.collection('hrEmployees').doc(employeeId).delete();

        if (currentEmployee && currentEmployee.id === employeeId) {
          currentEmployee = null;
          document.getElementById('employeeHeader').style.display = 'none';
          document.getElementById('inductionContent').style.display = 'none';
        }
        
        showNotification('Mitarbeiter endgÃ¼ltig gelÃ¶scht', 'success');
        document.getElementById('contextMenu')?.remove();
      } catch (error) {
        console.error('Fehler beim LÃ¶schen:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    // ==================== SETTINGS MODAL ====================
    function openSettingsModal() {
      createAndShowSettingsModal();
    }

    async function createAndShowSettingsModal() {
      const modalId = 'settingsModal';
      let modal = document.getElementById(modalId);
      
      if (modal) {
        modal.classList.add('active');
        switchSettingsTab('units');
        return;
      }

      const modalHTML = `
        <div class="settings-modal" id="${modalId}">
          <div class="settings-content">
            <div class="settings-header">
              <div class="settings-title">
                <i class="fas fa-cog"></i> Einstellungen
              </div>
              <button class="settings-close" onclick="closeModal('${modalId}')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            
            <div class="settings-body">
              <div class="settings-tabs">
                <button class="settings-tab active" onclick="switchSettingsTab('units')">
                  <i class="fas fa-building"></i> Units
                </button>
                <button class="settings-tab" onclick="switchSettingsTab('ranks')">
                  <i class="fas fa-user-tie"></i> RÃ¤nge
                </button>
                <button class="settings-tab" onclick="switchSettingsTab('ankundigungen')">
                  <i class="fas fa-bullhorn"></i> AnkÃ¼ndigungen
                </button>
              </div>
              
              <div id="settingsTabContent" style="flex: 1; overflow: hidden; display: flex; flex-direction: column;">
                <!-- Tab-Inhalte werden dynamisch geladen -->
              </div>
              
              <div class="settings-actions">
                <button class="btn btn-secondary" onclick="closeModal('${modalId}')">
                  <i class="fas fa-times"></i> SchlieÃŸen
                </button>
                <button class="btn btn-primary" onclick="saveSettings()">
                  <i class="fas fa-save"></i> Einstellungen speichern
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      document.body.insertAdjacentHTML('beforeend', modalHTML);
      setTimeout(() => {
        modal = document.getElementById(modalId);
        modal.classList.add('active');
        switchSettingsTab('units');
      }, 10);
    }

    function switchSettingsTab(tabName) {
      const tabs = document.querySelectorAll('.settings-tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      const activeTab = Array.from(tabs).find(tab => 
        tab.getAttribute('onclick')?.includes(tabName)
      );
      if (activeTab) activeTab.classList.add('active');
      
      loadSettingsTabContent(tabName);
    }

    function loadSettingsTabContent(tabName) {
      const container = document.getElementById('settingsTabContent');
      
      if (tabName === 'units') {
        container.innerHTML = `
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-building"></i> Unit-Liste bearbeiten</h3>
            <div class="unit-list" id="unitList">
              ${settings.units.map((unit, index) => `
                <div class="unit-item">
                  <div class="unit-name">${escapeHtml(unit.name)}</div>
                  <input type="text" class="discord-id" value="${escapeHtml(unit.discordId || '')}" 
                         placeholder="Discord Rollen-ID" onchange="updateUnitDiscordId(${index}, this.value)">
                  <button class="btn btn-danger" onclick="removeUnit(${index})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              `).join('')}
            </div>
            <button class="add-btn" onclick="addNewUnit()">
              <i class="fas fa-plus"></i> Neue Unit hinzufÃ¼gen
            </button>
          </div>
        `;
      } else if (tabName === 'ranks') {
        container.innerHTML = `
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-user-tie"></i> Rang-Liste bearbeiten</h3>
            <div class="rank-list" id="rankList">
              ${settings.ranks.map((rank, index) => `
                <div class="rank-item">
                  <div class="rank-name">${escapeHtml(rank.name)}</div>
                  <input type="text" class="discord-id" value="${escapeHtml(rank.discordId || '')}" 
                         placeholder="Discord Rollen-ID" onchange="updateRankDiscordId(${index}, this.value)">
                  <button class="btn btn-danger" onclick="removeRank(${index})">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              `).join('')}
            </div>
            <button class="add-btn" onclick="addNewRank()">
              <i class="fas fa-plus"></i> Neuen Rang hinzufÃ¼gen
            </button>
          </div>
        `;
      } else if (tabName === 'ankundigungen') {
        const today = new Date().toISOString().split('T')[0];
        const now = new Date();
        const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
        
        container.innerHTML = `
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-bullhorn"></i> AnkÃ¼ndigungen & Besprechungen</h3>
            <div style="display: flex; flex-direction: column; gap: 24px;">
              <div>
                <h4 style="color: var(--gray-light); font-size: 14px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <i class="fas fa-plus"></i> Neue AnkÃ¼ndigung erstellen
                </h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                  <input type="text" class="settings-input" id="newAnkundigungTitle" placeholder="Titel der AnkÃ¼ndigung">
                  <textarea class="settings-input" id="newAnkundigungContent" placeholder="Inhalt der AnkÃ¼ndigung..." rows="4"></textarea>
                  <button class="btn btn-primary" onclick="createNewAnkundigung()" style="align-self: flex-start;">
                    <i class="fas fa-save"></i> AnkÃ¼ndigung speichern
                  </button>
                </div>
              </div>
              
              <div>
                <h4 style="color: var(--gray-light); font-size: 14px; margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <i class="fas fa-plus"></i> Neue Besprechung erstellen
                </h4>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                  <input type="text" class="settings-input" id="newBesprechungThema" placeholder="Thema der Besprechung">
                  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                    <input type="date" class="settings-input" id="newBesprechungDate" value="${today}">
                    <input type="time" class="settings-input" id="newBesprechungTime" value="${timeString}">
                  </div>
                  <input type="text" class="settings-input" id="newBesprechungOrt" placeholder="Ort der Besprechung">
                  <textarea class="settings-input" id="newBesprechungContent" placeholder="Inhalt der Besprechung..." rows="4"></textarea>
                  <button class="btn btn-primary" onclick="createNewBesprechung()" style="align-self: flex-start;">
                    <i class="fas fa-save"></i> Besprechung speichern
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
      }
    }

    // Settings Funktionen
    function addNewUnit() {
      const name = prompt('Name der neuen Unit:');
      if (name && name.trim()) {
        settings.units.push({
          name: name.trim(),
          discordId: ''
        });
        switchSettingsTab('units');
        showNotification('Unit hinzugefÃ¼gt', 'success');
      }
    }

    function addNewRank() {
      const name = prompt('Name des neuen Rangs:');
      if (name && name.trim()) {
        settings.ranks.push({
          name: name.trim(),
          discordId: ''
        });
        switchSettingsTab('ranks');
        showNotification('Rang hinzugefÃ¼gt', 'success');
      }
    }

    function updateUnitDiscordId(index, discordId) {
      if (index >= 0 && index < settings.units.length) {
        settings.units[index].discordId = discordId;
      }
    }

    function updateRankDiscordId(index, discordId) {
      if (index >= 0 && index < settings.ranks.length) {
        settings.ranks[index].discordId = discordId;
      }
    }

    function removeUnit(index) {
      if (confirm('Unit wirklich lÃ¶schen?')) {
        settings.units.splice(index, 1);
        switchSettingsTab('units');
        showNotification('Unit gelÃ¶scht', 'success');
      }
    }

    function removeRank(index) {
      if (confirm('Rang wirklich lÃ¶schen?')) {
        settings.ranks.splice(index, 1);
        switchSettingsTab('ranks');
        showNotification('Rang gelÃ¶scht', 'success');
      }
    }

    async function createNewAnkundigung() {
      const title = document.getElementById('newAnkundigungTitle').value.trim();
      const content = document.getElementById('newAnkundigungContent').value.trim();

      if (!content) {
        showNotification('Bitte geben Sie den Inhalt der AnkÃ¼ndigung ein', 'warning');
        return;
      }

      const ankundigung = {
        id: `ANK-${Date.now()}`,
        type: 'ankundigung',
        title: title || 'Ohne Titel',
        content: content,
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        icon: 'ðŸª§'
      };

      try {
        await db.collection('hrAnkundigungen').doc(ankundigung.id).set(ankundigung);
        
        showNotification('AnkÃ¼ndigung erfolgreich gespeichert', 'success');
        document.getElementById('newAnkundigungTitle').value = '';
        document.getElementById('newAnkundigungContent').value = '';
      } catch (error) {
        console.error('Fehler beim Speichern der AnkÃ¼ndigung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function createNewBesprechung() {
      const thema = document.getElementById('newBesprechungThema').value.trim();
      const date = document.getElementById('newBesprechungDate').value;
      const time = document.getElementById('newBesprechungTime').value;
      const ort = document.getElementById('newBesprechungOrt').value.trim();
      const content = document.getElementById('newBesprechungContent').value.trim();

      if (!thema || !date || !time || !content) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const besprechung = {
        id: `BES-${Date.now()}`,
        type: 'besprechung',
        thema,
        date,
        time,
        ort: ort || '',
        content,
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        icon: 'ðŸ—ƒï¸'
      };

      try {
        await db.collection('hrAnkundigungen').doc(besprechung.id).set(besprechung);
        
        showNotification('Besprechung erfolgreich gespeichert', 'success');
        document.getElementById('newBesprechungThema').value = '';
        document.getElementById('newBesprechungDate').value = '';
        document.getElementById('newBesprechungTime').value = '';
        document.getElementById('newBesprechungOrt').value = '';
        document.getElementById('newBesprechungContent').value = '';
      } catch (error) {
        console.error('Fehler beim Speichern der Besprechung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveSettings() {
      try {
        await db.collection('hrSettings').doc('settings').set(settings, { merge: true });
        
        updateUnitAndRankSelects();
        closeModal('settingsModal');
        showNotification('Einstellungen gespeichert', 'success');
      } catch (error) {
        console.error('Fehler beim Speichern der Einstellungen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    // ==================== SOLDATEN & BEOBACHTUNGS MODALS ====================
    function openSoldatenModal() {
      showNotification('SoldatengesprÃ¤ch-Funktion in Entwicklung', 'info');
      // Hier wÃ¼rde die vollstÃ¤ndige Soldaten-Modal-Logik implementiert werden
    }

    function openBeobachtungAktenModal() {
      showNotification('Beobachtungs-Akten-Funktion in Entwicklung', 'info');
      // Hier wÃ¼rde die vollstÃ¤ndige Beobachtungs-Akten-Logik implementiert werden
    }

    // Initialisiere die App nach DOM Laden
    setTimeout(() => {
      if (!isAuthenticated) {
        document.getElementById('mainPasswordModal').style.display = 'flex';
      }
    }, 100);
  </script>
</body>
</html>
