<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CACHE-CONTROL META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>ðŸ“‹ HR - Einweisungsmanagement v2.0</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css?v=20240128">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js?v=20240128"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js?v=20240128"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js?v=20240128"></script>

  <style>
    :root{
      --primary:#4f46e5; --primary-dark:#4338ca; --primary-light:#818cf8;
      --secondary:#10b981; --secondary-dark:#059669;
      --danger:#ef4444; --danger-dark:#dc2626;
      --warning:#f59e0b; --warning-dark:#d97706;
      --dark:#111827; --dark-card:#1f2937;
      --light:#f9fafb; --gray:#6b7280; --gray-light:#d1d5db;
      --border:rgba(255,255,255,.12);
      --archived:#6b7280; --archived-dark:#4b5563;

      --shadow-lg:0 10px 25px -5px rgba(0,0,0,.2);
      --shadow-md:0 4px 12px rgba(0,0,0,.08);
      --shadow-sm:0 1px 3px rgba(0,0,0,.1);

      --radius-lg:12px; --radius-md:8px; --radius-sm:6px;
      --transition:all .2s cubic-bezier(.4,0,.2,1);
    }

    *{margin:0;padding:0;box-sizing:border-box}

    body{
      font-family:'Inter',sans-serif;
      background:#0f172a;
      color:var(--light);
      min-height:100vh;
      overflow-x:hidden;
      font-size:14px;
      line-height:1.4;
    }

    .bg-effects{
      position:fixed; inset:0;
      z-index:-1; overflow:hidden;
    }
    .bg-gradient{
      position:absolute; inset:0;
      background:
        radial-gradient(circle at 15% 70%, rgba(79,70,229,.10) 0%, transparent 40%),
        radial-gradient(circle at 85% 30%, rgba(16,185,129,.08) 0%, transparent 40%);
    }

    .app-container{
      max-width:1400px;
      margin:0 auto;
      padding:16px;
      display:grid;
      grid-template-columns:280px 1fr;
      gap:16px;
      min-height:100vh;
    }

    /* Header */
    .app-header{
      grid-column:1 / -1;
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      padding:16px 20px;
      margin-bottom:16px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:var(--shadow-md);
    }
    .header-content{display:flex;justify-content:space-between;align-items:center}
    .brand{display:flex;align-items:center;gap:12px}
    /* Logo */
    .logo {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: #fff;
      transition: var(--transition);
      cursor: pointer;
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
    }
    .logo:hover {
      transform: scale(1.05);
      background: var(--primary-dark);
    }

    .brand-text h1{font-size:18px;font-weight:800;color:#fff;margin-bottom:2px}
    .brand-text .subtitle{font-size:11px;color:var(--gray);font-weight:600}
    .header-stats{display:flex;gap:12px}
    .stat-card{
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      padding:10px 14px;
      background:rgba(255,255,255,.05);
      border-radius:var(--radius-md);
      border:1px solid rgba(255,255,255,.08);
      min-width:90px;
      transition:var(--transition);
    }
    .stat-card:hover{transform:translateY(-1px);background:rgba(255,255,255,.08)}
    .stat-value{font-size:20px;font-weight:800;color:#fff;margin-bottom:2px}
    .stat-label{font-size:10px;color:var(--gray);text-transform:uppercase;letter-spacing:.4px;font-weight:700}

    /* Sidebar */
    .sidebar{
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      height:calc(100vh - 120px);
      position:sticky;
      top:20px;
      display:flex;
      flex-direction:column;
    }
    .sidebar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
    .sidebar-title{
      font-size:14px;font-weight:800;color:var(--gray-light);
      display:flex;align-items:center;gap:8px;
      text-transform:uppercase;letter-spacing:.4px;
    }
    .employee-count{
      background:var(--primary);
      color:#fff;
      font-size:11px;font-weight:800;
      padding:4px 10px;
      border-radius:20px;
    }
    .sidebar-filter-buttons{display:flex;gap:6px;margin-bottom:16px}
    .sidebar-filter-btn{
      padding:8px 10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-sm);
      color:var(--gray-light);
      font-size:11px;font-weight:700;
      cursor:pointer;
      transition:var(--transition);
      flex:1;
      text-align:center;
    }
    .sidebar-filter-btn:hover{background:rgba(255,255,255,.08)}
    .sidebar-filter-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}

    .sidebar-controls{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}
    .search-container{position:relative}
    .search-input{
      width:100%;
      padding:10px 12px 10px 36px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:13px;
      transition:var(--transition);
    }
    .search-input::placeholder{color:rgba(255,255,255,.5)}
    .search-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 2px rgba(79,70,229,.10);
    }
    .search-icon{
      position:absolute;left:12px;top:50%;
      transform:translateY(-50%);
      color:var(--gray);font-size:13px;
    }

    .employee-list-container{
      flex:1;
      display:flex;
      flex-direction:column;
      margin-bottom:16px;
      min-height:0;
    }
    .employee-list{
      display:flex;
      flex-direction:column;
      gap:12px;
      overflow-y:auto;
      padding-right:4px;
      flex:1;
      min-height:0;
    }
    .employee-list::-webkit-scrollbar{width:6px}
    .employee-list::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:3px}
    .employee-list::-webkit-scrollbar-thumb{background:var(--primary);border-radius:3px}

    /* Employee Cards */
    .employee-card{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:14px;
      border:1px solid rgba(255,255,255,.08);
      cursor:pointer;
      transition:var(--transition);
      position:relative;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      gap:8px;
      min-height:110px;
      justify-content:flex-start;
    }
    .employee-card:hover{
      background:rgba(255,255,255,.05);
      border-color:rgba(79,70,229,.30);
      transform:translateY(-1px);
      box-shadow:var(--shadow-sm);
    }
    .employee-card.active{
      background:rgba(79,70,229,.10);
      border-color:var(--primary);
      box-shadow:0 0 0 1px var(--primary);
    }
    .employee-card.archived{
      opacity:0.7;
      background:rgba(107,114,128,.05);
      border-color:rgba(107,114,128,.3);
    }
    .employee-card.archived::after{
      content:'ARCHIVIERT';
      position:absolute;
      top:4px;
      right:4px;
      background:var(--archived);
      color:white;
      font-size:9px;
      font-weight:900;
      padding:2px 6px;
      border-radius:4px;
    }
    .employee-card.deleted{
      opacity:0.5;
      background:rgba(239,68,68,.05);
      border-color:rgba(239,68,68,.3);
    }
    .employee-card.deleted::after{
      content:'GELÃ–SCHT';
      position:absolute;
      top:4px;
      right:4px;
      background:var(--danger);
      color:white;
      font-size:9px;
      font-weight:900;
      padding:2px 6px;
      border-radius:4px;
    }
    .employee-card::before{
      content:'';
      position:absolute;left:0;top:0;bottom:0;
      width:2px;background:var(--primary);
      opacity:0;transition:var(--transition);
    }
    .employee-card.active::before{opacity:1}

    .employee-top-row{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:2px}
    .employee-name{font-weight:800;font-size:15px;color:#fff;line-height:1.3;word-break:break-word}
    .employee-dn{
      font-family:'Inter',monospace;
      font-size:11px;font-weight:800;
      color:var(--primary-light);
      background:rgba(79,70,229,.10);
      padding:2px 7px;
      border-radius:999px;
      border:1px solid rgba(79,70,229,.20);
      white-space:nowrap;
      flex-shrink:0;
      margin-left:8px;
    }
    .employee-meta{
      font-size:11px;color:var(--gray);
      line-height:1.3;
      margin-bottom:4px;
      display:flex;align-items:center;gap:4px;
    }
    .employee-meta i{font-size:10px;opacity:.6}

    .induction-badges{
      display:flex;gap:6px;flex-wrap:wrap;
      margin-top:0;
      padding-top:2px;
    }
    .induction-badge{
      font-size:10px;
      padding:3px 8px;
      border-radius:12px;
      font-weight:700;
      display:flex;align-items:center;gap:4px;
      white-space:nowrap;
      transition:var(--transition);
      border:1px solid transparent;
    }
    .induction-badge:hover{transform:translateY(-1px)}
    .badge-oral.pending{background:rgba(239,68,68,.10);color:#fca5a5;border-color:rgba(239,68,68,.20)}
    .badge-oral.completed{background:rgba(16,185,129,.10);color:#86efac;border-color:rgba(16,185,129,.20)}
    .badge-org.pending{background:rgba(245,158,11,.10);color:#fcd34d;border-color:rgba(245,158,11,.20)}
    .badge-org.completed{background:rgba(16,185,129,.10);color:#86efac;border-color:rgba(16,185,129,.20)}

    .quick-actions{display:grid;grid-template-columns:1fr;gap:8px;margin-top:auto}
    .quick-action-btn{
      padding:10px;
      background:rgba(79,70,229,.08);
      border:1px solid rgba(79,70,229,.15);
      border-radius:var(--radius-md);
      color:var(--primary-light);
      font-size:12px;font-weight:800;
      cursor:pointer;
      transition:var(--transition);
      display:flex;align-items:center;justify-content:center;gap:6px;
    }
    .quick-action-btn:hover{
      background:rgba(79,70,229,.12);
      border-color:var(--primary);
      transform:translateY(-1px);
      color:#fff;
    }

    /* Main Content */
    .main-content{
      background:rgba(31,41,55,.8);
      backdrop-filter:blur(12px);
      border-radius:var(--radius-lg);
      border:1px solid rgba(255,255,255,.08);
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:420px;
    }
    .content-header{
      padding:16px 20px;
      background:rgba(79,70,229,.05);
      border-bottom:1px solid rgba(255,255,255,.08);
      display:none;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
    }
    .employee-info h2{font-size:18px;font-weight:900;color:#fff;margin-bottom:8px}
    .employee-tags{display:flex;gap:12px;flex-wrap:wrap}
    .employee-tag{display:flex;align-items:center;gap:6px;font-size:12px;color:var(--gray);font-weight:700}
    .tag-value{
      color:#fff;
      font-weight:800;
      background:rgba(79,70,229,.10);
      padding:3px 8px;
      border-radius:4px;
      border:1px solid rgba(79,70,229,.20);
      font-size:11px;
    }
    .action-buttons{display:flex;gap:8px;flex-wrap:wrap}

    .btn{
      padding:8px 12px;
      border:none;
      border-radius:var(--radius-md);
      font-weight:800;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;align-items:center;justify-content:center;gap:6px;
      font-size:12px;
      user-select:none;
    }
    .btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary-dark);transform:translateY(-1px)}
    .btn-secondary{
      background:rgba(255,255,255,.08);
      color:#fff;
      border:1px solid rgba(255,255,255,.12);
    }
    .btn-secondary:hover{background:rgba(255,255,255,.12);transform:translateY(-1px)}
    .btn-danger{background:var(--danger);color:#fff}
    .btn-danger:hover{background:var(--danger-dark);transform:translateY(-1px)}
    .btn-archived{background:var(--archived);color:#fff}
    .btn-archived:hover{background:var(--archived-dark);transform:translateY(-1px)}

    .induction-content{
      padding:20px;
      flex:1;
      overflow-y:auto;
      display:none;
    }

    .induction-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:16px;
      margin-bottom:20px;
    }
    .induction-card{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      transition:var(--transition);
      position:relative;
    }
    .induction-card.completed{
      border-color:var(--secondary);
      background:rgba(16,185,129,.05);
    }
    .induction-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:10px}
    .induction-title{
      font-size:14px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .induction-icon{
      width:32px;height:32px;
      background:var(--primary);
      border-radius:var(--radius-md);
      display:flex;align-items:center;justify-content:center;
      font-size:14px;color:#fff;
    }
    .induction-card.completed .induction-icon{background:var(--secondary)}
    .induction-status{
      font-size:11px;font-weight:900;
      padding:4px 8px;border-radius:12px;
      background:rgba(255,255,255,.08);
      color:var(--gray);
      white-space:nowrap;
    }
    .induction-card.completed .induction-status{background:rgba(16,185,129,.15);color:var(--secondary)}

    .oral-form-grid, .org-form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:4px;
    }
    .form-group{display:flex;flex-direction:column;gap:6px}
    .form-label{
      font-weight:900;color:var(--gray-light);
      font-size:11px;text-transform:uppercase;letter-spacing:.4px;
    }
    .form-input,.form-select,.form-textarea{
      padding:8px 10px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius-sm);
      color:#fff;
      font-size:13px;
      transition:var(--transition);
      width:100%;
    }
    .form-input::placeholder,.form-textarea::placeholder{color:rgba(255,255,255,.4)}
    .form-select{
      color:#fff !important;
      background-color:rgba(255,255,255,.05) !important;
      appearance:none;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat:no-repeat;
      background-position:right 10px center;
      padding-right:30px;
    }
    .form-input:focus,.form-select:focus,.form-textarea:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 2px rgba(79,70,229,.10);
    }
    .form-textarea{
      resize:vertical;
      min-height:60px;
      font-family:'Inter',sans-serif;
      line-height:1.4;
    }

    .time-container{
      display:grid;
      grid-template-columns:1fr auto 1fr;
      gap:8px;
      align-items:center;
    }
    .time-separator{color:var(--gray);font-weight:700;text-align:center;font-size:12px;padding:0 4px}
    input[type="time"]{font-size:13px;padding:7px 8px}

    /* Toggle */
    .toggle-switch{position:relative;display:inline-block;width:44px;height:24px}
    .toggle-switch input{opacity:0;width:0;height:0}
    .toggle-slider{
      position:absolute;cursor:pointer;inset:0;
      background-color:rgba(255,255,255,.10);
      transition:var(--transition);
      border-radius:34px;
    }
    .toggle-slider:before{
      position:absolute;content:"";
      height:16px;width:16px;left:4px;bottom:4px;
      background-color:#fff;
      transition:var(--transition);
      border-radius:50%;
    }
    input:checked + .toggle-slider{background-color:var(--secondary)}
    input:checked + .toggle-slider:before{transform:translateX(20px)}

    /* Templates */
    .templates-section{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
    }
    .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;gap:10px;flex-wrap:wrap}
    .section-title{
      font-size:14px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .template-actions{display:flex;gap:8px;flex-wrap:wrap}

    .template-cards{
      display:grid;
      grid-template-columns:1fr;
      gap:16px;
    }

    .template-card{
      background:rgba(0,0,0,.20);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
    }
    .template-card.completed{border-color:var(--secondary)}
    .template-card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:10px}
    .template-card-title{
      font-size:13px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:6px;
    }
    .template-badge{
      font-size:10px;font-weight:900;
      padding:3px 8px;border-radius:12px;
      background:rgba(79,70,229,.10);
      color:var(--primary-light);
      white-space:nowrap;
    }
    .template-content{
      font-family:Consolas,Monaco,monospace;
      background:rgba(0,0,0,.30);
      padding:12px;
      border-radius:var(--radius-sm);
      border-left:2px solid var(--primary);
      overflow-x:auto;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:11px;
      line-height:1.4;
      color:var(--gray-light);
      max-height:180px;
      overflow-y:auto;
    }
    .template-card.completed .template-content{border-left-color:var(--secondary)}

    /* Floating Buttons Container */
    .floating-buttons-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 1000;
    }

    .floating-button {
      width: 56px;
      height: 56px;
      background: var(--primary);
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 20px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .floating-button:hover {
      background: var(--primary-dark);
      transform: scale(1.1);
      box-shadow: 0 10px 25px rgba(79,70,229,.3);
    }

    .floating-button.settings {
      background: var(--archived);
    }

    .floating-button.settings:hover {
      background: var(--archived-dark);
    }

    .floating-button.soldaten {
      background: var(--warning);
    }

    .floating-button.soldaten:hover {
      background: var(--warning-dark);
    }

    .floating-button.ankundigung {
      background: #8b5cf6;
    }

    .floating-button.ankundigung:hover {
      background: #7c3aed;
    }

    .floating-button.beobachtung {
      background: #8b5cf6;
    }

    .floating-button.beobachtung:hover {
      background: #7c3aed;
    }

    /* Settings Modal */
    .settings-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .settings-modal.active {
      display: flex;
    }

    .settings-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 1000px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .settings-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .settings-title i {
      color: var(--archived);
      font-size: 20px;
    }

    .settings-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .settings-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .settings-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .settings-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .settings-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .settings-tab:hover {
      color: var(--archived);
    }

    .settings-tab.active {
      color: var(--archived);
    }

    .settings-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--archived);
    }

    .settings-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .settings-form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .settings-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .settings-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .settings-input:focus {
      outline: none;
      border-color: var(--archived);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(107,114,128,.15);
    }

    .settings-textarea {
      min-height: 80px;
      resize: vertical;
      line-height: 1.5;
    }

    .settings-unit-list {
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 20px;
      max-height: 300px;
      overflow-y: auto;
    }

    .settings-unit-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-sm);
      margin-bottom: 8px;
      border: 1px solid rgba(255,255,255,.08);
    }

    .settings-unit-item:last-child {
      margin-bottom: 0;
    }

    .settings-unit-name {
      font-weight: 900;
      color: #fff;
      font-size: 13px;
    }

    .settings-unit-discord {
      font-family: 'Consolas', 'Monaco', monospace;
      background: rgba(107,114,128,.15);
      color: #9ca3af;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(107,114,128,.25);
    }

    .settings-unit-actions {
      display: flex;
      gap: 6px;
    }

    .settings-unit-btn {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      font-size: 11px;
    }

    .settings-unit-btn-edit {
      background: rgba(107,114,128,.15);
      color: #9ca3af;
      border: 1px solid rgba(107,114,128,.25);
    }

    .settings-unit-btn-edit:hover {
      background: rgba(107,114,128,.25);
    }

    .settings-unit-btn-delete {
      background: rgba(239,68,68,.15);
      color: #fca5a5;
      border: 1px solid rgba(239,68,68,.25);
    }

    .settings-unit-btn-delete:hover {
      background: rgba(239,68,68,.25);
    }

    .settings-audit-log {
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 20px;
      max-height: 400px;
      overflow-y: auto;
    }

    .settings-audit-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-sm);
      padding: 12px;
      margin-bottom: 8px;
      border-left: 3px solid var(--primary);
    }

    .settings-audit-item:last-child {
      margin-bottom: 0;
    }

    .settings-audit-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .settings-audit-action {
      font-weight: 900;
      color: #fff;
      font-size: 13px;
    }

    .settings-audit-entity {
      background: rgba(79,70,229,.15);
      color: var(--primary-light);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(79,70,229,.25);
    }

    .settings-audit-info {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .settings-audit-user {
      color: #fff;
      font-weight: 700;
    }

    .settings-audit-timestamp {
      color: var(--gray);
    }

    .empty-settings {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-settings-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-settings-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    .settings-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .settings-btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
    }

    .settings-btn-save {
      background: var(--archived);
      color: #fff;
    }

    .settings-btn-save:hover {
      background: var(--archived-dark);
      transform: translateY(-1px);
    }

    /* Status Filter - GEÃ„NDERT: "Mitarbeiter" statt "Aktiv" */
    .status-filter {
      display: flex;
      gap: 6px;
      margin-bottom: 12px;
    }

    .status-filter-btn {
      padding: 6px 12px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: var(--radius-sm);
      color: var(--gray-light);
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
    }

    .status-filter-btn:hover {
      background: rgba(255,255,255,.08);
    }

    .status-filter-btn.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
    }

    /* AnkÃ¼ndigungen/Besprechungen/Aufstellungen Modal */
    .ankundigung-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .ankundigung-modal.active {
      display: flex;
    }

    .ankundigung-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .ankundigung-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .ankundigung-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .ankundigung-title i {
      color: #8b5cf6;
      font-size: 20px;
    }

    .ankundigung-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .ankundigung-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .ankundigung-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigung-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .ankundigung-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ankundigung-tab:hover {
      color: #8b5cf6;
    }

    .ankundigung-tab.active {
      color: #8b5cf6;
    }

    .ankundigung-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: #8b5cf6;
    }

    .ankundigung-form-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .ankundigung-form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ankundigung-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .ankundigung-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .ankundigung-input:focus {
      outline: none;
      border-color: #8b5cf6;
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(139,92,246,.15);
    }

    .ankundigung-textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .ankundigung-preview {
      background: rgba(0,0,0,.3);
      border-radius: var(--radius-md);
      padding: 20px;
      border-left: 3px solid #8b5cf6;
      margin-top: 10px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .ankundigung-preview-title {
      font-weight: 900;
      color: var(--gray-light);
      margin-bottom: 12px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .ankundigung-preview-content {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      line-height: 1.4;
      color: #fff;
      background: rgba(0,0,0,.2);
      padding: 16px;
      border-radius: var(--radius-sm);
      max-height: 200px;
      overflow-y: auto;
      min-height: 100px;
    }

    .ankundigung-preview-content::-webkit-scrollbar {
      width: 6px;
    }

    .ankundigung-preview-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 3px;
    }

    .ankundigung-preview-content::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 3px;
    }

    .ankundigung-tab-content {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigung-liste-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .ankundigung-liste {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
    }

    .ankundigung-liste::-webkit-scrollbar {
      width: 8px;
    }

    .ankundigung-liste::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .ankundigung-liste::-webkit-scrollbar-thumb {
      background: #8b5cf6;
      border-radius: 4px;
    }

    .ankundigung-liste::-webkit-scrollbar-thumb:hover {
      background: #7c3aed;
    }

    .ankundigung-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
      flex-shrink: 0;
    }

    .ankundigung-item:hover {
      background: rgba(255,255,255,.05);
      border-color: #8b5cf6;
    }

    .ankundigung-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .ankundigung-item-title {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .ankundigung-item-type {
      font-family: 'Inter', monospace;
      background: rgba(139,92,246,.10);
      color: #a78bfa;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(139,92,246,.20);
    }

    .ankundigung-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .ankundigung-item-content {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid #8b5cf6;
      max-height: 100px;
      overflow-y: auto;
    }

    .ankundigung-item-content::-webkit-scrollbar {
      width: 4px;
    }

    .ankundigung-item-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .ankundigung-item-content::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,.30);
      border-radius: 2px;
    }

    .ankundigung-item-template {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 11px;
      line-height: 1.4;
      color: var(--gray-light);
      background: rgba(0,0,0,.3);
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255,255,255,.08);
      max-height: 150px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .ankundigung-item-template::-webkit-scrollbar {
      width: 4px;
    }

    .ankundigung-item-template::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .ankundigung-item-template::-webkit-scrollbar-thumb {
      background: rgba(139,92,246,.30);
      border-radius: 2px;
    }

    .ankundigung-item-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .ankundigung-item-btn {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
    }

    .ankundigung-item-btn-copy {
      background: rgba(139,92,246,.15);
      color: #a78bfa;
      border: 1px solid rgba(139,92,246,.25);
    }

    .ankundigung-item-btn-copy:hover {
      background: rgba(139,92,246,.25);
    }

    .ankundigung-item-btn-delete {
      background: rgba(239,68,68,.15);
      color: #fca5a5;
      border: 1px solid rgba(239,68,68,.25);
    }

    .ankundigung-item-btn-delete:hover {
      background: rgba(239,68,68,.25);
    }

    .empty-ankundigung {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-ankundigung-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-ankundigung-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    .ankundigung-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .ankundigung-btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
    }

    .ankundigung-btn-copy {
      background: #8b5cf6;
      color: #fff;
    }

    .ankundigung-btn-copy:hover {
      background: #7c3aed;
      transform: translateY(-1px);
    }

    .ankundigung-btn-save {
      background: var(--secondary);
      color: #fff;
    }

    .ankundigung-btn-save:hover {
      background: var(--secondary-dark);
      transform: translateY(-1px);
    }

    .ankundigung-search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .ankundigung-search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .ankundigung-search-input::placeholder {
      color: rgba(255,255,255,.5);
    }

    .ankundigung-search-input:focus {
      outline: none;
      border-color: #8b5cf6;
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(139,92,246,.15);
    }

    .ankundigung-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    /* SoldatengesprÃ¤ch Modal */
    .soldaten-modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      backdrop-filter: blur(4px);
      z-index: 2000;
      align-items: center;
      justify-content: center;
      padding: 20px;
      animation: fadeIn .2s ease;
    }

    .soldaten-modal.active {
      display: flex;
    }

    .soldaten-content {
      background: rgba(31,41,55,.95);
      border-radius: var(--radius-lg);
      padding: 24px;
      width: 100%;
      max-width: 900px;
      max-height: 90vh;
      border: 1px solid rgba(255,255,255,.15);
      box-shadow: var(--shadow-lg);
      animation: slideUp .2s ease;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .soldaten-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-title {
      font-size: 18px;
      font-weight: 900;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .soldaten-title i {
      color: var(--warning);
      font-size: 20px;
    }

    .soldaten-close {
      background: none;
      border: none;
      color: var(--gray);
      font-size: 20px;
      cursor: pointer;
      transition: var(--transition);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }

    .soldaten-close:hover {
      color: #fff;
      background: rgba(255,255,255,.1);
    }

    .soldaten-body {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-tabs {
      display: flex;
      gap: 2px;
      margin-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-tab {
      padding: 12px 20px;
      background: none;
      border: none;
      color: var(--gray);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      font-size: 13px;
      position: relative;
    }

    .soldaten-tab:hover {
      color: var(--warning);
    }

    .soldaten-tab.active {
      color: var(--warning);
    }

    .soldaten-tab.active::after {
      content: '';
      position: absolute;
      bottom: -1px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--warning);
    }

    .soldaten-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 20px;
    }

    .soldaten-form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .soldaten-label {
      font-weight: 900;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .soldaten-input {
      padding: 12px 16px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .soldaten-input:focus {
      outline: none;
      border-color: var(--warning);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(245,158,11,.15);
    }

    .soldaten-textarea {
      min-height: 120px;
      resize: vertical;
      line-height: 1.5;
    }

    .soldaten-preview {
      background: rgba(0,0,0,.3);
      border-radius: var(--radius-md);
      padding: 20px;
      border-left: 3px solid var(--warning);
      margin-top: 10px;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .soldaten-preview-title {
      font-weight: 900;
      color: var(--gray-light);
      margin-bottom: 12px;
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .soldaten-preview-content {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      line-height: 1.4;
      color: #fff;
      background: rgba(0,0,0,.2);
      padding: 16px;
      border-radius: var(--radius-sm);
      max-height: 200px;
      overflow-y: auto;
      min-height: 100px;
    }

    .soldaten-preview-content::-webkit-scrollbar {
      width: 6px;
    }

    .soldaten-preview-content::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 3px;
    }

    .soldaten-preview-content::-webkit-scrollbar-thumb {
      background: var(--warning);
      border-radius: 3px;
    }

    .soldaten-tab-content {
      flex: 1;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-liste-container {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .soldaten-liste {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 0;
    }

    .soldaten-liste::-webkit-scrollbar {
      width: 8px;
    }

    .soldaten-liste::-webkit-scrollbar-track {
      background: rgba(255,255,255,.05);
      border-radius: 4px;
    }

    .soldaten-liste::-webkit-scrollbar-thumb {
      background: var(--warning);
      border-radius: 4px;
    }

    .soldaten-liste::-webkit-scrollbar-thumb:hover {
      background: var(--warning-dark);
    }

    .soldaten-item {
      background: rgba(255,255,255,.03);
      border-radius: var(--radius-md);
      padding: 16px;
      border: 1px solid rgba(255,255,255,.08);
      transition: var(--transition);
      flex-shrink: 0;
    }

    .soldaten-item:hover {
      background: rgba(255,255,255,.05);
      border-color: var(--warning);
    }

    .soldaten-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .soldaten-item-name {
      font-weight: 900;
      color: #fff;
      font-size: 15px;
    }

    .soldaten-item-dn {
      font-family: 'Inter', monospace;
      background: rgba(245,158,11,.10);
      color: #fcd34d;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 900;
      border: 1px solid rgba(245,158,11,.20);
    }

    .soldaten-item-date {
      color: var(--gray);
      font-size: 11px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .soldaten-item-notizen {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--warning);
      max-height: 100px;
      overflow-y: auto;
    }

    .soldaten-item-notizen::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-notizen::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-notizen::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-sonstiges {
      color: var(--gray-light);
      font-size: 13px;
      line-height: 1.5;
      margin-bottom: 12px;
      padding: 12px;
      background: rgba(0,0,0,.2);
      border-radius: var(--radius-sm);
      border-left: 2px solid var(--warning);
      max-height: 100px;
      overflow-y: auto;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-sonstiges::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-template {
      font-family: 'Consolas', 'Monaco', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 11px;
      line-height: 1.4;
      color: var(--gray-light);
      background: rgba(0,0,0,.3);
      padding: 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(255,255,255,.08);
      max-height: 150px;
      overflow-y: auto;
      margin-bottom: 12px;
    }

    .soldaten-item-template::-webkit-scrollbar {
      width: 4px;
    }

    .soldaten-item-template::-webkit-scrollbar-track {
      background: rgba(255,255,255,.03);
      border-radius: 2px;
    }

    .soldaten-item-template::-webkit-scrollbar-thumb {
      background: rgba(245,158,11,.30);
      border-radius: 2px;
    }

    .soldaten-item-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }

    .soldaten-item-btn {
      padding: 6px 12px;
      border: none;
      border-radius: var(--radius-sm);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 11px;
    }

    .soldaten-item-btn-copy {
      background: rgba(245,158,11,.15);
      color: #fcd34d;
      border: 1px solid rgba(245,158,11,.25);
    }

    .soldaten-item-btn-copy:hover {
      background: rgba(245,158,11,.25);
    }

    .soldaten-item-btn-delete {
      background: rgba(239,68,68,.15);
      color: #fca5a5;
      border: 1px solid rgba(239,68,68,.25);
    }

    .soldaten-item-btn-delete:hover {
      background: rgba(239,68,68,.25);
    }

    .empty-soldaten {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .empty-soldaten-icon {
      font-size: 36px;
      margin-bottom: 12px;
      opacity: .3;
    }

    .empty-soldaten-title {
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
      color: var(--gray-light);
    }

    .soldaten-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-top: 10px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,.1);
      flex-shrink: 0;
    }

    .soldaten-btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 900;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 13px;
    }

    .soldaten-btn-copy {
      background: var(--warning);
      color: #fff;
    }

    .soldaten-btn-copy:hover {
      background: var(--warning-dark);
      transform: translateY(-1px);
    }

    .soldaten-btn-save {
      background: var(--secondary);
      color: #fff;
    }

    .soldaten-btn-save:hover {
      background: var(--secondary-dark);
      transform: translateY(-1px);
    }

    .soldaten-search-container {
      position: relative;
      margin-bottom: 20px;
      flex-shrink: 0;
    }

    .soldaten-search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255,255,255,.05);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
    }

    .soldaten-search-input::placeholder {
      color: rgba(255,255,255,.5);
    }

    .soldaten-search-input:focus {
      outline: none;
      border-color: var(--warning);
      background: rgba(255,255,255,.08);
      box-shadow: 0 0 0 3px rgba(245,158,11,.15);
    }

    .soldaten-search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 16px;
    }

    /* Beobachtungs Akten Modal */
    .beobachtung-akten-modal{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.85);
      backdrop-filter:blur(4px);
      z-index:2000;
      align-items:center;
      justify-content:center;
      padding:20px;
      animation:fadeIn .2s ease;
    }
    .beobachtung-akten-modal.active{display:flex}
    
    .beobachtung-akten-content{
      background:rgba(31,41,55,.95);
      border-radius:var(--radius-lg);
      padding:24px;
      width:100%;
      max-width:900px;
      max-height:90vh;
      border:1px solid rgba(255,255,255,.15);
      box-shadow:var(--shadow-lg);
      animation:slideUp .2s ease;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    
    .beobachtung-akten-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
      padding-bottom:16px;
      border-bottom:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-akten-title{
      font-size:18px;
      font-weight:900;
      color:#fff;
      display:flex;
      align-items:center;
      gap:10px;
    }
    
    .beobachtung-akten-title i{
      color:var(--primary-light);
      font-size:20px;
    }
    
    .beobachtung-akten-close{
      background:none;
      border:none;
      color:var(--gray);
      font-size:20px;
      cursor:pointer;
      transition:var(--transition);
      width:32px;
      height:32px;
      display:flex;
      align-items:center;
      justify-content:center;
      border-radius:50%;
    }
    
    .beobachtung-akten-close:hover{
      color:#fff;
      background:rgba(255,255,255,.1);
    }
    
    .beobachtung-akten-body{
      flex:1;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
    }
    
    .beobachtung-tabs{
      display:flex;
      gap:2px;
      margin-bottom:16px;
      border-bottom:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-tab{
      padding:12px 20px;
      background:none;
      border:none;
      color:var(--gray);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      font-size:13px;
      position:relative;
    }
    
    .beobachtung-tab:hover{
      color:var(--primary-light);
    }
    
    .beobachtung-tab.active{
      color:var(--primary);
    }
    
    .beobachtung-tab.active::after{
      content:'';
      position:absolute;
      bottom:-1px;
      left:0;
      right:0;
      height:2px;
      background:var(--primary);
    }
    
    .akte-form-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-bottom:20px;
    }
    
    .akte-form-group{
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    
    .akte-label{
      font-weight:900;
      color:var(--gray-light);
      font-size:12px;
      text-transform:uppercase;
      letter-spacing:.5px;
    }
    
    .akte-input{
      padding:12px 16px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:14px;
      transition:var(--transition);
      width:100%;
      font-family:'Inter',sans-serif;
    }
    
    .akte-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(79,70,229,.15);
    }
    
    .akte-textarea{
      min-height:120px;
      resize:vertical;
      line-height:1.5;
    }
    
    .beobachtung-preview{
      background:rgba(0,0,0,.3);
      border-radius:var(--radius-md);
      padding:20px;
      border-left:3px solid var(--primary);
      margin-top:10px;
      margin-bottom:20px;
      flex-shrink:0;
    }
    
    .beobachtung-preview-title{
      font-weight:900;
      color:var(--gray-light);
      margin-bottom:12px;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    
    .beobachtung-preview-content{
      font-family:'Consolas','Monaco',monospace;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:12px;
      line-height:1.4;
      color:#fff;
      background:rgba(0,0,0,.2);
      padding:16px;
      border-radius:var(--radius-sm);
      max-height:200px;
      overflow-y:auto;
      min-height:100px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar{
      width:6px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar-track{
      background:rgba(255,255,255,.05);
      border-radius:3px;
    }
    
    .beobachtung-preview-content::-webkit-scrollbar-thumb{
      background:var(--primary);
      border-radius:3px;
    }
    
    .beobachtung-akten-liste{
      flex:1;
      overflow-y:auto;
      padding-right:8px;
      min-height:0;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar{
      width:8px;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar-track{
      background:rgba(255,255,255,.05);
      border-radius:4px;
    }
    
    .beobachtung-akten-liste::-webkit-scrollbar-thumb{
      background:var(--primary);
      border-radius:4px;
    }
    
    .beobachtung-akte-item{
      background:rgba(255,255,255,.03);
      border-radius:var(--radius-md);
      padding:16px;
      border:1px solid rgba(255,255,255,.08);
      margin-bottom:12px;
      transition:var(--transition);
    }
    
    .beobachtung-akte-item:hover{
      background:rgba(255,255,255,.05);
      border-color:var(--primary-light);
    }
    
    .beobachtung-akte-header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      margin-bottom:12px;
    }
    
    .beobachtung-akte-name{
      font-weight:900;
      color:#fff;
      font-size:15px;
    }
    
    .beobachtung-akte-dn{
      font-family:'Inter',monospace;
      background:rgba(79,70,229,.10);
      color:var(--primary-light);
      padding:4px 10px;
      border-radius:12px;
      font-size:11px;
      font-weight:900;
      border:1px solid rgba(79,70,229,.20);
    }
    
    .beobachtung-akte-date{
      color:var(--gray);
      font-size:11px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:4px;
    }
    
    .beobachtung-akte-grund{
      color:var(--gray-light);
      font-size:13px;
      line-height:1.5;
      margin-bottom:12px;
      padding:12px;
      background:rgba(0,0,0,.2);
      border-radius:var(--radius-sm);
      border-left:2px solid var(--primary);
    }
    
    .beobachtung-akte-template{
      font-family:'Consolas','Monaco',monospace;
      white-space:pre-wrap;
      word-wrap:break-word;
      font-size:11px;
      line-height:1.4;
      color:var(--gray-light);
      background:rgba(0,0,0,.3);
      padding:12px;
      border-radius:var(--radius-sm);
      border:1px solid rgba(255,255,255,.08);
      max-height:150px;
      overflow-y:auto;
      margin-bottom:12px;
    }
    
    .beobachtung-akte-actions{
      display:flex;
      gap:8px;
      justify-content:flex-end;
    }
    
    .beobachtung-akte-btn{
      padding:6px 12px;
      border:none;
      border-radius:var(--radius-sm);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:6px;
      font-size:11px;
    }
    
    .beobachtung-akte-btn-copy{
      background:rgba(79,70,229,.15);
      color:var(--primary-light);
      border:1px solid rgba(79,70,229,.25);
    }
    
    .beobachtung-akte-btn-copy:hover{
      background:rgba(79,70,229,.25);
    }
    
    .beobachtung-akte-btn-delete{
      background:rgba(239,68,68,.15);
      color:#fca5a5;
      border:1px solid rgba(239,68,68,.25);
    }
    
    .beobachtung-akte-btn-delete:hover{
      background:rgba(239,68,68,.25);
    }
    
    .empty-beobachtungen{
      text-align:center;
      padding:40px 20px;
      color:var(--gray);
    }
    
    .empty-beobachtungen-icon{
      font-size:36px;
      margin-bottom:12px;
      opacity:.3;
    }
    
    .empty-beobachtungen-title{
      font-size:14px;
      font-weight:900;
      margin-bottom:6px;
      color:var(--gray-light);
    }
    
    .beobachtung-actions{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-top:10px;
      padding-top:20px;
      border-top:1px solid rgba(255,255,255,.1);
      flex-shrink:0;
    }
    
    .beobachtung-btn{
      padding:10px 20px;
      border:none;
      border-radius:var(--radius-md);
      font-weight:900;
      cursor:pointer;
      transition:var(--transition);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      font-size:13px;
    }
    
    .beobachtung-btn-copy{
      background:var(--primary);
      color:#fff;
    }
    
    .beobachtung-btn-copy:hover{
      background:var(--primary-dark);
      transform:translateY(-1px);
    }
    
    .beobachtung-btn-save{
      background:var(--secondary);
      color:#fff;
    }
    
    .beobachtung-btn-save:hover{
      background:var(--secondary-dark);
      transform:translateY(-1px);
    }

    /* Akten Suche */
    .akten-search-container{
      position:relative;
      margin-bottom:20px;
    }
    
    .akten-search-input{
      width:100%;
      padding:12px 16px 12px 44px;
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.1);
      border-radius:var(--radius-md);
      color:#fff;
      font-size:14px;
      transition:var(--transition);
    }
    
    .akten-search-input::placeholder{
      color:rgba(255,255,255,.5);
    }
    
    .akten-search-input:focus{
      outline:none;
      border-color:var(--primary);
      background:rgba(255,255,255,.08);
      box-shadow:0 0 0 3px rgba(79,70,229,.15);
    }
    
    .akten-search-icon{
      position:absolute;
      left:16px;
      top:50%;
      transform:translateY(-50%);
      color:var(--gray);
      font-size:16px;
    }

    /* Modals */
    .modal-overlay{
      display:none;
      position:fixed;inset:0;
      background:rgba(0,0,0,.80);
      backdrop-filter:blur(4px);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:16px;
      animation:fadeIn .2s ease;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-overlay.active{display:flex}
    .modal{
      background:rgba(31,41,55,.95);
      border-radius:var(--radius-lg);
      padding:20px;
      width:100%;
      max-width:500px;
      border:1px solid rgba(255,255,255,.12);
      box-shadow:var(--shadow-lg);
      animation:slideUp .2s ease;
    }
    @keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
    .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;gap:10px}
    .modal-title{
      font-size:16px;font-weight:900;color:#fff;
      display:flex;align-items:center;gap:8px;
    }
    .modal-close{
      background:none;border:none;color:var(--gray);
      font-size:18px;cursor:pointer;
      transition:var(--transition);
      width:28px;height:28px;
      display:flex;align-items:center;justify-content:center;
      border-radius:50%;
    }
    .modal-close:hover{color:#fff;background:rgba(255,255,255,.10)}

    /* Empty / Loading */
    .empty-state{text-align:center;padding:40px 20px;color:var(--gray);width:100%}
    .empty-icon{font-size:36px;margin-bottom:12px;opacity:.3}
    .empty-title{font-size:14px;font-weight:900;margin-bottom:6px;color:var(--gray-light)}
    .empty-description{font-size:12px;color:var(--gray);max-width:250px;margin:0 auto 12px}

    .loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:40px;width:100%}
    .loading-spinner{
      width:32px;height:32px;
      border:2px solid rgba(255,255,255,.10);
      border-top-color:var(--primary);
      border-radius:50%;
      animation:spin 1s linear infinite;
      margin-bottom:12px;
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    /* Notification */
    .notification{
      position:fixed;
      bottom:16px;right:16px;
      background:var(--secondary);
      color:#fff;
      padding:10px 14px;
      border-radius:var(--radius-md);
      box-shadow:var(--shadow-md);
      display:flex;align-items:center;gap:8px;
      z-index:1001;
      transform:translateY(100px);
      opacity:0;
      transition:transform .2s ease, opacity .2s ease;
      min-width:200px;
    }
    .notification.show{transform:translateY(0);opacity:1}
    .notification-icon{font-size:14px}
    .notification-message{font-weight:900;font-size:13px}

    /* Responsive */
    @media (max-width:1200px){
      .app-container{grid-template-columns:1fr;padding:16px;gap:16px}
      .sidebar{position:static;max-height:500px;height:auto}
      .induction-grid{grid-template-columns:1fr}
    }
    @media (max-width:768px){
      .app-header{padding:14px 16px}
      .header-content{flex-direction:column;gap:12px;align-items:stretch}
      .header-stats{justify-content:center}
      .brand{gap:10px}
      .logo{width:36px;height:36px;font-size:16px}
      .brand-text h1{font-size:16px}
      .brand-text .subtitle{font-size:10px}
      .content-header{flex-direction:column;align-items:stretch;padding:14px}
      .employee-tags{flex-direction:column;gap:6px}
      .induction-content{padding:16px}
      .oral-form-grid,.org-form-grid{grid-template-columns:1fr}
      .settings-form-grid{grid-template-columns:1fr}
      .soldaten-form-grid,.akte-form-grid{grid-template-columns:1fr}
      .floating-buttons-container{
        bottom: 16px;
        right: 16px;
      }
      .settings-tabs{flex-direction:column}
      .settings-tab{text-align:left;padding:10px 16px}
      .soldaten-tabs,.beobachtung-tabs,.ankundigung-tabs{flex-direction:column}
      .soldaten-tab,.beobachtung-tab,.ankundigung-tab{text-align:left;padding:10px 16px}
      .soldaten-actions,.beobachtung-actions,.ankundigung-actions{flex-direction:column;align-items:stretch}
    }
    @media (max-width:480px){
      .app-container{padding:12px}
      .app-header{padding:12px}
      .stat-card{padding:8px 10px;min-width:70px}
      .stat-value{font-size:18px}
      .sidebar{padding:14px}
      .modal{padding:16px;margin:12px}
      .notification{left:12px;right:12px;bottom:12px;min-width:auto}
      .soldaten-content,.beobachtung-akten-content,.ankundigung-content{padding:16px}
      .soldaten-item-actions,.beobachtung-akte-actions,.ankundigung-item-actions{flex-direction:column}
    }
  </style>
</head>

<body>
  <div class="bg-effects"><div class="bg-gradient"></div></div>

  <!-- Floating Buttons -->
  <div class="floating-buttons-container">
    <button class="floating-button settings" onclick="openSettingsModal()" title="Einstellungen">
      <i class="fas fa-cog"></i>
    </button>
    <button class="floating-button ankundigung" onclick="openAnkundigungModal()" title="AnkÃ¼ndigungen">
      ðŸª§
    </button>
    <button class="floating-button soldaten" onclick="openSoldatenModal()" title="SoldatengesprÃ¤che">
      <i class="fas fa-comments"></i>
    </button>
    <button class="floating-button beobachtung" onclick="openBeobachtungAktenModal()" title="Beobachtungs-Akten">
      <i class="fas fa-folder-open"></i>
    </button>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal" onclick="if(event.target===this)closeModal('settingsModal')">
    <div class="settings-content">
      <div class="settings-header">
        <div class="settings-title">
          <i class="fas fa-cog"></i> Einstellungen
        </div>
        <button class="settings-close" onclick="closeModal('settingsModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-body">
        <div class="settings-tabs">
          <button class="settings-tab active" onclick="switchSettingsTab('units')">
            <i class="fas fa-building"></i> Units & RÃ¤nge
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('discord')">
            <i class="fab fa-discord"></i> Discord IDs
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('hr')">
            <i class="fas fa-users"></i> HR Rollen
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('audit')">
            <i class="fas fa-history"></i> Audit Log
          </button>
        </div>
        
        <!-- Units & RÃ¤nge Tab -->
        <div class="settings-tab-content" id="settingsUnitsTab">
          <div class="settings-form-grid">
            <div class="settings-form-group">
              <label class="settings-label">Neue Unit</label>
              <input type="text" class="settings-input" id="newUnitName" placeholder="Unit Name">
            </div>
            
            <div class="settings-form-group">
              <label class="settings-label">Neuer Rang</label>
              <input type="text" class="settings-input" id="newRankName" placeholder="Rang Name">
            </div>
          </div>
          
          <div class="settings-unit-list" id="unitsList">
            <!-- Units werden hier dynamisch geladen -->
          </div>
          
          <div class="settings-actions">
            <button class="settings-btn settings-btn-save" onclick="saveNewUnit()">
              <i class="fas fa-plus"></i> Unit hinzufÃ¼gen
            </button>
          </div>
        </div>
        
        <!-- Discord IDs Tab -->
        <div class="settings-tab-content" id="settingsDiscordTab" style="display:none;">
          <div class="settings-form-grid">
            <div class="settings-form-group">
              <label class="settings-label">Unit</label>
              <select class="settings-input" id="discordUnitSelect">
                <option value="">Unit auswÃ¤hlen</option>
                <!-- Options werden dynamisch geladen -->
              </select>
            </div>
            
            <div class="settings-form-group">
              <label class="settings-label">Discord Rollen-ID</label>
              <input type="text" class="settings-input" id="discordRoleId" placeholder="z.B. 123456789012345678">
            </div>
            
            <div class="settings-form-group">
              <label class="settings-label">Rang</label>
              <select class="settings-input" id="discordRankSelect">
                <option value="">Rang auswÃ¤hlen</option>
                <!-- Options werden dynamisch geladen -->
              </select>
            </div>
            
            <div class="settings-form-group">
              <label class="settings-label">Discord Rollen-ID</label>
              <input type="text" class="settings-input" id="discordRankRoleId" placeholder="z.B. 123456789012345678">
            </div>
          </div>
          
          <div class="settings-actions">
            <button class="settings-btn settings-btn-save" onclick="saveDiscordIds()">
              <i class="fas fa-save"></i> Discord IDs speichern
            </button>
          </div>
        </div>
        
        <!-- HR Rollen Tab -->
        <div class="settings-tab-content" id="settingsHrTab" style="display:none;">
          <div class="settings-form-grid">
            <div class="settings-form-group">
              <label class="settings-label">HR Discord Rollen-ID</label>
              <input type="text" class="settings-input" id="hrDiscordRoleId" placeholder="z.B. 1097625910242447422">
            </div>
            
            <div class="settings-form-group">
              <label class="settings-label">Webhook URL</label>
              <input type="text" class="settings-input" id="discordWebhookUrl" placeholder="https://discord.com/api/webhooks/...">
            </div>
          </div>
          
          <div class="settings-actions">
            <button class="settings-btn settings-btn-save" onclick="saveHrSettings()">
              <i class="fas fa-save"></i> HR Einstellungen speichern
            </button>
          </div>
        </div>
        
        <!-- Audit Log Tab -->
        <div class="settings-tab-content" id="settingsAuditTab" style="display:none;">
          <div class="settings-audit-log" id="auditLogList">
            <!-- Audit Log EintrÃ¤ge werden hier dynamisch geladen -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AnkÃ¼ndigungen/Besprechungen/Aufstellungen Modal -->
  <div class="ankundigung-modal" id="ankundigungModal" onclick="if(event.target===this)closeModal('ankundigungModal')">
    <div class="ankundigung-content">
      <div class="ankundigung-header">
        <div class="ankundigung-title">
          <i class="fas fa-bullhorn"></i> AnkÃ¼ndigungen & Besprechungen
        </div>
        <button class="ankundigung-close" onclick="closeModal('ankundigungModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="ankundigung-body">
        <div class="ankundigung-tabs">
          <button class="ankundigung-tab active" onclick="switchAnkundigungTab('new')">
            <span>ðŸª§</span> Neue AnkÃ¼ndigung
          </button>
          <button class="ankundigung-tab" onclick="switchAnkundigungTab('besprechung')">
            <span>ðŸ–Šï¸</span> Neue Besprechung
          </button>
          <button class="ankundigung-tab" onclick="switchAnkundigungTab('aufstellung')">
            <span>ðŸ•›</span> Neue Aufstellung
          </button>
          <button class="ankundigung-tab" onclick="switchAnkundigungTab('list')">
            <i class="fas fa-list"></i> Liste
          </button>
        </div>
        
        <!-- Neue AnkÃ¼ndigung Tab -->
        <div class="ankundigung-tab-content" id="ankundigungNewTab">
          <div class="ankundigung-form-grid">
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Titel</label>
              <input type="text" class="ankundigung-input" id="ankundigungTitle" placeholder="Titel der AnkÃ¼ndigung">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Inhalt *</label>
              <textarea class="ankundigung-input ankundigung-textarea" id="ankundigungContent" placeholder="Inhalt der AnkÃ¼ndigung..."></textarea>
            </div>
          </div>
          
          <div class="ankundigung-preview">
            <div class="ankundigung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="ankundigung-preview-content" id="ankundigungPreview">
ðŸª§ **AnkÃ¼ndigung**


            </div>
          </div>
          
          <div class="ankundigung-actions">
            <button class="ankundigung-btn ankundigung-btn-copy" onclick="copyAnkundigungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="ankundigung-btn ankundigung-btn-save" onclick="saveAnkundigung()">
              <i class="fas fa-save"></i> AnkÃ¼ndigung speichern
            </button>
          </div>
        </div>
        
        <!-- Neue Besprechung Tab -->
        <div class="ankundigung-tab-content" id="ankundigungBesprechungTab" style="display:none;">
          <div class="ankundigung-form-grid">
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Thema *</label>
              <input type="text" class="ankundigung-input" id="besprechungThema" placeholder="Thema der Besprechung">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Datum *</label>
              <input type="date" class="ankundigung-input" id="besprechungDate" value="">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Uhrzeit *</label>
              <input type="time" class="ankundigung-input" id="besprechungTime" value="">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Ort</label>
              <input type="text" class="ankundigung-input" id="besprechungOrt" placeholder="Ort der Besprechung">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Inhalt *</label>
              <textarea class="ankundigung-input ankundigung-textarea" id="besprechungContent" placeholder="Inhalt der Besprechung..."></textarea>
            </div>
          </div>
          
          <div class="ankundigung-preview">
            <div class="ankundigung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="ankundigung-preview-content" id="besprechungPreview">
ðŸ–Šï¸ **Besprechung**

Thema: 
Datum: 
Uhrzeit: 
Ort: 


            </div>
          </div>
          
          <div class="ankundigung-actions">
            <button class="ankundigung-btn ankundigung-btn-copy" onclick="copyBesprechungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="ankundigung-btn ankundigung-btn-save" onclick="saveBesprechung()">
              <i class="fas fa-save"></i> Besprechung speichern
            </button>
          </div>
        </div>
        
        <!-- Neue Aufstellung Tab -->
        <div class="ankundigung-tab-content" id="ankundigungAufstellungTab" style="display:none;">
          <div class="ankundigung-form-grid">
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Typ *</label>
              <select class="ankundigung-input" id="aufstellungTyp">
                <option value="">Typ auswÃ¤hlen</option>
                <option value="Tagesaufstellung">Tagesaufstellung</option>
                <option value="Wochenaufstellung">Wochenaufstellung</option>
                <option value="Sonderaufstellung">Sonderaufstellung</option>
              </select>
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Datum *</label>
              <input type="date" class="ankundigung-input" id="aufstellungDate" value="">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Uhrzeit *</label>
              <input type="time" class="ankundigung-input" id="aufstellungTime" value="">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Ort *</label>
              <input type="text" class="ankundigung-input" id="aufstellungOrt" placeholder="Ort der Aufstellung">
            </div>
            
            <div class="ankundigung-form-group">
              <label class="ankundigung-label">Bemerkungen</label>
              <textarea class="ankundigung-input ankundigung-textarea" id="aufstellungBemerkungen" placeholder="Bemerkungen zur Aufstellung..."></textarea>
            </div>
          </div>
          
          <div class="ankundigung-preview">
            <div class="ankundigung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="ankundigung-preview-content" id="aufstellungPreview">
ðŸ•› **Aufstellung**

Typ: 
Datum: 
Uhrzeit: 
Ort: 
Bemerkungen:

            </div>
          </div>
          
          <div class="ankundigung-actions">
            <button class="ankundigung-btn ankundigung-btn-copy" onclick="copyAufstellungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="ankundigung-btn ankundigung-btn-save" onclick="saveAufstellung()">
              <i class="fas fa-save"></i> Aufstellung speichern
            </button>
          </div>
        </div>
        
        <!-- Liste Tab -->
        <div class="ankundigung-tab-content" id="ankundigungListTab" style="display:none;">
          <div class="ankundigung-search-container">
            <i class="fas fa-search ankundigung-search-icon"></i>
            <input type="text" class="ankundigung-search-input" id="ankundigungSearch" placeholder="Nach Titel oder Inhalt suchen..." oninput="searchAnkundigungen(this.value)">
          </div>
          
          <div class="ankundigung-liste-container">
            <div class="ankundigung-liste" id="ankundigungListe">
              <div class="empty-ankundigung">
                <div class="empty-ankundigung-icon"><i class="fas fa-bullhorn"></i></div>
                <div class="empty-ankundigung-title">Keine EintrÃ¤ge gefunden</div>
                <div class="empty-description">Erstellen Sie Ihren ersten Eintrag</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SoldatengesprÃ¤ch Modal -->
  <div class="soldaten-modal" id="soldatenModal" onclick="if(event.target===this)closeModal('soldatenModal')">
    <div class="soldaten-content">
      <div class="soldaten-header">
        <div class="soldaten-title">
          <i class="fas fa-comments"></i> SoldatengesprÃ¤che
        </div>
        <button class="soldaten-close" onclick="closeModal('soldatenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="soldaten-body">
        <div class="soldaten-tabs">
          <button class="soldaten-tab active" onclick="switchSoldatenTab('new')">Neues GesprÃ¤ch</button>
          <button class="soldaten-tab" onclick="switchSoldatenTab('list')">GesprÃ¤chsliste</button>
        </div>
        
        <!-- Neues GesprÃ¤ch Tab -->
        <div class="soldaten-tab-content" id="soldatenNewTab">
          <div class="soldaten-form-grid">
            <div class="soldaten-form-group">
              <label class="soldaten-label">Name *</label>
              <input type="text" class="soldaten-input" id="soldatenName" placeholder="VollstÃ¤ndiger Name">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Dienstnummer (DN) *</label>
              <input type="number" class="soldaten-input" id="soldatenDN" placeholder="z.B. 43">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Hauptunit</label>
              <select class="soldaten-input" id="soldatenUnit">
                <option value="">Unit auswÃ¤hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Rang</label>
              <select class="soldaten-input" id="soldatenRank">
                <option value="">Rang auswÃ¤hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Datum *</label>
              <input type="date" class="soldaten-input" id="soldatenDate" value="">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Uhrzeit *</label>
              <input type="time" class="soldaten-input" id="soldatenTime" value="">
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Notizen *</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenNotizen" placeholder="Notizen zum GesprÃ¤ch..."></textarea>
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Sonstiges</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenSonstiges" placeholder="Weitere Informationen..."></textarea>
            </div>
          </div>
          
          <div class="soldaten-preview">
            <div class="soldaten-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="soldaten-preview-content" id="soldatenPreview">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
SoldatengesprÃ¤ch

Name: 
DN: 
Hauptunit: 
Rang: 
Datum:
Uhrzeit: 
Notizen:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            </div>
          </div>
          
          <div class="soldaten-actions">
            <button class="soldaten-btn soldaten-btn-copy" onclick="copySoldatenTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="soldaten-btn soldaten-btn-save" onclick="saveSoldatenGesprÃ¤ch()">
              <i class="fas fa-save"></i> GesprÃ¤ch speichern
            </button>
          </div>
        </div>
        
        <!-- GesprÃ¤chsliste Tab -->
        <div class="soldaten-tab-content" id="soldatenListTab" style="display:none;">
          <div class="soldaten-search-container">
            <i class="fas fa-search soldaten-search-icon"></i>
            <input type="text" class="soldaten-search-input" id="soldatenSearch" placeholder="Nach Name oder DN suchen..." oninput="searchSoldaten(this.value)">
          </div>
          
          <div class="soldaten-liste-container">
            <div class="soldaten-liste" id="soldatenListe">
              <div class="empty-soldaten">
                <div class="empty-soldaten-icon"><i class="fas fa-comments"></i></div>
                <div class="empty-soldaten-title">Keine GesprÃ¤che gefunden</div>
                <div class="empty-description">Erstellen Sie Ihr erstes SoldatengesprÃ¤ch</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Beobachtungs Akten Modal -->
  <div class="beobachtung-akten-modal" id="beobachtungAktenModal" onclick="if(event.target===this)closeModal('beobachtungAktenModal')">
    <div class="beobachtung-akten-content">
      <div class="beobachtung-akten-header">
        <div class="beobachtung-akten-title">
          <i class="fas fa-folder-open"></i> Beobachtungs-Akten
        </div>
        <button class="beobachtung-akten-close" onclick="closeModal('beobachtungAktenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="beobachtung-akten-body">
        <div class="beobachtung-tabs">
          <button class="beobachtung-tab active" onclick="switchBeobachtungTab('new')">Neue Akte erstellen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('list')">Akten durchsuchen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('beobachtung')">Beobachtung hinzufÃ¼gen</button>
        </div>
        
        <!-- Neue Akte erstellen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungNewTab">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="akteName" placeholder="VollstÃ¤ndiger Name">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="akteDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Unit</label>
              <select class="akte-input" id="akteUnit">
                <option value="">Unit auswÃ¤hlen</option>
              </select>
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Rang</label>
              <select class="akte-input" id="akteRank">
                <option value="">Rang auswÃ¤hlen</option>
              </select>
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-save" onclick="createNewAkte()">
              <i class="fas fa-plus"></i> Neue Akte erstellen
            </button>
          </div>
        </div>
        
        <!-- Akten durchsuchen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungListTab" style="display:none;">
          <div class="akten-search-container">
            <i class="fas fa-search akten-search-icon"></i>
            <input type="text" class="akten-search-input" id="aktenSearch" placeholder="Nach Name oder DN suchen..." oninput="searchAkten(this.value)">
          </div>
          
          <div class="beobachtung-akten-liste" id="aktenListe">
            <div class="empty-beobachtungen">
              <div class="empty-beobachtungen-icon"><i class="fas fa-folder-open"></i></div>
              <div class="empty-beobachtungen-title">Keine Akten gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Akte</div>
            </div>
          </div>
        </div>
        
        <!-- Beobachtung hinzufÃ¼gen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungBeobachtungTab" style="display:none;">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="beobachtungName" placeholder="Name der Person">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="beobachtungDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group" style="grid-column: span 2;">
              <label class="akte-label">Grund der Beobachtung *</label>
              <textarea class="akte-input akte-textarea" id="beobachtungGrund" placeholder="Beschreiben Sie den Grund der Beobachtung..."></textarea>
            </div>
          </div>
          
          <div class="beobachtung-preview">
            <div class="beobachtung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="beobachtung-preview-content" id="beobachtungPreview">
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: 
DN:  
Grund:
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-copy" onclick="copyBeobachtungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="beobachtung-btn beobachtung-btn-save" onclick="saveBeobachtungToAkte()">
              <i class="fas fa-save"></i> Zu Akte hinzufÃ¼gen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check notification-icon"></i>
    <span class="notification-message" id="notificationMessage"></span>
  </div>

  <div class="app-container">
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <div class="logo">
            <i class="fas fa-user-check"></i>
          </div>
          <div class="brand-text">
            <h1>Human Resources v2.0</h1>
            <div class="subtitle">â€¢ Soft Delete â€¢ Audit Log â€¢ Archivierung</div>
          </div>
        </div>
        <div class="header-stats">
          <!-- GEÃ„NDERT: "Mitarbeiter" statt "Aktiv" -->
          <div class="stat-card">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Mitarbeiter</div>
          </div>
          <!-- GEÃ„NDERT: "Archiviert" durch "Beobachtung" ersetzt -->
          <div class="stat-card">
            <div class="stat-value" id="totalBeobachtungen">0</div>
            <div class="stat-label">Beobachtung</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalDeleted">0</div>
            <div class="stat-label">GelÃ¶scht</div>
          </div>
        </div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title"><i class="fas fa-users"></i> Mitarbeiter</h3>
        <div class="employee-count" id="employeeCount">0</div>
      </div>

      <div class="sidebar-controls">
        <!-- GEÃ„NDERT: Status-Filter - "Mitarbeiter" statt "Aktiv" und "Beobachtung" statt "Archiviert" -->
        <div class="status-filter">
          <button class="status-filter-btn active" onclick="filterByStatus('active')">Mitarbeiter</button>
          <button class="status-filter-btn" onclick="filterByStatus('archived')">Beobachtung</button>
          <button class="status-filter-btn" onclick="filterByStatus('deleted')">GelÃ¶scht</button>
        </div>

        <div class="sidebar-filter-buttons">
          <button class="sidebar-filter-btn active" onclick="filterEmployeesByType('all')">Alle</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('oral')">MÃ¼ndlich</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('org')">Organisatorisch</button>
        </div>

        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchEmployees" placeholder="Nach Namen oder DN suchen...">
        </div>
      </div>

      <div class="employee-list-container">
        <div class="employee-list" id="employeeList">
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">Keine Mitarbeiter</div>
            <div class="empty-description">FÃ¼gen Sie Ihren ersten Mitarbeiter hinzu</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="openNewEmployeeModal()">
          <i class="fas fa-user-plus"></i> Neuer Mitarbeiter
        </button>
        <!-- GEÃ„NDERT: "Archiv anzeigen" durch "Beobachtung anzeigen" -->
        <button class="quick-action-btn" onclick="toggleBeobachtungFilter()" id="toggleBeobachtungBtn">
          <i class="fas fa-eye"></i> Beobachtung anzeigen
        </button>
      </div>
    </aside>

    <main class="main-content">
      <div class="content-header" id="employeeHeader">
        <div class="employee-info">
          <h2 id="currentEmployeeName">WÃ¤hlen Sie einen Mitarbeiter</h2>
          <div class="employee-tags">
            <div class="employee-tag"><i class="fas fa-hashtag"></i> <span class="tag-value" id="currentEmployeeDN">DN-</span></div>
            <div class="employee-tag"><i class="fas fa-building"></i> <span class="tag-value" id="currentEmployeeUnit">Unit</span></div>
            <div class="employee-tag"><i class="fas fa-user-tie"></i> <span class="tag-value" id="currentEmployeeRank">Rang</span></div>
            <div class="employee-tag"><i class="fas fa-info-circle"></i> <span class="tag-value" id="currentEmployeeStatus">Status</span></div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="openEditEmployeeModal()"><i class="fas fa-edit"></i> Bearbeiten</button>
          <!-- GEÃ„NDERT: "Archivieren" durch "Beobachtung" -->
          <button class="btn btn-archived" onclick="toggleBeobachtungEmployee()"><i class="fas fa-eye"></i> Beobachtung</button>
          <button class="btn btn-danger" onclick="softDeleteEmployee()"><i class="fas fa-trash"></i> LÃ¶schen</button>
        </div>
      </div>

      <div class="induction-content" id="inductionContent">
        <div class="induction-grid">
          <div class="induction-card" id="oralInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-comments"></i></div>
                MÃ¼ndliche Einweisung
              </div>
              <div class="induction-status" id="oralInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="oralInductionToggle" onchange="toggleInduction('oral', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="oral-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="oralDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="oralTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="oralTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="oralPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect">
                  <option value="">Unit auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect">
                  <option value="">Rang auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="oralNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>

          <div class="induction-card" id="orgInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-clipboard-list"></i></div>
                Organisatorische Einweisung
              </div>
              <div class="induction-status" id="orgInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px;">
              <label style="font-weight:800;color:var(--gray);font-size:12px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="orgInductionToggle" onchange="toggleInduction('org', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="org-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="orgDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="orgTimeStart">
                  <div class="time-separator">-</div>
                  <input type="time" class="form-input" id="orgTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="orgPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect2">
                  <option value="">Unit auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect2">
                  <option value="">Rang auswÃ¤hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="orgNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <div class="section-header">
            <div class="section-title"><i class="fas fa-file-code"></i> Discord Vorlagen</div>
            <div class="template-actions">
              <button class="btn btn-secondary" onclick="copyOralTemplate()"><i class="fas fa-comments"></i> MÃ¼ndlich</button>
              <button class="btn btn-secondary" onclick="copyOrgTemplate()"><i class="fas fa-clipboard-list"></i> Organisatorisch</button>
              <button class="btn btn-secondary" onclick="copyAuditToDiscord()"><i class="fab fa-discord"></i> Audit an Discord</button>
            </div>
          </div>

          <div class="template-cards">
            <div class="template-card" id="oralTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-comments"></i> MÃ¼ndliche Einweisung</div>
                <div class="template-badge" id="oralTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="oralTemplateContent"></div>
            </div>

            <div class="template-card" id="orgTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-clipboard-list"></i> Organisatorische Einweisung</div>
                <div class="template-badge" id="orgTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="orgTemplateContent"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal" onclick="if(event.target===this)closeModal('newEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-user-plus"></i> Neuen Mitarbeiter hinzufÃ¼gen</div>
        <button class="modal-close" onclick="closeModal('newEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div class="form-group">
          <label class="form-label">VollstÃ¤ndiger Name *</label>
          <input type="text" class="form-input" id="newEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="newEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="newEmployeeUnit">
            <option value="">Unit auswÃ¤hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="newEmployeeRank">
            <option value="">Rang auswÃ¤hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:16px;">
        <button class="btn btn-secondary" onclick="closeModal('newEmployeeModal')">Abbrechen</button>
        <button class="btn btn-primary" onclick="createNewEmployee()"><i class="fas fa-plus"></i> Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal" onclick="if(event.target===this)closeModal('editEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-edit"></i> Mitarbeiter bearbeiten</div>
        <button class="modal-close" onclick="closeModal('editEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:16px;">
        <div class="form-group">
          <label class="form-label">VollstÃ¤ndiger Name *</label>
          <input type="text" class="form-input" id="editEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="editEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="editEmployeeUnit">
            <option value="">Unit auswÃ¤hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="editEmployeeRank">
            <option value="">Rang auswÃ¤hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:16px;">
        <button class="btn btn-danger" onclick="permanentlyDeleteEmployee()" style="margin-right:auto;"><i class="fas fa-skull-crossbones"></i> EndgÃ¼ltig lÃ¶schen</button>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-secondary" onclick="closeModal('editEmployeeModal')">Abbrechen</button>
          <button class="btn btn-primary" onclick="saveEditedEmployee()"><i class="fas fa-save"></i> Ã„nderungen speichern</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== CACHE-BUSTING CODE ====================
    const APP_VERSION = '2.0.20240128';
    const LAST_VERSION_KEY = 'hr_app_last_version';
    
    const lastVersion = localStorage.getItem(LAST_VERSION_KEY);
    if (lastVersion !== APP_VERSION) {
      console.log(`Neue Version erkannt: ${lastVersion} -> ${APP_VERSION}`);
      
      if ('caches' in window) {
        caches.keys().then(function(names) {
          for (let name of names) {
            caches.delete(name);
          }
          console.log('Service Worker Caches gelÃ¶scht');
        });
      }
      
      localStorage.setItem(LAST_VERSION_KEY, APP_VERSION);
      
      if (performance.navigation.type === 0 || performance.navigation.type === 1) {
        console.log('Erzwinge Hard Refresh fÃ¼r neue Version');
        setTimeout(() => {
          window.location.reload(true);
        }, 100);
      }
    }
    
    document.addEventListener('DOMContentLoaded', function() {
      document.title = document.title.replace('v1.0', `v${APP_VERSION}`);
      
      const now = Date.now();
      const cacheBuster = `?v=${APP_VERSION}&t=${now}`;
      
      const scripts = document.querySelectorAll('script[src]');
      scripts.forEach(script => {
        if (!script.src.includes('?v=')) {
          script.src = script.src + cacheBuster;
        }
      });
      
      initializeApp();
    });
    // ==================== ENDE CACHE-BUSTING ====================

    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBTnsLNw68UuOd5Xa2ymMffWk4SYGDQjso",
      authDomain: "cc-shop-finanzsystem.firebaseapp.com",
      projectId: "cc-shop-finanzsystem",
      storageBucket: "cc-shop-finanzsystem.firebasestorage.app",
      messagingSenderId: "575918945925",
      appId: "1:575918945925:web:bf9d973d5cd9fc547e5bec",
      measurementId: "G-9SZREFTJS6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Discord Webhook URL
    const DEFAULT_DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1465894064980365363/Tls9jtrEkn8oK3jpIqImiNWI1ljF5EVnSQaswJZ8WpQ9HVwCgpbajxzgEu19jPzRUYuK";

    // App State
    let currentEmployee = null;
    let employees = [];
    let settings = {
      units: [],
      ranks: [],
      unitDiscordIds: {},
      rankDiscordIds: {},
      hrDiscordRoleId: "1097625910242447422",
      discordWebhookUrl: DEFAULT_DISCORD_WEBHOOK_URL
    };
    let auditLogs = [];
    let currentFilter = 'all';
    let currentStatusFilter = 'active';
    let showArchived = false;
    let showDeleted = false;
    let unsubscribeFunctions = [];
    
    let akten = [];
    let soldatenGesprÃ¤che = [];
    let ankundigungen = [];
    let currentBeobachtungTab = 'new';
    let currentSoldatenTab = 'new';
    let currentAnkundigungTab = 'new';

    // ==================== INITIALISIERUNG ====================
    function initializeApp() {
      console.log(`HR App Version ${APP_VERSION} geladen`);
      
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('oralDate').value = today;
      document.getElementById('orgDate').value = today;
      document.getElementById('soldatenDate').value = today;
      document.getElementById('besprechungDate').value = today;
      document.getElementById('aufstellungDate').value = today;

      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      document.getElementById('soldatenTime').value = `${hours}:${minutes}`;
      document.getElementById('besprechungTime').value = `${hours}:${minutes}`;
      document.getElementById('aufstellungTime').value = `${hours}:${minutes}`;

      document.getElementById('oralTimeStart').value = '16:40';
      document.getElementById('oralTimeEnd').value = '18:00';
      document.getElementById('orgTimeStart').value = '22:10';
      document.getElementById('orgTimeEnd').value = '23:05';

      setupEventListeners();
      updateStats();
      adjustSidebarHeight();
      setupRealtimeListeners();
      loadSettings();
      
      setupFormChangeListeners();
      seedTemplateBoxes();
      setupBeobachtungEventListeners();
      setupSoldatenEventListeners();
      setupAnkundigungEventListeners();
      
      // Starte Echtzeit-Update-Listener
      startRealtimeUpdates();
    }

    // ==================== ECHTZEIT-UPDATES ====================
    // Diese Funktion startet alle Listener fÃ¼r Echtzeit-Updates
    function startRealtimeUpdates() {
      setupRealtimeListeners();
      
      // Spezielle Listener fÃ¼r FormularÃ¤nderungen
      setupFormRealtimeListeners();
    }

    // Diese Funktion setzt Listener fÃ¼r FormularÃ¤nderungen
    function setupFormRealtimeListeners() {
      // Listener fÃ¼r alle Formular-Inputs
      const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea, .toggle-switch input');
      
      formInputs.forEach(input => {
        // Entferne alte Event-Listener
        const newInput = input.cloneNode(true);
        input.parentNode.replaceChild(newInput, input);
        
        // FÃ¼ge neuen Event-Listener hinzu
        newInput.addEventListener('input', function() {
          // Speichere den Wert im localStorage mit Timestamp
          const inputId = this.id;
          const inputValue = this.value;
          const isChecked = this.type === 'checkbox' ? this.checked : null;
          
          const data = {
            value: inputValue,
            checked: isChecked,
            timestamp: Date.now(),
            employeeId: currentEmployee ? currentEmployee.id : null
          };
          
          localStorage.setItem(`hr_form_${inputId}`, JSON.stringify(data));
          
          // Trigger fÃ¼r andere Tabs
          window.dispatchEvent(new CustomEvent('formDataChanged', {
            detail: { inputId, data }
          }));
          
          // Auto-save nach 5 Sekunden InaktivitÃ¤t
          clearTimeout(window.formSaveTimeout);
          window.formSaveTimeout = setTimeout(() => {
            if (currentEmployee) {
              saveEmployeeData(true);
              showNotification('Ã„nderungen gespeichert', 'success');
            }
          }, 5000);
        });
        
        newInput.addEventListener('change', function() {
          if (currentEmployee) {
            handleFormChange();
          }
        });
      });
    }

    // Listener fÃ¼r formDataChanged Event (wird von anderen Tabs ausgelÃ¶st)
    window.addEventListener('formDataChanged', function(e) {
      const { inputId, data } = e.detail;
      
      // PrÃ¼fe ob die Daten Ã¤lter als 1 Sekunde sind (um eigene Ã„nderungen zu ignorieren)
      if (Date.now() - data.timestamp > 1000) {
        const inputElement = document.getElementById(inputId);
        if (inputElement) {
          if (inputElement.type === 'checkbox') {
            inputElement.checked = data.checked;
          } else {
            inputElement.value = data.value;
          }
          
          // Trigger change event
          const event = new Event('change', { bubbles: true });
          inputElement.dispatchEvent(event);
        }
      }
    });

    // PrÃ¼fe regelmÃ¤ÃŸig auf Ã„nderungen in localStorage (fÃ¼r Cross-Tab Kommunikation)
    function checkForExternalChanges() {
      const keys = Object.keys(localStorage).filter(key => key.startsWith('hr_form_'));
      
      keys.forEach(key => {
        const dataStr = localStorage.getItem(key);
        if (dataStr) {
          try {
            const data = JSON.parse(dataStr);
            const inputId = key.replace('hr_form_', '');
            
            // Wenn die Daten jÃ¼nger als 10 Sekunden sind und von einem anderen Tab stammen
            if (Date.now() - data.timestamp < 10000) {
              const inputElement = document.getElementById(inputId);
              if (inputElement && 
                  ((inputElement.type === 'checkbox' && inputElement.checked !== data.checked) ||
                   (inputElement.type !== 'checkbox' && inputElement.value !== data.value))) {
                
                // Update das Input-Feld
                if (inputElement.type === 'checkbox') {
                  inputElement.checked = data.checked;
                } else {
                  inputElement.value = data.value;
                }
                
                // Trigger change event
                const event = new Event('change', { bubbles: true });
                inputElement.dispatchEvent(event);
              }
            }
          } catch (e) {
            console.error('Fehler beim Parsen von localStorage Daten:', e);
          }
        }
      });
    }

    // Starte regelmÃ¤ÃŸige PrÃ¼fung auf externe Ã„nderungen
    setInterval(checkForExternalChanges, 2000);

    // ==================== REALTIME LISTENER SETUP ====================
    function setupRealtimeListeners() {
      // Listener fÃ¼r Mitarbeiter mit Status-Filter
      const unsubscribeEmployees = db.collection('hrEmployees')
        .orderBy('lastUpdated', 'desc')
        .onSnapshot((snapshot) => {
          employees = [];
          
          snapshot.forEach(doc => {
            const data = doc.data();
            employees.push({ 
              id: doc.id, 
              ...data,
              status: data.status || 'active',
              isDeleted: data.isDeleted || false,
              archived: data.archived || false,
              deletedAt: data.deletedAt || null,
              archivedAt: data.archivedAt || null,
              deletedBy: data.deletedBy || null,
              archivedBy: data.archivedBy || null
            });
          });

          renderEmployeeList();
          updateStats();
          
          if (currentEmployee) {
            const updatedEmployee = employees.find(emp => emp.id === currentEmployee.id);
            if (updatedEmployee) {
              selectEmployee(updatedEmployee);
            }
          }
          
          setTimeout(updateInductionDisplay, 100);
        }, (error) => {
          console.error('Fehler beim Lauschen auf Mitarbeiter-Ã„nderungen:', error);
          showNotification('Fehler bei Live-Updates', 'error');
        });

      // Listener fÃ¼r Settings
      const unsubscribeSettings = db.collection('hrSettings').doc('settings')
        .onSnapshot((doc) => {
          if (doc.exists) {
            const data = doc.data();
            settings = { ...settings, ...data };
            updateSettingsUI();
            updateUnitAndRankSelects();
          }
        }, (error) => {
          console.error('Fehler beim Lauschen auf Settings:', error);
        });

      // Listener fÃ¼r Audit Log
      const unsubscribeAuditLog = db.collection('hrAuditLog')
        .orderBy('timestamp', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          auditLogs = [];
          snapshot.forEach(doc => {
            auditLogs.push({ 
              id: doc.id, 
              ...doc.data(),
              timestampFormatted: doc.data().timestamp ? 
                new Date(doc.data().timestamp.toDate()).toLocaleString('de-DE') : 
                new Date().toLocaleString('de-DE')
            });
          });
          renderAuditLog();
        }, (error) => {
          console.error('Fehler beim Lauschen auf Audit Log:', error);
        });

      // Listener fÃ¼r Akten
      const unsubscribeAkten = db.collection('hrAkten')
        .orderBy('lastUpdated', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          akten = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            akten.push({ 
              id: doc.id, 
              ...data,
              createdFormatted: data.createdFormatted || new Date(data.created).toLocaleDateString('de-DE')
            });
          });
        }, (error) => {
          console.error('Fehler beim Lauschen auf Akten-Ã„nderungen:', error);
        });

      // Listener fÃ¼r SoldatengesprÃ¤che
      const unsubscribeSoldaten = db.collection('hrSoldatenGesprÃ¤che')
        .orderBy('created', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          soldatenGesprÃ¤che = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            soldatenGesprÃ¤che.push({ 
              id: doc.id, 
              ...data,
              createdFormatted: data.createdFormatted || new Date(data.created).toLocaleDateString('de-DE'),
              dateFormatted: data.dateFormatted || (data.date ? new Date(data.date).toLocaleDateString('de-DE') : '')
            });
          });
        }, (error) => {
          console.error('Fehler beim Lauschen auf SoldatengesprÃ¤che:', error);
        });

      // Listener fÃ¼r AnkÃ¼ndigungen
      const unsubscribeAnkundigungen = db.collection('hrAnkundigungen')
        .orderBy('created', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          ankundigungen = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            ankundigungen.push({ 
              id: doc.id, 
              ...data,
              createdFormatted: data.createdFormatted || new Date(data.created).toLocaleDateString('de-DE'),
              dateFormatted: data.dateFormatted || (data.date ? new Date(data.date).toLocaleDateString('de-DE') : '')
            });
          });
        }, (error) => {
          console.error('Fehler beim Lauschen auf AnkÃ¼ndigungen:', error);
        });

      unsubscribeFunctions = [
        unsubscribeEmployees,
        unsubscribeSettings,
        unsubscribeAuditLog,
        unsubscribeAkten,
        unsubscribeSoldaten,
        unsubscribeAnkundigungen
      ];
    }

    function cleanupRealtimeListeners() {
      unsubscribeFunctions.forEach(unsubscribe => {
        if (typeof unsubscribe === 'function') {
          unsubscribe();
        }
      });
      unsubscribeFunctions = [];
    }

    window.addEventListener('beforeunload', cleanupRealtimeListeners);

    // ==================== SETTINGS FUNKTIONEN ====================
    async function loadSettings() {
      try {
        const doc = await db.collection('hrSettings').doc('settings').get();
        if (doc.exists) {
          const data = doc.data();
          settings = { ...settings, ...data };
          updateSettingsUI();
          updateUnitAndRankSelects();
        } else {
          // Default Settings erstellen
          const defaultSettings = {
            units: ["Air Force", "S.O.C", "Infantry", "Military Police", "Navy Marine", "Navy SEALs"],
            ranks: ["Private", "Private First Class", "Specialist", "Corporal", "Sergeant", "Staff Sergeant", 
                   "Sergeant First Class", "Master Sergeant", "Sergeant Major", "Lieutenant", "Captain", 
                   "Major", "Colonel", "Major General", "Lieutenant General", "Vice General of Army", "General of Army"],
            unitDiscordIds: {},
            rankDiscordIds: {},
            hrDiscordRoleId: "1097625910242447422",
            discordWebhookUrl: DEFAULT_DISCORD_WEBHOOK_URL
          };
          
          await db.collection('hrSettings').doc('settings').set(defaultSettings);
          settings = defaultSettings;
          updateSettingsUI();
          updateUnitAndRankSelects();
        }
      } catch (error) {
        console.error('Fehler beim Laden der Settings:', error);
        showNotification('Fehler beim Laden der Einstellungen', 'error');
      }
    }

    function openSettingsModal() {
      openModal('settingsModal');
      updateSettingsUI();
      renderUnitsList();
      renderAuditLog();
    }

    function closeSettingsModal() {
      closeModal('settingsModal');
    }

    function switchSettingsTab(tabName) {
      document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      const tabIndex = ['units', 'discord', 'hr', 'audit'].indexOf(tabName);
      document.querySelectorAll('.settings-tab')[tabIndex].classList.add('active');
      
      document.querySelectorAll('.settings-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      
      document.getElementById(`settings${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).style.display = 'block';
    }

    function updateSettingsUI() {
      document.getElementById('hrDiscordRoleId').value = settings.hrDiscordRoleId || '';
      document.getElementById('discordWebhookUrl').value = settings.discordWebhookUrl || DEFAULT_DISCORD_WEBHOOK_URL;
      
      // Unit Select im Discord Tab fÃ¼llen
      const unitSelect = document.getElementById('discordUnitSelect');
      unitSelect.innerHTML = '<option value="">Unit auswÃ¤hlen</option>';
      settings.units.forEach(unit => {
        const option = document.createElement('option');
        option.value = unit;
        option.textContent = unit;
        unitSelect.appendChild(option);
      });
      
      // Rank Select im Discord Tab fÃ¼llen
      const rankSelect = document.getElementById('discordRankSelect');
      rankSelect.innerHTML = '<option value="">Rang auswÃ¤hlen</option>';
      settings.ranks.forEach(rank => {
        const option = document.createElement('option');
        option.value = rank;
        option.textContent = rank;
        rankSelect.appendChild(option);
      });
    }

    function renderUnitsList() {
      const container = document.getElementById('unitsList');
      
      if (!settings.units || settings.units.length === 0) {
        container.innerHTML = `
          <div class="empty-settings">
            <div class="empty-settings-icon"><i class="fas fa-building"></i></div>
            <div class="empty-settings-title">Keine Units definiert</div>
            <div class="empty-description">FÃ¼gen Sie Ihre erste Unit hinzu</div>
          </div>
        `;
        return;
      }

      let html = '';
      settings.units.forEach(unit => {
        const discordId = settings.unitDiscordIds[unit] || '';
        
        html += `
          <div class="settings-unit-item">
            <div class="settings-unit-name">${escapeHtml(unit)}</div>
            <div style="display: flex; align-items: center; gap: 12px;">
              ${discordId ? `<div class="settings-unit-discord">${discordId}</div>` : ''}
              <div class="settings-unit-actions">
                <button class="settings-unit-btn settings-unit-btn-edit" onclick="editUnit('${escapeHtml(unit)}')">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="settings-unit-btn settings-unit-btn-delete" onclick="deleteUnit('${escapeHtml(unit)}')">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    async function saveNewUnit() {
      const unitName = document.getElementById('newUnitName').value.trim();
      const rankName = document.getElementById('newRankName').value.trim();
      
      if (!unitName && !rankName) {
        showNotification('Bitte geben Sie eine Unit oder einen Rang ein', 'warning');
        return;
      }
      
      try {
        if (unitName) {
          if (!settings.units.includes(unitName)) {
            settings.units.push(unitName);
          }
        }
        
        if (rankName) {
          if (!settings.ranks.includes(rankName)) {
            settings.ranks.push(rankName);
          }
        }
        
        await db.collection('hrSettings').doc('settings').update({
          units: settings.units,
          ranks: settings.ranks
        });
        
        document.getElementById('newUnitName').value = '';
        document.getElementById('newRankName').value = '';
        
        updateUnitAndRankSelects();
        renderUnitsList();
        showNotification('Unit/Rang hinzugefÃ¼gt', 'success');
        
        // Audit Log erstellen
        await createAuditLog('create', 'settings', unitName || rankName, `${unitName ? 'Unit' : 'Rang'} erstellt`);
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function deleteUnit(unitName) {
      if (!confirm(`Unit "${unitName}" wirklich lÃ¶schen?`)) return;
      
      try {
        settings.units = settings.units.filter(u => u !== unitName);
        delete settings.unitDiscordIds[unitName];
        
        await db.collection('hrSettings').doc('settings').update({
          units: settings.units,
          unitDiscordIds: settings.unitDiscordIds
        });
        
        updateUnitAndRankSelects();
        renderUnitsList();
        showNotification('Unit gelÃ¶scht', 'success');
        
        // Audit Log erstellen
        await createAuditLog('delete', 'settings', unitName, 'Unit gelÃ¶scht');
      } catch (error) {
        console.error('Fehler beim LÃ¶schen:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    function editUnit(unitName) {
      const discordId = prompt(`Discord Rollen-ID fÃ¼r "${unitName}" eingeben:`, settings.unitDiscordIds[unitName] || '');
      
      if (discordId !== null) {
        saveUnitDiscordId(unitName, discordId);
      }
    }

    async function saveUnitDiscordId(unitName, discordId) {
      try {
        settings.unitDiscordIds[unitName] = discordId.trim();
        
        await db.collection('hrSettings').doc('settings').update({
          unitDiscordIds: settings.unitDiscordIds
        });
        
        renderUnitsList();
        showNotification('Discord ID gespeichert', 'success');
        
        // Audit Log erstellen
        await createAuditLog('update', 'settings', unitName, `Discord ID fÃ¼r Unit aktualisiert: ${discordId}`);
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveDiscordIds() {
      const unit = document.getElementById('discordUnitSelect').value;
      const unitDiscordId = document.getElementById('discordRoleId').value.trim();
      const rank = document.getElementById('discordRankSelect').value;
      const rankDiscordId = document.getElementById('discordRankRoleId').value.trim();
      
      try {
        if (unit && unitDiscordId) {
          settings.unitDiscordIds[unit] = unitDiscordId;
        }
        
        if (rank && rankDiscordId) {
          settings.rankDiscordIds[rank] = rankDiscordId;
        }
        
        await db.collection('hrSettings').doc('settings').update({
          unitDiscordIds: settings.unitDiscordIds,
          rankDiscordIds: settings.rankDiscordIds
        });
        
        document.getElementById('discordRoleId').value = '';
        document.getElementById('discordRankRoleId').value = '';
        
        renderUnitsList();
        showNotification('Discord IDs gespeichert', 'success');
        
        // Audit Log erstellen
        await createAuditLog('update', 'settings', 'discord_ids', 'Discord IDs aktualisiert');
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveHrSettings() {
      const hrDiscordRoleId = document.getElementById('hrDiscordRoleId').value.trim();
      const discordWebhookUrl = document.getElementById('discordWebhookUrl').value.trim();
      
      try {
        settings.hrDiscordRoleId = hrDiscordRoleId;
        settings.discordWebhookUrl = discordWebhookUrl;
        
        await db.collection('hrSettings').doc('settings').update({
          hrDiscordRoleId: hrDiscordRoleId,
          discordWebhookUrl: discordWebhookUrl
        });
        
        showNotification('HR Einstellungen gespeichert', 'success');
        
        // Audit Log erstellen
        await createAuditLog('update', 'settings', 'hr_settings', 'HR Einstellungen aktualisiert');
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderAuditLog() {
      const container = document.getElementById('auditLogList');
      
      if (auditLogs.length === 0) {
        container.innerHTML = `
          <div class="empty-settings">
            <div class="empty-settings-icon"><i class="fas fa-history"></i></div>
            <div class="empty-settings-title">Keine Audit Log EintrÃ¤ge</div>
            <div class="empty-description">Ã„nderungen werden hier protokolliert</div>
          </div>
        `;
        return;
      }

      let html = '';
      auditLogs.forEach(log => {
        const actionIcon = log.action === 'create' ? 'fa-plus' : 
                          log.action === 'update' ? 'fa-edit' : 
                          log.action === 'delete' ? 'fa-trash' : 
                          log.action === 'archive' ? 'fa-archive' : 'fa-info-circle';
        
        const actionColor = log.action === 'create' ? 'var(--secondary)' : 
                           log.action === 'update' ? 'var(--warning)' : 
                           log.action === 'delete' ? 'var(--danger)' : 
                           log.action === 'archive' ? 'var(--archived)' : 'var(--primary)';
        
        html += `
          <div class="settings-audit-item" style="border-left-color: ${actionColor}">
            <div class="settings-audit-header">
              <div class="settings-audit-action">
                <i class="fas ${actionIcon}"></i> ${getActionText(log.action)}
              </div>
              <div class="settings-audit-entity">
                ${escapeHtml(log.entityType)}: ${escapeHtml(log.entityId)}
              </div>
            </div>
            <div class="settings-audit-info">
              <i class="fas fa-user"></i> <span class="settings-audit-user">${escapeHtml(log.user || 'System')}</span>
              <i class="fas fa-clock"></i> <span class="settings-audit-timestamp">${log.timestampFormatted}</span>
            </div>
            ${log.details ? `<div style="color: var(--gray-light); font-size: 12px; margin-top: 4px;">${escapeHtml(log.details)}</div>` : ''}
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function getActionText(action) {
      const actions = {
        'create': 'Erstellt',
        'update': 'Aktualisiert',
        'delete': 'GelÃ¶scht',
        'archive': 'Archiviert',
        'restore': 'Wiederhergestellt'
      };
      return actions[action] || action;
    }

    // ==================== AUDIT LOG FUNKTIONEN ====================
    async function createAuditLog(action, entityType, entityId, details = '', user = getCurrentUser()) {
      try {
        const auditLog = {
          action,
          entityType,
          entityId,
          user,
          details,
          timestamp: firebase.firestore.FieldValue.serverTimestamp(),
          timestampFormatted: new Date().toLocaleString('de-DE')
        };
        
        await db.collection('hrAuditLog').add(auditLog);
        
        // Discord Webhook senden
        sendAuditToDiscord(auditLog);
        
        console.log('Audit Log erstellt:', auditLog);
      } catch (error) {
        console.error('Fehler beim Erstellen des Audit Logs:', error);
      }
    }

    function getCurrentUser() {
      // In einer echten App wÃ¼rde man hier den eingeloggten Benutzer verwenden
      // FÃ¼r dieses Beispiel verwenden wir einen simulierten Benutzer
      return localStorage.getItem('hr_current_user') || 'Admin';
    }

    async function sendAuditToDiscord(auditLog) {
      if (!settings.discordWebhookUrl) return;
      
      const embed = {
        title: `ðŸ“ HR Audit Log: ${getActionText(auditLog.action)}`,
        description: `**Typ:** ${auditLog.entityType}\n**ID:** ${auditLog.entityId}\n**Benutzer:** ${auditLog.user}\n**Details:** ${auditLog.details}`,
        color: getDiscordColorForAction(auditLog.action),
        timestamp: new Date().toISOString(),
        footer: {
          text: 'HR Management System'
        }
      };
      
      const payload = {
        embeds: [embed]
      };
      
      try {
        const response = await fetch(settings.discordWebhookUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        
        if (!response.ok) {
          console.error('Fehler beim Senden an Discord:', await response.text());
        }
      } catch (error) {
        console.error('Fehler beim Senden an Discord:', error);
      }
    }

    function getDiscordColorForAction(action) {
      const colors = {
        'create': 0x10b981, // GrÃ¼n
        'update': 0xf59e0b, // Orange
        'delete': 0xef4444, // Rot
        'archive': 0x6b7280, // Grau
        'restore': 0x8b5cf6  // Lila
      };
      return colors[action] || 0x4f46e5; // Default: Indigo
    }

    async function copyAuditToDiscord() {
      if (auditLogs.length === 0) {
        showNotification('Keine Audit Log EintrÃ¤ge zum Senden', 'warning');
        return;
      }
      
      const latestLogs = auditLogs.slice(0, 5); // Letzten 5 EintrÃ¤ge senden
      
      for (const log of latestLogs) {
        await sendAuditToDiscord(log);
      }
      
      showNotification(`${latestLogs.length} Audit Log EintrÃ¤ge an Discord gesendet`, 'success');
    }

    // ==================== MITARBEITER FUNKTIONEN MIT SOFT DELETE & BEOBACHTUNG ====================
    function filterByStatus(status) {
      currentStatusFilter = status;
      
      document.querySelectorAll('.status-filter-btn').forEach(btn => btn.classList.remove('active'));
      const btnIndex = status === 'active' ? 0 : status === 'archived' ? 1 : 2;
      document.querySelectorAll('.status-filter-btn')[btnIndex].classList.add('active');
      
      renderEmployeeList();
      updateStats();
    }

    function renderEmployeeList() {
      const container = document.getElementById('employeeList');
      const countElement = document.getElementById('employeeCount');

      let filteredEmployees = getFilteredEmployees();
      
      // Status Filter anwenden
      if (currentStatusFilter === 'active') {
        filteredEmployees = filteredEmployees.filter(emp => 
          emp.status === 'active' && !emp.isDeleted && !emp.archived
        );
      } else if (currentStatusFilter === 'archived') {
        // GEÃ„NDERT: "Archiviert" zu "Beobachtung"
        filteredEmployees = filteredEmployees.filter(emp => emp.archived);
      } else if (currentStatusFilter === 'deleted') {
        filteredEmployees = filteredEmployees.filter(emp => emp.isDeleted);
      }

      filteredEmployees.sort((a, b) => {
        const nameA = (a.name || '').toUpperCase();
        const nameB = (b.name || '').toUpperCase();
        return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;
      });

      if (filteredEmployees.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">${getEmptyStateTitle()}</div>
            <div class="empty-description">${getEmptyStateDescription()}</div>
          </div>
        `;
        countElement.textContent = '0';
        return;
      }

      container.innerHTML = '';
      countElement.textContent = filteredEmployees.length;

      filteredEmployees.forEach(employee => {
        let cardClass = 'employee-card';
        if (currentEmployee?.id === employee.id) cardClass += ' active';
        if (employee.archived) cardClass += ' archived';
        if (employee.isDeleted) cardClass += ' deleted';

        const card = document.createElement('div');
        card.className = cardClass;
        card.onclick = () => selectEmployee(employee);
        card.oncontextmenu = (e) => { e.preventDefault(); showEmployeeContextMenu(e, employee); };

        const oralCompleted = employee.inductions?.oral?.completed || false;
        const orgCompleted = employee.inductions?.org?.completed || false;

        let statusBadge = '';
        if (employee.isDeleted) {
          statusBadge = `<div style="position: absolute; top: 4px; right: 4px; background: var(--danger); color: white; font-size: 9px; font-weight: 900; padding: 2px 6px; border-radius: 4px;">GELÃ–SCHT</div>`;
        } else if (employee.archived) {
          // GEÃ„NDERT: "ARCHIVIERT" zu "BEOBACHTUNG"
          statusBadge = `<div style="position: absolute; top: 4px; right: 4px; background: var(--archived); color: white; font-size: 9px; font-weight: 900; padding: 2px 6px; border-radius: 4px;">BEOBACHTUNG</div>`;
        }

        card.innerHTML = `
          ${statusBadge}
          <div class="employee-top-row">
            <div class="employee-name">${escapeHtml(employee.name || '')}</div>
            <div class="employee-dn">DN ${escapeHtml(employee.dn || '')}</div>
          </div>
          <div class="employee-meta">
            <i class="fas fa-user-tie"></i> ${escapeHtml(employee.rank || 'Kein Rang')} â€¢
            <i class="fas fa-building"></i> ${escapeHtml(employee.unit || 'Keine Unit')}
          </div>
          <div class="induction-badges">
            <div class="induction-badge badge-oral ${oralCompleted ? 'completed' : 'pending'}">
              <i class="fas ${oralCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              MÃ¼ndlich
            </div>
            <div class="induction-badge badge-org ${orgCompleted ? 'completed' : 'pending'}">
              <i class="fas ${orgCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              Organisatorisch
            </div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    function updateStats() {
      const activeEmployees = employees.filter(emp => 
        emp.status === 'active' && !emp.isDeleted && !emp.archived
      ).length;
      
      // GEÃ„NDERT: "Archiviert" zu "Beobachtung"
      const beobachtungEmployees = employees.filter(emp => emp.archived).length;
      const deletedEmployees = employees.filter(emp => emp.isDeleted).length;
      
      document.getElementById('totalEmployees').textContent = activeEmployees;
      document.getElementById('totalBeobachtungen').textContent = beobachtungEmployees;
      document.getElementById('totalDeleted').textContent = deletedEmployees;
    }

    async function softDeleteEmployee() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      if (!confirm(`Mitarbeiter "${currentEmployee.name}" (DN ${currentEmployee.dn}) wirklich als gelÃ¶scht markieren?\n\nDer Mitarbeiter wird nicht physisch gelÃ¶scht, sondern nur als gelÃ¶scht markiert.`)) {
        return;
      }

      try {
        await db.collection('hrEmployees').doc(currentEmployee.id).update({
          isDeleted: true,
          deletedAt: firebase.firestore.FieldValue.serverTimestamp(),
          deletedBy: getCurrentUser(),
          status: 'deleted',
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Audit Log erstellen
        await createAuditLog('delete', 'employee', currentEmployee.id, `Mitarbeiter als gelÃ¶scht markiert: ${currentEmployee.name} (DN ${currentEmployee.dn})`);
        
        showNotification('Mitarbeiter als gelÃ¶scht markiert', 'success');
        filterByStatus('deleted');
      } catch (error) {
        console.error('Fehler beim Soft Delete:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    async function permanentlyDeleteEmployee() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      if (!confirm(`Mitarbeiter "${currentEmployee.name}" (DN ${currentEmployee.dn}) ENDGÃœLTIG lÃ¶schen?\n\nDiese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden!`)) {
        return;
      }

      try {
        // Audit Log erstellen vor dem LÃ¶schen
        await createAuditLog('delete', 'employee', currentEmployee.id, `Mitarbeiter endgÃ¼ltig gelÃ¶scht: ${currentEmployee.name} (DN ${currentEmployee.dn})`);
        
        await db.collection('hrEmployees').doc(currentEmployee.id).delete();
        
        currentEmployee = null;
        document.getElementById('employeeHeader').style.display = 'none';
        document.getElementById('inductionContent').style.display = 'none';
        
        showNotification('Mitarbeiter endgÃ¼ltig gelÃ¶scht', 'success');
        closeModal('editEmployeeModal');
      } catch (error) {
        console.error('Fehler beim endgÃ¼ltigen LÃ¶schen:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    // GEÃ„NDERT: toggleArchiveEmployee zu toggleBeobachtungEmployee
    async function toggleBeobachtungEmployee() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      const isCurrentlyInBeobachtung = currentEmployee.archived || false;
      const action = isCurrentlyInBeobachtung ? 'aus Beobachtung entfernen' : 'zur Beobachtung hinzufÃ¼gen';
      
      if (!confirm(`Mitarbeiter "${currentEmployee.name}" wirklich ${action}?`)) {
        return;
      }

      try {
        const updateData = {
          archived: !isCurrentlyInBeobachtung,
          archivedAt: firebase.firestore.FieldValue.serverTimestamp(),
          archivedBy: getCurrentUser(),
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        if (!isCurrentlyInBeobachtung) {
          updateData.status = 'archived';
        } else {
          updateData.status = 'active';
        }
        
        await db.collection('hrEmployees').doc(currentEmployee.id).update(updateData);
        
        // Audit Log erstellen
        const logAction = isCurrentlyInBeobachtung ? 'restore' : 'archive';
        await createAuditLog(logAction, 'employee', currentEmployee.id, 
          `${isCurrentlyInBeobachtung ? 'Aus Beobachtung entfernt' : 'Zur Beobachtung hinzugefÃ¼gt'}: ${currentEmployee.name} (DN ${currentEmployee.dn})`);
        
        showNotification(`Mitarbeiter ${action === 'zur Beobachtung hinzufÃ¼gen' ? 'zur Beobachtung hinzugefÃ¼gt' : 'aus Beobachtung entfernt'}`, 'success');
        
        if (isCurrentlyInBeobachtung) {
          filterByStatus('active');
        } else {
          filterByStatus('archived');
        }
      } catch (error) {
        console.error('Fehler beim Beobachtung-Status Ã¤ndern:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    // GEÃ„NDERT: toggleArchiveFilter zu toggleBeobachtungFilter
    function toggleBeobachtungFilter() {
      showArchived = !showArchived;
      const btn = document.getElementById('toggleBeobachtungBtn');
      if (showArchived) {
        btn.innerHTML = '<i class="fas fa-eye-slash"></i> Beobachtung ausblenden';
        filterByStatus('archived');
      } else {
        btn.innerHTML = '<i class="fas fa-eye"></i> Beobachtung anzeigen';
        filterByStatus('active');
      }
    }

    // ==================== BESTEHENDE FUNKTIONEN (angepasst) ====================
    function setupEventListeners() {
      document.getElementById('searchEmployees').addEventListener('input', function (e) {
        filterEmployees(e.target.value);
      });

      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey && e.key === 'n') { e.preventDefault(); openNewEmployeeModal(); }
        if (e.ctrlKey && e.key === 'f') { e.preventDefault(); document.getElementById('searchEmployees').focus(); }
        if (e.ctrlKey && e.key === 'e' && currentEmployee) { e.preventDefault(); openEditEmployeeModal(); }
        if (e.ctrlKey && e.key === 'b') { e.preventDefault(); openBeobachtungAktenModal(); }
        if (e.ctrlKey && e.key === 's') { e.preventDefault(); openSoldatenModal(); }
        if (e.ctrlKey && e.key === 'a') { e.preventDefault(); openAnkundigungModal(); }
        if (e.ctrlKey && e.key === 'p') { e.preventDefault(); openSettingsModal(); }
      });

      window.addEventListener('resize', adjustSidebarHeight);
    }

    function adjustSidebarHeight() {
      const sidebar = document.querySelector('.sidebar');
      const header = document.querySelector('.app-header');
      const windowHeight = window.innerHeight;
      const headerHeight = header.offsetHeight;

      const availableHeight = windowHeight - headerHeight - 40;
      const newHeight = Math.max(availableHeight, 500);
      sidebar.style.height = `${newHeight}px`;
    }

    function setupFormChangeListeners() {
      const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea, .toggle-switch input');
      formInputs.forEach(input => {
        input.addEventListener('input', handleFormChange);
        input.addEventListener('change', handleFormChange);
      });
    }

    function setupBeobachtungEventListeners() {
      const beobachtungInputs = document.querySelectorAll('#beobachtungName, #beobachtungDN, #beobachtungGrund');
      beobachtungInputs.forEach(input => {
        input.addEventListener('input', updateBeobachtungPreview);
      });
    }

    function setupSoldatenEventListeners() {
      const soldatenInputs = document.querySelectorAll('#soldatenName, #soldatenDN, #soldatenUnit, #soldatenRank, #soldatenDate, #soldatenTime, #soldatenNotizen, #soldatenSonstiges');
      soldatenInputs.forEach(input => {
        input.addEventListener('input', updateSoldatenPreview);
      });
    }

    function setupAnkundigungEventListeners() {
      const ankundigungInputs = document.querySelectorAll('#ankundigungTitle, #ankundigungContent');
      ankundigungInputs.forEach(input => {
        input.addEventListener('input', updateAnkundigungPreview);
      });
      
      const besprechungInputs = document.querySelectorAll('#besprechungThema, #besprechungDate, #besprechungTime, #besprechungOrt, #besprechungContent');
      besprechungInputs.forEach(input => {
        input.addEventListener('input', updateBesprechungPreview);
      });
      
      const aufstellungInputs = document.querySelectorAll('#aufstellungTyp, #aufstellungDate, #aufstellungTime, #aufstellungOrt, #aufstellungBemerkungen');
      aufstellungInputs.forEach(input => {
        input.addEventListener('input', updateAufstellungPreview);
      });
    }

    function handleFormChange() {
      if (currentEmployee) {
        saveFormData();
        updateTemplates();
        saveEmployeeData(true);
      }
    }

    function updateUnitAndRankSelects() {
      const unitSelects = [
        document.getElementById('unitSelect'),
        document.getElementById('unitSelect2'),
        document.getElementById('newEmployeeUnit'),
        document.getElementById('editEmployeeUnit'),
        document.getElementById('soldatenUnit'),
        document.getElementById('akteUnit')
      ];
      
      const rankSelects = [
        document.getElementById('rankSelect'),
        document.getElementById('rankSelect2'),
        document.getElementById('newEmployeeRank'),
        document.getElementById('editEmployeeRank'),
        document.getElementById('soldatenRank'),
        document.getElementById('akteRank')
      ];
      
      unitSelects.forEach(select => {
        if (select) {
          select.innerHTML = '<option value="">Unit auswÃ¤hlen</option>';
          (settings.units || []).forEach(unit => {
            const option = document.createElement('option');
            option.value = unit;
            option.textContent = unit;
            select.appendChild(option);
          });
        }
      });
      
      rankSelects.forEach(select => {
        if (select) {
          select.innerHTML = '<option value="">Rang auswÃ¤hlen</option>';
          (settings.ranks || []).forEach(rank => {
            const option = document.createElement('option');
            option.value = rank;
            option.textContent = rank;
            select.appendChild(option);
          });
        }
      });
    }

    function selectEmployee(employee) {
      currentEmployee = employee;

      document.getElementById('employeeHeader').style.display = 'flex';
      document.getElementById('inductionContent').style.display = 'block';

      updateEmployeeHeader();
      loadEmployeeData();
      updateInductionDisplay();
      renderEmployeeList();
    }

    function updateEmployeeHeader() {
      if (!currentEmployee) return;

      document.getElementById('currentEmployeeName').textContent = currentEmployee.name || '';
      document.getElementById('currentEmployeeDN').textContent = currentEmployee.dn || '';
      document.getElementById('currentEmployeeUnit').textContent = currentEmployee.unit || 'Keine Unit';
      document.getElementById('currentEmployeeRank').textContent = currentEmployee.rank || 'Kein Rang';
      
      let status = 'Aktiv';
      let statusColor = 'var(--secondary)';
      
      if (currentEmployee.isDeleted) {
        status = 'GelÃ¶scht';
        statusColor = 'var(--danger)';
      } else if (currentEmployee.archived) {
        // GEÃ„NDERT: "Archiviert" zu "Beobachtung"
        status = 'Beobachtung';
        statusColor = 'var(--archived)';
      }
      
      document.getElementById('currentEmployeeStatus').textContent = status;
      document.getElementById('currentEmployeeStatus').style.color = statusColor;
    }

    function loadEmployeeData() {
      if (!currentEmployee) return;

      const oralData = currentEmployee.oralData || {};
      const orgData = currentEmployee.orgData || {};

      document.getElementById('oralDate').value = oralData.date || (new Date().toISOString().split('T')[0]);
      document.getElementById('oralTimeStart').value = oralData.timeStart || '16:40';
      document.getElementById('oralTimeEnd').value = oralData.timeEnd || '18:00';
      document.getElementById('oralPerson').value = oralData.person || '';
      document.getElementById('oralNotes').value = oralData.notes || '';
      document.getElementById('unitSelect').value = oralData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect').value = oralData.rank || currentEmployee.rank || '';

      document.getElementById('orgDate').value = orgData.date || (new Date().toISOString().split('T')[0]);
      document.getElementById('orgTimeStart').value = orgData.timeStart || '22:10';
      document.getElementById('orgTimeEnd').value = orgData.timeEnd || '23:05';
      document.getElementById('orgPerson').value = orgData.person || '';
      document.getElementById('orgNotes').value = orgData.notes || '';
      document.getElementById('unitSelect2').value = orgData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect2').value = orgData.rank || currentEmployee.rank || '';

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      document.getElementById('oralInductionToggle').checked = oralCompleted;
      document.getElementById('orgInductionToggle').checked = orgCompleted;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);

      checkBothInductionsCompleted();
      updateTemplates();
    }

    function updateInductionDisplay() {
      if (!currentEmployee) return;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);

      renderEmployeeList();
    }

    function updateInductionUI(type, completed) {
      const card = document.getElementById(`${type}InductionCard`);
      const status = document.getElementById(`${type}InductionStatus`);

      if (completed) {
        card.classList.add('completed');
        status.textContent = 'BESTANDEN';
      } else {
        card.classList.remove('completed');
        status.textContent = 'AUSSTEHEND';
      }
    }

    function saveFormData() {
      if (!currentEmployee) return;

      currentEmployee.oralData = {
        date: document.getElementById('oralDate').value,
        timeStart: document.getElementById('oralTimeStart').value,
        timeEnd: document.getElementById('oralTimeEnd').value,
        person: document.getElementById('oralPerson').value,
        notes: document.getElementById('oralNotes').value,
        unit: document.getElementById('unitSelect').value,
        rank: document.getElementById('rankSelect').value
      };

      currentEmployee.orgData = {
        date: document.getElementById('orgDate').value,
        timeStart: document.getElementById('orgTimeStart').value,
        timeEnd: document.getElementById('orgTimeEnd').value,
        person: document.getElementById('orgPerson').value,
        notes: document.getElementById('orgNotes').value,
        unit: document.getElementById('unitSelect2').value,
        rank: document.getElementById('rankSelect2').value
      };

      const unitSelectValue = document.getElementById('unitSelect').value;
      const rankSelectValue = document.getElementById('rankSelect').value;
      if (unitSelectValue) currentEmployee.unit = unitSelectValue;
      if (rankSelectValue) currentEmployee.rank = rankSelectValue;

      currentEmployee.lastUpdated = new Date().toISOString();
    }

    function openEditEmployeeModal() {
      if (!currentEmployee) {
        showNotification('Bitte wÃ¤hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      document.getElementById('editEmployeeName').value = currentEmployee.name || '';
      document.getElementById('editEmployeeDN').value = currentEmployee.dn || '';
      document.getElementById('editEmployeeUnit').value = currentEmployee.unit || '';
      document.getElementById('editEmployeeRank').value = currentEmployee.rank || '';

      openModal('editEmployeeModal');
    }

    async function saveEditedEmployee() {
      if (!currentEmployee) return;

      const name = document.getElementById('editEmployeeName').value.trim();
      const dn = document.getElementById('editEmployeeDN').value;

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind Pflichtfelder', 'warning');
        return;
      }

      currentEmployee.name = name;
      currentEmployee.dn = dn;
      currentEmployee.unit = document.getElementById('editEmployeeUnit').value || '';
      currentEmployee.rank = document.getElementById('editEmployeeRank').value || '';

      const success = await saveEmployeeToFirebase(currentEmployee);
      if (success) {
        closeModal('editEmployeeModal');
        updateEmployeeHeader();
        renderEmployeeList();
        updateTemplates();
        showNotification('Mitarbeiterdaten erfolgreich aktualisiert', 'success');
        
        // Audit Log erstellen
        await createAuditLog('update', 'employee', currentEmployee.id, `Mitarbeiter aktualisiert: ${name} (DN ${dn})`);
      }
    }

    function toggleInduction(type, completed) {
      if (!currentEmployee) return;

      if (!currentEmployee.inductions) currentEmployee.inductions = {};

      currentEmployee.inductions[type] = {
        completed: completed,
        date: completed ? new Date().toISOString() : null,
        updatedBy: 'System'
      };

      updateInductionUI(type, completed);
      updateTemplates();
      saveEmployeeData(true);
      checkBothInductionsCompleted();
      renderEmployeeList();
      updateStats();

      const typeName = type === 'oral' ? 'MÃ¼ndliche' : 'Organisatorische';
      const status = completed ? 'bestanden' : 'als ausstehend markiert';
      showNotification(`${typeName} Einweisung ${status}`, 'success');
      
      // Audit Log erstellen
      createAuditLog('update', 'employee', currentEmployee.id, `${typeName} Einweisung ${status} fÃ¼r ${currentEmployee.name}`);
    }

    function checkBothInductionsCompleted() {
      if (!currentEmployee) return false;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      const nowBothCompleted = oralCompleted && orgCompleted;

      if (nowBothCompleted && !bothInductionsCompleted) {
        bothInductionsCompleted = true;
      } else if (!nowBothCompleted) {
        bothInductionsCompleted = false;
      }

      return nowBothCompleted;
    }

    function updateTemplates() {
      if (!currentEmployee) {
        seedTemplateBoxes();
        return;
      }

      saveFormData();

      const oralTemplate = generateTemplate('oral');
      document.getElementById('oralTemplateContent').textContent = oralTemplate;

      const orgTemplate = generateTemplate('org');
      document.getElementById('orgTemplateContent').textContent = orgTemplate;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      document.getElementById('oralTemplateBadge').textContent = oralCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
      document.getElementById('orgTemplateBadge').textContent = orgCompleted ? 'BESTANDEN' : 'AUSSTEHEND';

      document.getElementById('oralTemplateCard').classList.toggle('completed', oralCompleted);
      document.getElementById('orgTemplateCard').classList.toggle('completed', orgCompleted);
    }

    function generateTemplate(type) {
      const isOral = type === 'oral';
      const completed = isOral
        ? (currentEmployee.inductions?.oral?.completed || false)
        : (currentEmployee.inductions?.org?.completed || false);

      const data = isOral ? currentEmployee.oralData : currentEmployee.orgData;

      const name = currentEmployee.name || '';
      const dn = currentEmployee.dn || '';

      const unit = isOral
        ? (document.getElementById('unitSelect').value || currentEmployee.unit || '')
        : (document.getElementById('unitSelect2').value || currentEmployee.unit || '');

      const rank = isOral
        ? (document.getElementById('rankSelect').value || currentEmployee.rank || '')
        : (document.getElementById('rankSelect2').value || currentEmployee.rank || '');

      const date = data?.date ? new Date(data.date).toLocaleDateString('de-DE') : '';
      const timeStart = data?.timeStart || '';
      const timeEnd = data?.timeEnd || '';
      const person = data?.person || '';
      const notes = data?.notes || '';

      const timeSeparator = isOral ? 'bis' : '-';

      const unitDiscordId = settings.unitDiscordIds[unit] || '';
      const rankDiscordId = settings.rankDiscordIds[rank] || '';

      const unitDisplay = unitDiscordId ? `<@&${unitDiscordId}>` : unit;
      const rankDisplay = rankDiscordId ? `<@&${rankDiscordId}>` : rank;

      return `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
${isOral ? 'MÃ¼ndliche Einweisung' : 'Organisatorische Einweisung'}

Name: ${name}
DN: ${dn}
Hauptunit: ${unitDisplay}
Rang: ${rankDisplay}
Datum: ${date}
Uhrzeit: ${timeStart} ${timeSeparator} ${timeEnd}
Beteiligte: ${person}
Sonstiges: ${notes}

/////////////////////////////////////////////////////////////////////////
<@&${settings.hrDiscordRoleId}>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
    }

    async function saveEmployeeToFirebase(employee) {
      try {
        const dataToSave = {
          name: employee.name,
          dn: employee.dn,
          unit: employee.unit,
          rank: employee.rank,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          inductions: employee.inductions || {},
          oralData: employee.oralData || {},
          orgData: employee.orgData || {},
          status: employee.status || 'active',
          isDeleted: employee.isDeleted || false,
          archived: employee.archived || false
        };

        await db.collection('hrEmployees').doc(employee.id).set(dataToSave, { merge: true });
        return true;
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
        return false;
      }
    }

    function saveEmployeeData(autosave = false) {
      if (!currentEmployee || !autosave) return;
      
      // Auto-save nach 2 Sekunden InaktivitÃ¤t
      clearTimeout(window.saveTimeout);
      window.saveTimeout = setTimeout(async () => {
        const success = await saveEmployeeToFirebase(currentEmployee);
        if (success) {
          console.log('Autosave erfolgreich');
        }
      }, 2000);
    }

    async function createNewEmployee() {
      const name = document.getElementById('newEmployeeName').value.trim();
      const dn = document.getElementById('newEmployeeDN').value;
      const unit = document.getElementById('newEmployeeUnit').value;
      const rank = document.getElementById('newEmployeeRank').value;

      if (!name || !dn) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const employeeId = `EMP-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;

      const newEmployee = {
        id: employeeId,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        status: 'active',
        isDeleted: false,
        archived: false,
        lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
        inductions: { oral: { completed: false }, org: { completed: false } },
        oralData: { date: '', timeStart: '16:40', timeEnd: '18:00', person: '', notes: '', unit: unit || '', rank: rank || '' },
        orgData: { date: '', timeStart: '22:10', timeEnd: '23:05', person: '', notes: '', unit: unit || '', rank: rank || '' }
      };

      try {
        await db.collection('hrEmployees').doc(employeeId).set(newEmployee);
        
        // Audit Log erstellen
        await createAuditLog('create', 'employee', employeeId, `Neuer Mitarbeiter: ${name} (DN ${dn})`);
        
        closeModal('newEmployeeModal');
        selectEmployee(newEmployee);
        updateStats();

        document.getElementById('newEmployeeName').value = '';
        document.getElementById('newEmployeeDN').value = '';
        document.getElementById('newEmployeeUnit').value = '';
        document.getElementById('newEmployeeRank').value = '';

        showNotification(`Mitarbeiter "${name}" erstellt`, 'success');
      } catch (error) {
        console.error('Fehler beim Erstellen:', error);
        showNotification('Fehler beim Erstellen: ' + error.message, 'error');
      }
    }

    function getFilteredEmployees() {
      let filtered = employees;
      
      if (currentFilter === 'oral') {
        filtered = filtered.filter(emp => !(emp.inductions?.oral?.completed));
      } else if (currentFilter === 'org') {
        filtered = filtered.filter(emp => !(emp.inductions?.org?.completed));
      }
      
      return filtered;
    }

    function getEmptyStateTitle() {
      if (currentStatusFilter === 'archived') return 'Keine Beobachtungen'; // GEÃ„NDERT
      if (currentStatusFilter === 'deleted') return 'Keine gelÃ¶schten Mitarbeiter';
      return 'Keine Mitarbeiter';
    }

    function getEmptyStateDescription() {
      if (currentStatusFilter === 'archived') return 'Keine Mitarbeiter unter Beobachtung'; // GEÃ„NDERT
      if (currentStatusFilter === 'deleted') return 'Keine gelÃ¶schten Mitarbeiter';
      if (currentFilter === 'oral') return 'Keine Mitarbeiter mit ausstehender mÃ¼ndlicher Einweisung';
      if (currentFilter === 'org') return 'Keine Mitarbeiter mit ausstehender organisatorischer Einweisung';
      return 'FÃ¼gen Sie Ihren ersten Mitarbeiter hinzu';
    }

    function filterEmployeesByType(type) {
      currentFilter = type;

      document.querySelectorAll('.sidebar-filter-btn').forEach(btn => btn.classList.remove('active'));
      if (type === 'all') document.querySelectorAll('.sidebar-filter-btn')[0].classList.add('active');
      if (type === 'oral') document.querySelectorAll('.sidebar-filter-btn')[1].classList.add('active');
      if (type === 'org') document.querySelectorAll('.sidebar-filter-btn')[2].classList.add('active');

      renderEmployeeList();
    }

    function filterEmployees(searchTerm) {
      const cards = document.querySelectorAll('.employee-card');
      const term = (searchTerm || '').toLowerCase().trim();

      if (!term) {
        cards.forEach(card => card.style.display = 'flex');
        return;
      }

      cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(term) ? 'flex' : 'none';
      });
    }

    // ==================== ANKÃœNDIGUNGEN FUNKTIONEN ====================
    function openAnkundigungModal() {
      openModal('ankundigungModal');
      updateAnkundigungPreview();
    }

    function closeAnkundigungModal() {
      closeModal('ankundigungModal');
    }

    function switchAnkundigungTab(tabName) {
      currentAnkundigungTab = tabName;
      
      document.querySelectorAll('.ankundigung-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      let tabIndex = 0;
      if (tabName === 'new') tabIndex = 0;
      else if (tabName === 'besprechung') tabIndex = 1;
      else if (tabName === 'aufstellung') tabIndex = 2;
      else if (tabName === 'list') tabIndex = 3;
      
      document.querySelectorAll('.ankundigung-tab')[tabIndex].classList.add('active');
      
      document.querySelectorAll('.ankundigung-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      let tabId = '';
      if (tabName === 'new') tabId = 'ankundigungNewTab';
      else if (tabName === 'besprechung') tabId = 'ankundigungBesprechungTab';
      else if (tabName === 'aufstellung') tabId = 'ankundigungAufstellungTab';
      else tabId = 'ankundigungListTab';
      
      document.getElementById(tabId).style.display = 'block';
      
      if (tabName === 'list') {
        renderAnkundigungListe();
      }
    }

    function updateAnkundigungPreview() {
      const title = document.getElementById('ankundigungTitle').value;
      const content = document.getElementById('ankundigungContent').value;

      const template = `ðŸª§ **AnkÃ¼ndigung**${title ? '\n\n**' + title + '**' : ''}

${content || ''}`;

      document.getElementById('ankundigungPreview').textContent = template;
    }

    function updateBesprechungPreview() {
      const thema = document.getElementById('besprechungThema').value;
      const date = document.getElementById('besprechungDate').value;
      const time = document.getElementById('besprechungTime').value;
      const ort = document.getElementById('besprechungOrt').value;
      const content = document.getElementById('besprechungContent').value;

      const formattedDate = date ? new Date(date).toLocaleDateString('de-DE') : '';
      
      const template = `ðŸ–Šï¸ **Besprechung**

Thema: ${thema || ''}
Datum: ${formattedDate}
Uhrzeit: ${time || ''}
Ort: ${ort || ''}

${content || ''}`;

      document.getElementById('besprechungPreview').textContent = template;
    }

    function updateAufstellungPreview() {
      const typ = document.getElementById('aufstellungTyp').value;
      const date = document.getElementById('aufstellungDate').value;
      const time = document.getElementById('aufstellungTime').value;
      const ort = document.getElementById('aufstellungOrt').value;
      const bemerkungen = document.getElementById('aufstellungBemerkungen').value;

      const formattedDate = date ? new Date(date).toLocaleDateString('de-DE') : '';
      
      const template = `ðŸ•› **Aufstellung**

Typ: ${typ || ''}
Datum: ${formattedDate}
Uhrzeit: ${time || ''}
Ort: ${ort || ''}
Bemerkungen: ${bemerkungen || ''}`;

      document.getElementById('aufstellungPreview').textContent = template;
    }

    async function copyAnkundigungTemplate() {
      const template = document.getElementById('ankundigungPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'AnkÃ¼ndigung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function copyBesprechungTemplate() {
      const template = document.getElementById('besprechungPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Besprechung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function copyAufstellungTemplate() {
      const template = document.getElementById('aufstellungPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Aufstellung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function saveAnkundigung() {
      const title = document.getElementById('ankundigungTitle').value.trim();
      const content = document.getElementById('ankundigungContent').value.trim();

      if (!content) {
        showNotification('Bitte geben Sie den Inhalt der AnkÃ¼ndigung ein', 'warning');
        return;
      }

      const ankundigung = {
        id: `ANK-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        type: 'ankundigung',
        title: title || 'Ohne Titel',
        content,
        date: new Date().toISOString(),
        dateFormatted: new Date().toLocaleDateString('de-DE'),
        template: document.getElementById('ankundigungPreview').textContent,
        icon: 'ðŸª§'
      };

      try {
        await db.collection('hrAnkundigungen').doc(ankundigung.id).set(ankundigung);
        
        // Audit Log erstellen
        await createAuditLog('create', 'ankundigung', ankundigung.id, `AnkÃ¼ndigung erstellt: ${title || 'Ohne Titel'}`);
        
        showNotification('AnkÃ¼ndigung erfolgreich gespeichert', 'success');
        document.getElementById('ankundigungTitle').value = '';
        document.getElementById('ankundigungContent').value = '';
        updateAnkundigungPreview();
        renderAnkundigungListe();
        switchAnkundigungTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern der AnkÃ¼ndigung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveBesprechung() {
      const thema = document.getElementById('besprechungThema').value.trim();
      const date = document.getElementById('besprechungDate').value;
      const time = document.getElementById('besprechungTime').value;
      const ort = document.getElementById('besprechungOrt').value.trim();
      const content = document.getElementById('besprechungContent').value.trim();

      if (!thema || !date || !time || !content) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const besprechung = {
        id: `BES-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        type: 'besprechung',
        thema,
        date,
        time,
        ort: ort || '',
        content,
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        dateFormatted: new Date(date).toLocaleDateString('de-DE'),
        template: document.getElementById('besprechungPreview').textContent,
        icon: 'ðŸ–Šï¸'
      };

      try {
        await db.collection('hrAnkundigungen').doc(besprechung.id).set(besprechung);
        
        // Audit Log erstellen
        await createAuditLog('create', 'besprechung', besprechung.id, `Besprechung erstellt: ${thema}`);
        
        showNotification('Besprechung erfolgreich gespeichert', 'success');
        document.getElementById('besprechungThema').value = '';
        document.getElementById('besprechungDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('besprechungTime').value = '';
        document.getElementById('besprechungOrt').value = '';
        document.getElementById('besprechungContent').value = '';
        updateBesprechungPreview();
        renderAnkundigungListe();
        switchAnkundigungTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern der Besprechung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveAufstellung() {
      const typ = document.getElementById('aufstellungTyp').value;
      const date = document.getElementById('aufstellungDate').value;
      const time = document.getElementById('aufstellungTime').value;
      const ort = document.getElementById('aufstellungOrt').value.trim();
      const bemerkungen = document.getElementById('aufstellungBemerkungen').value.trim();

      if (!typ || !date || !time || !ort) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const aufstellung = {
        id: `AUF-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        type: 'aufstellung',
        typ,
        date,
        time,
        ort,
        bemerkungen: bemerkungen || '',
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        dateFormatted: new Date(date).toLocaleDateString('de-DE'),
        template: document.getElementById('aufstellungPreview').textContent,
        icon: 'ðŸ•›'
      };

      try {
        await db.collection('hrAnkundigungen').doc(aufstellung.id).set(aufstellung);
        
        // Audit Log erstellen
        await createAuditLog('create', 'aufstellung', aufstellung.id, `Aufstellung erstellt: ${typ}`);
        
        showNotification('Aufstellung erfolgreich gespeichert', 'success');
        document.getElementById('aufstellungTyp').value = '';
        document.getElementById('aufstellungDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('aufstellungTime').value = '';
        document.getElementById('aufstellungOrt').value = '';
        document.getElementById('aufstellungBemerkungen').value = '';
        updateAufstellungPreview();
        renderAnkundigungListe();
        switchAnkundigungTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern der Aufstellung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderAnkundigungListe() {
      const container = document.getElementById('ankundigungListe');
      const searchTerm = document.getElementById('ankundigungSearch')?.value.toLowerCase() || '';
      
      let filteredAnkundigungen = ankundigungen;
      if (searchTerm) {
        filteredAnkundigungen = ankundigungen.filter(item => 
          (item.title && item.title.toLowerCase().includes(searchTerm)) || 
          (item.thema && item.thema.toLowerCase().includes(searchTerm)) ||
          (item.content && item.content.toLowerCase().includes(searchTerm)) ||
          (item.bemerkungen && item.bemerkungen.toLowerCase().includes(searchTerm))
        );
      }
      
      if (filteredAnkundigungen.length === 0) {
        container.innerHTML = `
          <div class="empty-ankundigung">
            <div class="empty-ankundigung-icon"><i class="fas fa-bullhorn"></i></div>
            <div class="empty-ankundigung-title">${searchTerm ? 'Keine passenden EintrÃ¤ge gefunden' : 'Keine EintrÃ¤ge gefunden'}</div>
            <div class="empty-description">${searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihren ersten Eintrag'}</div>
          </div>
        `;
        return;
      }

      let html = '';
      filteredAnkundigungen.forEach(item => {
        const typeLabel = item.type === 'ankundigung' ? 'AnkÃ¼ndigung' : 
                         item.type === 'besprechung' ? 'Besprechung' : 'Aufstellung';
        
        const title = item.type === 'ankundigung' ? (item.title || 'Ohne Titel') :
                     item.type === 'besprechung' ? item.thema : `${item.typ} - ${item.ort}`;
        
        const date = item.type === 'ankundigung' ? item.createdFormatted : 
                    item.dateFormatted || item.createdFormatted;
        
        const content = item.type === 'ankundigung' ? item.content :
                       item.type === 'besprechung' ? item.content : item.bemerkungen;
        
        html += `
          <div class="ankundigung-item">
            <div class="ankundigung-item-header">
              <div class="ankundigung-item-title">
                <span>${item.icon || 'ðŸ“„'}</span> ${escapeHtml(title)}
              </div>
              <div class="ankundigung-item-type">
                ${typeLabel}
              </div>
            </div>
            <div class="ankundigung-item-date">
              <i class="fas fa-calendar"></i> Erstellt: ${date}
            </div>
            <div class="ankundigung-item-content">
              ${escapeHtml(content.length > 200 ? content.substring(0, 200) + '...' : content)}
            </div>
            ${item.type === 'besprechung' ? `
            <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
              ${item.time ? `<div style="background: rgba(139,92,246,.10); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(139,92,246,.20);">
                <i class="fas fa-clock"></i> ${item.time}
              </div>` : ''}
              ${item.ort ? `<div style="background: rgba(139,92,246,.10); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(139,92,246,.20);">
                <i class="fas fa-map-marker-alt"></i> ${item.ort}
              </div>` : ''}
            </div>
            ` : ''}
            ${item.type === 'aufstellung' ? `
            <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
              <div style="background: rgba(139,92,246,.10); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(139,92,246,.20);">
                ${item.typ}
              </div>
              ${item.time ? `<div style="background: rgba(139,92,246,.10); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(139,92,246,.20);">
                <i class="fas fa-clock"></i> ${item.time}
              </div>` : ''}
              <div style="background: rgba(139,92,246,.10); color: #a78bfa; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(139,92,246,.20);">
                <i class="fas fa-map-marker-alt"></i> ${item.ort}
              </div>
            </div>
            ` : ''}
            <div class="ankundigung-item-actions">
              <button class="ankundigung-item-btn ankundigung-item-btn-copy" onclick="copyAnkundigungFromList('${item.id}')">
                <i class="fas fa-copy"></i> Kopieren
              </button>
              <button class="ankundigung-item-btn ankundigung-item-btn-delete" onclick="deleteAnkundigung('${item.id}')">
                <i class="fas fa-trash"></i> LÃ¶schen
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function searchAnkundigungen(searchTerm) {
      renderAnkundigungListe();
    }

    async function copyAnkundigungFromList(itemId) {
      const item = ankundigungen.find(i => i.id === itemId);
      if (!item) return;

      const success = await copyToClipboard(item.template);
      showNotification(success ? `${item.type === 'ankundigung' ? 'AnkÃ¼ndigung' : item.type === 'besprechung' ? 'Besprechung' : 'Aufstellung'} kopiert` : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function deleteAnkundigung(itemId) {
      if (!confirm('Eintrag wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) return;

      try {
        // Audit Log erstellen
        const item = ankundigungen.find(i => i.id === itemId);
        if (item) {
          await createAuditLog('delete', item.type, itemId, `GelÃ¶scht: ${item.title || item.thema || item.typ}`);
        }
        
        await db.collection('hrAnkundigungen').doc(itemId).delete();
        showNotification('Eintrag gelÃ¶scht', 'success');
      } catch (error) {
        console.error('Fehler beim LÃ¶schen des Eintrags:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    // ==================== SOLDATENGESPRÃ„CH FUNKTIONEN ====================
    function openSoldatenModal() {
      openModal('soldatenModal');
      updateSoldatenPreview();
    }

    function closeSoldatenModal() {
      closeModal('soldatenModal');
    }

    function switchSoldatenTab(tabName) {
      currentSoldatenTab = tabName;
      
      document.querySelectorAll('.soldaten-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.soldaten-tab')[tabName === 'new' ? 0 : 1].classList.add('active');
      
      document.querySelectorAll('.soldaten-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      let tabId = '';
      if (tabName === 'new') tabId = 'soldatenNewTab';
      else tabId = 'soldatenListTab';
      
      document.getElementById(tabId).style.display = 'block';
      
      if (tabName === 'list') {
        renderSoldatenListe();
      }
    }

    function updateSoldatenPreview() {
      const name = document.getElementById('soldatenName').value;
      const dn = document.getElementById('soldatenDN').value;
      const unit = document.getElementById('soldatenUnit').value;
      const rank = document.getElementById('soldatenRank').value;
      const date = document.getElementById('soldatenDate').value;
      const time = document.getElementById('soldatenTime').value;
      const notizen = document.getElementById('soldatenNotizen').value;
      const sonstiges = document.getElementById('soldatenSonstiges').value;

      const formattedDate = date ? new Date(date).toLocaleDateString('de-DE') : '';
      
      const template = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
SoldatengesprÃ¤ch

Name: ${name || ''}
DN: ${dn || ''}
Hauptunit: ${unit || ''}
Rang: ${rank || ''}
Datum: ${formattedDate}
Uhrzeit: ${time || ''}
Notizen: ${notizen || ''}
Sonstiges: ${sonstiges || ''}

/////////////////////////////////////////////////////////////////////////
<@&${settings.hrDiscordRoleId}>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

      document.getElementById('soldatenPreview').textContent = template;
    }

    async function copySoldatenTemplate() {
      const template = document.getElementById('soldatenPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'SoldatengesprÃ¤ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function saveSoldatenGesprÃ¤ch() {
      const name = document.getElementById('soldatenName').value.trim();
      const dn = document.getElementById('soldatenDN').value;
      const unit = document.getElementById('soldatenUnit').value;
      const rank = document.getElementById('soldatenRank').value;
      const date = document.getElementById('soldatenDate').value;
      const time = document.getElementById('soldatenTime').value;
      const notizen = document.getElementById('soldatenNotizen').value.trim();
      const sonstiges = document.getElementById('soldatenSonstiges').value.trim();

      if (!name || !dn || !date || !time || !notizen) {
        showNotification('Bitte fÃ¼llen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const gesprÃ¤ch = {
        id: `SOLDATEN-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        date,
        time,
        notizen,
        sonstiges: sonstiges || '',
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        dateFormatted: new Date(date).toLocaleDateString('de-DE'),
        template: document.getElementById('soldatenPreview').textContent
      };

      try {
        await db.collection('hrSoldatenGesprÃ¤che').doc(gesprÃ¤ch.id).set(gesprÃ¤ch);
        
        // Audit Log erstellen
        await createAuditLog('create', 'soldatengesprÃ¤ch', gesprÃ¤ch.id, `SoldatengesprÃ¤ch erstellt fÃ¼r: ${name} (DN ${dn})`);
        
        showNotification('SoldatengesprÃ¤ch erfolgreich gespeichert', 'success');
        document.getElementById('soldatenName').value = '';
        document.getElementById('soldatenDN').value = '';
        document.getElementById('soldatenUnit').value = '';
        document.getElementById('soldatenRank').value = '';
        document.getElementById('soldatenDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('soldatenTime').value = '';
        document.getElementById('soldatenNotizen').value = '';
        document.getElementById('soldatenSonstiges').value = '';
        updateSoldatenPreview();
        renderSoldatenListe();
        switchSoldatenTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern des SoldatengesprÃ¤chs:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderSoldatenListe() {
      const container = document.getElementById('soldatenListe');
      const searchTerm = document.getElementById('soldatenSearch')?.value.toLowerCase() || '';
      
      let filteredGesprÃ¤che = soldatenGesprÃ¤che;
      if (searchTerm) {
        filteredGesprÃ¤che = soldatenGesprÃ¤che.filter(gesprÃ¤ch => 
          gesprÃ¤ch.name.toLowerCase().includes(searchTerm) || 
          gesprÃ¤ch.dn.toString().includes(searchTerm)
        );
      }
      
      if (filteredGesprÃ¤che.length === 0) {
        container.innerHTML = `
          <div class="empty-soldaten">
            <div class="empty-soldaten-icon"><i class="fas fa-comments"></i></div>
            <div class="empty-soldaten-title">${searchTerm ? 'Keine passenden GesprÃ¤che gefunden' : 'Keine GesprÃ¤che gefunden'}</div>
            <div class="empty-description">${searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihr erstes SoldatengesprÃ¤ch'}</div>
          </div>
        `;
        return;
      }

      let html = '';
      filteredGesprÃ¤che.forEach(gesprÃ¤ch => {
        html += `
          <div class="soldaten-item">
            <div class="soldaten-item-header">
              <div class="soldaten-item-name">${escapeHtml(gesprÃ¤ch.name)}</div>
              <div class="soldaten-item-dn">DN ${escapeHtml(gesprÃ¤ch.dn)}</div>
            </div>
            <div class="soldaten-item-date">
              <i class="fas fa-calendar"></i> GesprÃ¤ch am: ${gesprÃ¤ch.dateFormatted} um ${gesprÃ¤ch.time || ''}
            </div>
            <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
              <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                ${gesprÃ¤ch.unit || 'Keine Unit'}
              </div>
              <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                ${gesprÃ¤ch.rank || 'Kein Rang'}
              </div>
            </div>
            
            <div class="soldaten-item-notizen">
              <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                <i class="fas fa-sticky-note" style="color: var(--warning); font-size: 12px;"></i>
                <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Notizen:</span>
              </div>
              ${escapeHtml(gesprÃ¤ch.notizen.length > 200 ? gesprÃ¤ch.notizen.substring(0, 200) + '...' : gesprÃ¤ch.notizen)}
            </div>
            
            ${gesprÃ¤ch.sonstiges ? `
            <div class="soldaten-item-sonstiges">
              <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                <i class="fas fa-ellipsis-h" style="color: var(--warning); font-size: 12px;"></i>
                <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Sonstiges:</span>
              </div>
              ${escapeHtml(gesprÃ¤ch.sonstiges.length > 200 ? gesprÃ¤ch.sonstiges.substring(0, 200) + '...' : gesprÃ¤ch.sonstiges)}
            </div>
            ` : ''}
            
            <div class="soldaten-item-actions">
              <button class="soldaten-item-btn soldaten-item-btn-copy" onclick="copySoldatenFromList('${gesprÃ¤ch.id}')">
                <i class="fas fa-copy"></i> Kopieren
              </button>
              <button class="soldaten-item-btn soldaten-item-btn-delete" onclick="deleteSoldatenGesprÃ¤ch('${gesprÃ¤ch.id}')">
                <i class="fas fa-trash"></i> LÃ¶schen
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function searchSoldaten(searchTerm) {
      renderSoldatenListe();
    }

    async function copySoldatenFromList(gesprÃ¤chId) {
      const gesprÃ¤ch = soldatenGesprÃ¤che.find(g => g.id === gesprÃ¤chId);
      if (!gesprÃ¤ch) return;

      const success = await copyToClipboard(gesprÃ¤ch.template);
      showNotification(success ? 'SoldatengesprÃ¤ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function deleteSoldatenGesprÃ¤ch(gesprÃ¤chId) {
      if (!confirm('SoldatengesprÃ¤ch wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) return;

      try {
        const gesprÃ¤ch = soldatenGesprÃ¤che.find(g => g.id === gesprÃ¤chId);
        if (gesprÃ¤ch) {
          await createAuditLog('delete', 'soldatengesprÃ¤ch', gesprÃ¤chId, `GelÃ¶scht: ${gesprÃ¤ch.name} (DN ${gesprÃ¤ch.dn})`);
        }
        
        await db.collection('hrSoldatenGesprÃ¤che').doc(gesprÃ¤chId).delete();
        showNotification('SoldatengesprÃ¤ch gelÃ¶scht', 'success');
      } catch (error) {
        console.error('Fehler beim LÃ¶schen des SoldatengesprÃ¤chs:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    // ==================== BEOBACHTUNGS AKTEN FUNKTIONEN ====================
    function openBeobachtungAktenModal() {
      openModal('beobachtungAktenModal');
      updateBeobachtungPreview();
    }

    function closeBeobachtungAktenModal() {
      closeModal('beobachtungAktenModal');
    }

    function switchBeobachtungTab(tabName) {
      currentBeobachtungTab = tabName;
      
      document.querySelectorAll('.beobachtung-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.beobachtung-tab')[tabName === 'new' ? 0 : tabName === 'list' ? 1 : 2].classList.add('active');
      
      document.querySelectorAll('.beobachtung-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      let tabId = '';
      if (tabName === 'new') tabId = 'beobachtungNewTab';
      else if (tabName === 'list') tabId = 'beobachtungListTab';
      else tabId = 'beobachtungBeobachtungTab';
      
      document.getElementById(tabId).style.display = 'block';
      
      if (tabName === 'list') {
        renderAktenListe();
      }
    }

    function updateBeobachtungPreview() {
      const name = document.getElementById('beobachtungName').value;
      const dn = document.getElementById('beobachtungDN').value;
      const grund = document.getElementById('beobachtungGrund').value;

      const template = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: ${name || ''}
DN: ${dn || ''}
Grund: ${grund || ''}
/////////////////////////////////////////////////////////////////////////
<@&${settings.hrDiscordRoleId}>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

      document.getElementById('beobachtungPreview').textContent = template;
    }

    async function copyBeobachtungTemplate() {
      const template = document.getElementById('beobachtungPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function createNewAkte() {
      const name = document.getElementById('akteName').value.trim();
      const dn = document.getElementById('akteDN').value;
      const unit = document.getElementById('akteUnit').value;
      const rank = document.getElementById('akteRank').value;

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind erforderlich', 'warning');
        return;
      }

      const existingAkte = akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
      if (existingAkte) {
        showNotification('Eine Akte fÃ¼r diese Person existiert bereits', 'warning');
        return;
      }

      const akte = {
        id: `AKTE-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        beobachtungen: [],
        lastUpdated: new Date().toISOString()
      };

      try {
        await db.collection('hrAkten').doc(akte.id).set(akte);
        
        // Audit Log erstellen
        await createAuditLog('create', 'akte', akte.id, `Neue Akte erstellt: ${name} (DN ${dn})`);
        
        showNotification('Akte erfolgreich erstellt', 'success');
        document.getElementById('akteName').value = '';
        document.getElementById('akteDN').value = '';
        document.getElementById('akteUnit').value = '';
        document.getElementById('akteRank').value = '';
        renderAktenListe();
        switchBeobachtungTab('list');
      } catch (error) {
        console.error('Fehler beim Erstellen der Akte:', error);
        showNotification('Fehler beim Erstellen: ' + error.message, 'error');
      }
    }

    async function saveBeobachtungToAkte() {
      const name = document.getElementById('beobachtungName').value.trim();
      const dn = document.getElementById('beobachtungDN').value;
      const grund = document.getElementById('beobachtungGrund').value.trim();

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind erforderlich', 'warning');
        return;
      }

      if (!grund) {
        showNotification('Bitte geben Sie einen Grund fÃ¼r die Beobachtung an', 'warning');
        return;
      }

      let akte = akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
      
      if (!akte) {
        const newAkte = {
          id: `AKTE-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
          name,
          dn,
          unit: '',
          rank: '',
          created: new Date().toISOString(),
          createdFormatted: new Date().toLocaleDateString('de-DE'),
          beobachtungen: [],
          lastUpdated: new Date().toISOString()
        };
        
        try {
          await db.collection('hrAkten').doc(newAkte.id).set(newAkte);
          
          // Audit Log erstellen
          await createAuditLog('create', 'akte', newAkte.id, `Neue Akte erstellt mit Beobachtung: ${name} (DN ${dn})`);
          
          akte = newAkte;
        } catch (error) {
          console.error('Fehler beim Erstellen der Akte:', error);
          showNotification('Fehler beim Erstellen der Akte: ' + error.message, 'error');
          return;
        }
      }

      const beobachtung = {
        id: `BEO-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        grund,
        date: new Date().toISOString(),
        dateFormatted: new Date().toLocaleDateString('de-DE'),
        template: document.getElementById('beobachtungPreview').textContent
      };

      try {
        if (!akte.beobachtungen) akte.beobachtungen = [];
        akte.beobachtungen.unshift(beobachtung);
        akte.lastUpdated = new Date().toISOString();
        
        await db.collection('hrAkten').doc(akte.id).update({
          beobachtungen: akte.beobachtungen,
          lastUpdated: akte.lastUpdated
        });
        
        // Audit Log erstellen
        await createAuditLog('create', 'beobachtung', beobachtung.id, `Beobachtung hinzugefÃ¼gt zu Akte: ${name} (DN ${dn})`);
        
        showNotification('Beobachtung zur Akte hinzugefÃ¼gt', 'success');
        document.getElementById('beobachtungName').value = '';
        document.getElementById('beobachtungDN').value = '';
        document.getElementById('beobachtungGrund').value = '';
        updateBeobachtungPreview();
        renderAktenListe();
        switchBeobachtungTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern der Beobachtung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderAktenListe() {
      const container = document.getElementById('aktenListe');
      const searchTerm = document.getElementById('aktenSearch')?.value.toLowerCase() || '';
      
      let filteredAkten = akten;
      if (searchTerm) {
        filteredAkten = akten.filter(akte => 
          akte.name.toLowerCase().includes(searchTerm) || 
          akte.dn.toString().includes(searchTerm)
        );
      }
      
      if (filteredAkten.length === 0) {
        container.innerHTML = `
          <div class="empty-beobachtungen">
            <div class="empty-beobachtungen-icon"><i class="fas fa-folder-open"></i></div>
            <div class="empty-beobachtungen-title">${searchTerm ? 'Keine passenden Akten gefunden' : 'Keine Akten gefunden'}</div>
            <div class="empty-description">${searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihre erste Akte'}</div>
          </div>
        `;
        return;
      }

      let html = '';
      filteredAkten.forEach(akte => {
        const beobachtungenCount = akte.beobachtungen ? akte.beobachtungen.length : 0;
        
        html += `
          <div class="beobachtung-akte-item">
            <div class="beobachtung-akte-header">
              <div class="beobachtung-akte-name">${escapeHtml(akte.name)}</div>
              <div class="beobachtung-akte-dn">DN ${escapeHtml(akte.dn)}</div>
            </div>
            <div class="beobachtung-akte-date">
              <i class="fas fa-calendar"></i> Erstellt: ${akte.createdFormatted}
            </div>
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
              <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                ${akte.unit || 'Keine Unit'}
              </div>
              <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                ${akte.rank || 'Kein Rang'}
              </div>
            </div>
            <div style="color: var(--gray); font-size: 11px; margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-eye"></i> ${beobachtungenCount} Beobachtung${beobachtungenCount !== 1 ? 'en' : ''}
            </div>
        `;

        if (beobachtungenCount > 0) {
          const latestBeobachtung = akte.beobachtungen[0];
          html += `
            <div class="beobachtung-akte-grund">
              <div style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">
                <i class="fas fa-calendar"></i> Letzte Beobachtung: ${latestBeobachtung.dateFormatted}
              </div>
              ${escapeHtml(latestBeobachtung.grund.length > 150 ? latestBeobachtung.grund.substring(0, 150) + '...' : latestBeobachtung.grund)}
            </div>
          `;
        }

        html += `
            <div class="beobachtung-akte-actions">
              <button class="beobachtung-akte-btn beobachtung-akte-btn-copy" onclick="openAkteDetail('${akte.id}')">
                <i class="fas fa-eye"></i> Akte Ã¶ffnen
              </button>
              <button class="beobachtung-akte-btn beobachtung-akte-btn-delete" onclick="deleteAkte('${akte.id}')">
                <i class="fas fa-trash"></i> LÃ¶schen
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function searchAkten(searchTerm) {
      renderAktenListe();
    }

    function openAkteDetail(akteId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte) return;

      let beobachtungenHtml = '';
      if (akte.beobachtungen && akte.beobachtungen.length > 0) {
        akte.beobachtungen.forEach(beobachtung => {
          beobachtungenHtml += `
            <div class="beobachtung-akte-item">
              <div class="beobachtung-akte-date">
                <i class="fas fa-calendar"></i> ${beobachtung.dateFormatted}
              </div>
              <div class="beobachtung-akte-grund">
                ${escapeHtml(beobachtung.grund)}
              </div>
              <div class="beobachtung-akte-template">
                ${escapeHtml(beobachtung.template)}
              </div>
              <div class="beobachtung-akte-actions">
                <button class="beobachtung-akte-btn beobachtung-akte-btn-copy" onclick="copyBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                  <i class="fas fa-copy"></i> Kopieren
                </button>
                <button class="beobachtung-akte-btn beobachtung-akte-btn-delete" onclick="deleteBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                  <i class="fas fa-trash"></i> LÃ¶schen
                </button>
              </div>
            </div>
          `;
        });
      } else {
        beobachtungenHtml = `
          <div class="empty-beobachtungen">
            <div class="empty-beobachtungen-icon"><i class="fas fa-eye"></i></div>
            <div class="empty-beobachtungen-title">Keine Beobachtungen</div>
            <div class="empty-description">FÃ¼gen Sie die erste Beobachtung hinzu</div>
          </div>
        `;
      }

      const modalHtml = `
        <div class="beobachtung-akten-modal active" onclick="if(event.target===this)closeModal('akteDetailModal')">
          <div class="beobachtung-akten-content">
            <div class="beobachtung-akten-header">
              <div class="beobachtung-akten-title">
                <i class="fas fa-folder-open"></i> Akte: ${escapeHtml(akte.name)} (DN ${escapeHtml(akte.dn)})
              </div>
              <button class="beobachtung-akten-close" onclick="closeModal('akteDetailModal')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="beobachtung-akten-body">
              <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                  <i class="fas fa-building"></i> ${akte.unit || 'Keine Unit'}
                </div>
                <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                  <i class="fas fa-user-tie"></i> ${akte.rank || 'Kein Rang'}
                </div>
                <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                  <i class="fas fa-eye"></i> ${akte.beobachtungen ? akte.beobachtungen.length : 0} Beobachtungen
                </div>
              </div>
              
              <div class="beobachtung-akten-liste">
                ${beobachtungenHtml}
              </div>
              
              <div class="beobachtung-actions">
                <button class="beobachtung-btn beobachtung-btn-save" onclick="addNewBeobachtungToAkte('${akte.id}')">
                  <i class="fas fa-plus"></i> Neue Beobachtung hinzufÃ¼gen
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      const modalContainer = document.createElement('div');
      modalContainer.id = 'akteDetailModal';
      modalContainer.innerHTML = modalHtml;
      document.body.appendChild(modalContainer);
    }

    async function copyBeobachtungFromAkte(akteId, beobachtungId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte || !akte.beobachtungen) return;

      const beobachtung = akte.beobachtungen.find(b => b.id === beobachtungId);
      if (!beobachtung) return;

      const success = await copyToClipboard(beobachtung.template);
      showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function deleteBeobachtungFromAkte(akteId, beobachtungId) {
      if (!confirm('Beobachtung wirklich lÃ¶schen? Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.')) return;

      const akte = akten.find(a => a.id === akteId);
      if (!akte || !akte.beobachtungen) return;

      try {
        const beobachtung = akte.beobachtungen.find(b => b.id === beobachtungId);
        akte.beobachtungen = akte.beobachtungen.filter(b => b.id !== beobachtungId);
        akte.lastUpdated = new Date().toISOString();
        
        await db.collection('hrAkten').doc(akteId).update({
          beobachtungen: akte.beobachtungen,
          lastUpdated: akte.lastUpdated
        });
        
        // Audit Log erstellen
        if (beobachtung) {
          await createAuditLog('delete', 'beobachtung', beobachtungId, `Beobachtung gelÃ¶scht aus Akte: ${akte.name}`);
        }
        
        showNotification('Beobachtung gelÃ¶scht', 'success');
        closeModal('akteDetailModal');
        setTimeout(() => openAkteDetail(akteId), 100);
        renderAktenListe();
      } catch (error) {
        console.error('Fehler beim LÃ¶schen der Beobachtung:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    async function deleteAkte(akteId) {
      if (!confirm('Akte wirklich lÃ¶schen? Alle Beobachtungen werden ebenfalls gelÃ¶scht.')) return;

      try {
        const akte = akten.find(a => a.id === akteId);
        if (akte) {
          await createAuditLog('delete', 'akte', akteId, `Akte gelÃ¶scht: ${akte.name} (DN ${akte.dn})`);
        }
        
        await db.collection('hrAkten').doc(akteId).delete();
        showNotification('Akte gelÃ¶scht', 'success');
      } catch (error) {
        console.error('Fehler beim LÃ¶schen der Akte:', error);
        showNotification('Fehler beim LÃ¶schen: ' + error.message, 'error');
      }
    }

    function addNewBeobachtungToAkte(akteId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte) return;

      closeModal('akteDetailModal');
      openBeobachtungAktenModal();
      switchBeobachtungTab('beobachtung');
      document.getElementById('beobachtungName').value = akte.name;
      document.getElementById('beobachtungDN').value = akte.dn;
      updateBeobachtungPreview();
    }

    // ==================== HILFSFUNKTIONEN ====================
    function seedTemplateBoxes() {
      document.getElementById('oralTemplateContent').textContent = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
MÃ¼ndliche Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&${settings.hrDiscordRoleId}>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;

      document.getElementById('orgTemplateContent').textContent = `â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
/////////////////////////////////////////////////////////////////////////
Organisatorische Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&${settings.hrDiscordRoleId}>
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•`;
    }

    async function copyOralTemplate() {
      const template = document.getElementById('oralTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'MÃ¼ndliche Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function copyOrgTemplate() {
      const template = document.getElementById('orgTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Organisatorische Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
        if (modalId === 'akteDetailModal') {
          setTimeout(() => modal.remove(), 300);
        }
      }
    }

    function openNewEmployeeModal() {
      openModal('newEmployeeModal');
    }

    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const messageElement = document.getElementById('notificationMessage');
      messageElement.textContent = message;

      if (type === 'success') notification.style.background = 'var(--secondary)';
      else if (type === 'error') notification.style.background = 'var(--danger)';
      else if (type === 'warning') notification.style.background = 'var(--warning)';
      else notification.style.background = 'var(--primary)';

      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 3000);
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        try {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch {
          return false;
        }
      }
    }

    // Employee Context Menu Funktionen (vereinfacht)
    function showEmployeeContextMenu(e, employee) {
      e.preventDefault();
      // Vereinfachte Version - kÃ¶nnte erweitert werden
      selectEmployee(employee);
      openEditEmployeeModal();
    }

  </script>
</body>
</html>
