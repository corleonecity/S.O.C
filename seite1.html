<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- CACHE-CONTROL META TAGS -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  
  <title>üìã HR - Einweisungsmanagement v1.0</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <style>
    :root {
      --primary: #4f46e5;
      --primary-dark: #4338ca;
      --primary-light: #818cf8;
      --secondary: #10b981;
      --secondary-dark: #059669;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --purple: #8b5cf6;
      --purple-dark: #7c3aed;
      --dark: #0f172a;
      --dark-card: #1e293b;
      --darker: #0f172a;
      --light: #f1f5f9;
      --gray: #94a3b8;
      --gray-light: #cbd5e1;
      --gray-dark: #475569;
      --border: rgba(255, 255, 255, 0.08);

      --shadow-lg: 0 20px 40px -15px rgba(0, 0, 0, 0.3);
      --shadow-md: 0 8px 20px rgba(0, 0, 0, 0.15);
      --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
      --shadow-card: 0 2px 8px rgba(0, 0, 0, 0.1);

      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --radius-xs: 4px;

      --transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-smooth: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      --transition-fast: all 0.15s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Animierte Hintergrund-Effekte */
    body {
      font-family: 'Inter', sans-serif;
      background: var(--darker);
      color: var(--light);
      min-height: 100vh;
      overflow-x: hidden;
      font-size: 15px;
      line-height: 1.5;
      position: relative;
    }

    .bg-effects {
      position: fixed;
      inset: 0;
      z-index: -2;
      overflow: hidden;
      pointer-events: none;
    }

    .bg-gradient {
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(circle at 15% 70%, rgba(79, 70, 229, 0.15) 0%, transparent 45%),
        radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.12) 0%, transparent 45%),
        radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
      animation: gradientShift 20s ease infinite alternate;
    }

    .bg-particles {
      position: absolute;
      inset: 0;
      opacity: 0.4;
    }

    .particle {
      position: absolute;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      animation: float 25s infinite linear;
    }

    @keyframes float {
      0% {
        transform: translateY(0) translateX(0) rotate(0deg);
        opacity: 0;
      }
      10% {
        opacity: 0.5;
      }
      90% {
        opacity: 0.5;
      }
      100% {
        transform: translateY(-100vh) translateX(100px) rotate(360deg);
        opacity: 0;
      }
    }

    @keyframes gradientShift {
      0% {
        transform: scale(1) rotate(0deg);
      }
      50% {
        transform: scale(1.05) rotate(1deg);
      }
      100% {
        transform: scale(1) rotate(0deg);
      }
    }

    .app-container {
      max-width: 1300px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 20px;
      min-height: 100vh;
      position: relative;
      z-index: 1;
    }

    /* Header - Modernisiert */
    .app-header {
      grid-column: 1 / -1;
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 20px 28px;
      margin-bottom: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: var(--shadow-md);
      position: relative;
      overflow: hidden;
    }

    .app-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .logo-container {
      width: 56px;
      height: 56px;
      border-radius: var(--radius-md);
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(139, 92, 246, 0.1));
      border: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
      padding: 8px;
    }

    .logo-container img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: var(--radius-sm);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-text h1 {
      font-size: 22px;
      font-weight: 800;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
      letter-spacing: -0.5px;
    }

    .brand-text .subtitle {
      font-size: 13px;
      color: var(--gray);
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .header-icons {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-left: 8px;
    }

    .header-icon {
      font-size: 18px;
      cursor: pointer;
      transition: var(--transition);
      opacity: 0.8;
      background: rgba(255, 255, 255, 0.05);
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .header-icon:hover {
      opacity: 1;
      transform: translateY(-2px);
      background: rgba(255, 255, 255, 0.1);
      border-color: var(--primary);
    }

    .header-stats {
      display: flex;
      gap: 16px;
    }

    .stat-card {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 14px 20px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: var(--radius-md);
      border: 1px solid rgba(255, 255, 255, 0.08);
      min-width: 100px;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg, var(--primary), var(--purple));
      opacity: 0;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-3px);
      background: rgba(255, 255, 255, 0.08);
      border-color: rgba(255, 255, 255, 0.12);
      box-shadow: var(--shadow-sm);
    }

    .stat-card:hover::before {
      opacity: 1;
    }

    .stat-value {
      font-size: 24px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 4px;
      letter-spacing: -0.5px;
    }

    .stat-label {
      font-size: 11px;
      color: var(--gray);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 700;
    }

    /* Sidebar - Verbessert */
    .sidebar {
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      height: calc(100vh - 140px);
      position: sticky;
      top: 20px;
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-md);
    }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .sidebar-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--gray-light);
      display: flex;
      align-items: center;
      gap: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .employee-count {
      background: linear-gradient(135deg, var(--primary), var(--purple));
      color: #fff;
      font-size: 12px;
      font-weight: 800;
      padding: 6px 14px;
      border-radius: 20px;
      min-width: 36px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    }

    .sidebar-filter-buttons {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
    }

    .sidebar-filter-btn {
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: var(--radius-md);
      color: var(--gray-light);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      flex: 1;
      text-align: center;
      letter-spacing: 0.3px;
    }

    .sidebar-filter-btn:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .sidebar-filter-btn.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.2);
    }

    .sidebar-controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 20px;
    }

    .search-container {
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 12px 16px 12px 44px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      font-family: 'Inter', sans-serif;
    }

    .search-input::placeholder {
      color: rgba(255, 255, 255, 0.4);
      font-weight: 400;
    }

    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
    }

    .search-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
      font-size: 14px;
    }

    .employee-list-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-bottom: 20px;
      min-height: 0;
    }

    .employee-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      overflow-y: auto;
      padding-right: 6px;
      flex: 1;
      min-height: 0;
    }

    .employee-list::-webkit-scrollbar {
      width: 6px;
    }

    .employee-list::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 3px;
    }

    .employee-list::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 3px;
    }

    .employee-list::-webkit-scrollbar-thumb:hover {
      background: var(--primary-dark);
    }

    /* Employee Cards - Modernisiert */
    .employee-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: var(--radius-md);
      padding: 18px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      cursor: pointer;
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 120px;
      justify-content: flex-start;
    }

    .employee-card::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: linear-gradient(to bottom, var(--primary), var(--purple));
      opacity: 0;
      transition: var(--transition);
    }

    .employee-card:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: rgba(79, 70, 229, 0.4);
      transform: translateY(-2px);
      box-shadow: var(--shadow-card);
    }

    .employee-card:hover::before {
      opacity: 1;
    }

    .employee-card.active {
      background: rgba(79, 70, 229, 0.12);
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary), 0 8px 24px rgba(79, 70, 229, 0.15);
    }

    .employee-card.active::before {
      opacity: 1;
    }

    .employee-card.archived {
      opacity: 0.7;
      border-color: var(--warning);
    }

    .employee-card.archived .employee-name::after {
      content: ' [ARCHIV]';
      color: var(--warning);
      font-size: 11px;
      font-weight: 700;
      margin-left: 6px;
    }

    .employee-top-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 4px;
    }

    .employee-name {
      font-weight: 700;
      font-size: 16px;
      color: #fff;
      line-height: 1.3;
      word-break: break-word;
      letter-spacing: -0.3px;
    }

    .employee-dn {
      font-family: 'Inter', monospace;
      font-size: 12px;
      font-weight: 700;
      color: var(--primary-light);
      background: rgba(79, 70, 229, 0.12);
      padding: 4px 10px;
      border-radius: 20px;
      border: 1px solid rgba(79, 70, 229, 0.25);
      white-space: nowrap;
      flex-shrink: 0;
      margin-left: 10px;
    }

    .employee-meta {
      font-size: 12px;
      color: var(--gray);
      line-height: 1.4;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .employee-meta i {
      font-size: 11px;
      opacity: 0.6;
    }

    .induction-badges {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .induction-badge {
      font-size: 11px;
      padding: 5px 10px;
      border-radius: 12px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 5px;
      white-space: nowrap;
      transition: var(--transition);
      border: 1px solid transparent;
      letter-spacing: 0.3px;
    }

    .induction-badge:hover {
      transform: translateY(-1px);
    }

    .badge-oral.pending {
      background: rgba(239, 68, 68, 0.12);
      color: #fca5a5;
      border-color: rgba(239, 68, 68, 0.25);
    }

    .badge-oral.completed {
      background: rgba(16, 185, 129, 0.12);
      color: #86efac;
      border-color: rgba(16, 185, 129, 0.25);
    }

    .badge-org.pending {
      background: rgba(245, 158, 11, 0.12);
      color: #fcd34d;
      border-color: rgba(245, 158, 11, 0.25);
    }

    .badge-org.completed {
      background: rgba(16, 185, 129, 0.12);
      color: #86efac;
      border-color: rgba(16, 185, 129, 0.25);
    }

    .quick-actions {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: auto;
    }

    .quick-action-btn {
      padding: 12px;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.12), rgba(139, 92, 246, 0.08));
      border: 1px solid rgba(79, 70, 229, 0.2);
      border-radius: var(--radius-md);
      color: var(--primary-light);
      font-size: 13px;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      letter-spacing: 0.3px;
    }

    .quick-action-btn:hover {
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.2), rgba(139, 92, 246, 0.12));
      border-color: var(--primary);
      transform: translateY(-2px);
      color: #fff;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.2);
    }

    /* Main Content - Verbessert */
    .main-content {
      background: rgba(30, 41, 59, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255, 255, 255, 0.1);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-height: 500px;
      box-shadow: var(--shadow-md);
    }

    .content-header {
      padding: 24px 28px;
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.08), rgba(139, 92, 246, 0.05));
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: none;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      position: relative;
    }

    .content-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
    }

    .employee-info h2 {
      font-size: 22px;
      font-weight: 800;
      color: #fff;
      margin-bottom: 12px;
      letter-spacing: -0.5px;
    }

    .employee-tags {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .employee-tag {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--gray);
      font-weight: 600;
    }

    .tag-value {
      color: #fff;
      font-weight: 700;
      background: rgba(79, 70, 229, 0.12);
      padding: 6px 12px;
      border-radius: var(--radius-sm);
      border: 1px solid rgba(79, 70, 229, 0.25);
      font-size: 12px;
      letter-spacing: 0.3px;
    }

    .action-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* Buttons - Konsistent und modern */
    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-size: 14px;
      user-select: none;
      letter-spacing: 0.3px;
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s;
    }

    .btn:hover::after {
      left: 100%;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: #fff;
      box-shadow: 0 6px 16px rgba(79, 70, 229, 0.3);
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(79, 70, 229, 0.4);
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.08);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    .btn-secondary:hover {
      background: rgba(255, 255, 255, 0.12);
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: var(--shadow-sm);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), var(--danger-dark));
      color: #fff;
      box-shadow: 0 6px 16px rgba(239, 68, 68, 0.3);
    }

    .btn-danger:hover {
      background: linear-gradient(135deg, var(--danger-dark), var(--danger));
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(239, 68, 68, 0.4);
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), var(--warning-dark));
      color: #fff;
      box-shadow: 0 6px 16px rgba(245, 158, 11, 0.3);
    }

    .btn-warning:hover {
      background: linear-gradient(135deg, var(--warning-dark), var(--warning));
      transform: translateY(-2px);
      box-shadow: 0 10px 24px rgba(245, 158, 11, 0.4);
    }

    /* Induction Content */
    .induction-content {
      padding: 28px;
      flex: 1;
      overflow-y: auto;
      display: none;
    }

    .induction-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin-bottom: 28px;
    }

    .induction-card {
      background: rgba(255, 255, 255, 0.04);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
    }

    .induction-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--primary), transparent);
      opacity: 0.5;
    }

    .induction-card.completed {
      border-color: var(--secondary);
      background: rgba(16, 185, 129, 0.06);
      box-shadow: 0 8px 32px rgba(16, 185, 129, 0.1);
    }

    .induction-card.completed::before {
      background: linear-gradient(90deg, transparent, var(--secondary), transparent);
    }

    .induction-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 12px;
    }

    .induction-title {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .induction-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, var(--primary), var(--purple));
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      color: #fff;
      flex-shrink: 0;
    }

    .induction-card.completed .induction-icon {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
    }

    .induction-status {
      font-size: 12px;
      font-weight: 800;
      padding: 6px 12px;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.08);
      color: var(--gray);
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .induction-card.completed .induction-status {
      background: rgba(16, 185, 129, 0.2);
      color: var(--secondary);
    }

    .oral-form-grid,
    .org-form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
      margin-bottom: 8px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-label {
      font-weight: 700;
      color: var(--gray-light);
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-select,
    .form-textarea {
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: var(--radius-md);
      color: #fff;
      font-size: 14px;
      transition: var(--transition);
      width: 100%;
      font-family: 'Inter', sans-serif;
    }

    .form-input::placeholder,
    .form-textarea::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    .form-select {
      color: #fff;
      background-color: rgba(255, 255, 255, 0.05);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' fill='white' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 16px center;
      padding-right: 40px;
    }

    .form-select option {
      background: var(--dark-card);
      color: #fff;
    }

    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: var(--primary);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.15);
    }

    .form-textarea {
      resize: vertical;
      min-height: 80px;
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
    }

    .time-container {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 10px;
      align-items: center;
    }

    .time-separator {
      color: var(--gray);
      font-weight: 600;
      text-align: center;
      font-size: 14px;
      padding: 0 6px;
    }

    input[type="time"] {
      font-size: 14px;
      padding: 11px 14px;
    }

    /* Toggle Switch - Modernisiert */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 28px;
    }

    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.12);
      transition: var(--transition);
      border-radius: 34px;
    }

    .toggle-slider::before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 4px;
      bottom: 4px;
      background-color: #fff;
      transition: var(--transition);
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
    }

    input:checked + .toggle-slider {
      background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
    }

    input:checked + .toggle-slider::before {
      transform: translateX(22px);
    }

    /* Templates Section */
    .templates-section {
      background: rgba(255, 255, 255, 0.04);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 12px;
      flex-wrap: wrap;
    }

    .section-title {
      font-size: 16px;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .template-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }

    .template-cards {
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    .template-card {
      background: rgba(0, 0, 0, 0.25);
      border-radius: var(--radius-md);
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      transition: var(--transition);
    }

    .template-card:hover {
      border-color: rgba(255, 255, 255, 0.15);
      transform: translateY(-2px);
    }

    .template-card.completed {
      border-color: var(--secondary);
      background: rgba(16, 185, 129, 0.08);
    }

    .template-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      gap: 12px;
    }

    .template-card-title {
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .template-badge {
      font-size: 11px;
      font-weight: 800;
      padding: 5px 12px;
      border-radius: 20px;
      background: rgba(79, 70, 229, 0.12);
      color: var(--primary-light);
      white-space: nowrap;
      letter-spacing: 0.5px;
    }

    .template-card.completed .template-badge {
      background: rgba(16, 185, 129, 0.2);
      color: var(--secondary);
    }

    .template-content {
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      background: rgba(0, 0, 0, 0.35);
      padding: 16px;
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--primary);
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 12px;
      line-height: 1.5;
      color: var(--gray-light);
      max-height: 200px;
      overflow-y: auto;
    }

    .template-card.completed .template-content {
      border-left-color: var(--secondary);
    }

    /* Floating Buttons - Modernisiert */
    .floating-buttons-container {
      position: fixed;
      bottom: 28px;
      right: 28px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      z-index: 1000;
    }

    .floating-button {
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border: none;
      border-radius: 50%;
      color: #fff;
      font-size: 22px;
      cursor: pointer;
      box-shadow: var(--shadow-lg);
      transition: var(--transition);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }

    .floating-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(circle at center, rgba(255, 255, 255, 0.2), transparent);
      opacity: 0;
      transition: var(--transition);
    }

    .floating-button:hover::after {
      opacity: 1;
    }

    .floating-button:hover {
      transform: scale(1.1) translateY(-4px);
      box-shadow: 0 15px 35px rgba(79, 70, 229, 0.4);
    }

    .floating-button.soldaten {
      background: linear-gradient(135deg, var(--warning), var(--warning-dark));
    }

    .floating-button.soldaten:hover {
      box-shadow: 0 15px 35px rgba(245, 158, 11, 0.4);
    }

    /* Alle bestehenden Modal-Stile bleiben erhalten */
    /* Die bestehenden Modal-Stile bleiben im Wesentlichen gleich, nur mit konsistenteren Schriftgr√∂√üen und Abst√§nden */

    /* Responsive Verbesserungen */
    @media (max-width: 1200px) {
      .app-container {
        grid-template-columns: 1fr;
        padding: 16px;
        gap: 16px;
      }
      
      .sidebar {
        position: static;
        max-height: 500px;
        height: auto;
        top: 0;
      }
      
      .induction-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .app-header {
        padding: 16px 20px;
      }
      
      .header-content {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .header-stats {
        justify-content: center;
      }
      
      .brand {
        gap: 12px;
      }
      
      .brand-text h1 {
        font-size: 18px;
      }
      
      .brand-text .subtitle {
        font-size: 12px;
      }
      
      .content-header {
        flex-direction: column;
        align-items: stretch;
        padding: 20px;
      }
      
      .employee-tags {
        flex-direction: column;
        gap: 8px;
      }
      
      .induction-content {
        padding: 20px;
      }
      
      .oral-form-grid,
      .org-form-grid {
        grid-template-columns: 1fr;
      }
      
      .floating-buttons-container {
        bottom: 20px;
        right: 20px;
      }
      
      .floating-button {
        width: 56px;
        height: 56px;
        font-size: 20px;
      }
    }

    @media (max-width: 480px) {
      .app-container {
        padding: 12px;
      }
      
      .app-header {
        padding: 14px 16px;
      }
      
      .stat-card {
        padding: 12px 16px;
        min-width: 85px;
      }
      
      .stat-value {
        font-size: 20px;
      }
      
      .sidebar {
        padding: 16px;
      }
      
      .floating-buttons-container {
        bottom: 16px;
        right: 16px;
      }
    }

    /* Animierte Elemente */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeInUp 0.4s ease forwards;
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(79, 70, 229, 0.4);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(79, 70, 229, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(79, 70, 229, 0);
      }
    }

    /* Smooth Scroll */
    * {
      scrollbar-width: thin;
      scrollbar-color: var(--primary) rgba(255, 255, 255, 0.05);
    }

    *::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    *::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    *::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, var(--primary), var(--purple));
      border-radius: 4px;
    }

    *::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(to bottom, var(--primary-dark), var(--purple-dark));
    }
  </style>
</head>

<body>
  <!-- Animierter Hintergrund -->
  <div class="bg-effects">
    <div class="bg-gradient"></div>
    <div class="bg-particles" id="bgParticles"></div>
  </div>

  <!-- Main Password Modal (am Anfang) -->
  <div class="main-password-modal" id="mainPasswordModal">
    <div class="main-password-content">
      <div class="main-password-header">
        <div class="main-password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr HR App erforderlich
        </div>
      </div>
      <div class="main-password-form">
        <input type="password" class="main-password-input" id="mainPasswordInput" 
               placeholder="Passwort eingeben" onkeypress="if(event.key === 'Enter') checkMainPassword()">
        <div class="main-password-error" id="mainPasswordError" style="display:none">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkMainPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Settings Password Modal -->
  <div class="settings-password-modal" id="settingsPasswordModal">
    <div class="settings-password-content">
      <div class="settings-password-header">
        <div class="settings-password-title">
          <i class="fas fa-lock"></i> Passwort f√ºr Settings erforderlich
        </div>
        <button class="settings-password-close" onclick="closeSettingsPasswordModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="settings-password-form">
        <input type="password" class="settings-password-input" id="settingsPasswordInput" 
               placeholder="Passwort eingeben" onkeypress="if(event.key === 'Enter') checkSettingsPassword()">
        <div class="settings-password-error" id="settingsPasswordError">Falsches Passwort</div>
        <button class="btn btn-primary" onclick="checkSettingsPassword()">
          <i class="fas fa-unlock"></i> Best√§tigen
        </button>
      </div>
    </div>
  </div>

  <!-- Edit Ank√ºndigung/Besprechung Modal -->
  <div class="edit-item-modal" id="editItemModal">
    <div class="edit-item-content">
      <div class="edit-item-header">
        <div class="edit-item-title" id="editItemTitle">
          <i class="fas fa-edit"></i> Bearbeiten
        </div>
        <button class="edit-item-close" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="edit-item-body">
        <div class="edit-item-form" id="editItemForm">
          <!-- Form wird dynamisch eingef√ºgt -->
        </div>
      </div>
      
      <div class="edit-item-actions">
        <button class="btn btn-secondary" onclick="closeEditItemModal()">
          <i class="fas fa-times"></i> Abbrechen
        </button>
        <button class="btn btn-primary" onclick="saveEditedItem()">
          <i class="fas fa-save"></i> √Ñnderungen speichern
        </button>
      </div>
    </div>
  </div>

  <!-- Ank√ºndigung Banner -->
  <div class="ankundigung-banner" id="ankundigungBanner">
    <div class="banner-header">
      <div class="banner-title" id="bannerTitle">
        <span>ü™ß</span> Ank√ºndigung
      </div>
      <button class="banner-close" onclick="closeBanner()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="banner-content" id="bannerContent">
      Lade Ank√ºndigung...
    </div>
    <div class="banner-meta">
      <div class="banner-type" id="bannerType">Ank√ºndigung</div>
      <div id="bannerDate">Heute</div>
    </div>
  </div>

  <!-- Ank√ºndigungen Modal -->
  <div class="ankundigungen-modal" id="ankundigungenModal" onclick="if(event.target===this)closeModal('ankundigungenModal')">
    <div class="ankundigungen-content">
      <div class="ankundigungen-header">
        <div class="ankundigungen-title">
          <i class="fas fa-bullhorn"></i> Ank√ºndigungen
        </div>
        <button class="ankundigungen-close" onclick="closeModal('ankundigungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="ankundigungen-body">
        <div class="ankundigungen-search-container">
          <i class="fas fa-search ankundigungen-search-icon"></i>
          <input type="text" class="ankundigungen-search-input" id="ankundigungenSearch" 
                 placeholder="Nach Thema oder Inhalt suchen..." oninput="searchAnkundigungen(this.value)">
        </div>
        
        <div class="ankundigungen-list-container">
          <div class="ankundigungen-list" id="ankundigungenList">
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Ank√ºndigung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Besprechungen Modal -->
  <div class="besprechungen-modal" id="besprechungenModal" onclick="if(event.target===this)closeModal('besprechungenModal')">
    <div class="besprechungen-content">
      <div class="besprechungen-header">
        <div class="besprechungen-title">
          <i class="fas fa-calendar-alt"></i> Besprechungen
        </div>
        <button class="besprechungen-close" onclick="closeModal('besprechungenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="besprechungen-body">
        <div class="besprechungen-search-container">
          <i class="fas fa-search besprechungen-search-icon"></i>
          <input type="text" class="besprechungen-search-input" id="besprechungenSearch" 
                 placeholder="Nach Thema oder Inhalt suchen..." oninput="searchBesprechungen(this.value)">
        </div>
        
        <div class="besprechungen-list-container">
          <div class="besprechungen-list" id="besprechungenList">
            <div class="empty-besprechungen">
              <div class="empty-besprechungen-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-besprechungen-title">Keine Besprechungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Besprechung in den Settings</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Floating Buttons -->
  <div class="floating-buttons-container">
    <button class="floating-button soldaten" onclick="openSoldatenModal()" title="Soldatengespr√§che">
      <i class="fas fa-comments"></i>
    </button>
    <button class="floating-button" onclick="openBeobachtungAktenModal()" title="Beobachtungs-Akten">
      <i class="fas fa-folder-open"></i>
    </button>
    <button class="floating-button" onclick="openSettingsWithPassword()" title="Settings">
      <i class="fas fa-cog"></i>
    </button>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal" onclick="if(event.target===this)closeModal('settingsModal')">
    <div class="settings-content">
      <div class="settings-header">
        <div class="settings-title">
          <i class="fas fa-cog"></i> Settings
        </div>
        <button class="settings-close" onclick="closeModal('settingsModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="settings-body">
        <div class="settings-tabs">
          <button class="settings-tab active" onclick="switchSettingsTab('units')">
            <i class="fas fa-building"></i> Units
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('ranks')">
            <i class="fas fa-user-tie"></i> R√§nge
          </button>
          <button class="settings-tab" onclick="switchSettingsTab('ankundigungen')">
            <i class="fas fa-bullhorn"></i> Ank√ºndigungen
          </button>
        </div>
        
        <!-- Units Tab -->
        <div class="settings-tab-content" id="unitsTab">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-building"></i> Unit-Liste bearbeiten</h3>
            <div class="unit-list" id="unitList">
              <!-- Units werden hier dynamisch geladen -->
            </div>
            <button class="add-btn" onclick="addNewUnit()">
              <i class="fas fa-plus"></i> Neue Unit hinzuf√ºgen
            </button>
          </div>
        </div>
        
        <!-- R√§nge Tab -->
        <div class="settings-tab-content" id="ranksTab" style="display:none;">
          <div class="settings-section">
            <h3 class="section-title-settings"><i class="fas fa-user-tie"></i> Rang-Liste bearbeiten</h3>
            <div class="rank-list" id="rankList">
              <!-- R√§nge werden hier dynamisch geladen -->
            </div>
            <button class="add-btn" onclick="addNewRank()">
              <i class="fas fa-plus"></i> Neuen Rang hinzuf√ºgen
            </button>
          </div>
        </div>
        
        <!-- Ank√ºndigungen Tab -->
        <div class="settings-tab-content" id="ankundigungenTab" style="display:none;">
          <div class="ankundigungen-section">
            <div class="ankundigungen-tabs">
              <button class="ankundigungen-tab active" onclick="switchAnkundigungenTab('new')">
                <span>ü™ß</span> Neue Ank√ºndigung
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('besprechung')">
                <span>üóÉÔ∏è</span> Neue Besprechung
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('manage-ankundigungen')">
                <span>üìã</span> Ank√ºndigungen verwalten
              </button>
              <button class="ankundigungen-tab" onclick="switchAnkundigungenTab('manage-besprechungen')">
                <span>üìÖ</span> Besprechungen verwalten
              </button>
            </div>
            
            <!-- Neue Ank√ºndigung -->
            <div class="ankundigungen-tab-content" id="ankundigungenNewTab">
              <div class="ankundigungen-form-grid">
                <div class="settings-form-group">
                  <label class="settings-label">Titel</label>
                  <input type="text" class="settings-input" id="ankundigungTitle" placeholder="Titel der Ank√ºndigung">
                </div>
                <div class="settings-form-group">
                  <label class="settings-label">Inhalt *</label>
                  <textarea class="settings-input" id="ankundigungContent" 
                            placeholder="Inhalt der Ank√ºndigung..." rows="4"></textarea>
                </div>
              </div>
              <div class="settings-actions">
                <button class="btn btn-primary" onclick="saveAnkundigung()">
                  <i class="fas fa-save"></i> Ank√ºndigung speichern
                </button>
              </div>
            </div>
            
            <!-- NEUE BESPRECHUNG - MIT VERBESSERTEM LAYOUT -->
            <div class="ankundigungen-tab-content" id="ankundigungenBesprechungTab" style="display:none;">
              <div class="besprechung-form-scroll-container">
                <div class="besprechung-form-scroll">
                  <div class="besprechung-form-grid">
                    <div class="besprechung-form-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Thema *</label>
                        <input type="text" class="settings-input" id="besprechungThema" placeholder="Thema der Besprechung">
                      </div>
                    </div>
                    
                    <div class="besprechung-form-details-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Datum *</label>
                        <input type="date" class="settings-input" id="besprechungDate" value="">
                      </div>
                      <div class="settings-form-group">
                        <label class="settings-label">Uhrzeit *</label>
                        <input type="time" class="settings-input" id="besprechungTime" value="">
                      </div>
                      <div class="settings-form-group">
                        <label class="settings-label">Ort</label>
                        <input type="text" class="settings-input" id="besprechungOrt" placeholder="Ort der Besprechung">
                      </div>
                    </div>
                    
                    <div class="besprechung-form-row">
                      <div class="settings-form-group">
                        <label class="settings-label">Inhalt *</label>
                        <textarea class="settings-input" id="besprechungContent" 
                                  placeholder="Inhalt der Besprechung..." rows="8"></textarea>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="settings-actions">
                  <button class="btn btn-primary" onclick="saveBesprechung()">
                    <i class="fas fa-save"></i> Besprechung speichern
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Ank√ºndigungen verwalten -->
            <div class="ankundigungen-tab-content" id="ankundigungenManageAnkundigungenTab" style="display:none;">
              <div class="settings-form-group">
                <label class="settings-label">Ank√ºndigungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageAnkundigungenSearch" 
                       placeholder="Nach Ank√ºndigungen suchen..." oninput="searchManageAnkundigungen(this.value)">
              </div>
              
              <div class="manage-items-container">
                <div class="manage-items-list-container">
                  <div class="manage-items-list" id="manageAnkundigungenList">
                    <div class="empty-ankundigungen">
                      <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
                      <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Besprechungen verwalten -->
            <div class="ankundigungen-tab-content" id="ankundigungenManageBesprechungenTab" style="display:none;">
              <div class="settings-form-group">
                <label class="settings-label">Besprechungen durchsuchen</label>
                <input type="text" class="settings-input" id="manageBesprechungenSearch" 
                       placeholder="Nach Besprechungen suchen..." oninput="searchManageBesprechungen(this.value)">
              </div>
              
              <div class="manage-items-container">
                <div class="manage-items-list-container">
                  <div class="manage-items-list" id="manageBesprechungenList">
                    <div class="empty-ankundigungen">
                      <div class="empty-ankundigungen-icon"><i class="fas fa-calendar-alt"></i></div>
                      <div class="empty-ankundigungen-title">Keine Besprechungen gefunden</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="settings-actions">
          <button class="btn btn-secondary" onclick="closeModal('settingsModal')">
            <i class="fas fa-times"></i> Schlie√üen
          </button>
          <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save"></i> Einstellungen speichern
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Soldatengespr√§ch Modal -->
  <div class="soldaten-modal" id="soldatenModal" onclick="if(event.target===this)closeModal('soldatenModal')">
    <div class="soldaten-content">
      <div class="soldaten-header">
        <div class="soldaten-title">
          <i class="fas fa-comments"></i> Soldatengespr√§che
        </div>
        <button class="soldaten-close" onclick="closeModal('soldatenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="soldaten-body">
        <div class="soldaten-tabs">
          <button class="soldaten-tab active" onclick="switchSoldatenTab('new')">Neues Gespr√§ch</button>
          <button class="soldaten-tab" onclick="switchSoldatenTab('list')">Gespr√§chsliste</button>
        </div>
        
        <!-- Neues Gespr√§ch Tab -->
        <div class="soldaten-tab-content" id="soldatenNewTab">
          <div class="soldaten-form-grid">
            <div class="soldaten-form-group">
              <label class="soldaten-label">Name *</label>
              <input type="text" class="soldaten-input" id="soldatenName" placeholder="Vollst√§ndiger Name">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Dienstnummer (DN) *</label>
              <input type="number" class="soldaten-input" id="soldatenDN" placeholder="z.B. 43">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Hauptunit</label>
              <select class="soldaten-input" id="soldatenUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Rang</label>
              <select class="soldaten-input" id="soldatenRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Datum *</label>
              <input type="date" class="soldaten-input" id="soldatenDate" value="">
            </div>
            
            <div class="soldaten-form-group">
              <label class="soldaten-label">Uhrzeit *</label>
              <input type="time" class="soldaten-input" id="soldatenTime" value="">
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Notizen *</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenNotizen" 
                        placeholder="Notizen zum Gespr√§ch..."></textarea>
            </div>
            
            <div class="soldaten-form-group" style="grid-column: span 2;">
              <label class="soldaten-label">Sonstiges</label>
              <textarea class="soldaten-input soldaten-textarea" id="soldatenSonstiges" 
                        placeholder="Weitere Informationen..."></textarea>
            </div>
          </div>
          
          <div class="soldaten-preview">
            <div class="soldaten-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="soldaten-preview-content" id="soldatenPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Soldatengespr√§ch

Name: 
DN: 
Hauptunit: 
Rang: 
Datum:
Uhrzeit: 
Notizen:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            </div>
          </div>
          
          <div class="soldaten-actions">
            <button class="soldaten-btn soldaten-btn-copy" onclick="copySoldatenTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="soldaten-btn soldaten-btn-save" onclick="saveSoldatenGespr√§ch()">
              <i class="fas fa-save"></i> Gespr√§ch speichern
            </button>
          </div>
        </div>
        
        <!-- Gespr√§chsliste Tab -->
        <div class="soldaten-tab-content" id="soldatenListTab" style="display:none;">
          <div class="soldaten-search-container">
            <i class="fas fa-search soldaten-search-icon"></i>
            <input type="text" class="soldaten-search-input" id="soldatenSearch" 
                   placeholder="Nach Name oder DN suchen..." oninput="searchSoldaten(this.value)">
          </div>
          
          <!-- Scrollbar-Container f√ºr die Liste -->
          <div class="soldaten-liste-container">
            <div class="soldaten-liste" id="soldatenListe">
              <div class="empty-soldaten">
                <div class="empty-soldaten-icon"><i class="fas fa-comments"></i></div>
                <div class="empty-soldaten-title">Keine Gespr√§che gefunden</div>
                <div class="empty-description">Erstellen Sie Ihr erstes Soldatengespr√§ch</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Beobachtungs Akten Modal -->
  <div class="beobachtung-akten-modal" id="beobachtungAktenModal" onclick="if(event.target===this)closeModal('beobachtungAktenModal')">
    <div class="beobachtung-akten-content">
      <div class="beobachtung-akten-header">
        <div class="beobachtung-akten-title">
          <i class="fas fa-folder-open"></i> Beobachtungs-Akten
        </div>
        <button class="beobachtung-akten-close" onclick="closeModal('beobachtungAktenModal')">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="beobachtung-akten-body">
        <div class="beobachtung-tabs">
          <button class="beobachtung-tab active" onclick="switchBeobachtungTab('new')">Neue Akte erstellen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('list')">Akten durchsuchen</button>
          <button class="beobachtung-tab" onclick="switchBeobachtungTab('beobachtung')">Beobachtung hinzuf√ºgen</button>
        </div>
        
        <!-- Neue Akte erstellen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungNewTab">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="akteName" placeholder="Vollst√§ndiger Name">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="akteDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Unit</label>
              <select class="akte-input" id="akteUnit">
                <option value="">Unit ausw√§hlen</option>
              </select>
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Rang</label>
              <select class="akte-input" id="akteRank">
                <option value="">Rang ausw√§hlen</option>
              </select>
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-save" onclick="createNewAkte()">
              <i class="fas fa-plus"></i> Neue Akte erstellen
            </button>
          </div>
        </div>
        
        <!-- Akten durchsuchen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungListTab" style="display:none;">
          <div class="akten-search-container">
            <i class="fas fa-search akten-search-icon"></i>
            <input type="text" class="akten-search-input" id="aktenSearch" 
                   placeholder="Nach Name oder DN suchen..." oninput="searchAkten(this.value)">
          </div>
          
          <div class="beobachtung-akten-liste" id="aktenListe">
            <div class="empty-beobachtungen">
              <div class="empty-beobachtungen-icon"><i class="fas fa-folder-open"></i></div>
              <div class="empty-beobachtungen-title">Keine Akten gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Akte</div>
            </div>
          </div>
        </div>
        
        <!-- Beobachtung hinzuf√ºgen Tab -->
        <div class="beobachtung-tab-content" id="beobachtungBeobachtungTab" style="display:none;">
          <div class="akte-form-grid">
            <div class="akte-form-group">
              <label class="akte-label">Name *</label>
              <input type="text" class="akte-input" id="beobachtungName" placeholder="Name der Person">
            </div>
            
            <div class="akte-form-group">
              <label class="akte-label">Dienstnummer (DN) *</label>
              <input type="number" class="akte-input" id="beobachtungDN" placeholder="z.B. 43">
            </div>
            
            <div class="akte-form-group" style="grid-column: span 2;">
              <label class="akte-label">Grund der Beobachtung *</label>
              <textarea class="akte-input akte-textarea" id="beobachtungGrund" 
                        placeholder="Beschreiben Sie den Grund der Beobachtung..."></textarea>
            </div>
          </div>
          
          <div class="beobachtung-preview">
            <div class="beobachtung-preview-title">
              <i class="fas fa-file-alt"></i> Vorschau
            </div>
            <div class="beobachtung-preview-content" id="beobachtungPreview">
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: 
DN:  
Grund:
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            </div>
          </div>
          
          <div class="beobachtung-actions">
            <button class="beobachtung-btn beobachtung-btn-copy" onclick="copyBeobachtungTemplate()">
              <i class="fas fa-copy"></i> In Zwischenablage kopieren
            </button>
            <button class="beobachtung-btn beobachtung-btn-save" onclick="saveBeobachtungToAkte()">
              <i class="fas fa-save"></i> Zu Akte hinzuf√ºgen
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="notification" id="notification">
    <i class="fas fa-check notification-icon"></i>
    <span class="notification-message" id="notificationMessage"></span>
  </div>

  <!-- App Container (wird erst nach Passwort-Eingabe angezeigt) -->
  <div class="app-container" id="appContainer" style="display:none;">
    <header class="app-header">
      <div class="header-content">
        <div class="brand">
          <!-- Logo Container -->
          <div class="logo-container" id="logoContainer">
            <img
              src=""
              alt="Logo">
          </div>
          <div class="brand-text">
            <h1>Human Resources <span class="header-icons">
              <span class="header-icon" onclick="openAnkundigungenModal()" title="Ank√ºndigungen anzeigen">üîî</span>
              <span class="header-icon" onclick="openBesprechungenModal()" title="Besprechungen anzeigen">üóÉÔ∏è</span>
            </span></h1>
            <div class="subtitle">Einweisungsmanagement ‚Ä¢ Version 1.0</div>
          </div>
        </div>
        <div class="header-stats">
          <div class="stat-card">
            <div class="stat-value" id="totalEmployees">0</div>
            <div class="stat-label">Mitarbeiter</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalAkten">0</div>
            <div class="stat-label">Beobachtung</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalArchived">0</div>
            <div class="stat-label">Archiviert</div>
          </div>
        </div>
      </div>
    </header>

    <aside class="sidebar">
      <div class="sidebar-header">
        <h3 class="sidebar-title"><i class="fas fa-users"></i> Mitarbeiter</h3>
        <div class="employee-count" id="employeeCount">0</div>
      </div>

      <div class="sidebar-controls">
        <div class="sidebar-filter-buttons">
          <button class="sidebar-filter-btn active" onclick="filterEmployeesByType('all')">Alle</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('oral')">M√ºndlich</button>
          <button class="sidebar-filter-btn" onclick="filterEmployeesByType('org')">Organisatorische</button>
        </div>

        <div class="search-container">
          <i class="fas fa-search search-icon"></i>
          <input type="text" class="search-input" id="searchEmployees" placeholder="Nach Namen oder DN suchen...">
        </div>
      </div>

      <div class="employee-list-container">
        <div class="employee-list" id="employeeList">
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">Keine Mitarbeiter</div>
            <div class="empty-description">F√ºgen Sie Ihren ersten Mitarbeiter hinzu</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <button class="quick-action-btn" onclick="openNewEmployeeModal()">
          <i class="fas fa-user-plus"></i> Neuer Mitarbeiter
        </button>
        <button class="quick-action-btn" onclick="toggleArchiveView()">
          <i class="fas fa-archive"></i> <span id="archiveToggleText">Archiv anzeigen</span>
        </button>
      </div>
    </aside>

    <main class="main-content">
      <div class="content-header" id="employeeHeader">
        <div class="employee-info">
          <h2 id="currentEmployeeName">W√§hlen Sie einen Mitarbeiter</h2>
          <div class="employee-tags">
            <div class="employee-tag"><i class="fas fa-hashtag"></i> <span class="tag-value" id="currentEmployeeDN">DN-</span></div>
            <div class="employee-tag"><i class="fas fa-building"></i> <span class="tag-value" id="currentEmployeeUnit">Unit</span></div>
            <div class="employee-tag"><i class="fas fa-user-tie"></i> <span class="tag-value" id="currentEmployeeRank">Rang</span></div>
            <div class="employee-tag" id="archiveStatusTag" style="display:none;">
              <i class="fas fa-archive"></i> <span class="tag-value" style="background:var(--warning);">Archiviert</span>
            </div>
          </div>
        </div>
        <div class="action-buttons">
          <button class="btn btn-secondary" onclick="openEditEmployeeModal()"><i class="fas fa-edit"></i> Bearbeiten</button>
          <button class="btn btn-secondary" id="archiveButton" onclick="toggleArchiveEmployee()" style="display:none;">
            <i class="fas fa-archive"></i> <span id="archiveButtonText">Archivieren</span>
          </button>
        </div>
      </div>

      <div class="induction-content" id="inductionContent">
        <div class="induction-grid">
          <div class="induction-card" id="oralInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-comments"></i></div>
                M√ºndliche Einweisung
              </div>
              <div class="induction-status" id="oralInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
              <label style="font-weight:700;color:var(--gray);font-size:13px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="oralInductionToggle" onchange="toggleInduction('oral', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="oral-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="oralDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="oralTimeStart">
                  <div class="time-separator">bis</div>
                  <input type="time" class="form-input" id="oralTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="oralPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="oralNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>

          <div class="induction-card" id="orgInductionCard">
            <div class="induction-card-header">
              <div class="induction-title">
                <div class="induction-icon"><i class="fas fa-clipboard-list"></i></div>
                Organisatorische Einweisung
              </div>
              <div class="induction-status" id="orgInductionStatus">AUSSTEHEND</div>
            </div>

            <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px;">
              <label style="font-weight:700;color:var(--gray);font-size:13px;">Bestanden:</label>
              <label class="toggle-switch">
                <input type="checkbox" id="orgInductionToggle" onchange="toggleInduction('org', this.checked)">
                <span class="toggle-slider"></span>
              </label>
            </div>

            <div class="org-form-grid">
              <div class="form-group">
                <label class="form-label">Datum</label>
                <input type="date" class="form-input" id="orgDate">
              </div>
              <div class="form-group">
                <label class="form-label">Uhrzeit</label>
                <div class="time-container">
                  <input type="time" class="form-input" id="orgTimeStart">
                  <div class="time-separator">-</div>
                  <input type="time" class="form-input" id="orgTimeEnd">
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Beteiligte Person</label>
                <input type="text" class="form-input" id="orgPerson" placeholder="Name der beteiligten Person">
              </div>
              <div class="form-group">
                <label class="form-label">Unit</label>
                <select class="form-select" id="unitSelect2">
                  <option value="">Unit ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Rang</label>
                <select class="form-select" id="rankSelect2">
                  <option value="">Rang ausw√§hlen</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-label">Sonstige Bemerkungen</label>
                <textarea class="form-textarea" id="orgNotes" placeholder="Weitere Informationen..."></textarea>
              </div>
            </div>
          </div>
        </div>

        <div class="templates-section">
          <div class="section-header">
            <div class="section-title"><i class="fas fa-file-code"></i> Discord Vorlagen</div>
            <div class="template-actions">
              <button class="btn btn-secondary" onclick="copyOralTemplate()"><i class="fas fa-comments"></i> M√ºndlich</button>
              <button class="btn btn-secondary" onclick="copyOrgTemplate()"><i class="fas fa-clipboard-list"></i> Organisatorisch</button>
            </div>
          </div>

          <div class="template-cards">
            <div class="template-card" id="oralTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-comments"></i> M√ºndliche Einweisung</div>
                <div class="template-badge" id="oralTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="oralTemplateContent"></div>
            </div>

            <div class="template-card" id="orgTemplateCard">
              <div class="template-card-header">
                <div class="template-card-title"><i class="fas fa-clipboard-list"></i> Organisatorische Einweisung</div>
                <div class="template-badge" id="orgTemplateBadge">AUSSTEHEND</div>
              </div>
              <div class="template-content" id="orgTemplateContent"></div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- New Employee Modal -->
  <div class="modal-overlay" id="newEmployeeModal" onclick="if(event.target===this)closeModal('newEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-user-plus"></i> Neuen Mitarbeiter hinzuf√ºgen</div>
        <button class="modal-close" onclick="closeModal('newEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
        <div class="form-group">
          <label class="form-label">Vollst√§ndiger Name *</label>
          <input type="text" class="form-input" id="newEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="newEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="newEmployeeUnit">
            <option value="">Unit ausw√§hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="newEmployeeRank">
            <option value="">Rang ausw√§hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:flex-end;gap:12px;margin-top:20px;">
        <button class="btn btn-secondary" onclick="closeModal('newEmployeeModal')">Abbrechen</button>
        <button class="btn btn-primary" onclick="createNewEmployee()"><i class="fas fa-plus"></i> Erstellen</button>
      </div>
    </div>
  </div>

  <!-- Edit Employee Modal -->
  <div class="modal-overlay" id="editEmployeeModal" onclick="if(event.target===this)closeModal('editEmployeeModal')">
    <div class="modal">
      <div class="modal-header">
        <div class="modal-title"><i class="fas fa-edit"></i> Mitarbeiter bearbeiten</div>
        <button class="modal-close" onclick="closeModal('editEmployeeModal')"><i class="fas fa-times"></i></button>
      </div>

      <div class="form-grid-new" style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px;">
        <div class="form-group">
          <label class="form-label">Vollst√§ndiger Name *</label>
          <input type="text" class="form-input" id="editEmployeeName" placeholder="z.B. Max Fiart">
        </div>
        <div class="form-group">
          <label class="form-label">Dienstnummer (DN) *</label>
          <input type="number" class="form-input" id="editEmployeeDN" placeholder="z.B. 43" min="1" max="9999">
        </div>
        <div class="form-group">
          <label class="form-label">Unit</label>
          <select class="form-select" id="editEmployeeUnit">
            <option value="">Unit ausw√§hlen</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Rang</label>
          <select class="form-select" id="editEmployeeRank">
            <option value="">Rang ausw√§hlen</option>
          </select>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:20px;">
        <button class="btn btn-danger" onclick="deleteCurrentEmployee()" style="margin-right:auto;"><i class="fas fa-trash"></i> L√∂schen</button>
        <div style="display:flex;gap:12px;">
          <button class="btn btn-secondary" onclick="closeModal('editEmployeeModal')">Abbrechen</button>
          <button class="btn btn-primary" onclick="saveEditedEmployee()"><i class="fas fa-save"></i> √Ñnderungen speichern</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ==================== KONFIGURATION ====================
    const APP_VERSION = '1.1.20240214';
    const DEFAULT_PASSWORD = 'hr';
    const SETTINGS_PASSWORD = 'soc1';
    const PASSWORD_EXPIRE_MINUTES = 60;
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyBTnsLNw68UuOd5Xa2ymMffWk4SYGDQjso",
      authDomain: "cc-shop-finanzsystem.firebaseapp.com",
      projectId: "cc-shop-finanzsystem",
      storageBucket: "cc-shop-finanzsystem.firebasestorage.app",
      messagingSenderId: "575918945925",
      appId: "1:575918945925:web:bf9d973d5cd9fc547e5bec",
      measurementId: "G-9SZREFTJS6"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // App State
    let currentEmployee = null;
    let employees = [];
    let bothInductionsCompleted = false;
    let currentFilter = 'all';
    let settings = {
      units: [],
      ranks: []
    };
    let showArchived = false;
    let ankundigungen = [];
    let soldatenGespr√§che = [];
    let akten = [];
    let currentSettingsTab = 'units';
    let currentAnkundigungenTab = 'new';
    let currentSoldatenTab = 'new';
    let currentBeobachtungTab = 'new';
    let isAuthenticated = false;
    let settingsAuthenticated = false;
    let settingsAuthTimestamp = 0;
    
    // Unsubscribe-Funktionen f√ºr Listener
    let unsubscribeFunctions = [];
    
    // Edit Item State
    let currentEditItemId = null;
    let currentEditItemType = null; // 'ankundigung' oder 'besprechung'

    document.addEventListener('DOMContentLoaded', function () {
      console.log(`HR App Version ${APP_VERSION} geladen`);
      createParticles();
      checkAuthentication();
      
      // Alle Elemente animieren
      setTimeout(() => {
        const elements = document.querySelectorAll('.app-header, .sidebar, .main-content, .floating-button');
        elements.forEach((el, index) => {
          el.classList.add('animate-in');
          el.style.animationDelay = `${index * 0.1}s`;
        });
      }, 100);
    });

    // ==================== ANIMIERUNGS FUNKTIONEN ====================
    function createParticles() {
      const particlesContainer = document.getElementById('bgParticles');
      if (!particlesContainer) return;
      
      particlesContainer.innerHTML = '';
      
      const particleCount = 15;
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        
        // Zuf√§llige Gr√∂√üe und Position
        const size = Math.random() * 4 + 1;
        const left = Math.random() * 100;
        const top = Math.random() * 100;
        const animationDuration = Math.random() * 20 + 15;
        const animationDelay = Math.random() * 10;
        
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${left}%`;
        particle.style.top = `${top}%`;
        particle.style.animationDuration = `${animationDuration}s`;
        particle.style.animationDelay = `${animationDelay}s`;
        
        // Zuf√§llige Farbe
        const colors = [
          'rgba(79, 70, 229, 0.15)',
          'rgba(139, 92, 246, 0.15)',
          'rgba(16, 185, 129, 0.15)',
          'rgba(245, 158, 11, 0.15)'
        ];
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        
        particlesContainer.appendChild(particle);
      }
    }

    // ==================== AUTHENTIFIZIERUNG ====================
    function checkAuthentication() {
      const savedPassword = localStorage.getItem('hr_app_password');
      const savedTimestamp = localStorage.getItem('hr_app_password_timestamp');
      const currentTime = Date.now();
      const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
      
      if (savedPassword === DEFAULT_PASSWORD && savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
        isAuthenticated = true;
        settingsAuthenticated = true;
        settingsAuthTimestamp = Date.now();
        localStorage.setItem('hr_settings_auth_timestamp', settingsAuthTimestamp);
        initializeApp();
      } else {
        // Password modal ist bereits im HTML sichtbar
        setTimeout(() => {
          document.getElementById('mainPasswordInput').focus();
        }, 100);
      }
    }

    function checkMainPassword() {
      const password = document.getElementById('mainPasswordInput').value;
      const errorElement = document.getElementById('mainPasswordError');
      
      if (password === DEFAULT_PASSWORD) {
        localStorage.setItem('hr_app_password', password);
        localStorage.setItem('hr_app_password_timestamp', Date.now());
        isAuthenticated = true;
        settingsAuthenticated = true;
        settingsAuthTimestamp = Date.now();
        localStorage.setItem('hr_settings_auth_timestamp', settingsAuthTimestamp);
        
        // Modal ausblenden und App anzeigen
        document.getElementById('mainPasswordModal').style.display = 'none';
        document.getElementById('appContainer').style.display = 'grid';
        
        // Animation f√ºr App Container
        const appContainer = document.getElementById('appContainer');
        appContainer.style.opacity = '0';
        appContainer.style.transform = 'translateY(20px)';
        appContainer.style.display = 'grid';
        
        setTimeout(() => {
          appContainer.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
          appContainer.style.opacity = '1';
          appContainer.style.transform = 'translateY(0)';
        }, 50);
        
        initializeApp();
      } else {
        errorElement.style.display = 'block';
        document.getElementById('mainPasswordInput').value = '';
        document.getElementById('mainPasswordInput').focus();
      }
    }

    function checkSettingsAuth() {
      if (settingsAuthenticated) {
        const savedTimestamp = localStorage.getItem('hr_settings_auth_timestamp');
        const currentTime = Date.now();
        const expireTime = PASSWORD_EXPIRE_MINUTES * 60 * 1000;
        
        if (savedTimestamp && (currentTime - parseInt(savedTimestamp) < expireTime)) {
          return true;
        }
      }
      return false;
    }

    function openSettingsPasswordModal() {
      document.getElementById('settingsPasswordModal').classList.add('active');
      setTimeout(() => {
        document.getElementById('settingsPasswordInput').focus();
      }, 100);
    }

    function closeSettingsPasswordModal() {
      document.getElementById('settingsPasswordModal').classList.remove('active');
      document.getElementById('settingsPasswordInput').value = '';
      document.getElementById('settingsPasswordError').classList.remove('show');
    }

    function checkSettingsPassword() {
      const password = document.getElementById('settingsPasswordInput').value;
      const errorElement = document.getElementById('settingsPasswordError');
      
      if (password === SETTINGS_PASSWORD) {
        settingsAuthenticated = true;
        settingsAuthTimestamp = Date.now();
        localStorage.setItem('hr_settings_auth_timestamp', settingsAuthTimestamp);
        closeSettingsPasswordModal();
        openSettingsModal();
      } else {
        errorElement.classList.add('show');
        document.getElementById('settingsPasswordInput').value = '';
        document.getElementById('settingsPasswordInput').focus();
      }
    }

    function openSettingsWithPassword() {
      if (checkSettingsAuth()) {
        openSettingsModal();
      } else {
        openSettingsPasswordModal();
      }
    }

    // ==================== ANK√úNDIGUNGEN MODAL ====================
    function openAnkundigungenModal() {
      openModal('ankundigungenModal');
      loadAnkundigungen();
    }

    async function loadAnkundigungen() {
      const container = document.getElementById('ankundigungenList');
      container.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>Lade Ank√ºndigungen...</div></div>';

      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'ankundigung')
          .get();
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Ank√ºndigung in den Settings</div>
            </div>
          `;
          return;
        }

        let html = '';
        let hasItems = false;
        let items = [];
        
        querySnapshot.forEach(doc => {
          const item = doc.data();
          items.push({ ...item, id: doc.id });
        });
        
        items.sort((a, b) => {
          return new Date(b.created || 0) - new Date(a.created || 0);
        });
        
        items.forEach(item => {
          hasItems = true;
          
          const title = item.title || 'Ohne Titel';
          const date = item.createdFormatted || new Date(item.created || Date.now()).toLocaleDateString('de-DE');
          const content = item.content || '';
          
          html += `
            <div class="ankundigungen-item animate-in">
              <div class="ankundigungen-item-header">
                <div class="ankundigungen-item-title">
                  <span>${item.icon || 'ü™ß'}</span> ${escapeHtml(title)}
                </div>
                <div class="ankundigungen-item-type">
                  Ank√ºndigung
                </div>
              </div>
              <div class="ankundigungen-item-date">
                <i class="fas fa-calendar"></i> ${date}
              </div>
              <div class="ankundigungen-item-content">
                ${escapeHtml(content)}
              </div>
            </div>
          `;
        });

        if (hasItems) {
          container.innerHTML = html;
          
          // Animation f√ºr die Items
          setTimeout(() => {
            const items = container.querySelectorAll('.ankundigungen-item');
            items.forEach((item, index) => {
              item.style.animationDelay = `${index * 0.1}s`;
            });
          }, 50);
        } else {
          container.innerHTML = `
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Ank√ºndigung in den Settings</div>
            </div>
          `;
        }
      } catch (error) {
        console.error('Fehler beim Laden der Ank√ºndigungen:', error);
        container.innerHTML = `
          <div class="empty-ankundigungen">
            <div class="empty-ankundigungen-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="empty-ankundigungen-title">Fehler beim Laden</div>
            <div class="empty-description">${error.message}</div>
          </div>
        `;
      }
    }

    function searchAnkundigungen(searchTerm) {
      const items = document.querySelectorAll('.ankundigungen-item');
      const term = searchTerm.toLowerCase().trim();
      
      if (!term) {
        items.forEach(item => item.style.display = 'block');
        return;
      }
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(term) ? 'block' : 'none';
      });
    }

    // ==================== BESPRECHUNGEN MODAL ====================
    function openBesprechungenModal() {
      openModal('besprechungenModal');
      loadBesprechungen();
    }

    async function loadBesprechungen() {
      const container = document.getElementById('besprechungenList');
      container.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>Lade Besprechungen...</div></div>';

      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'besprechung')
          .get();
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="empty-besprechungen">
              <div class="empty-besprechungen-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-besprechungen-title">Keine Besprechungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Besprechung in den Settings</div>
            </div>
          `;
          return;
        }

        let html = '';
        let hasItems = false;
        let items = [];
        
        querySnapshot.forEach(doc => {
          const item = doc.data();
          items.push({ ...item, id: doc.id });
        });
        
        items.sort((a, b) => {
          return new Date(b.created || 0) - new Date(a.created || 0);
        });
        
        items.forEach(item => {
          hasItems = true;
          
          const title = item.thema || 'Ohne Thema';
          const date = item.date ? new Date(item.date).toLocaleDateString('de-DE') : new Date(item.created || Date.now()).toLocaleDateString('de-DE');
          const content = item.content || '';
          
          html += `
            <div class="besprechungen-item animate-in">
              <div class="besprechungen-item-header">
                <div class="besprechungen-item-title">
                  <span>${item.icon || 'üóÉÔ∏è'}</span> ${escapeHtml(title)}
                </div>
                <div class="besprechungen-item-type">
                  Besprechung
                </div>
              </div>
              <div class="besprechungen-item-date">
                <i class="fas fa-calendar"></i> ${date}
                ${item.time ? ` ‚Ä¢ ${item.time}` : ''}
                ${item.ort ? ` ‚Ä¢ ${item.ort}` : ''}
              </div>
              <div class="besprechungen-item-content">
                ${escapeHtml(content)}
              </div>
            </div>
          `;
        });

        if (hasItems) {
          container.innerHTML = html;
          
          // Animation f√ºr die Items
          setTimeout(() => {
            const items = container.querySelectorAll('.besprechungen-item');
            items.forEach((item, index) => {
              item.style.animationDelay = `${index * 0.1}s`;
            });
          }, 50);
        } else {
          container.innerHTML = `
            <div class="empty-besprechungen">
              <div class="empty-besprechungen-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-besprechungen-title">Keine Besprechungen gefunden</div>
              <div class="empty-description">Erstellen Sie Ihre erste Besprechung in den Settings</div>
            </div>
          `;
        }
      } catch (error) {
        console.error('Fehler beim Laden der Besprechungen:', error);
        container.innerHTML = `
          <div class="empty-besprechungen">
            <div class="empty-besprechungen-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="empty-besprechungen-title">Fehler beim Laden</div>
            <div class="empty-description">${error.message}</div>
          </div>
        `;
      }
    }

    function searchBesprechungen(searchTerm) {
      const items = document.querySelectorAll('.besprechungen-item');
      const term = searchTerm.toLowerCase().trim();
      
      if (!term) {
        items.forEach(item => item.style.display = 'block');
        return;
      }
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(term) ? 'block' : 'none';
      });
    }

    // ==================== APP INITIALISIERUNG ====================
    function initializeApp() {
      if (!isAuthenticated) return;
      
      console.log('App wird initialisiert');
      loadSettings();
      setupRealtimeListeners();
      updateUnitAndRankSelects();
      
      // Setze heutiges Datum
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('oralDate').value = today;
      document.getElementById('orgDate').value = today;
      document.getElementById('soldatenDate').value = today;
      document.getElementById('besprechungDate').value = today;

      // Setze aktuelle Zeit
      const now = new Date();
      const hours = now.getHours().toString().padStart(2, '0');
      const minutes = now.getMinutes().toString().padStart(2, '0');
      document.getElementById('soldatenTime').value = `${hours}:${minutes}`;
      document.getElementById('besprechungTime').value = `${hours}:${minutes}`;

      // Standardzeiten
      document.getElementById('oralTimeStart').value = '16:40';
      document.getElementById('oralTimeEnd').value = '18:00';
      document.getElementById('orgTimeStart').value = '22:10';
      document.getElementById('orgTimeEnd').value = '23:05';

      setupEventListeners();
      setupFormChangeListeners();
      seedTemplateBoxes();
      setupSoldatenEventListeners();
      adjustSidebarHeight();
      
      setTimeout(showLatestAnkundigung, 1000);
    }

    // ==================== ANK√úNDIGUNGEN FUNKTIONEN ====================
    async function showLatestAnkundigung() {
      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'ankundigung')
          .get();
        
        if (querySnapshot.empty) {
          console.log('Keine Ank√ºndigungen gefunden');
          return;
        }
        
        let latestAnkundigung = null;
        let latestDate = 0;
        
        querySnapshot.forEach(doc => {
          const ankundigung = doc.data();
          const date = new Date(ankundigung.created || 0).getTime();
          if (date > latestDate) {
            latestDate = date;
            latestAnkundigung = ankundigung;
          }
        });
        
        if (!latestAnkundigung) return;
        
        const banner = document.getElementById('ankundigungBanner');
        const title = document.getElementById('bannerTitle');
        const content = document.getElementById('bannerContent');
        const type = document.getElementById('bannerType');
        const date = document.getElementById('bannerDate');
        
        title.innerHTML = `<span>${latestAnkundigung.icon || 'ü™ß'}</span> ${escapeHtml(latestAnkundigung.title || 'Ank√ºndigung')}`;
        content.textContent = latestAnkundigung.content || '';
        type.textContent = 'Ank√ºndigung';
        date.textContent = latestAnkundigung.createdFormatted || new Date(latestDate).toLocaleDateString('de-DE');
        
        banner.classList.add('show');
        
        setTimeout(() => {
          banner.classList.remove('show');
        }, 10000);
      } catch (error) {
        console.error('Fehler beim Laden der Ank√ºndigung:', error);
      }
    }

    function closeBanner() {
      document.getElementById('ankundigungBanner').classList.remove('show');
    }

    function switchAnkundigungenTab(tabName) {
      currentAnkundigungenTab = tabName;
      
      document.querySelectorAll('.ankundigungen-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.ankundigungen-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      
      if (tabName === 'new') {
        document.querySelector('.ankundigungen-tab:nth-child(1)').classList.add('active');
        document.getElementById('ankundigungenNewTab').style.display = 'flex';
      } else if (tabName === 'besprechung') {
        document.querySelector('.ankundigungen-tab:nth-child(2)').classList.add('active');
        document.getElementById('ankundigungenBesprechungTab').style.display = 'flex';
        
        // Nach dem Tab-Wechsel den Scrollbereich fokusieren
        setTimeout(() => {
          const formContainer = document.querySelector('.besprechung-form-scroll');
          if (formContainer) {
            formContainer.scrollTop = 0;
          }
        }, 100);
      } else if (tabName === 'manage-ankundigungen') {
        document.querySelector('.ankundigungen-tab:nth-child(3)').classList.add('active');
        document.getElementById('ankundigungenManageAnkundigungenTab').style.display = 'flex';
        loadManageAnkundigungen();
      } else if (tabName === 'manage-besprechungen') {
        document.querySelector('.ankundigungen-tab:nth-child(4)').classList.add('active');
        document.getElementById('ankundigungenManageBesprechungenTab').style.display = 'flex';
        loadManageBesprechungen();
      }
    }

    async function loadManageAnkundigungen() {
      const container = document.getElementById('manageAnkundigungenList');
      container.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>Lade Ank√ºndigungen...</div></div>';

      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'ankundigung')
          .get();
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-bullhorn"></i></div>
              <div class="empty-ankundigungen-title">Keine Ank√ºndigungen gefunden</div>
            </div>
          `;
          return;
        }

        let html = '';
        let items = [];
        
        querySnapshot.forEach(doc => {
          const item = doc.data();
          items.push({ ...item, id: doc.id });
        });
        
        items.sort((a, b) => {
          return new Date(b.created || 0) - new Date(a.created || 0);
        });
        
        items.forEach(item => {
          const date = item.createdFormatted || new Date(item.created || Date.now()).toLocaleDateString('de-DE');
          
          html += `
            <div class="manage-item animate-in" data-id="${item.id}">
              <div class="manage-item-header">
                <div class="manage-item-title">
                  <span>${item.icon || 'ü™ß'}</span> ${escapeHtml(item.title || 'Ohne Titel')}
                </div>
                <div class="manage-item-type">
                  Ank√ºndigung
                </div>
              </div>
              <div class="manage-item-date">
                <i class="fas fa-calendar"></i> ${date}
              </div>
              <div class="manage-item-content">
                ${escapeHtml(item.content || '')}
              </div>
              <div class="manage-item-actions">
                <button class="manage-item-btn manage-item-btn-edit" onclick="editAnkundigung('${item.id}')">
                  <i class="fas fa-edit"></i> Bearbeiten
                </button>
                <button class="manage-item-btn manage-item-btn-delete" onclick="deleteAnkundigung('${item.id}')">
                  <i class="fas fa-trash"></i> L√∂schen
                </button>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
        
        // Animation f√ºr die Items
        setTimeout(() => {
          const items = container.querySelectorAll('.manage-item');
          items.forEach((item, index) => {
            item.style.animationDelay = `${index * 0.1}s`;
          });
        }, 50);
      } catch (error) {
        console.error('Fehler beim Laden der Ank√ºndigungen:', error);
        container.innerHTML = `
          <div class="empty-ankundigungen">
            <div class="empty-ankundigungen-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="empty-ankundigungen-title">Fehler beim Laden</div>
          </div>
        `;
      }
    }

    async function loadManageBesprechungen() {
      const container = document.getElementById('manageBesprechungenList');
      container.innerHTML = '<div class="loading"><div class="loading-spinner"></div><div>Lade Besprechungen...</div></div>';

      try {
        const querySnapshot = await db.collection('hrAnkundigungen')
          .where('type', '==', 'besprechung')
          .get();
        
        if (querySnapshot.empty) {
          container.innerHTML = `
            <div class="empty-ankundigungen">
              <div class="empty-ankundigungen-icon"><i class="fas fa-calendar-alt"></i></div>
              <div class="empty-ankundigungen-title">Keine Besprechungen gefunden</div>
            </div>
          `;
          return;
        }

        let html = '';
        let items = [];
        
        querySnapshot.forEach(doc => {
          const item = doc.data();
          items.push({ ...item, id: doc.id });
        });
        
        items.sort((a, b) => {
          return new Date(b.created || 0) - new Date(a.created || 0);
        });
        
        items.forEach(item => {
          const date = item.date ? new Date(item.date).toLocaleDateString('de-DE') : new Date(item.created || Date.now()).toLocaleDateString('de-DE');
          
          html += `
            <div class="manage-item animate-in" data-id="${item.id}">
              <div class="manage-item-header">
                <div class="manage-item-title">
                  <span>${item.icon || 'üóÉÔ∏è'}</span> ${escapeHtml(item.thema || 'Ohne Thema')}
                </div>
                <div class="manage-item-type">
                  Besprechung
                </div>
              </div>
              <div class="manage-item-date">
                <i class="fas fa-calendar"></i> ${date}
                ${item.time ? ` ‚Ä¢ ${item.time}` : ''}
                ${item.ort ? ` ‚Ä¢ ${item.ort}` : ''}
              </div>
              <div class="manage-item-content">
                ${escapeHtml(item.content || '')}
              </div>
              <div class="manage-item-actions">
                <button class="manage-item-btn manage-item-btn-edit" onclick="editBesprechung('${item.id}')">
                  <i class="fas fa-edit"></i> Bearbeiten
                </button>
                <button class="manage-item-btn manage-item-btn-delete" onclick="deleteBesprechung('${item.id}')">
                  <i class="fas fa-trash"></i> L√∂schen
                </button>
              </div>
            </div>
          `;
        });

        container.innerHTML = html;
        
        // Animation f√ºr die Items
        setTimeout(() => {
          const items = container.querySelectorAll('.manage-item');
          items.forEach((item, index) => {
            item.style.animationDelay = `${index * 0.1}s`;
          });
        }, 50);
      } catch (error) {
        console.error('Fehler beim Laden der Besprechungen:', error);
        container.innerHTML = `
          <div class="empty-ankundigungen">
            <div class="empty-ankundigungen-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="empty-ankundigungen-title">Fehler beim Laden</div>
          </div>
        `;
      }
    }

    function searchManageAnkundigungen(searchTerm) {
      const items = document.querySelectorAll('#manageAnkundigungenList .manage-item');
      const term = searchTerm.toLowerCase().trim();
      
      if (!term) {
        items.forEach(item => item.style.display = 'block');
        return;
      }
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(term) ? 'block' : 'none';
      });
    }

    function searchManageBesprechungen(searchTerm) {
      const items = document.querySelectorAll('#manageBesprechungenList .manage-item');
      const term = searchTerm.toLowerCase().trim();
      
      if (!term) {
        items.forEach(item => item.style.display = 'block');
        return;
      }
      
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(term) ? 'block' : 'none';
      });
    }

    async function editAnkundigung(id) {
      try {
        const doc = await db.collection('hrAnkundigungen').doc(id).get();
        if (!doc.exists) {
          showNotification('Ank√ºndigung nicht gefunden', 'error');
          return;
        }

        const ankundigung = doc.data();
        currentEditItemId = id;
        currentEditItemType = 'ankundigung';
        
        document.getElementById('editItemTitle').innerHTML = `<i class="fas fa-edit"></i> Ank√ºndigung bearbeiten`;
        
        const formHtml = `
          <div class="settings-form-group">
            <label class="settings-label">Titel</label>
            <input type="text" class="edit-item-input" id="editAnkundigungTitle" value="${escapeHtml(ankundigung.title || '')}">
          </div>
          
          <div class="settings-form-group">
            <label class="settings-label">Inhalt *</label>
            <textarea class="edit-item-input edit-item-textarea" id="editAnkundigungContent" rows="6">${escapeHtml(ankundigung.content || '')}</textarea>
          </div>
        `;
        
        document.getElementById('editItemForm').innerHTML = formHtml;
        openEditItemModal();
        
      } catch (error) {
        console.error('Fehler beim Laden der Ank√ºndigung:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    async function editBesprechung(id) {
      try {
        const doc = await db.collection('hrAnkundigungen').doc(id).get();
        if (!doc.exists) {
          showNotification('Besprechung nicht gefunden', 'error');
          return;
        }

        const besprechung = doc.data();
        currentEditItemId = id;
        currentEditItemType = 'besprechung';
        
        document.getElementById('editItemTitle').innerHTML = `<i class="fas fa-edit"></i> Besprechung bearbeiten`;
        
        const formHtml = `
          <div class="settings-form-group">
            <label class="settings-label">Thema *</label>
            <input type="text" class="edit-item-input" id="editBesprechungThema" value="${escapeHtml(besprechung.thema || '')}">
          </div>
          
          <div class="settings-form-group">
            <label class="settings-label">Datum *</label>
            <input type="date" class="edit-item-input" id="editBesprechungDate" value="${besprechung.date || ''}">
          </div>
          
          <div class="settings-form-group">
            <label class="settings-label">Uhrzeit *</label>
            <input type="time" class="edit-item-input" id="editBesprechungTime" value="${besprechung.time || ''}">
          </div>
          
          <div class="settings-form-group">
            <label class="settings-label">Ort</label>
            <input type="text" class="edit-item-input" id="editBesprechungOrt" value="${escapeHtml(besprechung.ort || '')}">
          </div>
          
          <div class="settings-form-group">
            <label class="settings-label">Inhalt *</label>
            <textarea class="edit-item-input edit-item-textarea" id="editBesprechungContent" rows="6">${escapeHtml(besprechung.content || '')}</textarea>
          </div>
        `;
        
        document.getElementById('editItemForm').innerHTML = formHtml;
        openEditItemModal();
        
      } catch (error) {
        console.error('Fehler beim Laden der Besprechung:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    async function saveEditedItem() {
      if (!currentEditItemId || !currentEditItemType) return;

      if (currentEditItemType === 'ankundigung') {
        const title = document.getElementById('editAnkundigungTitle').value.trim();
        const content = document.getElementById('editAnkundigungContent').value.trim();

        if (!content) {
          showNotification('Bitte geben Sie den Inhalt der Ank√ºndigung ein', 'warning');
          return;
        }

        try {
          await db.collection('hrAnkundigungen').doc(currentEditItemId).update({
            title: title || 'Ohne Titel',
            content,
            updated: new Date().toISOString()
          });
          
          closeEditItemModal();
          showNotification('Ank√ºndigung erfolgreich aktualisiert', 'success');
          
          // Aktualisiere die Listen
          loadManageAnkundigungen();
          loadAnkundigungen(); // Aktualisiere auch das Ank√ºndigungs-Modal
        } catch (error) {
          console.error('Fehler beim Aktualisieren der Ank√ºndigung:', error);
          showNotification('Fehler: ' + error.message, 'error');
        }
      } else if (currentEditItemType === 'besprechung') {
        const thema = document.getElementById('editBesprechungThema').value.trim();
        const date = document.getElementById('editBesprechungDate').value;
        const time = document.getElementById('editBesprechungTime').value;
        const ort = document.getElementById('editBesprechungOrt').value.trim();
        const content = document.getElementById('editBesprechungContent').value.trim();

        if (!thema || !date || !time || !content) {
          showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
          return;
        }

        try {
          await db.collection('hrAnkundigungen').doc(currentEditItemId).update({
            thema,
            date,
            time,
            ort: ort || '',
            content,
            updated: new Date().toISOString()
          });
          
          closeEditItemModal();
          showNotification('Besprechung erfolgreich aktualisiert', 'success');
          
          // Aktualisiere die Listen
          loadManageBesprechungen();
          loadBesprechungen(); // Aktualisiere auch das Besprechungs-Modal
        } catch (error) {
          console.error('Fehler beim Aktualisieren der Besprechung:', error);
          showNotification('Fehler: ' + error.message, 'error');
        }
      }
    }

    async function deleteAnkundigung(id) {
      if (!confirm('Ank√ºndigung wirklich l√∂schen?')) return;

      try {
        await db.collection('hrAnkundigungen').doc(id).delete();
        
        showNotification('Ank√ºndigung gel√∂scht', 'success');
        
        loadManageAnkundigungen();
      } catch (error) {
        console.error('Fehler beim L√∂schen der Ank√ºndigung:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    async function deleteBesprechung(id) {
      if (!confirm('Besprechung wirklich l√∂schen?')) return;

      try {
        await db.collection('hrAnkundigungen').doc(id).delete();
        
        showNotification('Besprechung gel√∂scht', 'success');
        
        loadManageBesprechungen();
      } catch (error) {
        console.error('Fehler beim L√∂schen der Besprechung:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    function openEditItemModal() {
      document.getElementById('editItemModal').classList.add('active');
    }

    function closeEditItemModal() {
      document.getElementById('editItemModal').classList.remove('active');
      currentEditItemId = null;
      currentEditItemType = null;
      document.getElementById('editItemForm').innerHTML = '';
    }

    async function saveAnkundigung() {
      const title = document.getElementById('ankundigungTitle').value.trim();
      const content = document.getElementById('ankundigungContent').value.trim();

      if (!content) {
        showNotification('Bitte geben Sie den Inhalt der Ank√ºndigung ein', 'warning');
        return;
      }

      const ankundigung = {
        id: `ANK-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        type: 'ankundigung',
        title: title || 'Ohne Titel',
        content: content,
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        icon: 'ü™ß'
      };

      try {
        await db.collection('hrAnkundigungen').doc(ankundigung.id).set(ankundigung);
        
        showNotification('Ank√ºndigung erfolgreich gespeichert', 'success');
        document.getElementById('ankundigungTitle').value = '';
        document.getElementById('ankundigungContent').value = '';
        
        closeModal('settingsModal');
      } catch (error) {
        console.error('Fehler beim Speichern der Ank√ºndigung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    async function saveBesprechung() {
      const thema = document.getElementById('besprechungThema').value.trim();
      const date = document.getElementById('besprechungDate').value;
      const time = document.getElementById('besprechungTime').value;
      const ort = document.getElementById('besprechungOrt').value.trim();
      const content = document.getElementById('besprechungContent').value.trim();

      if (!thema || !date || !time || !content) {
        showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const besprechung = {
        id: `BES-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        type: 'besprechung',
        thema,
        date,
        time,
        ort: ort || '',
        content,
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        icon: 'üóÉÔ∏è'
      };

      try {
        await db.collection('hrAnkundigungen').doc(besprechung.id).set(besprechung);
        
        showNotification('Besprechung erfolgreich gespeichert', 'success');
        document.getElementById('besprechungThema').value = '';
        document.getElementById('besprechungDate').value = '';
        document.getElementById('besprechungTime').value = '';
        document.getElementById('besprechungOrt').value = '';
        document.getElementById('besprechungContent').value = '';
        
        closeModal('settingsModal');
      } catch (error) {
        console.error('Fehler beim Speichern der Besprechung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    // ==================== SETTINGS FUNKTIONEN ====================
    function openSettingsModal() {
      if (!checkSettingsAuth()) {
        openSettingsPasswordModal();
        return;
      }
      openModal('settingsModal');
      populateSettingsUI();
    }

    function switchSettingsTab(tabName) {
      currentSettingsTab = tabName;
      
      document.querySelectorAll('.settings-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      document.querySelectorAll('.settings-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      
      if (tabName === 'units') {
        document.querySelector('.settings-tab:nth-child(1)').classList.add('active');
        document.getElementById('unitsTab').style.display = 'block';
      } else if (tabName === 'ranks') {
        document.querySelector('.settings-tab:nth-child(2)').classList.add('active');
        document.getElementById('ranksTab').style.display = 'block';
      } else if (tabName === 'ankundigungen') {
        document.querySelector('.settings-tab:nth-child(3)').classList.add('active');
        document.getElementById('ankundigungenTab').style.display = 'block';
      }
    }

    async function loadSettings() {
      try {
        const doc = await db.collection('hrSettings').doc('settings').get();
        if (doc.exists) {
          const loadedSettings = doc.data();
          settings = { ...settings, ...loadedSettings };
        }
        
        if (!settings.units || settings.units.length === 0) {
          settings.units = [
            { name: "Air Force", discordId: "1269229762400878675" },
            { name: "S.O.C", discordId: "1339523576159666218" },
            { name: "Infantry", discordId: "1187756956425920645" },
            { name: "Military Police", discordId: "1289716541658497055" },
            { name: "Navy Marine", discordId: "1097653037968920776" },
            { name: "Navy SEALs", discordId: "1125174901989445693" }
          ];
        }

        if (!settings.ranks || settings.ranks.length === 0) {
          settings.ranks = [
            { name: "Private", discordId: "1097625924104626198" },
            { name: "Private First Class", discordId: "1098190829295771739" },
            { name: "Specialist", discordId: "1097625921516748830" },
            { name: "Corporal", discordId: "1097625914763919532" },
            { name: "Sergeant", discordId: "1097625913274933298" },
            { name: "Staff Sergeant", discordId: "1097625912163451112" },
            { name: "Sergeant First Class", discordId: "1348414845862674524" },
            { name: "Master Sergeant", discordId: "1348414845862674524" },
            { name: "Lieutenant", discordId: "1097625900125782278" },
            { name: "Captain", discordId: "1097625898880077955" },
            { name: "Major", discordId: "1097625896560640024" },
            { name: "Colonel", discordId: "1097625895541428275" },
            { name: "Major General", discordId: "1097625893880479777" },
            { name: "General of Army", discordId: "1097625891632316436" }
          ];
        }

        updateUnitAndRankSelects();
        populateSettingsUI();
      } catch (error) {
        console.error('Fehler beim Laden der Einstellungen:', error);
      }
    }

    function populateSettingsUI() {
      const unitList = document.getElementById('unitList');
      unitList.innerHTML = '';
      
      settings.units.forEach((unit, index) => {
        const unitItem = document.createElement('div');
        unitItem.className = 'unit-item animate-in';
        unitItem.style.animationDelay = `${index * 0.05}s`;
        unitItem.innerHTML = `
          <div class="unit-name">${escapeHtml(unit.name)}</div>
          <input type="text" class="discord-id" value="${escapeHtml(unit.discordId || '')}" 
                 placeholder="Discord Rollen-ID" onchange="updateUnitDiscordId(${index}, this.value)">
          <button class="btn btn-danger" onclick="removeUnit(${index})">
            <i class="fas fa-trash"></i>
          </button>
        `;
        unitList.appendChild(unitItem);
      });

      const rankList = document.getElementById('rankList');
      rankList.innerHTML = '';
      
      settings.ranks.forEach((rank, index) => {
        const rankItem = document.createElement('div');
        rankItem.className = 'rank-item animate-in';
        rankItem.style.animationDelay = `${index * 0.05}s`;
        rankItem.innerHTML = `
          <div class="rank-name">${escapeHtml(rank.name)}</div>
          <input type="text" class="discord-id" value="${escapeHtml(rank.discordId || '')}" 
                 placeholder="Discord Rollen-ID" onchange="updateRankDiscordId(${index}, this.value)">
          <button class="btn btn-danger" onclick="removeRank(${index})">
            <i class="fas fa-trash"></i>
          </button>
        `;
        rankList.appendChild(rankItem);
      });
    }

    function addNewUnit() {
      const name = prompt('Name der neuen Unit:');
      if (name && name.trim()) {
        settings.units.push({
          name: name.trim(),
          discordId: ''
        });
        populateSettingsUI();
        showNotification('Unit hinzugef√ºgt', 'success');
      }
    }

    function addNewRank() {
      const name = prompt('Name des neuen Rangs:');
      if (name && name.trim()) {
        settings.ranks.push({
          name: name.trim(),
          discordId: ''
        });
        populateSettingsUI();
        showNotification('Rang hinzugef√ºgt', 'success');
      }
    }

    function updateUnitDiscordId(index, discordId) {
      if (index >= 0 && index < settings.units.length) {
        settings.units[index].discordId = discordId;
      }
    }

    function updateRankDiscordId(index, discordId) {
      if (index >= 0 && index < settings.ranks.length) {
        settings.ranks[index].discordId = discordId;
      }
    }

    function removeUnit(index) {
      if (confirm('Unit wirklich l√∂schen?')) {
        settings.units.splice(index, 1);
        populateSettingsUI();
        showNotification('Unit gel√∂scht', 'success');
      }
    }

    function removeRank(index) {
      if (confirm('Rang wirklich l√∂schen?')) {
        settings.ranks.splice(index, 1);
        populateSettingsUI();
        showNotification('Rang gel√∂scht', 'success');
      }
    }

    async function saveSettings() {
      try {
        await db.collection('hrSettings').doc('settings').set(settings, { merge: true });
        
        updateUnitAndRankSelects();
        closeModal('settingsModal');
        showNotification('Einstellungen gespeichert', 'success');
      } catch (error) {
        console.error('Fehler beim Speichern der Einstellungen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    function updateUnitAndRankSelects() {
      const unitSelects = [
        document.getElementById('unitSelect'),
        document.getElementById('unitSelect2'),
        document.getElementById('newEmployeeUnit'),
        document.getElementById('editEmployeeUnit'),
        document.getElementById('soldatenUnit'),
        document.getElementById('akteUnit'),
        document.getElementById('beobachtungUnit')
      ];

      unitSelects.forEach(select => {
        if (select) {
          const currentValue = select.value;
          select.innerHTML = '<option value="">Unit ausw√§hlen</option>';
          
          if (settings.units && settings.units.length > 0) {
            settings.units.forEach(unit => {
              const option = document.createElement('option');
              option.value = unit.name;
              option.textContent = unit.name;
              select.appendChild(option);
            });
          }
          
          select.value = currentValue;
        }
      });

      const rankSelects = [
        document.getElementById('rankSelect'),
        document.getElementById('rankSelect2'),
        document.getElementById('newEmployeeRank'),
        document.getElementById('editEmployeeRank'),
        document.getElementById('soldatenRank'),
        document.getElementById('akteRank'),
        document.getElementById('beobachtungRank')
      ];

      rankSelects.forEach(select => {
        if (select) {
          const currentValue = select.value;
          select.innerHTML = '<option value="">Rang ausw√§hlen</option>';
          
          if (settings.ranks && settings.ranks.length > 0) {
            settings.ranks.forEach(rank => {
              const option = document.createElement('option');
              option.value = rank.name;
              option.textContent = rank.name;
              select.appendChild(option);
            });
          }
          
          select.value = currentValue;
        }
      });
    }

    // ==================== REALTIME LISTENER SETUP ====================
    function setupRealtimeListeners() {
      const unsubscribeEmployees = db.collection('hrEmployees')
        .orderBy('lastUpdated', 'desc')
        .onSnapshot((snapshot) => {
          employees = [];
          let archivedCount = 0;
          
          snapshot.forEach(doc => {
            const employee = { id: doc.id, ...doc.data() };
            employees.push(employee);
            
            if (employee.status === 'archived') {
              archivedCount++;
            }
          });

          renderEmployeeList();
          updateStats();
          document.getElementById('totalArchived').textContent = archivedCount;
          
          if (currentEmployee) {
            const updatedEmployee = employees.find(emp => emp.id === currentEmployee.id);
            if (updatedEmployee) {
              selectEmployee(updatedEmployee);
            }
          }
          
          setTimeout(updateInductionDisplay, 100);
        }, (error) => {
          console.error('Fehler beim Lauschen auf Mitarbeiter-√Ñnderungen:', error);
          showNotification('Fehler bei Live-Updates', 'error');
        });

      const unsubscribeAkten = db.collection('hrAkten')
        .orderBy('lastUpdated', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          akten = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            akten.push({ 
              id: doc.id, 
              ...data,
              createdFormatted: data.createdFormatted || new Date(data.created).toLocaleDateString('de-DE')
            });
          });
          updateStats();
        }, (error) => {
          console.error('Fehler beim Lauschen auf Akten-√Ñnderungen:', error);
        });

      const unsubscribeSoldaten = db.collection('hrSoldatenGespr√§che')
        .orderBy('created', 'desc')
        .limit(100)
        .onSnapshot((snapshot) => {
          soldatenGespr√§che = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            soldatenGespr√§che.push({ 
              id: doc.id, 
              ...data,
              createdFormatted: data.createdFormatted || new Date(data.created).toLocaleDateString('de-DE'),
              dateFormatted: data.dateFormatted || (data.date ? new Date(data.date).toLocaleDateString('de-DE') : '')
            });
          });
        }, (error) => {
          console.error('Fehler beim Lauschen auf Soldatengespr√§che:', error);
        });

      const unsubscribeSettings = db.collection('hrSettings')
        .doc('settings')
        .onSnapshot((doc) => {
          if (doc.exists) {
            const newSettings = doc.data();
            settings = { ...settings, ...newSettings };
            populateSettingsUI();
            updateUnitAndRankSelects();
          }
        }, (error) => {
          console.error('Fehler beim Lauschen auf Settings:', error);
        });

      const unsubscribeAnkundigungen = db.collection('hrAnkundigungen')
        .onSnapshot((snapshot) => {
          ankundigungen = [];
          snapshot.forEach(doc => {
            const data = doc.data();
            ankundigungen.push({ 
              id: doc.id, 
              ...data
            });
          });
        }, (error) => {
          console.error('Fehler beim Lauschen auf Ank√ºndigungen:', error);
        });

      unsubscribeFunctions = [
        unsubscribeEmployees,
        unsubscribeAkten,
        unsubscribeSoldaten,
        unsubscribeSettings,
        unsubscribeAnkundigungen
      ];
    }

    // ==================== SOLDATENGESPR√ÑCH FUNKTIONEN ====================
    function openSoldatenModal() {
      openModal('soldatenModal');
      updateSoldatenPreview();
    }

    function switchSoldatenTab(tabName) {
      currentSoldatenTab = tabName;
      
      document.querySelectorAll('.soldaten-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.soldaten-tab')[tabName === 'new' ? 0 : 1].classList.add('active');
      
      document.querySelectorAll('.soldaten-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      let tabId = '';
      if (tabName === 'new') tabId = 'soldatenNewTab';
      else tabId = 'soldatenListTab';
      
      document.getElementById(tabId).style.display = 'block';
      
      if (tabName === 'list') {
        renderSoldatenListe();
      }
    }

    function updateSoldatenPreview() {
      const name = document.getElementById('soldatenName').value;
      const dn = document.getElementById('soldatenDN').value;
      const unit = document.getElementById('soldatenUnit').value;
      const rank = document.getElementById('soldatenRank').value;
      const date = document.getElementById('soldatenDate').value;
      const time = document.getElementById('soldatenTime').value;
      const notizen = document.getElementById('soldatenNotizen').value;
      const sonstiges = document.getElementById('soldatenSonstiges').value;

      const formattedDate = date ? new Date(date).toLocaleDateString('de-DE') : '';
      
      // Find Discord IDs for unit and rank
      const unitSetting = settings.units.find(u => u.name === unit);
      const rankSetting = settings.ranks.find(r => r.name === rank);
      
      const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
      const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;
      
      const template = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Soldatengespr√§ch

Name: ${name || ''}
DN: ${dn || ''}
Hauptunit: ${unitDisplay || ''}
Rang: ${rankDisplay || ''}
Datum: ${formattedDate}
Uhrzeit: ${time || ''}
Notizen: ${notizen || ''}
Sonstiges: ${sonstiges || ''}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;

      document.getElementById('soldatenPreview').textContent = template;
    }

    async function copySoldatenTemplate() {
      const template = document.getElementById('soldatenPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Soldatengespr√§ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function saveSoldatenGespr√§ch() {
      const name = document.getElementById('soldatenName').value.trim();
      const dn = document.getElementById('soldatenDN').value;
      const unit = document.getElementById('soldatenUnit').value;
      const rank = document.getElementById('soldatenRank').value;
      const date = document.getElementById('soldatenDate').value;
      const time = document.getElementById('soldatenTime').value;
      const notizen = document.getElementById('soldatenNotizen').value.trim();
      const sonstiges = document.getElementById('soldatenSonstiges').value.trim();

      if (!name || !dn || !date || !time || !notizen) {
        showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const gespr√§ch = {
        id: `SOLDATEN-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        date,
        time,
        notizen,
        sonstiges: sonstiges || '',
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        dateFormatted: new Date(date).toLocaleDateString('de-DE'),
        template: document.getElementById('soldatenPreview').textContent
      };

      try {
        await db.collection('hrSoldatenGespr√§che').doc(gespr√§ch.id).set(gespr√§ch);
        
        showNotification('Soldatengespr√§ch erfolgreich gespeichert', 'success');
        document.getElementById('soldatenName').value = '';
        document.getElementById('soldatenDN').value = '';
        document.getElementById('soldatenUnit').value = '';
        document.getElementById('soldatenRank').value = '';
        document.getElementById('soldatenDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('soldatenTime').value = '';
        document.getElementById('soldatenNotizen').value = '';
        document.getElementById('soldatenSonstiges').value = '';
        updateSoldatenPreview();
        renderSoldatenListe();
        switchSoldatenTab('list');
      } catch (error) {
        console.error('Fehler beim Speichern des Soldatengespr√§chs:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderSoldatenListe() {
      const container = document.getElementById('soldatenListe');
      const searchTerm = document.getElementById('soldatenSearch')?.value.toLowerCase() || '';
      
      let filteredGespr√§che = soldatenGespr√§che;
      if (searchTerm) {
        filteredGespr√§che = soldatenGespr√§che.filter(gespr√§ch => 
          gespr√§ch.name.toLowerCase().includes(searchTerm) || 
          gespr√§ch.dn.toString().includes(searchTerm)
        );
      }
      
      if (filteredGespr√§che.length === 0) {
        container.innerHTML = `
          <div class="empty-soldaten">
            <div class="empty-soldaten-icon"><i class="fas fa-comments"></i></div>
            <div class="empty-soldaten-title">${searchTerm ? 'Keine passenden Gespr√§che gefunden' : 'Keine Gespr√§che gefunden'}</div>
            <div class="empty-description">${searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihr erstes Soldatengespr√§ch'}</div>
          </div>
        `;
        return;
      }

      let html = '';
      filteredGespr√§che.forEach((gespr√§ch, index) => {
        html += `
          <div class="soldaten-item animate-in" style="animation-delay: ${index * 0.05}s">
            <div class="soldaten-item-header">
              <div class="soldaten-item-name">${escapeHtml(gespr√§ch.name)}</div>
              <div class="soldaten-item-dn">DN ${escapeHtml(gespr√§ch.dn)}</div>
            </div>
            <div class="soldaten-item-date">
              <i class="fas fa-calendar"></i> Gespr√§ch am: ${gespr√§ch.dateFormatted} um ${gespr√§ch.time || ''}
            </div>
            <div style="display: flex; gap: 12px; margin-bottom: 12px; flex-wrap: wrap;">
              <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                ${gespr√§ch.unit || 'Keine Unit'}
              </div>
              <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                ${gespr√§ch.rank || 'Kein Rang'}
              </div>
            </div>
            
            <div class="soldaten-item-notizen">
              <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                <i class="fas fa-sticky-note" style="color: var(--warning); font-size: 12px;"></i>
                <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Notizen:</span>
              </div>
              ${escapeHtml(gespr√§ch.notizen.length > 200 ? gespr√§ch.notizen.substring(0, 200) + '...' : gespr√§ch.notizen)}
            </div>
            
            ${gespr√§ch.sonstiges ? `
            <div class="soldaten-item-sonstiges">
              <div style="display: flex; align-items: center; gap: 6px; margin-bottom: 8px;">
                <i class="fas fa-ellipsis-h" style="color: var(--warning); font-size: 12px;"></i>
                <span style="font-weight: 900; color: var(--warning); font-size: 12px;">Sonstiges:</span>
              </div>
              ${escapeHtml(gespr√§ch.sonstiges.length > 200 ? gespr√§ch.sonstiges.substring(0, 200) + '...' : gespr√§ch.sonstiges)}
            </div>
            ` : ''}
            
            <div class="soldaten-item-actions">
              <button class="soldaten-item-btn soldaten-item-btn-copy" onclick="copySoldatenFromList('${gespr√§ch.id}')">
                <i class="fas fa-copy"></i> Kopieren
              </button>
              <button class="soldaten-item-btn soldaten-item-btn-delete" onclick="deleteSoldatenGespr√§ch('${gespr√§ch.id}')">
                <i class="fas fa-trash"></i> L√∂schen
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }  

    function searchSoldaten(searchTerm) {
      renderSoldatenListe();
    }

    async function copySoldatenFromList(gespr√§chId) {
      const gespr√§ch = soldatenGespr√§che.find(g => g.id === gespr√§chId);
      if (!gespr√§ch) return;

      const success = await copyToClipboard(gespr√§ch.template);
      showNotification(success ? 'Soldatengespr√§ch kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function deleteSoldatenGespr√§ch(gespr√§chId) {
      if (!confirm('Soldatengespr√§ch wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) return;

      try {
        await db.collection('hrSoldatenGespr√§che').doc(gespr√§chId).delete();
        
        showNotification('Soldatengespr√§ch gel√∂scht', 'success');
      } catch (error) {
        console.error('Fehler beim L√∂schen des Soldatengespr√§chs:', error);
        showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
      }
    }

    function setupSoldatenEventListeners() {
      const soldatenInputs = document.querySelectorAll('#soldatenName, #soldatenDN, #soldatenUnit, #soldatenRank, #soldatenDate, #soldatenTime, #soldatenNotizen, #soldatenSonstiges');
      soldatenInputs.forEach(input => {
        input.addEventListener('input', updateSoldatenPreview);
      });
    }

    // ==================== BEOBACHTUNGS AKTEN FUNKTIONEN ====================
    function openBeobachtungAktenModal() {
      openModal('beobachtungAktenModal');
      updateBeobachtungPreview();
    }

    function switchBeobachtungTab(tabName) {
      currentBeobachtungTab = tabName;
      
      document.querySelectorAll('.beobachtung-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.beobachtung-tab')[tabName === 'new' ? 0 : tabName === 'list' ? 1 : 2].classList.add('active');
      
      document.querySelectorAll('.beobachtung-tab-content').forEach(content => {
        content.style.display = 'none';
      });
      let tabId = '';
      if (tabName === 'new') tabId = 'beobachtungNewTab';
      else if (tabName === 'list') tabId = 'beobachtungListTab';
      else tabId = 'beobachtungBeobachtungTab';
      
      document.getElementById(tabId).style.display = 'block';
      
      if (tabName === 'list') {
        renderAktenListe();
      }
    }

    function updateBeobachtungPreview() {
      const name = document.getElementById('beobachtungName').value;
      const dn = document.getElementById('beobachtungDN').value;
      const grund = document.getElementById('beobachtungGrund').value;

      // Find Discord IDs for unit and rank if they exist in the akten
      const akte = akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
      const unit = akte?.unit || '';
      const rank = akte?.rank || '';
      
      const unitSetting = settings.units.find(u => u.name === unit);
      const rankSetting = settings.ranks.find(r => r.name === rank);
      
      const unitDisplay = unitSetting?.discordId ? `<@&${unitSetting.discordId}>` : unit;
      const rankDisplay = rankSetting?.discordId ? `<@&${rankSetting.discordId}>` : rank;

      const template = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Beobachtung
Name: ${name || ''}
DN: ${dn || ''}
Unit: ${unitDisplay || ''}
Rang: ${rankDisplay || ''}
Grund: ${grund || ''}
/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;

      document.getElementById('beobachtungPreview').textContent = template;
    }

    async function copyBeobachtungTemplate() {
      const template = document.getElementById('beobachtungPreview').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function createNewAkte() {
      const name = document.getElementById('akteName').value.trim();
      const dn = document.getElementById('akteDN').value;
      const unit = document.getElementById('akteUnit').value;
      const rank = document.getElementById('akteRank').value;

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind erforderlich', 'warning');
        return;
      }

      const existingAkte = akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
      if (existingAkte) {
        showNotification('Eine Akte f√ºr diese Person existiert bereits', 'warning');
        return;
      }

      const akte = {
        id: `AKTE-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        created: new Date().toISOString(),
        createdFormatted: new Date().toLocaleDateString('de-DE'),
        beobachtungen: [],
        lastUpdated: new Date().toISOString()
      };

      try {
        await db.collection('hrAkten').doc(akte.id).set(akte);
        
        showNotification('Akte erfolgreich erstellt', 'success');
        document.getElementById('akteName').value = '';
        document.getElementById('akteDN').value = '';
        document.getElementById('akteUnit').value = '';
        document.getElementById('akteRank').value = '';
        updateStats();
        renderAktenListe();
        switchBeobachtungTab('list');
      } catch (error) {
        console.error('Fehler beim Erstellen der Akte:', error);
        showNotification('Fehler beim Erstellen: ' + error.message, 'error');
      }
    }

    async function saveBeobachtungToAkte() {
      const name = document.getElementById('beobachtungName').value.trim();
      const dn = document.getElementById('beobachtungDN').value;
      const grund = document.getElementById('beobachtungGrund').value.trim();

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind erforderlich', 'warning');
        return;
      }

      if (!grund) {
        showNotification('Bitte geben Sie einen Grund f√ºr die Beobachtung an', 'warning');
        return;
      }

      let akte = akten.find(a => a.dn == dn && a.name.toLowerCase() === name.toLowerCase());
      
      if (!akte) {
        const newAkte = {
          id: `AKTE-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
          name,
          dn,
          unit: '',
          rank: '',
          created: new Date().toISOString(),
          createdFormatted: new Date().toLocaleDateString('de-DE'),
          beobachtungen: [],
          lastUpdated: new Date().toISOString()
        };
        
        try {
          await db.collection('hrAkten').doc(newAkte.id).set(newAkte);
          akte = newAkte;
        } catch (error) {
          console.error('Fehler beim Erstellen der Akte:', error);
          showNotification('Fehler beim Erstellen der Akte: ' + error.message, 'error');
          return;
        }
      }

      const beobachtung = {
        id: `BEO-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`,
        name,
        dn,
        grund,
        date: new Date().toISOString(),
        dateFormatted: new Date().toLocaleDateString('de-DE'),
        template: document.getElementById('beobachtungPreview').textContent
      };

      try {
        if (!akte.beobachtungen) akte.beobachtungen = [];
        akte.beobachtungen.unshift(beobachtung);
        akte.lastUpdated = new Date().toISOString();
        
        await db.collection('hrAkten').doc(akte.id).update({
          beobachtungen: akte.beobachtungen,
          lastUpdated: akte.lastUpdated
        });

        showNotification('Beobachtung zur Akte hinzuf√ºgt', 'success');
        document.getElementById('beobachtungName').value = '';
        document.getElementById('beobachtungDN').value = '';
        document.getElementById('beobachtungGrund').value = '';
        updateBeobachtungPreview();
        updateStats();
        renderAktenListe();
      } catch (error) {
        console.error('Fehler beim Speichern der Beobachtung:', error);
        showNotification('Fehler beim Speichern: ' + error.message, 'error');
      }
    }

    function renderAktenListe() {
      const container = document.getElementById('aktenListe');
      const searchTerm = document.getElementById('aktenSearch')?.value.toLowerCase() || '';
      
      let filteredAkten = akten;
      if (searchTerm) {
        filteredAkten = akten.filter(akte => 
          akte.name.toLowerCase().includes(searchTerm) || 
          akte.dn.toString().includes(searchTerm)
        );
      }
      
      if (filteredAkten.length === 0) {
        container.innerHTML = `
          <div class="empty-beobachtungen">
            <div class="empty-beobachtungen-icon"><i class="fas fa-folder-open"></i></div>
            <div class="empty-beobachtungen-title">${searchTerm ? 'Keine passenden Akten gefunden' : 'Keine Akten gefunden'}</div>
            <div class="empty-description">${searchTerm ? 'Versuchen Sie einen anderen Suchbegriff' : 'Erstellen Sie Ihre erste Akte'}</div>
          </div>
        `;
        return;
      }

      let html = '';
      filteredAkten.forEach((akte, index) => {
        const beobachtungenCount = akte.beobachtungen ? akte.beobachtungen.length : 0;
        
        html += `
          <div class="beobachtung-akte-item animate-in" style="animation-delay: ${index * 0.05}s">
            <div class="beobachtung-akte-header">
              <div class="beobachtung-akte-name">${escapeHtml(akte.name)}</div>
              <div class="beobachtung-akte-dn">DN ${escapeHtml(akte.dn)}</div>
            </div>
            <div class="beobachtung-akte-date">
              <i class="fas fa-calendar"></i> Erstellt: ${akte.createdFormatted}
            </div>
            <div style="display: flex; gap: 12px; margin-bottom: 12px;">
              <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                ${akte.unit || 'Keine Unit'}
              </div>
              <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                ${akte.rank || 'Kein Rang'}
              </div>
            </div>
            <div style="color: var(--gray); font-size: 11px; margin-bottom: 12px; display: flex; align-items: center; gap: 4px;">
              <i class="fas fa-eye"></i> ${beobachtungenCount} Beobachtung${beobachtungenCount !== 1 ? 'en' : ''}
            </div>
        `;

        if (beobachtungenCount > 0) {
          const latestBeobachtung = akte.beobachtungen[0];
          html += `
            <div class="beobachtung-akte-grund">
              <div style="font-size: 11px; color: var(--gray); margin-bottom: 4px;">
                <i class="fas fa-calendar"></i> Letzte Beobachtung: ${latestBeobachtung.dateFormatted}
              </div>
              ${escapeHtml(latestBeobachtung.grund.length > 150 ? latestBeobachtung.grund.substring(0, 150) + '...' : latestBeobachtung.grund)}
            </div>
          `;
        }

        html += `
            <div class="beobachtung-akte-actions">
              <button class="beobachtung-akte-btn beobachtung-akte-btn-copy" onclick="openAkteDetail('${akte.id}')">
                <i class="fas fa-eye"></i> Akte √∂ffnen
              </button>
              <button class="beobachtung-akte-btn beobachtung-akte-btn-delete" onclick="deleteAkte('${akte.id}')">
                <i class="fas fa-trash"></i> L√∂schen
              </button>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function searchAkten(searchTerm) {
      renderAktenListe();
    }

    function openAkteDetail(akteId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte) return;

      let beobachtungenHtml = '';
      if (akte.beobachtungen && akte.beobachtungen.length > 0) {
        akte.beobachtungen.forEach((beobachtung, index) => {
          beobachtungenHtml += `
            <div class="beobachtung-akte-item animate-in" style="animation-delay: ${index * 0.05}s">
              <div class="beobachtung-akte-date">
                <i class="fas fa-calendar"></i> ${beobachtung.dateFormatted}
              </div>
              <div class="beobachtung-akte-grund">
                ${escapeHtml(beobachtung.grund)}
              </div>
              <div class="beobachtung-akte-template">
                ${escapeHtml(beobachtung.template)}
              </div>
              <div class="beobachtung-akte-actions">
                <button class="beobachtung-akte-btn beobachtung-akte-btn-copy" onclick="copyBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                  <i class="fas fa-copy"></i> Kopieren
                </button>
                <button class="beobachtung-akte-btn beobachtung-akte-btn-delete" onclick="deleteBeobachtungFromAkte('${akte.id}', '${beobachtung.id}')">
                  <i class="fas fa-trash"></i> L√∂schen
                </button>
              </div>
            </div>
          `;
        });
      } else {
        beobachtungenHtml = `
          <div class="empty-beobachtungen">
            <div class="empty-beobachtungen-icon"><i class="fas fa-eye"></i></div>
            <div class="empty-beobachtungen-title">Keine Beobachtungen</div>
            <div class="empty-description">F√ºgen Sie die erste Beobachtung hinzu</div>
          </div>
        `;
      }

      const modalHtml = `
        <div class="beobachtung-akten-modal active" onclick="if(event.target===this)closeModal('akteDetailModal')">
          <div class="beobachtung-akten-content">
            <div class="beobachtung-akten-header">
              <div class="beobachtung-akten-title">
                <i class="fas fa-folder-open"></i> Akte: ${escapeHtml(akte.name)} (DN ${escapeHtml(akte.dn)})
              </div>
              <button class="beobachtung-akten-close" onclick="closeModal('akteDetailModal')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="beobachtung-akten-body">
              <div style="display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap;">
                <div style="background: rgba(79,70,229,.10); color: var(--primary-light); padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(79,70,229,.20);">
                  <i class="fas fa-building"></i> ${akte.unit || 'Keine Unit'}
                </div>
                <div style="background: rgba(16,185,129,.10); color: #86efac; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(16,185,129,.20);">
                  <i class="fas fa-user-tie"></i> ${akte.rank || 'Kein Rang'}
                </div>
                <div style="background: rgba(245,158,11,.10); color: #fcd34d; padding: 8px 16px; border-radius: var(--radius-md); font-size: 13px; font-weight: 900; border: 1px solid rgba(245,158,11,.20);">
                  <i class="fas fa-eye"></i> ${akte.beobachtungen ? akte.beobachtungen.length : 0} Beobachtungen
                </div>
              </div>
              
              <div class="beobachtung-akten-liste">
                ${beobachtungenHtml}
              </div>
              
              <div class="beobachtung-actions">
                <button class="beobachtung-btn beobachtung-btn-save" onclick="addNewBeobachtungToAkte('${akte.id}')">
                  <i class="fas fa-plus"></i> Neue Beobachtung hinzuf√ºgen
                </button>
              </div>
            </div>
          </div>
        </div>
      `;

      const modalContainer = document.createElement('div');
      modalContainer.id = 'akteDetailModal';
      modalContainer.innerHTML = modalHtml;
      document.body.appendChild(modalContainer);
      
      // Animation f√ºr die Items
      setTimeout(() => {
        const items = modalContainer.querySelectorAll('.beobachtung-akte-item');
        items.forEach((item, index) => {
          item.style.animationDelay = `${index * 0.1}s`;
        });
      }, 50);
    }

    async function copyBeobachtungFromAkte(akteId, beobachtungId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte || !akte.beobachtungen) return;

      const beobachtung = akte.beobachtungen.find(b => b.id === beobachtungId);
      if (!beobachtung) return;

      const success = await copyToClipboard(beobachtung.template);
      showNotification(success ? 'Beobachtung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function deleteBeobachtungFromAkte(akteId, beobachtungId) {
      if (!confirm('Beobachtung wirklich l√∂schen? Diese Aktion kann nicht r√ºckg√§ngig gemacht werden.')) return;

      const akte = akten.find(a => a.id === akteId);
      if (!akte || !akte.beobachtungen) return;

      try {
        akte.beobachtungen = akte.beobachtungen.filter(b => b.id !== beobachtungId);
        akte.lastUpdated = new Date().toISOString();
        
        await db.collection('hrAkten').doc(akteId).update({
          beobachtungen: akte.beobachtungen,
          lastUpdated: akte.lastUpdated
        });

        showNotification('Beobachtung gel√∂scht', 'success');
        closeModal('akteDetailModal');
        setTimeout(() => openAkteDetail(akteId), 100);
        renderAktenListe();
      } catch (error) {
        console.error('Fehler beim L√∂schen der Beobachtung:', error);
        showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
      }
    }

    async function deleteAkte(akteId) {
      if (!confirm('Akte wirklich l√∂schen? Alle Beobachtungen werden ebenfalls gel√∂scht.')) return;

      try {
        await db.collection('hrAkten').doc(akteId).delete();
        
        showNotification('Akte gel√∂scht', 'success');
      } catch (error) {
        console.error('Fehler beim L√∂schen der Akte:', error);
        showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
      }
    }

    function addNewBeobachtungToAkte(akteId) {
      const akte = akten.find(a => a.id === akteId);
      if (!akte) return;

      closeModal('akteDetailModal');
      openBeobachtungAktenModal();
      switchBeobachtungTab('beobachtung');
      document.getElementById('beobachtungName').value = akte.name;
      document.getElementById('beobachtungDN').value = akte.dn;
      updateBeobachtungPreview();
    }

    // ==================== HAUPTFUNKTIONEN ====================
    function setupEventListeners() {
      document.getElementById('searchEmployees').addEventListener('input', function (e) {
        filterEmployees(e.target.value);
      });

      document.addEventListener('keydown', function (e) {
        if (e.ctrlKey && e.key === 'n') { e.preventDefault(); openNewEmployeeModal(); }
        if (e.ctrlKey && e.key === 'f') { e.preventDefault(); document.getElementById('searchEmployees').focus(); }
        if (e.ctrlKey && e.key === 'e' && currentEmployee) { e.preventDefault(); openEditEmployeeModal(); }
        if (e.ctrlKey && e.key === 'b') { e.preventDefault(); openBeobachtungAktenModal(); }
        if (e.ctrlKey && e.key === 's') { e.preventDefault(); openSoldatenModal(); }
        if (e.ctrlKey && e.key === ',') { e.preventDefault(); openSettingsWithPassword(); }
      });

      window.addEventListener('resize', adjustSidebarHeight);
      
      // Periodisch Partikel neu erstellen
      setInterval(createParticles, 30000);
    }

    function setupFormChangeListeners() {
      const formInputs = document.querySelectorAll('.form-input, .form-select, .form-textarea, .toggle-switch input');
      formInputs.forEach(input => {
        input.addEventListener('input', handleFormChange);
        input.addEventListener('change', handleFormChange);
      });
    }

    function adjustSidebarHeight() {
      const sidebar = document.querySelector('.sidebar');
      const header = document.querySelector('.app-header');
      const windowHeight = window.innerHeight;
      const headerHeight = header.offsetHeight;

      const availableHeight = windowHeight - headerHeight - 40;
      const newHeight = Math.max(availableHeight, 500);
      sidebar.style.height = `${newHeight}px`;
    }

    // ==================== MITARBEITER FUNKTIONEN ====================
    function renderEmployeeList() {
      const container = document.getElementById('employeeList');
      const countElement = document.getElementById('employeeCount');

      let filteredEmployees = getFilteredEmployees();

      filteredEmployees.sort((a, b) => {
        const nameA = (a.name || '').toUpperCase();
        const nameB = (b.name || '').toUpperCase();
        return nameA < nameB ? -1 : nameA > nameB ? 1 : 0;
      });

      if (filteredEmployees.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-icon"><i class="fas fa-user-plus"></i></div>
            <div class="empty-title">${getEmptyStateTitle()}</div>
            <div class="empty-description">${getEmptyStateDescription()}</div>
          </div>
        `;
        countElement.textContent = '0';
        return;
      }

      container.innerHTML = '';
      countElement.textContent = filteredEmployees.length;

      filteredEmployees.forEach((employee, index) => {
        const isArchived = employee.status === 'archived';
        const isActive = currentEmployee?.id === employee.id;
        
        const card = document.createElement('div');
        card.className = `employee-card ${isActive ? 'active' : ''} ${isArchived ? 'archived' : ''} animate-in`;
        card.style.animationDelay = `${index * 0.05}s`;
        card.onclick = () => selectEmployee(employee);
        card.oncontextmenu = (e) => { e.preventDefault(); showEmployeeContextMenu(e, employee); };

        const oralCompleted = employee.inductions?.oral?.completed || false;
        const orgCompleted = employee.inductions?.org?.completed || false;

        card.innerHTML = `
          <div class="employee-top-row">
            <div class="employee-name">${escapeHtml(employee.name || '')}</div>
            <div class="employee-dn">DN ${escapeHtml(employee.dn || '')}</div>
          </div>
          <div class="employee-meta">
            <i class="fas fa-user-tie"></i> ${escapeHtml(employee.rank || 'Kein Rang')} ‚Ä¢
            <i class="fas fa-building"></i> ${escapeHtml(employee.unit || 'Keine Unit')}
          </div>
          <div class="induction-badges">
            <div class="induction-badge badge-oral ${oralCompleted ? 'completed' : 'pending'}">
              <i class="fas ${oralCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              M√ºndlich
            </div>
            <div class="induction-badge badge-org ${orgCompleted ? 'completed' : 'pending'}">
              <i class="fas ${orgCompleted ? 'fa-check-circle' : 'fa-clock'}"></i>
              Organisatorisch
            </div>
          </div>
        `;

        container.appendChild(card);
      });
    }

    function getEmptyStateTitle() {
      if (showArchived) return 'Keine archivierten Mitarbeiter';
      return 'Keine aktiven Mitarbeiter';
    }

    function getFilteredEmployees() {
      let filtered = employees.filter(emp => {
        if (showArchived) {
          return emp.status === 'archived';
        } else {
          return !emp.status || emp.status === 'active';
        }
      });

      if (currentFilter === 'oral') {
        filtered = filtered.filter(emp => !(emp.inductions?.oral?.completed));
      } else if (currentFilter === 'org') {
        filtered = filtered.filter(emp => !(emp.inductions?.org?.completed));
      }
      
      return filtered;
    }

    function getEmptyStateDescription() {
      if (showArchived) {
        if (currentFilter === 'oral') return 'Keine archivierten Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
        if (currentFilter === 'org') return 'Keine archivierten Mitarbeiter mit ausstehender organisatorischer Einweisung';
        return 'Keine archivierten Mitarbeiter gefunden';
      }
      
      if (currentFilter === 'oral') return 'Keine Mitarbeiter mit ausstehender m√ºndlicher Einweisung';
      if (currentFilter === 'org') return 'Keine Mitarbeiter mit ausstehender organisatorischer Einweisung';
      return 'F√ºgen Sie Ihren ersten Mitarbeiter hinzu';
    }

    function filterEmployees(searchTerm) {
      const cards = document.querySelectorAll('.employee-card');
      const term = (searchTerm || '').toLowerCase().trim();

      if (!term) {
        cards.forEach(card => card.style.display = 'flex');
        return;
      }

      cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        card.style.display = text.includes(term) ? 'flex' : 'none';
      });
    }

    function filterEmployeesByType(type) {
      currentFilter = type;

      document.querySelectorAll('.sidebar-filter-btn').forEach(btn => btn.classList.remove('active'));
      if (type === 'all') document.querySelectorAll('.sidebar-filter-btn')[0].classList.add('active');
      if (type === 'oral') document.querySelectorAll('.sidebar-filter-btn')[1].classList.add('active');
      if (type === 'org') document.querySelectorAll('.sidebar-filter-btn')[2].classList.add('active');

      renderEmployeeList();
    }

    function selectEmployee(employee) {
      currentEmployee = employee;

      document.getElementById('employeeHeader').style.display = 'flex';
      document.getElementById('inductionContent').style.display = 'block';

      updateEmployeeHeader();
      loadEmployeeData();
      updateInductionDisplay();
      renderEmployeeList();
    }

    function loadEmployeeData() {
      if (!currentEmployee) return;

      const oralData = currentEmployee.oralData || {};
      const orgData = currentEmployee.orgData || {};
      const isArchived = currentEmployee.status === 'archived';

      document.getElementById('oralDate').value = oralData.date || (new Date().toISOString().split('T')[0]);
      document.getElementById('oralTimeStart').value = oralData.timeStart || '16:40';
      document.getElementById('oralTimeEnd').value = oralData.timeEnd || '18:00';
      document.getElementById('oralPerson').value = oralData.person || '';
      document.getElementById('oralNotes').value = oralData.notes || '';
      document.getElementById('unitSelect').value = oralData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect').value = oralData.rank || currentEmployee.rank || '';

      document.getElementById('orgDate').value = orgData.date || (new Date().toISOString().split('T')[0]);
      document.getElementById('orgTimeStart').value = orgData.timeStart || '22:10';
      document.getElementById('orgTimeEnd').value = orgData.timeEnd || '23:05';
      document.getElementById('orgPerson').value = orgData.person || '';
      document.getElementById('orgNotes').value = orgData.notes || '';
      document.getElementById('unitSelect2').value = orgData.unit || currentEmployee.unit || '';
      document.getElementById('rankSelect2').value = orgData.rank || currentEmployee.rank || '';

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      document.getElementById('oralInductionToggle').checked = oralCompleted;
      document.getElementById('orgInductionToggle').checked = orgCompleted;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);

      const archiveTag = document.getElementById('archiveStatusTag');
      const archiveButton = document.getElementById('archiveButton');
      const archiveButtonText = document.getElementById('archiveButtonText');
      
      if (isArchived) {
        archiveTag.style.display = 'flex';
        archiveButton.style.display = 'inline-flex';
        archiveButtonText.textContent = 'Wiederherstellen';
        document.getElementById('oralInductionToggle').disabled = true;
        document.getElementById('orgInductionToggle').disabled = true;
      } else {
        archiveTag.style.display = 'none';
        archiveButton.style.display = 'inline-flex';
        archiveButtonText.textContent = 'Archivieren';
        document.getElementById('oralInductionToggle').disabled = false;
        document.getElementById('orgInductionToggle').disabled = false;
      }

      checkBothInductionsCompleted();
      updateTemplates();
    }

    function updateInductionDisplay() {
      if (!currentEmployee) return;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      updateInductionUI('oral', oralCompleted);
      updateInductionUI('org', orgCompleted);

      renderEmployeeList();
    }

    function updateEmployeeHeader() {
      if (!currentEmployee) return;

      document.getElementById('currentEmployeeName').textContent = currentEmployee.name || '';
      document.getElementById('currentEmployeeDN').textContent = currentEmployee.dn || '';
      document.getElementById('currentEmployeeUnit').textContent = currentEmployee.unit || 'Keine Unit';
      document.getElementById('currentEmployeeRank').textContent = currentEmployee.rank || 'Kein Rang';
    }

    function updateInductionUI(type, completed) {
      const card = document.getElementById(`${type}InductionCard`);
      const status = document.getElementById(`${type}InductionStatus`);

      if (completed) {
        card.classList.add('completed');
        status.textContent = 'BESTANDEN';
      } else {
        card.classList.remove('completed');
        status.textContent = 'AUSSTEHEND';
      }
    }

    function saveFormData() {
      if (!currentEmployee) return;

      currentEmployee.oralData = {
        date: document.getElementById('oralDate').value,
        timeStart: document.getElementById('oralTimeStart').value,
        timeEnd: document.getElementById('oralTimeEnd').value,
        person: document.getElementById('oralPerson').value,
        notes: document.getElementById('oralNotes').value,
        unit: document.getElementById('unitSelect').value,
        rank: document.getElementById('rankSelect').value
      };

      currentEmployee.orgData = {
        date: document.getElementById('orgDate').value,
        timeStart: document.getElementById('orgTimeStart').value,
        timeEnd: document.getElementById('orgTimeEnd').value,
        person: document.getElementById('orgPerson').value,
        notes: document.getElementById('orgNotes').value,
        unit: document.getElementById('unitSelect2').value,
        rank: document.getElementById('rankSelect2').value
      };

      const unitSelectValue = document.getElementById('unitSelect').value;
      const rankSelectValue = document.getElementById('rankSelect').value;
      if (unitSelectValue) currentEmployee.unit = unitSelectValue;
      if (rankSelectValue) currentEmployee.rank = rankSelectValue;
    }

    async function saveEmployeeData(autoSave = false) {
      if (!currentEmployee) return;

      try {
        const dataToSave = {
          name: currentEmployee.name,
          dn: currentEmployee.dn,
          unit: currentEmployee.unit,
          rank: currentEmployee.rank,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp(),
          inductions: currentEmployee.inductions || {},
          oralData: currentEmployee.oralData || {},
          orgData: currentEmployee.orgData || {},
          status: currentEmployee.status || 'active'
        };

        await db.collection('hrEmployees').doc(currentEmployee.id).set(dataToSave, { merge: true });
        
        return true;
      } catch (error) {
        console.error('Fehler beim Speichern:', error);
        if (!autoSave) {
          showNotification('Fehler beim Speichern: ' + error.message, 'error');
        }
        return false;
      }
    }

    function openEditEmployeeModal() {
      if (!currentEmployee) {
        showNotification('Bitte w√§hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      document.getElementById('editEmployeeName').value = currentEmployee.name || '';
      document.getElementById('editEmployeeDN').value = currentEmployee.dn || '';
      document.getElementById('editEmployeeUnit').value = currentEmployee.unit || '';
      document.getElementById('editEmployeeRank').value = currentEmployee.rank || '';

      openModal('editEmployeeModal');
    }

    async function saveEditedEmployee() {
      if (!currentEmployee) return;

      const name = document.getElementById('editEmployeeName').value.trim();
      const dn = document.getElementById('editEmployeeDN').value;

      if (!name || !dn) {
        showNotification('Name und Dienstnummer sind Pflichtfelder', 'warning');
        return;
      }

      const oldData = { ...currentEmployee };
      
      currentEmployee.name = name;
      currentEmployee.dn = dn;
      currentEmployee.unit = document.getElementById('editEmployeeUnit').value || '';
      currentEmployee.rank = document.getElementById('editEmployeeRank').value || '';

      const success = await saveEmployeeData(false);
      if (success) {
        closeModal('editEmployeeModal');
        updateEmployeeHeader();
        renderEmployeeList();
        updateTemplates(); // WICHTIG: Vorlagen aktualisieren!
        showNotification('Mitarbeiterdaten erfolgreich aktualisiert', 'success');
      }
    }

    async function deleteCurrentEmployee() {
      if (!currentEmployee) {
        showNotification('Bitte w√§hlen Sie zuerst einen Mitarbeiter aus', 'warning');
        return;
      }

      if (!confirm(`Mitarbeiter "${currentEmployee.name}" (DN ${currentEmployee.dn}) wirklich l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden!`)) {
        return;
      }

      try {
        await db.collection('hrEmployees').doc(currentEmployee.id).delete();

        closeModal('editEmployeeModal');
        currentEmployee = null;
        document.getElementById('employeeHeader').style.display = 'none';
        document.getElementById('inductionContent').style.display = 'none';
        renderEmployeeList();
        updateStats();
        showNotification('Mitarbeiter endg√ºltig gel√∂scht', 'success');
      } catch (error) {
        console.error('Fehler beim L√∂schen:', error);
        showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
      }
    }

    function toggleInduction(type, completed) {
      if (!currentEmployee) return;

      if (!currentEmployee.inductions) currentEmployee.inductions = {};

      currentEmployee.inductions[type] = {
        completed: completed,
        date: completed ? new Date().toISOString() : null,
        updatedBy: 'System'
      };

      updateInductionUI(type, completed);
      updateTemplates();
      saveEmployeeData(true);
      checkBothInductionsCompleted();
      renderEmployeeList();
      updateStats();

      const typeName = type === 'oral' ? 'M√ºndliche' : 'Organisatorische';
      const status = completed ? 'bestanden' : 'als ausstehend markiert';
      showNotification(`${typeName} Einweisung ${status}`, 'success');
    }

    function checkBothInductionsCompleted() {
      if (!currentEmployee) return false;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      const nowBothCompleted = oralCompleted && orgCompleted;

      if (nowBothCompleted && !bothInductionsCompleted) {
        bothInductionsCompleted = true;
      } else if (!nowBothCompleted) {
        bothInductionsCompleted = false;
      }

      return nowBothCompleted;
    }

    function updateTemplates() {
      if (!currentEmployee) {
        seedTemplateBoxes();
        return;
      }

      saveFormData();

      const oralTemplate = generateTemplate('oral');
      document.getElementById('oralTemplateContent').textContent = oralTemplate;

      const orgTemplate = generateTemplate('org');
      document.getElementById('orgTemplateContent').textContent = orgTemplate;

      const oralCompleted = currentEmployee.inductions?.oral?.completed || false;
      const orgCompleted = currentEmployee.inductions?.org?.completed || false;

      document.getElementById('oralTemplateBadge').textContent = oralCompleted ? 'BESTANDEN' : 'AUSSTEHEND';
      document.getElementById('orgTemplateBadge').textContent = orgCompleted ? 'BESTANDEN' : 'AUSSTEHEND';

      document.getElementById('oralTemplateCard').classList.toggle('completed', oralCompleted);
      document.getElementById('orgTemplateCard').classList.toggle('completed', orgCompleted);
    }

    function generateTemplate(type) {
      const isOral = type === 'oral';
      const completed = isOral
        ? (currentEmployee.inductions?.oral?.completed || false)
        : (currentEmployee.inductions?.org?.completed || false);

      const data = isOral ? currentEmployee.oralData : currentEmployee.orgData;

      const name = currentEmployee.name || '';
      const dn = currentEmployee.dn || '';

      const unit = isOral
        ? (document.getElementById('unitSelect').value || currentEmployee.unit || '')
        : (document.getElementById('unitSelect2').value || currentEmployee.unit || '');

      const rank = isOral
        ? (document.getElementById('rankSelect').value || currentEmployee.rank || '')
        : (document.getElementById('rankSelect2').value || currentEmployee.rank || '');

      const date = data?.date ? new Date(data.date).toLocaleDateString('de-DE') : '';
      const timeStart = data?.timeStart || '';
      const timeEnd = data?.timeEnd || '';
      const person = data?.person || '';
      const notes = data?.notes || '';

      const timeSeparator = isOral ? 'bis' : '-';

      const unitSetting = settings.units.find(u => u.name === unit);
      const rankSetting = settings.ranks.find(r => r.name === rank);
      
      const unitDiscordId = unitSetting?.discordId || '';
      const rankDiscordId = rankSetting?.discordId || '';

      const unitDisplay = unitDiscordId ? `<@&${unitDiscordId}>` : unit;
      const rankDisplay = rankDiscordId ? `<@&${rankDiscordId}>` : rank;

      return `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
${isOral ? 'M√ºndliche Einweisung' : 'Organisatorische Einweisung'}

Name: ${name}
DN: ${dn}
Hauptunit: ${unitDisplay}
Rang: ${rankDisplay}
Datum: ${date}
Uhrzeit: ${timeStart} ${timeSeparator} ${timeEnd}
Beteiligte: ${person}
Sonstiges: ${notes}

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
    }

    function updateStats() {
      const totalEmployees = employees.filter(emp => !emp.status || emp.status === 'active').length;
      const totalArchived = employees.filter(emp => emp.status === 'archived').length;
      
      document.getElementById('totalEmployees').textContent = totalEmployees;
      document.getElementById('totalArchived').textContent = totalArchived;
      
      let aktenCount = 0;
      employees.forEach(emp => {
        if (emp.beobachtungen && emp.beobachtungen.length > 0) {
          aktenCount += emp.beobachtungen.length;
        }
      });
      document.getElementById('totalAkten').textContent = aktenCount + akten.length;
    }

    function showEmployeeContextMenu(e, employee) {
      e.preventDefault();

      const existingMenu = document.getElementById('contextMenu');
      if (existingMenu) existingMenu.remove();

      const menu = document.createElement('div');
      menu.id = 'contextMenu';
      menu.style.cssText = `
        position: fixed;
        background: rgba(31, 41, 55, 0.95);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: var(--radius-md);
        padding: 8px;
        z-index: 1000;
        min-width: 160px;
        box-shadow: var(--shadow-md);
        animation: fadeInUp 0.2s ease;
      `;

      const isArchived = employee.status === 'archived';
      
      menu.innerHTML = `
        <div style="padding: 8px; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
          <div style="font-weight: 700; color: white; margin-bottom: 2px; font-size: 13px;">${escapeHtml(employee.name || '')}</div>
          <div style="font-size: 11px; color: var(--gray);">DN: ${escapeHtml(employee.dn || '')}</div>
          ${isArchived ? '<div style="font-size: 10px; color: var(--warning); margin-top: 4px;"><i class="fas fa-archive"></i> Archiviert</div>' : ''}
        </div>
        <div style="padding: 4px 0;">
          <button onclick="selectEmployee(employees.find(x => x.id === '${employee.id}')); openEditEmployeeModal(); document.getElementById('contextMenu')?.remove();"
            style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:var(--primary-light);font-weight:700;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;margin-bottom:2px;">
            <i class="fas fa-edit"></i> Bearbeiten
          </button>
          <button onclick="toggleArchiveEmployeeContext('${employee.id}')"
            style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:${isArchived ? 'var(--secondary)' : 'var(--warning)'};font-weight:700;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;margin-bottom:2px;">
            <i class="fas ${isArchived ? 'fa-undo' : 'fa-archive'}"></i> ${isArchived ? 'Wiederherstellen' : 'Archivieren'}
          </button>
          <button onclick="deleteEmployeePermanently('${employee.id}')"
            style="width:100%;text-align:left;padding:8px 10px;background:none;border:none;color:var(--danger);font-weight:700;cursor:pointer;transition:all .2s;border-radius:4px;display:flex;align-items:center;gap:6px;font-size:12px;">
            <i class="fas fa-trash"></i> L√∂schen
          </button>
        </div>
      `;

      menu.style.left = `${Math.min(e.pageX, window.innerWidth - 180)}px`;
      menu.style.top = `${Math.min(e.pageY, window.innerHeight - 240)}px`;

      document.body.appendChild(menu);

      setTimeout(() => {
        const closeMenu = (event) => {
          if (!menu.contains(event.target)) {
            menu.remove();
            document.removeEventListener('click', closeMenu);
          }
        };
        document.addEventListener('click', closeMenu);
      }, 100);
    }

    async function toggleArchiveEmployeeContext(employeeId) {
      const employee = employees.find(emp => emp.id === employeeId);
      if (!employee) return;

      const newStatus = employee.status === 'archived' ? 'active' : 'archived';

      try {
        await db.collection('hrEmployees').doc(employeeId).update({
          status: newStatus,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });

        const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
        showNotification(message, 'success');
        
        document.getElementById('contextMenu')?.remove();
      } catch (error) {
        console.error('Fehler beim Archivieren/Wiederherstellen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    async function deleteEmployeePermanently(employeeId) {
      const employee = employees.find(emp => emp.id === employeeId);
      if (!employee) return;

      if (!confirm(`Mitarbeiter "${employee.name}" (DN ${employee.dn}) wirklich endg√ºltig l√∂schen?\n\nDiese Aktion kann nicht r√ºckg√§ngig gemacht werden!`)) {
        return;
      }

      try {
        await db.collection('hrEmployees').doc(employeeId).delete();

        if (currentEmployee && currentEmployee.id === employeeId) {
          currentEmployee = null;
          document.getElementById('employeeHeader').style.display = 'none';
          document.getElementById('inductionContent').style.display = 'none';
        }
        
        showNotification('Mitarbeiter endg√ºltig gel√∂scht', 'success');
        document.getElementById('contextMenu')?.remove();
      } catch (error) {
        console.error('Fehler beim L√∂schen:', error);
        showNotification('Fehler beim L√∂schen: ' + error.message, 'error');
      }
    }

    async function copyToClipboard(text) {
      try {
        await navigator.clipboard.writeText(text);
        return true;
      } catch (err) {
        try {
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          return true;
        } catch {
          return false;
        }
      }
    }

    async function copyOralTemplate() {
      const template = document.getElementById('oralTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'M√ºndliche Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    async function copyOrgTemplate() {
      const template = document.getElementById('orgTemplateContent').textContent;
      const success = await copyToClipboard(template);
      showNotification(success ? 'Organisatorische Einweisung kopiert' : 'Fehler beim Kopieren', success ? 'success' : 'error');
    }

    function openModal(modalId) {
      document.getElementById(modalId).classList.add('active');
    }

    function closeModal(modalId) {
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.remove('active');
        if (modalId === 'akteDetailModal') {
          setTimeout(() => modal.remove(), 300);
        }
      }
    }

    function openNewEmployeeModal() {
      openModal('newEmployeeModal');
    }

    async function createNewEmployee() {
      const name = document.getElementById('newEmployeeName').value.trim();
      const dn = document.getElementById('newEmployeeDN').value;
      const unit = document.getElementById('newEmployeeUnit').value;
      const rank = document.getElementById('newEmployeeRank').value;

      if (!name || !dn) {
        showNotification('Bitte f√ºllen Sie alle Pflichtfelder aus (*)', 'warning');
        return;
      }

      const employeeId = `EMP-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;

      const newEmployee = {
        id: employeeId,
        name,
        dn,
        unit: unit || '',
        rank: rank || '',
        lastUpdated: new Date().toISOString(),
        inductions: { oral: { completed: false }, org: { completed: false } },
        oralData: { date: '', timeStart: '16:40', timeEnd: '18:00', person: '', notes: '', unit: unit || '', rank: rank || '' },
        orgData: { date: '', timeStart: '22:10', timeEnd: '23:05', person: '', notes: '', unit: unit || '', rank: rank || '' },
        status: 'active'
      };

      try {
        await db.collection('hrEmployees').doc(employeeId).set(newEmployee);

        closeModal('newEmployeeModal');
        selectEmployee(newEmployee);
        updateStats();

        document.getElementById('newEmployeeName').value = '';
        document.getElementById('newEmployeeDN').value = '';
        document.getElementById('newEmployeeUnit').value = '';
        document.getElementById('newEmployeeRank').value = '';

        showNotification(`Mitarbeiter "${name}" erstellt`, 'success');
      } catch (error) {
        console.error('Fehler beim Erstellen:', error);
        showNotification('Fehler beim Erstellen: ' + error.message, 'error');
      }
    }

    function showNotification(message, type = 'info') {
      const notification = document.getElementById('notification');
      const messageElement = document.getElementById('notificationMessage');
      messageElement.textContent = message;

      if (type === 'success') notification.style.background = 'linear-gradient(135deg, var(--secondary), var(--secondary-dark))';
      else if (type === 'error') notification.style.background = 'linear-gradient(135deg, var(--danger), var(--danger-dark))';
      else if (type === 'warning') notification.style.background = 'linear-gradient(135deg, var(--warning), var(--warning-dark))';
      else notification.style.background = 'linear-gradient(135deg, var(--primary), var(--primary-dark))';

      notification.classList.add('show');
      setTimeout(() => notification.classList.remove('show'), 3000);
    }

    function seedTemplateBoxes() {
      document.getElementById('oralTemplateContent').textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
M√ºndliche Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;

      document.getElementById('orgTemplateContent').textContent = `‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
/////////////////////////////////////////////////////////////////////////
Organisatorische Einweisung

Name:
DN:
Hauptunit:
Rang:
Datum:
Uhrzeit:
Beteiligte:
Sonstiges:

/////////////////////////////////////////////////////////////////////////
<@&1097625910242447422>
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;
    }

    function escapeHtml(str) {
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // ==================== SOFT DELETE + ARCHIVIERUNG ====================
    async function toggleArchiveEmployee() {
      if (!currentEmployee) return;

      const newStatus = currentEmployee.status === 'archived' ? 'active' : 'archived';

      try {
        await db.collection('hrEmployees').doc(currentEmployee.id).update({
          status: newStatus,
          lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });

        const message = newStatus === 'archived' ? 'Mitarbeiter archiviert' : 'Mitarbeiter wiederhergestellt';
        showNotification(message, 'success');
      } catch (error) {
        console.error('Fehler beim Archivieren/Wiederherstellen:', error);
        showNotification('Fehler: ' + error.message, 'error');
      }
    }

    function toggleArchiveView() {
      showArchived = !showArchived;
      const buttonText = document.getElementById('archiveToggleText');
      buttonText.textContent = showArchived ? 'Aktive anzeigen' : 'Archiv anzeigen';
      renderEmployeeList();
    }

    function handleFormChange() {
      if (currentEmployee) {
        saveFormData();
        updateTemplates();
        saveEmployeeData(true);
      }
    }
  </script>
</body>
</html>
